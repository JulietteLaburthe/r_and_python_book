<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>An Introduction to R and Python For Data Analysis: A Side By Side Approach</title>
  <meta name="description" content="An Introduction to R and Python For Data Analysis: A Side By Side Approach" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="An Introduction to R and Python For Data Analysis: A Side By Side Approach" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="tbrown122387/r_and_python_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="An Introduction to R and Python For Data Analysis: A Side By Side Approach" />
  
  
  

<meta name="author" content="Taylor R. Brown" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">An Introduction to R and Python For Data Analysis: A Side By Side Approach</h1>
<p class="author"><em>Taylor R. Brown</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#welcome">Welcome</a>
<ul>
<li><a href="#a-sample-course">A Sample Course</a></li>
<li><a href="#licenses">License(s)</a></li>
</ul></li>
<li><a href="#preface">Preface</a>
<ul>
<li><a href="#about-this-book">About this book</a></li>
<li><a href="#conventions">Conventions</a></li>
<li><a href="#installing-the-required-software">Installing the Required Software</a>
<ul>
<li><a href="#installing-r-and-rstudio">Installing R (and RStudio)</a></li>
<li><a href="#installing-python-by-installing-anaconda">Installing Python by Installing Anaconda</a></li>
</ul></li>
</ul></li>
<li><a href="#part-introducing-the-basics">(PART) Introducing the Basics</a></li>
<li><a href="#intro"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#hello-world-in-r"><span class="toc-section-number">1.1</span> Hello World in R</a></li>
<li><a href="#hello-world-in-python"><span class="toc-section-number">1.2</span> Hello World in Python</a></li>
<li><a href="#getting-help"><span class="toc-section-number">1.3</span> Getting Help</a>
<ul>
<li><a href="#reading-documentation"><span class="toc-section-number">1.3.1</span> Reading Documentation</a></li>
<li><a href="#understanding-file-paths"><span class="toc-section-number">1.3.2</span> Understanding File Paths</a></li>
</ul></li>
</ul></li>
<li><a href="#basic-types"><span class="toc-section-number">2</span> Basic Types</a>
<ul>
<li><a href="#basic-types-in-python"><span class="toc-section-number">2.1</span> Basic Types In Python</a>
<ul>
<li><a href="#type-conversions-in-python"><span class="toc-section-number">2.1.1</span> Type Conversions in Python</a></li>
</ul></li>
<li><a href="#basic-types-in-r"><span class="toc-section-number">2.2</span> Basic Types In R</a>
<ul>
<li><a href="#type-conversions-in-r"><span class="toc-section-number">2.2.1</span> Type Conversions in R</a></li>
<li><a href="#rs-simplification"><span class="toc-section-number">2.2.2</span> R’s Simplification</a></li>
</ul></li>
<li><a href="#exercises"><span class="toc-section-number">2.3</span> Exercises</a>
<ul>
<li><a href="#r-questions"><span class="toc-section-number">2.3.1</span> R Questions</a></li>
<li><a href="#python-questions"><span class="toc-section-number">2.3.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#r-vectors-versus-numpy-arrays-and-pandas-series"><span class="toc-section-number">3</span> R <code>vector</code>s versus Numpy <code>array</code>s and Pandas’ <code>Series</code></a>
<ul>
<li><a href="#overview-of-r"><span class="toc-section-number">3.1</span> Overview of R</a></li>
<li><a href="#overview-of-python"><span class="toc-section-number">3.2</span> Overview of Python</a></li>
<li><a href="#vectorization-in-r"><span class="toc-section-number">3.3</span> Vectorization in R</a></li>
<li><a href="#vectorization-in-python"><span class="toc-section-number">3.4</span> Vectorization in Python</a></li>
<li><a href="#indexing-vectors-in-r"><span class="toc-section-number">3.5</span> Indexing Vectors in R</a></li>
<li><a href="#indexing-numpy-arrays"><span class="toc-section-number">3.6</span> Indexing Numpy arrays</a></li>
<li><a href="#indexing-pandas-series"><span class="toc-section-number">3.7</span> Indexing Pandas’ Series</a></li>
<li><a href="#some-gotchas"><span class="toc-section-number">3.8</span> Some Gotchas</a>
<ul>
<li><a href="#shallow-versus-deep-copies"><span class="toc-section-number">3.8.1</span> Shallow versus Deep Copies</a></li>
<li><a href="#how-r-and-python-handle-missing-values"><span class="toc-section-number">3.8.2</span> How R and Python Handle Missing Values</a></li>
</ul></li>
<li><a href="#exercises-1"><span class="toc-section-number">3.9</span> Exercises</a>
<ul>
<li><a href="#r-questions-1"><span class="toc-section-number">3.9.1</span> R Questions</a></li>
<li><a href="#python-questions-1"><span class="toc-section-number">3.9.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#numpy-ndarrays-versus-rs-matrix-and-array-types"><span class="toc-section-number">4</span> Numpy <code>ndarray</code>s Versus R’s <code>matrix</code> and <code>array</code> Types</a>
<ul>
<li><a href="#numpy-ndarrays-in-python"><span class="toc-section-number">4.1</span> Numpy <code>ndarray</code>s In Python</a></li>
<li><a href="#the-matrix-and-array-classes-in-r"><span class="toc-section-number">4.2</span> The <code>matrix</code> and <code>array</code> classes in R</a></li>
<li><a href="#exercises-2"><span class="toc-section-number">4.3</span> Exercises</a>
<ul>
<li><a href="#r-questions-2"><span class="toc-section-number">4.3.1</span> R Questions</a></li>
<li><a href="#python-questions-2"><span class="toc-section-number">4.3.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#rs-lists-versus-pythons-lists-and-dicts"><span class="toc-section-number">5</span> R’s <code>list</code>s Versus Python’s <code>list</code>s and <code>dict</code>s</a>
<ul>
<li><a href="#lists-in-r"><span class="toc-section-number">5.1</span> <code>list</code>s In R</a></li>
<li><a href="#lists-in-python"><span class="toc-section-number">5.2</span> <code>list</code>s In Python</a></li>
<li><a href="#dictionaries-in-python"><span class="toc-section-number">5.3</span> Dictionaries In Python</a></li>
<li><a href="#exercises-3"><span class="toc-section-number">5.4</span> Exercises</a>
<ul>
<li><a href="#r-questions-3"><span class="toc-section-number">5.4.1</span> R Questions</a></li>
<li><a href="#python-questions-3"><span class="toc-section-number">5.4.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#functions"><span class="toc-section-number">6</span> Functions</a>
<ul>
<li><a href="#defining-r-functions"><span class="toc-section-number">6.1</span> Defining R Functions</a></li>
<li><a href="#defining-python-functions"><span class="toc-section-number">6.2</span> Defining Python Functions</a></li>
<li><a href="#more-details-on-rs-user-defined-functions"><span class="toc-section-number">6.3</span> More Details On R’s User-Defined Functions</a></li>
<li><a href="#more-details-on-pythons-user-defined-functions"><span class="toc-section-number">6.4</span> More details on Python’s user-defined functions</a></li>
<li><a href="#function-scope-in-r"><span class="toc-section-number">6.5</span> Function Scope in R</a></li>
<li><a href="#function-scope-in-python"><span class="toc-section-number">6.6</span> Function Scope in Python</a></li>
<li><a href="#modifying-a-functions-arguments"><span class="toc-section-number">6.7</span> Modifying a Function’s Arguments</a>
<ul>
<li><a href="#passing-by-value-in-r"><span class="toc-section-number">6.7.1</span> Passing By Value In R</a></li>
<li><a href="#passing-by-assignment-in-python"><span class="toc-section-number">6.7.2</span> Passing By Assignment In Python</a></li>
</ul></li>
<li><a href="#accessing-and-modifying-captured-variables"><span class="toc-section-number">6.8</span> Accessing and Modifying Captured Variables</a>
<ul>
<li><a href="#accessing-captured-variables-in-r"><span class="toc-section-number">6.8.1</span> Accessing Captured Variables in R</a></li>
<li><a href="#accessing-captured-variables-in-python"><span class="toc-section-number">6.8.2</span> Accessing Captured Variables in Python</a></li>
<li><a href="#modifying-captured-variables-in-r"><span class="toc-section-number">6.8.3</span> Modifying Captured Variables In R</a></li>
<li><a href="#modifying-captured-variables-in-python"><span class="toc-section-number">6.8.4</span> Modifying Captured Variables In Python</a></li>
</ul></li>
<li><a href="#exercises-4"><span class="toc-section-number">6.9</span> Exercises</a>
<ul>
<li><a href="#r-questions-4"><span class="toc-section-number">6.9.1</span> R Questions</a></li>
<li><a href="#python-questions-4"><span class="toc-section-number">6.9.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#categorical-data"><span class="toc-section-number">7</span> Categorical Data</a>
<ul>
<li><a href="#factors-in-r"><span class="toc-section-number">7.1</span> <code>factor</code>s in R</a></li>
<li><a href="#two-options-for-categorical-data-in-pandas"><span class="toc-section-number">7.2</span> Two Options for Categorical Data in Pandas</a></li>
<li><a href="#exercises-5"><span class="toc-section-number">7.3</span> Exercises</a>
<ul>
<li><a href="#r-questions-5"><span class="toc-section-number">7.3.1</span> R Questions</a></li>
<li><a href="#python-questions-5"><span class="toc-section-number">7.3.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#data-frames"><span class="toc-section-number">8</span> Data Frames</a>
<ul>
<li><a href="#data-frames-in-r"><span class="toc-section-number">8.1</span> Data Frames in R</a></li>
<li><a href="#data-frames-in-python"><span class="toc-section-number">8.2</span> Data Frames in Python</a></li>
<li><a href="#exercises-6"><span class="toc-section-number">8.3</span> Exercises</a>
<ul>
<li><a href="#r-questions-6"><span class="toc-section-number">8.3.1</span> R Questions</a></li>
<li><a href="#python-questions-6"><span class="toc-section-number">8.3.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#part-common-tasks-and-patterns">(PART) Common Tasks and Patterns</a></li>
<li><a href="#input-and-output"><span class="toc-section-number">9</span> Input and Output</a>
<ul>
<li><a href="#general-input-considerations"><span class="toc-section-number">9.1</span> General Input Considerations</a></li>
<li><a href="#reading-in-text-files-with-r"><span class="toc-section-number">9.2</span> Reading in Text Files with R</a></li>
<li><a href="#reading-in-text-files-with-pandas"><span class="toc-section-number">9.3</span> Reading in Text Files with Pandas</a></li>
<li><a href="#saving-data-in-r"><span class="toc-section-number">9.4</span> Saving Data in R</a>
<ul>
<li><a href="#writing-out-tabular-plain-text-data-in-r"><span class="toc-section-number">9.4.1</span> Writing Out Tabular Plain Text Data in R</a></li>
<li><a href="#serialization-in-r"><span class="toc-section-number">9.4.2</span> Serialization in R</a></li>
</ul></li>
<li><a href="#saving-data-in-python"><span class="toc-section-number">9.5</span> Saving Data in Python</a>
<ul>
<li><a href="#writing-out-tabular-plain-text-data-in-python"><span class="toc-section-number">9.5.1</span> Writing Out Tabular Plain Text Data in Python</a></li>
<li><a href="#serialization-in-python"><span class="toc-section-number">9.5.2</span> Serialization in Python</a></li>
</ul></li>
<li><a href="#exercises-7"><span class="toc-section-number">9.6</span> Exercises</a>
<ul>
<li><a href="#r-questions-7"><span class="toc-section-number">9.6.1</span> R Questions</a></li>
<li><a href="#python-questions-7"><span class="toc-section-number">9.6.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#using-third-party-code"><span class="toc-section-number">10</span> Using Third-Party Code</a>
<ul>
<li><a href="#installing-packages-in-r"><span class="toc-section-number">10.1</span> Installing Packages In R</a></li>
<li><a href="#installing-packages-in-python"><span class="toc-section-number">10.2</span> Installing Packages In Python</a></li>
<li><a href="#loading-packages-in-r"><span class="toc-section-number">10.3</span> Loading Packages In R</a></li>
<li><a href="#loading-packages-in-python"><span class="toc-section-number">10.4</span> Loading Packages In Python</a>
<ul>
<li><a href="#importing-examples"><span class="toc-section-number">10.4.1</span> <code>import</code>ing Examples</a></li>
</ul></li>
<li><a href="#exercises-8"><span class="toc-section-number">10.5</span> Exercises</a></li>
</ul></li>
<li><a href="#control-flow"><span class="toc-section-number">11</span> Control Flow</a>
<ul>
<li><a href="#conditional-logic"><span class="toc-section-number">11.1</span> Conditional Logic</a></li>
<li><a href="#loops"><span class="toc-section-number">11.2</span> Loops</a></li>
<li><a href="#exercises-9"><span class="toc-section-number">11.3</span> Exercises</a>
<ul>
<li><a href="#r-questions-8"><span class="toc-section-number">11.3.1</span> R Questions</a></li>
<li><a href="#python-questions-8"><span class="toc-section-number">11.3.2</span> Python Questions</a></li>
</ul></li>
</ul></li>
<li><a href="#reshaping-and-combining-data-sets"><span class="toc-section-number">12</span> Reshaping and Combining Data Sets</a>
<ul>
<li><a href="#ordering-and-sorting-data"><span class="toc-section-number">12.1</span> Ordering and Sorting Data</a></li>
<li><a href="#stacking-data-sets-and-placing-them-shoulder-to-shoulder"><span class="toc-section-number">12.2</span> Stacking Data Sets and Placing Them Shoulder to Shoulder</a></li>
<li><a href="#merging-or-joining-data-sets"><span class="toc-section-number">12.3</span> Merging or Joining Data Sets</a></li>
<li><a href="#long-versus-wide-data"><span class="toc-section-number">12.4</span> Long Versus Wide Data</a>
<ul>
<li><a href="#long-versus-wide-in-r"><span class="toc-section-number">12.4.1</span> Long Versus Wide in R</a></li>
<li><a href="#long-versus-wide-in-python"><span class="toc-section-number">12.4.2</span> Long Versus Wide in Python</a></li>
</ul></li>
</ul></li>
<li><a href="#visualization"><span class="toc-section-number">13</span> Visualization</a>
<ul>
<li><a href="#base-r-plotting"><span class="toc-section-number">13.1</span> Base R Plotting</a></li>
<li><a href="#plotting-with-ggplot2"><span class="toc-section-number">13.2</span> Plotting with <code>ggplot2</code></a></li>
<li><a href="#plotting-with-matplotlib"><span class="toc-section-number">13.3</span> Plotting with Matplotlib</a></li>
</ul></li>
<li><a href="#working-with-text-data"><span class="toc-section-number">14</span> Working With Text Data</a>
<ul>
<li><a href="#an-introducton-to-regular-expressions"><span class="toc-section-number">14.1</span> An Introducton to Regular Expressions</a>
<ul>
<li><a href="#literal-characters-versus-metacharacters"><span class="toc-section-number">14.1.1</span> Literal Characters versus Metacharacters</a></li>
<li><a href="#the-trouble-with-backslashes-escape-sequences"><span class="toc-section-number">14.1.2</span> The Trouble With Backslashes: Escape Sequences</a></li>
<li><a href="#more-examples-of-using-regular-expressions"><span class="toc-section-number">14.1.3</span> More Examples of Using Regular Expressions</a></li>
</ul></li>
</ul></li>
<li><a href="#dates-and-times"><span class="toc-section-number">15</span> Dates and Times</a></li>
<li><a href="#running-scripts-from-the-command-line"><span class="toc-section-number">16</span> Running Scripts from the Command Line</a></li>
<li><a href="#part-programming-styles">(PART) Programming Styles</a></li>
<li><a href="#an-introduction-to-object-oriented-programming"><span class="toc-section-number">17</span> An Introduction to Object-Oriented Programming</a>
<ul>
<li><a href="#oop-in-python"><span class="toc-section-number">17.1</span> OOP In Python</a>
<ul>
<li><a href="#overview"><span class="toc-section-number">17.1.1</span> Overview</a></li>
<li><a href="#a-first-example"><span class="toc-section-number">17.1.2</span> A First Example</a></li>
<li><a href="#adding-inheritance"><span class="toc-section-number">17.1.3</span> Adding Inheritance</a></li>
<li><a href="#adding-in-composition"><span class="toc-section-number">17.1.4</span> Adding in Composition</a></li>
</ul></li>
<li><a href="#oop-in-r"><span class="toc-section-number">17.2</span> OOP In R</a>
<ul>
<li><a href="#s3-objects-the-big-picture"><span class="toc-section-number">17.2.1</span> S3 objects: The Big Picture</a></li>
<li><a href="#using-s3-objects"><span class="toc-section-number">17.2.2</span> Using S3 objects</a></li>
<li><a href="#creating-s3-objects"><span class="toc-section-number">17.2.3</span> Creating S3 objects</a></li>
<li><a href="#s4-objects-the-big-picture"><span class="toc-section-number">17.2.4</span> S4 objects: The Big Picture</a></li>
<li><a href="#using-s4-objects"><span class="toc-section-number">17.2.5</span> Using S4 objects</a></li>
<li><a href="#creating-s4-objects"><span class="toc-section-number">17.2.6</span> Creating S4 objects</a></li>
<li><a href="#reference-classes-the-big-picture"><span class="toc-section-number">17.2.7</span> Reference Classes: The Big Picture</a></li>
<li><a href="#creating-reference-classes"><span class="toc-section-number">17.2.8</span> Creating Reference Classes</a></li>
<li><a href="#creating-r6-classes"><span class="toc-section-number">17.2.9</span> Creating R6 Classes</a></li>
</ul></li>
<li><a href="#exercises-10"><span class="toc-section-number">17.3</span> Exercises</a></li>
</ul></li>
<li><a href="#functional-programming"><span class="toc-section-number">18</span> Functional Programming</a>
<ul>
<li><a href="#functions-as-function-inputs-in-r"><span class="toc-section-number">18.1</span> Functions as Function Inputs in R</a>
<ul>
<li><a href="#sapply-and-vapply"><span class="toc-section-number">18.1.1</span> <code>sapply()</code> and <code>vapply()</code></a></li>
<li><a href="#lapply"><span class="toc-section-number">18.1.2</span> <code>lapply()</code></a></li>
<li><a href="#apply"><span class="toc-section-number">18.1.3</span> <code>apply()</code></a></li>
<li><a href="#tapply"><span class="toc-section-number">18.1.4</span> <code>tapply()</code></a></li>
<li><a href="#mapply"><span class="toc-section-number">18.1.5</span> <code>mapply()</code></a></li>
<li><a href="#reduce-and-do.call"><span class="toc-section-number">18.1.6</span> <code>Reduce()</code> and <code>do.call()</code></a></li>
</ul></li>
<li><a href="#another-example-in-r"><span class="toc-section-number">18.2</span> Another Example in R</a></li>
<li><a href="#functions-as-function-inputs-in-base-python"><span class="toc-section-number">18.3</span> Functions as Function Inputs in Base Python</a>
<ul>
<li><a href="#map"><span class="toc-section-number">18.3.1</span> <code>map()</code></a></li>
<li><a href="#filter"><span class="toc-section-number">18.3.2</span> <code>filter()</code></a></li>
</ul></li>
<li><a href="#functions-as-function-inputs-in-numpy"><span class="toc-section-number">18.4</span> Functions as Function Inputs in Numpy</a></li>
<li><a href="#functional-methods-in-pandas"><span class="toc-section-number">18.5</span> Functional Methods in Pandas</a></li>
<li><a href="#functions-as-function-inputs-miscellany"><span class="toc-section-number">18.6</span> Functions as Function Inputs (miscellany)</a></li>
<li><a href="#functions-as-function-outputs-in-r"><span class="toc-section-number">18.7</span> Functions as Function Outputs in R</a></li>
<li><a href="#functions-as-function-outputs-in-python"><span class="toc-section-number">18.8</span> Functions as Function Outputs in Python</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Introduction to R and Python For Data Analysis: A Side By Side Approach</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="welcome" class="section level1 unnumbered">
<h1 class="unnumbered">Welcome</h1>
<div id="a-sample-course" class="section level2 unnumbered">
<h2 class="unnumbered">A Sample Course</h2>
<p>Please email me for access to a private Github repository with course materials such as a syllabus, course schedule, and assignments.</p>
<p>You will notice that some of the exercise questions are unusually specific. For example, they will ask the student to assign the answer in a certain form to a variable with a very specific name. This is because they are written with automatic grading in mind. All of exercises have been very generously “battle tested” by the Fall 2021 STAT 5430 class at the University of Virginia. R scripts were graded with the <code>gradeR</code> package <span class="citation">(<a href="#ref-gradeR" role="doc-biblioref">Brown 2020</a>)</span>, and Python scripts with the <a href="https://otter-grader.readthedocs.io/en/latest/"><code>Otter-Grader</code> library</a> <span class="citation">(<a href="#ref-otter" role="doc-biblioref">Pyles 2019</a>)</span>.</p>
</div>
<div id="licenses" class="section level2 unnumbered">
<h2 class="unnumbered">License(s)</h2>
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />The textbook is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>. The code used to generate the text is licensed under a Creative Commons Zero v1.0 Universal license.</p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="preface" class="section level1 unnumbered">
<h1 class="unnumbered">Preface</h1>
<div id="about-this-book" class="section level2 unnumbered">
<h2 class="unnumbered">About this book</h2>
<p>This book is written to be used in a computing class that teaches both R and Python to graduate students in a statistics or data science department. This book is written for students that do not necessarily possess any previous familiarity with writing code.</p>
<ul>
<li><p>If you are using them for analyzing data, R and Python do a lot of the same things in pretty similar ways, so it does not always make sense to either a.) teach one language after the other, or b.) choose one over the other. The side-by-side approach helps to teach/learn more, save time, and reinforce shared concepts and key differences.</p></li>
<li><p>This text does not describe statistical modeling techniques in detail, but many exercises will ask students to implement them. These exercises will not assume mathematical familiarity. The objective is to test programming ability, and an added benefit is that the work might be useful later in their careers.</p></li>
<li><p>This book is written for aspiring data scientists, not necessarily aspiring software developers. Why do I draw the distinction? When discussing different types, for example, I do not discuss data structures in any depth. Rather, I discuss examples of applications where different types would be most useful.</p></li>
<li><p>Generally speaking, chapters should be read in order, but occasionally skipping ahead can be beneficial. Later chapters are more may assume some familiarity with previous chapters. Also, within a chapter’s section, sometimes a discussion for a particular topic in Python, say, might follow a discussion about the same topic in R. In this case, the later section will often assume that the previous section has been read first.</p></li>
</ul>
</div>
<div id="conventions" class="section level2 unnumbered">
<h2 class="unnumbered">Conventions</h2>
<p>Sometimes R and Python code look very similar, or even identical. This is why I usually separate R and Python code into separate sections. However, sometimes I do not, so whenever it is necessary to prevent confusion, I will remind you what language is being used in comments (more about comments in @ref(hello-world-in-python) ).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in python</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;hello world&#39;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">## hello world</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;hello world&#39;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;hello world&quot;</span></span></code></pre></div>
</div>
<div id="installing-the-required-software" class="section level2 unnumbered">
<h2 class="unnumbered">Installing the Required Software</h2>
<p>To get started, you must install both R and Python. The installation process depends on what kind of machine you have (e.g. what type of operating system your machine is running, is your processor <span class="math inline">\(32\)</span> or <span class="math inline">\(64\)</span> bit, etc.).</p>
<p>Below, I suggest running R with RStudio, and Python with Anaconda, and I provide some helpful links. I suggest downloading these two bundles separately; however, I should note that the recommendation below is not the only installation method. For example:
- one can run R and Python without downloading RStudio or Anaconda,
- one can install RStudio with Anaconda,
- one can run Python from within Rstudio,
- one can run Python from within Rstudio that is managed by Anaconda, etc., and
- options and procedures are very likely to change over time.</p>
<p>Instructors can prefer alternative strategies, if they wish. If they do, they should verify that Python’s version is <code>&gt;=3.6</code>, and R’s is <code>&gt;=4.0.0</code>. If so, all the code in this book should run.</p>
<div id="installing-r-and-rstudio" class="section level3 unnumbered">
<h3 class="unnumbered">Installing R (and RStudio)</h3>
<p>It is recommended that you install R and <em>RStudio Desktop</em>. <em>RStudio Desktop</em> is a graphical user interface with many tools that making writing R easier and more fun.</p>
<p>Install R from the Comprehensive R Archive Network (CRAN). You can access instructions for your specific machine by clicking <a href="https://cran.r-project.org/">here.</a></p>
<p>You can get RStudio Desktop directly from the <a href="https://www.rstudio.com/products/rstudio/download/#download">company’s website</a>.</p>
</div>
<div id="installing-python-by-installing-anaconda" class="section level3 unnumbered">
<h3 class="unnumbered">Installing Python by Installing Anaconda</h3>
<p>It is recommended that you install <em>Anaconda</em>, which is a package manager, environment manager, and Python distribution with many third party open source packages. It provides a graphical user interface for us, too, just as RStudio does. You can access instructions for your specific machine and OS by clicking <a href="https://docs.anaconda.com/anaconda/install/#">here</a>.</p>
<!--chapter:end:preface.Rmd-->
</div>
</div>
</div>
<div id="part-introducing-the-basics" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Introducing the Basics</h1>
</div>
<div id="intro" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Now that you have both R and Python installed, we can get started by taking a tour of our two different <strong>integrated development environments environments</strong> (IDEs) RStudio and Spyder.</p>
<p>In addition, I will also discuss a few topics superficially, so that we can get our feet wet:</p>
<ul>
<li>printing,</li>
<li>creating variables, and</li>
<li>calling functions.</li>
</ul>
<div id="hello-world-in-r" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Hello World in R</h2>
<p>Go ahead and open up RStudio. It should look something like this</p>
<div class="figure" style="text-align: center">
<img src="pics/rstudio.png" alt="RStudio" width="80%" />
<p class="caption">
(#fig:rstudio)RStudio
</p>
</div>
<p>I changed my “Editor Theme” from the default to “Cobalt” because it’s easier on my eyes. If you are opening RStudio for the first time, you probably see a lot more white. You can play around with the theme, if you wish, after going to <code>Tools -&gt; Global Options -&gt; Appearance</code>.</p>
<p>The <strong>console</strong>, which is located by default on the lower left panel, is the place that all of your code gets run. For short one-liners, you can type code directly into the console. Try typing the following code in there. Here we are making use of the <code>print()</code> function.</p>
<div class="rmd-details">
<p>In R, functions are “first-class objects,” which means can refer to the name of a function without asking it to do anything. However, when we <em>do</em> want to use it, we put parentheses after the name. This is called <strong>calling</strong> the function or <strong>invoking</strong> the function. If a function call takes any <strong>arguments</strong> (aka inputs), then the programmer supplies them between the two parentheses. A function may <strong>return</strong> values to be subsequently used, or it may just produce a “side-effect” such as printing some text, displaying a chart, or read/writing information to an external data source.</p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;hello R world&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;hello R world&quot;</span></span></code></pre></div>
<p>During the semester, we will write more complicated code. Complicated code is usually written incrementally and stored in a text file called a <strong>script</strong>. Click <code>File -&gt; New File -&gt; R Script</code> to create a new script. It should appear at the top left of the RStudio window (see Figure @ref(fig:rstudio) ) . After that, copy and paste the following code into your script window.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;hello world&#39;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;this program&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;is not incredibly interesting&#39;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;but it would be a pain&#39;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;to type it all directly into the console&#39;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>myName <span class="ot">&lt;-</span> <span class="st">&quot;Taylor&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(myName)</span></code></pre></div>
<p>This script will run five print statements, and then create a variable called <code>myName</code>. The print statements are of no use to the computer and will not affect how the program runs. They just display messages to the human running the code.</p>
<p>The variable created on the last line is more important because it is used by the computer, and so it can affect how the program runs. The operator <code>&lt;-</code> is the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/assignOps.html"><strong>assignment operator</strong></a>. It takes the character constant <code>"Taylor"</code>, which is on the right, and stores it under the name <code>myName</code>. If we added lines to this program, we could refer to the variable <code>myName</code> in subsequent calculations.</p>
<p>Save this file wherever you want on your hard drive. Call it <code>awesomeScript.R</code>. Personally, I saved it to my desktop.</p>
<p>After we have a saved script, we can run it by sending all the lines of code over to the console. One way to do that is by clicking the <code>Source</code> button at the top right of the script window (see Figure @ref(fig:rstudio) ).</p>
<p>Another way is that we can use R’s <code>source()</code> function. We can run the following code in the console.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Anything coming after the pound/hash-tag symbol </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># is a comment to the human programmer.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># These lines are ignored by R</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;/home/taylor/Desktop/&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;awesomeScript.R&quot;</span>)</span></code></pre></div>
<p>The first line changes the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/getwd.html"><strong>working directory</strong></a> to <code>Desktop/</code>. You, dear reader, should change this line by replacing <code>Desktop/</code> to whichever folder you chose to save <code>awesomeScript.R</code> in. If you would like to find out what your working directory is currently set to, you can use <code>getwd()</code>.</p>
<div class="rmd-details">
<p>Every computer has a different folder/directory structure–that is why it is highly recommended you refer to file locations as seldom as possible in your scripts. This makes your code more <em>portable.</em> When you send your file to someone else (e.g. your instructor or your boss), she will have to remove or change every mention of any directory. This is because those directories (probably) won’t exist on her machine.</p>
</div>
<p>The second line calls <code>source()</code>. This function finds the script file and executes all the commands found in that file sequentially.</p>
<p>A third way is to tell R to run <code>awesomeScript.R</code> from the command line. We will describe this approach in more detail in section @ref(running-scripts-from-the-command-line)</p>
<!---
---------------------------------------------------------------------------
-->
</div>
<div id="hello-world-in-python" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> Hello World in Python</h2>
<p>First, start by opening <em>Anaconda Navigator</em>. It should look something like this:</p>
<div class="figure" style="text-align: center">
<img src="pics/anaconda_navigator.png" alt="Anaconda Navigator" width="80%" />
<p class="caption">
(#fig:anaconda-navigator)Anaconda Navigator
</p>
</div>
<p>Recall that we will exclusively assume the use of <em>Spyder</em> in this textbook. Open that up now. It should look something like this:</p>
<div class="figure" style="text-align: center">
<img src="pics/spyder_screenshot.png" alt="Spyder" width="80%" />
<p class="caption">
(#fig:spyder)Spyder
</p>
</div>
<p>It looks a lot like RStudio, right? The script window is still on the left hand side, but it takes up the whole height of the window this time. However, you will notice that the console window has moved. It’s over on the bottom right now.</p>
<p>Again, you might notice a lot more white when you open this for the first time. Just like last time, I changed my color scheme. You can change yours by going to <code>Tools -&gt; Preferences</code> and then exploring the options available under the <code>Appearances</code> tab.</p>
<p>Try typing the following line of code into the console.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this looks like R code but it&#39;s Python code!</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;hello Python world&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">## hello Python world</span></span></code></pre></div>
<p>Already we have many similarities between our two languages. Both R and Python have a <code>print()</code> function, and they both use the same symbol to start a comment: <code>#</code>. Finally, they both define character/string constants with quotation marks In both languages, you can use either single or double quotes.</p>
<p>We will also show below that both languages share the same three ways to run scripts. Nice!</p>
<p>Let’s try writing our first Python script. R scripts end in <code>.r</code> or <code>.R</code>, while Python scripts end in <code>.py</code>. Call this file <code>awesomeScript.py</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save this as awesomeScript.py</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;hello world&#39;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;this program&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;is pretty similar to the last program&#39;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;it is not incredibly interesting, either&#39;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>my_name <span class="op">=</span> <span class="st">&quot;Taylor&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_name)</span></code></pre></div>
<p>Notice that the assignment operator is different in Python. It’s an <code>=</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>Just like RStudio, Spyder has a button that runs the entire script from start to finish. It’s the green triangle button (see Figure @ref(fig:spyder) ).</p>
<p>You can also write code to run <code>awesomeScript.py</code>. There are a few ways to do this, but here’s the easiest.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">&#39;/home/taylor/Desktop&#39;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>runfile(<span class="st">&quot;awesomeScript.py&quot;</span>)</span></code></pre></div>
<p>This is also pretty similar to the R code from before. <code>os.chdir()</code> sets our working directory to the <code>Desktop</code>. Then <code>runfile()</code> runs all of the lines in our program, sequentially, from start to finish.</p>
<p>The first line is new, though. We did not mention anything like this in R, yet. We will talk more about <code>import</code>ing modules in section @ref(loading-packages-in-python). Suffice it to say that we imported the <code>os</code> module to make the <code>chdir()</code> function available to us.</p>
<p>Third, we can tell Python to run <code>awesomeScript.py</code> from the command line. We will describe this approach in more detail in chapter @(running-scripts-from-the-command-line)</p>
</div>
<div id="getting-help" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> Getting Help</h2>
<div id="reading-documentation" class="section level3" number="1.3.1">
<h3 number="1.3.1"><span class="header-section-number">1.3.1</span> Reading Documentation</h3>
<p>Programming is not about memorization. Nobody can memorize, for example, every function and all of its arguments. So what do programmers do when they get stuck? The primary way is to find and read the documentation.</p>
<p>Getting help in R is easy. If you want to know more about a function, type into the console the name of the function with a leading question mark. For example, <code>?print</code> or <code>?setwd</code>. You can also use <code>help()</code> and <code>help.search()</code> to find out more about functions (e.g. <code>help(print)</code>). Sometimes you will need to put quotation marks around the name of the function (e.g. <code>?":"</code>).</p>
<p>This will not open a separate web browser window, which is very convenient. If you are using RStudio, you have some extra benefits. Everything will look very pretty, and you can search through the text by typing phrases into the search bar in the “Help” window.</p>
<p>In Python, the question mark comes <em>after</em> the name of the function<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> (e.g. <code>print?</code>), and you can use <code>help(print)</code> just as in R.</p>
<p>In Spyder, if you want the documentation to appear in the Help window (it looks prettier), then you can type the name of the function, and then <code>Ctrl-i</code> (<code>Cmd-i</code> on a mac keyboard).</p>
</div>
<div id="understanding-file-paths" class="section level3" number="1.3.2">
<h3 number="1.3.2"><span class="header-section-number">1.3.2</span> Understanding File Paths</h3>
<p>File paths look different on different operating systems. Mac and Linux machines tend to have forward slashes (i.e. <code>/</code>), while Windows machines tend to use backslashes (i.e. <code>\</code>).</p>
<p>Depending on what kind of operating system is running your code, you will need to change the file paths. It is important for everyone writing R and Python code to understand how things work on both types of machines–just because you’re writing code on a Windows machine doesn’t mean that it won’t be run on a Mac, or vice versa.</p>
<p>The directory repeatedly mentioned in the code above was <code>/home/taylor/Desktop</code>. This is a directory on my machine which is running Ubuntu Linux. The leading forward slash is the <em>root directory</em>. Inside that is the directory <code>home/</code>, and inside that is <code>taylor/</code>, and inside that is <code>Desktop/</code>. If you are running MacOS, these file paths will look very similar. The folder <code>home/</code> will most likely be replaced with <code>Users/</code>.</p>
<p>On Windows, things are a bit different. For one, a full path starts with a drive (e.g. <code>C:</code>). Second, there are backslashes (not forward slashes) to separate directory names (e.g <code>C:\Users\taylor\Desktop</code>).</p>
<p>Unfortunately, backslashes are a special character in both R and Python. Whenever you type a <code>\</code>, it will change the meaning of whatever comes after it. In other words, <code>\</code> is known as an <strong>escape character</strong>.</p>
<div class="rmd-details">
<p>In both R and Python, the backslash character is used to start an “escape” sequence. You can see some examples in R by clicking <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Quotes.html">here</a>, and some examples in Python by clicking <a href="https://docs.python.org/3/reference/lexical_analysis.html">here</a>. In Python it may also be used to <a href="https://docs.python.org/3/reference/lexical_analysis.html#explicit-line-joining">allow long lines of code to take up more than one line in a text file.</a></p>
</div>
<p>The recommended way of handling this is to just use forward slashes instead. For example, if you are running Windows, <code>C:/Users/taylor/Desktop/myScript.R</code> will work in R, and <code>C:/Users/taylor/Desktop/myScript.py</code> will work in Python.</p>
<p>You may also use “raw string constants” (e.g. <code>r'C:\Users\taylor\Desktop\my_file.txt'</code> ). “Raw” means that <code>\</code> will be treated as a literal character instead of an escape character.</p>
<p>Alternatively, you can “escape” the backslashes by replacing each single backslash with a double backslash.</p>
<!-- ## Exercises -->
<!-- ### Discussion -->
<!-- 1. What are some similarities between R and Python? Which of these are you most thankful for? Which of them are you most concerned about? -->
<!-- 2. What are some major differences between R and Python? What do you think about these differences? -->
<!-- ### Easy -->
<!-- 1. Create an R script called `my_script.R`. Inside that file,  -->
<!--     + create a variable called `myName` and assign your name to it.  -->
<!--     + create another variable called `myFavNum` and assign to it your favorite number. -->
<!--     + create a variable called `rMessage` and assign to it the following phrase `"camelCase is cool for naming variables in R"`  -->
<!-- 2. Create a Python script called `my_script.py`. Inside that file -->
<!--     + create a variable called `my_name` and assign your name to it.  -->
<!--     + create another variable called `my_fav_num` and assign to it your favorite number. -->
<!--     + create a variable called `py_message` and assign to it the following phrase `"snake_case is cool for naming variables in Python"`^[More suggestions on writing stylish Python code can be found [here](https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds). Regarding my suggesting camel case, [other style guides](https://style.tidyverse.org/syntax.html#object-names) disagree with this. Don't worry about this too much, though--after all "a foolish consistency is the hobgoblin of little minds."]  -->
<!--chapter:end:01-intro.Rmd-->
</div>
</div>
</div>
<div id="basic-types" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Basic Types</h1>
<p>In every programming language, data is stored in different ways. Writing a program that manipulates data requires understanding all of the choices. That is why we must be concerned with the different <strong>types</strong> of data in our R and Python programs. Different types are suitable for different purposes.</p>
<p>There are similarities between Python’s and R’s type systems. However, there are may differences as well. Be prepared for these differences. There are many more of them in this chapter than there were in the previous chapter!</p>
<p>If you’re ever unsure what type a variable has, use <code>type()</code> (in Python) or <code>typeof()</code> (in R) to query it.</p>
<p>Storing an individual piece of information is simple in both languages. However, while Python has scalar types, R does not draw as strong of a distinction between scalar and compound types.</p>
<div id="basic-types-in-python" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Basic Types In Python</h2>
<p>In Python, the simplest types we frequently use are <code>str</code> (short for string), <code>int</code> (short for integer), <code>float</code> (short for floating point) and <code>bool</code> (short for Boolean). This list is not exhaustive, but these are a good collection to start thinking about. For a complete list of built-in types in Python, click <a href="https://docs.python.org/3/library/stdtypes.html">here</a>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(<span class="st">&#39;a&#39;</span>), <span class="bu">type</span>(<span class="dv">1</span>), <span class="bu">type</span>(<span class="fl">1.3</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;str&#39;&gt; &lt;class &#39;int&#39;&gt; &lt;class &#39;float&#39;&gt;</span></span></code></pre></div>
<p>Strings are useful for processing text data such as names of people/places/things and messages such as texts, tweets and emails. If you are dealing with numbers, you need floating points if you have a number that might have a fractional part after its decimal; otherwise you’ll need an integer. Booleans are useful for situations where you need to record whether something is true or false. They are also important to understand for control-flow in section @ref(control-flow).</p>
<p>In the next section we will discuss the Numpy library. This library has a <a href="https://numpy.org/doc/stable/user/basics.types.html">broader collection</a> of basic types that allows for finer control over any script you write.</p>
<div id="type-conversions-in-python" class="section level3" number="2.1.1">
<h3 number="2.1.1"><span class="header-section-number">2.1.1</span> Type Conversions in Python</h3>
<p>We will often have to convert between types in a Python program. This is called <strong>type conversion</strong>, and it can be either implicitly or explicitly done.</p>
<p>For example, <code>int</code>s are often implicitly converted to <code>float</code>s, so that arithmetic operations work.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>my_int <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>my_float <span class="op">=</span> <span class="fl">3.2</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>my_sum <span class="op">=</span> my_int <span class="op">+</span> my_float</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;my_int&#39;s type&quot;</span>, <span class="bu">type</span>(my_int))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">## my_int&#39;s type &lt;class &#39;int&#39;&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;my_float&#39;s type&quot;</span>, <span class="bu">type</span>(my_float))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">## my_float&#39;s type &lt;class &#39;float&#39;&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_sum)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 4.2</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;my_sum&#39;s type&quot;</span>, <span class="bu">type</span>(my_sum))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">## my_sum&#39;s type &lt;class &#39;float&#39;&gt;</span></span></code></pre></div>
<p>You might be disappointed if you always count on this behavior, though.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fl">3.2</span> <span class="op">+</span> <span class="st">&quot;3.2&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: unsupported operand type(s) for +: &#39;float&#39; and &#39;str&#39;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Detailed traceback:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></span></code></pre></div>
<p>Explicit conversions occur when we as programmers explicitly ask Python to perform a conversion. We will do this with the functions such as <code>int()</code>, <code>str()</code>, <code>float()</code>, and <code>bool()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>my_date <span class="op">=</span> <span class="st">&quot;5/2/2021&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>month_day_year <span class="op">=</span> my_date.split(<span class="st">&#39;/&#39;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>my_year <span class="op">=</span> <span class="bu">int</span>(month_day_year[<span class="op">-</span><span class="dv">1</span>]) </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;my_year is equal to &#39;</span>, my_year, <span class="st">&#39;and its type is &#39;</span>, <span class="bu">type</span>(my_year))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">## my_year is equal to  2021 and its type is  &lt;class &#39;int&#39;&gt;</span></span></code></pre></div>
</div>
</div>
<div id="basic-types-in-r" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Basic Types In R</h2>
<p>In R, the names of basic types are only slightly different. They are <code>logical</code> (instead of <code>bool</code>), <code>integer</code> (instead of <code>int</code>), <code>double</code> or <code>numeric</code> (instead of <code>float</code>)<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>, <code>character</code> (instead of <code>str</code>), <code>complex</code> (for calculations involving imaginary numbers), and <code>raw</code> (useful for working with bytes).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cat() is kind of like print()</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">typeof</span>(<span class="st">&#39;a&#39;</span>), <span class="fu">typeof</span>(<span class="dv">1</span>), <span class="fu">typeof</span>(<span class="fl">1.3</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## character double double</span></span></code></pre></div>
<p>In this case R automatically upgraded <code>1</code> to a double. If you wanted to force it to be an integer, you can add a capital “L” to the end of the number.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cat() is kind of like print()</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">typeof</span>(<span class="st">&#39;a&#39;</span>), <span class="fu">typeof</span>(1L), <span class="fu">typeof</span>(<span class="fl">1.3</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">## character integer double</span></span></code></pre></div>
<div id="type-conversions-in-r" class="section level3" number="2.2.1">
<h3 number="2.2.1"><span class="header-section-number">2.2.1</span> Type Conversions in R</h3>
<p>You can explicitly and implicitly convert types in R just as you did in Python. Implicit conversion looks like this.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>myInt <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>myDouble <span class="ot">=</span> <span class="fl">3.2</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>mySum <span class="ot">=</span> myInt <span class="sc">+</span> myDouble</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;my_int&#39;s type is &quot;</span>, <span class="fu">typeof</span>(myInt)))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;my_int&#39;s type is double&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;my_float&#39;s type is &quot;</span>, <span class="fu">typeof</span>(myDouble)))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;my_float&#39;s type is double&quot;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mySum)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.2</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;my_sum&#39;s type is &quot;</span>, <span class="fu">typeof</span>(mySum)))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;my_sum&#39;s type is double&quot;</span></span></code></pre></div>
<p>Explicit conversion can be achieved with functions such as <code>as.integer</code>, <code>as.logical</code>, <code>as.double</code>, etc.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">typeof</span>(<span class="dv">1</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;double&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">typeof</span>(<span class="fu">as.logical</span>(<span class="dv">1</span>)))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;logical&quot;</span></span></code></pre></div>
</div>
<div id="rs-simplification" class="section level3" number="2.2.2">
<h3 number="2.2.2"><span class="header-section-number">2.2.2</span> R’s Simplification</h3>
<p>The basic types of R are a little different than the basic types of Python. On the one hand, Python has basic types for individual elements, and it uses separate types as containers for storing many elements. On the other, R uses the same type to store a single element as it does to store many elements. Strictly speaking, R does not have a scalar type.</p>
<p>Technically, all of the examples we just did in R are using length one <strong>vectors</strong>–<code>logical</code> <code>integer</code> <code>double</code>, <code>character</code>, <code>complex</code>, and <code>raw</code> are the possible <strong>modes</strong> of a vector. <code>vector</code>s will be discussed further section @ref(r-vectors-versus-numpy-arrays-and-pandas-series).</p>
<p>Think about which option you prefer. What are the benefits of using separate types for scalars and collections? What are the benefits of using the same type?</p>
</div>
</div>
<div id="exercises" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Exercises</h2>
<div id="r-questions" class="section level3" number="2.3.1">
<h3 number="2.3.1"><span class="header-section-number">2.3.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li><p>Which R base type is ideal for each piece of data? Assign your answers to a <code>character</code> <code>vector</code> of length four called <code>questionOne</code>.</p>
<ul>
<li>An individual’s IP address</li>
<li>whether or not an individual attended a study</li>
<li>the number of seeds found in a plant</li>
<li>the amount of time it takes for a car to race around a track</li>
</ul></li>
<li><p>Floating points are weird. What gets printed is not the same as what is stored! In R, you can control how many digits get printed by using the <code>options</code> function.</p>
<ul>
<li>Assign <code>a</code> to <code>2/3</code></li>
<li><code>print</code> <code>a</code>, and copy/paste what you see into the variable <code>aPrint</code>. Make sure it is a <code>character</code>.</li>
<li>Take a look at the documentation for <code>options</code>. Assign the value of <code>options()$digits</code> to <code>numDigitsStart</code></li>
<li>Change the number of digits to <code>22</code></li>
<li>Again, <code>print</code>, <code>a</code> and copy/paste what you see into the variable <code>aPrintv2</code>. Make sure it is a <code>character</code>.</li>
<li>Assign the output of <code>options()$digits</code> to <code>numDigitsEnd</code></li>
</ul></li>
<li><p>Floating points are weird. What gets stored might not be what you want. <a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f">“The only numbers that can be represented exactly in R’s numeric type are integers and fractions whose denominator is a power of 2.”</a></p>
<ul>
<li>Assign the squre root of 2 to <code>mySqrt</code></li>
<li>Print the square of this variable</li>
<li>Test (using <code>==</code>) that this variable is equal to <code>2</code>. Assign the result of this test to <code>isTwoRecoverable</code></li>
<li>Test for near equality (using <code>all.equal</code>) that this variable is “equal” to <code>2</code>. Assign the result of this test to <code>closeEnough</code>. Make sure to read the documentation for this function because the return type can be tricky!</li>
</ul></li>
</ol>
</div>
<div id="python-questions" class="section level3" number="2.3.2">
<h3 number="2.3.2"><span class="header-section-number">2.3.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li><p>Which Python type is ideal for each piece of data? Assign your answers to a <code>list</code> of <code>str</code>ings called <code>question_one</code>.</p>
<ul>
<li>An individual’s IP address</li>
<li>whether or not an individual attended a study</li>
<li>the number of seeds found in a plant</li>
<li>the amount of time it takes for a car to race around a track</li>
</ul></li>
<li><p>Floating points are weird. What gets printed is not the same as what is stored! In Python, you need to edit a class’s <code>__str__</code> method if you want to control how many digits get printed, but we won’t do that. Instead, we’ll use <a href="https://docs.python.org/3/library/stdtypes.html#str.format"><code>str.format()</code></a> to return a string directly (instead of copy/paste-ing it).</p>
<ul>
<li>Assign <code>a</code> to <code>2/3</code></li>
<li><code>print</code> <code>a</code>, and copy/paste what you see into the variable <code>a_print</code></li>
<li>Create a <code>str</code> that displays 22 digits of 2/3. Call it <code>a_printv2</code></li>
<li><code>print</code> the above string</li>
</ul></li>
<li><p>Floating points are weird. What gets stored might not be what you want. The Python documentation has an excellent discussion of how storage behavior can be surprising. Click <a href="https://docs.python.org/3/tutorial/floatingpoint.html">here</a> to read it.</p>
<ul>
<li>Assign the squre root of 2 to <code>my_sqrt</code></li>
<li><code>print</code> the square of this variable</li>
<li>Test (using <code>==</code>) that this variable is equal to <code>2</code>. Assign the result of this test to <code>is_two_recoverable</code></li>
<li>Test for near equality (using <code>np.isclose</code>) that this variable is “equal” to <code>2</code>. Assign the result of this test to <code>close_enough</code>.</li>
</ul></li>
</ol>
<!--chapter:end:02-basic_types.Rmd-->
</div>
</div>
</div>
<div id="r-vectors-versus-numpy-arrays-and-pandas-series" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> R <code>vector</code>s versus Numpy <code>array</code>s and Pandas’ <code>Series</code></h1>
<p>This section is for describing the data types that let us store collections of elements that all <strong>share the same type</strong>. Data is very commonly stored in this fashion, so this section is quite important. Once we have one of these collection objects in a program, we will be interested in learning how to extract and modify different elements in the collection, as well as how to use the entire collection in an efficient calculation.</p>
<div id="overview-of-r" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Overview of R</h2>
<p>In the previous section, I mentioned that R does not have scalar types–it just has <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Vector-objects"><strong>vectors</strong></a>. So, whether you want to store one number (or <code>logical</code>, or <code>character</code>, or …), or many numbers, you will need a <code>vector</code>.</p>
<div class="rmd-caution">
<p>For many, the word “vector” evokes an impression that these objects are designed to be used for performing matrix arithmetic (e.g. inner products, transposes, etc.). You can perform these operations on <code>vector</code>s, but in my opinion, this preconception can be misleading, and I recommend avoiding it. Most of the things you can do with <code>vector</code>s in R have little to do with linear algebra!</p>
</div>
<p>How do we create one of these? There are many ways. One common way is to read in elements from an external data set. Another way is to generate <code>vector</code>s from code.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>         <span class="co"># consecutive integers</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">2</span>)  <span class="co"># arbitrary sequences</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 3 5 7 9</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">5</span>)     <span class="co"># repeating numbers</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2 2 2 2 2</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;5/2/2021&quot;</span>, <span class="st">&quot;5/3/2021&quot;</span>, <span class="st">&quot;5/4/2021&quot;</span>) <span class="co"># combine elements without relying on a pattern</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;5/2/2021&quot; &quot;5/3/2021&quot; &quot;5/4/2021&quot;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">10</span>)                             <span class="co"># generate Gaussian random variables</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  0.64039551  0.25240806  1.37401077  2.25447855 -1.29881033  0.02720972  1.92920495 -0.07117049 -0.06157727</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [10] -0.58348310</span></span></code></pre></div>
<p><code>c()</code> is short for “combine.” <code>seq()</code> and <code>rep()</code> are short for “sequence” and “replicate,” respectively. <code>rnorm()</code> samples normal (or Gaussian) random variables. There is plenty more to learn about these functions, so I encourage you to take a look at their documentation.</p>
<div class="rmd-details">
<p>I should mention that functions such as <code>rnorm()</code> don’t create truly random numbers, just <em>pseudorandom</em> ones. Pseudorandom numbers are nearly indecipherable from truly random ones, but the way the computer generates them is actually deterministic.</p>
<p>First, a <em>seed</em>, or starting number is chosen. Then, the <em>pseudorandom number generator (PRNG)</em> maps that number to another number. The sequence of all the numbers appears to be random, but is actually deterministic.</p>
<p>Sometimes you will be interested in setting the seed on your own because it is a cheap way of sharing and communicating data with others. If two people use the same starting seed, and the same PRNG, then they should simulate the same data. This can be important if you want to help other people reproduce the results of code you share. Most of the time, though, I don’t set the seed, and I don’t think about the distinction between random and pseudorandom numbers.</p>
</div>
</div>
<div id="overview-of-python" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Overview of Python</h2>
<p>If you want to store many elements of the same type (and size) in Python, you will probably need a Numpy <code>array</code>. Numpy is a highly-regarded third party library <span class="citation">(<a href="#ref-harris2020array" role="doc-biblioref">Harris et al. 2020</a>)</span> for Python. Its <code>array</code> objects store elements of the same type, just as R’s <code>vector</code>s do.</p>
<p>There are five ways to create numpy arrays (<a href="https://numpy.org/doc/stable/user/basics.creation.html">source</a>). Here are some examples that complement the examples from above.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np   </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([1, 2, 3])</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">2</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 1,  3,  5,  7,  9, 11])</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>np.random.normal(size<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">## array([-0.78583785, -0.13803104,  0.5196683 ])</span></span></code></pre></div>
<p>Another option for storing a homogeneous collection of elements in Python is a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas-series"><code>Series</code> object</a> from the Pandas library. The benefit of these is that they play nicely with Pandas’ data frames (more information about Pandas’ data frames can be found in @ref(data-frames-in-python)), and that they have more flexibility with accessing elements by name ( see <a href="https://jakevdp.github.io/PythonDataScienceHandbook/03.01-introducing-pandas-objects.html#Series-as-generalized-NumPy-array">here</a> for more information ).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>first <span class="op">=</span> pd.Series([<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>second <span class="op">=</span> pd.Series([<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>], index <span class="op">=</span> [<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(first[<span class="dv">0</span>])</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 2</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(second[<span class="st">&#39;c&#39;</span>])</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 6</span></span></code></pre></div>
</div>
<div id="vectorization-in-r" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Vectorization in R</h2>
<p>An operation in R is <strong>vectorized</strong> if it applies to all of the elements of a <code>vector</code> at once. An operator that is not vectorized can only be applied to individual elements. In that case, the programmer would need to write more code to instruct the function to be applied to all of the elements of a vector. You should prefer writing vectorized code because it is usually easier to read. Moreover, many of these vectorized functions are written in compiled code, so they can often be much faster.</p>
<p>Arithmetic (e.g. <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>, <code>%%</code>, <code>%/%</code>, etc.) and logical (e.g. <code>!</code>, <code>|</code>, <code>&amp;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, etc.) operators are commonly applied to one or two vectors. Arithmetic is usually performed <em>element-by-element</em>. Numeric vectors are converted to logical vectors if they need to be. Be careful of operator precedence if you seek to minimize your use of parentheses.</p>
<p>Note that there are an extraordinary amount of named functions (e.g. <code>sum()</code>, <code>length()</code>, <code>cumsum()</code>, etc.) that operate on entire <code>vector</code>s, as well. Here are some examples.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)        </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 4 9</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">==</span> <span class="fu">rev</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)    </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] FALSE  TRUE FALSE</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sin</span>( (<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">/</span><span class="dv">3</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  8.660254e-01 -8.660254e-01 -2.449294e-16  8.660254e-01 -8.660254e-01</span></span></code></pre></div>
<p>In the last example, there is <strong>recycling</strong> happening. <code>(2*pi/3)</code> is taking three length-one vectors and producing another length-one vector. The resulting length-one vector is multiplied by a length five vector <code>1:5</code>. The single element in the length one vector gets <em>recycled</em> so that its value is multiplied by every element of <code>1:5</code>.
This makes sense most of the time, but sometimes recycling can be tricky. Notice that the following code does not produce an error–just a warning.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in (1:3) * (1:4): longer object length is not a multiple of shorter object length</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 4 9 4</span></span></code></pre></div>
</div>
<div id="vectorization-in-python" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Vectorization in Python</h2>
<p>The Python’s Numpy library makes extensive use of vectorization as well. Vectorization in Numpy is accomplished with <a href="https://numpy.org/doc/stable/reference/ufuncs.html"><strong>universal functions</strong></a>, or “ufuncs” for short. Some ufuncs can be invoked using the same syntax as in R (e.g. <code>+</code>). You can also refer to function by its name (e.g. <code>np.sum()</code> instead of <code>+</code>). Mixing and matching is allowed, too.</p>
<p>Ufuncs are called <em>unary</em> if they take in one array, and <em>binary</em> if they take in two. At the moment, there are <a href="https://numpy.org/doc/stable/reference/ufuncs.html#available-ufuncs">fewer than <span class="math inline">\(100\)</span> available</a>, all performing either mathematical operations, boolean-emitting comparisons, or bit-twiddling operations. For an exhaustive list of Numpy’s universal functions, <a href="https://numpy.org/doc/stable/reference/ufuncs.html#available-ufuncs">click here.</a> Here are some code examples.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">1</span>,<span class="dv">4</span>)<span class="op">*</span>np.arange(<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">## array([1, 4, 9])</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>np.zeros(<span class="dv">5</span>) <span class="op">&gt;</span> np.arange(<span class="op">-</span><span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ True,  True,  True, False, False])</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>np.exp( <span class="op">-</span><span class="fl">.5</span> <span class="op">*</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">10</span>)<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> np.sqrt( <span class="dv">2</span> <span class="op">*</span> np.pi)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">## array([0.00443185, 0.02622189, 0.09947714, 0.24197072, 0.37738323,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">##        0.37738323, 0.24197072, 0.09947714, 0.02622189, 0.00443185])</span></span></code></pre></div>
<p>Instead of calling it “recycling,” Numpy calls reusing elements of a shorter array in a binary operation <a href="https://numpy.org/devdocs/user/theory.broadcasting.html"><strong>broadcasting</strong></a>. It’s the same idea as in R, but in general, Python is stricter and disallows more scenarios.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="dv">1</span>,<span class="dv">3</span>)<span class="op">*</span>np.arange(<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Error in py_call_impl(callable, dots$args, dots$keywords): ValueError: operands could not be broadcast together with shapes (2,) (3,) </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Detailed traceback:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></span></code></pre></div>
<p>If you are working with string arrays, Numpy has a <a href="https://numpy.org/doc/stable/reference/routines.char.html#module-numpy.char"><code>np.char</code> module with many useful functions</a>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>np.char.upper(a)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;], dtype=&#39;&lt;U1&#39;)</span></span></code></pre></div>
<p>Then there are the <code>Series</code> objects from Pandas. Ufuncs continue to work in the same way on <code>Series</code> objects, and they <a href="https://jakevdp.github.io/PythonDataScienceHandbook/03.03-operations-in-pandas.html">respect common index values</a>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> pd.Series(np.repeat(<span class="dv">100</span>,<span class="dv">3</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> pd.Series(np.repeat(<span class="dv">10</span>,<span class="dv">3</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">+</span> s2</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    110</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    110</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    110</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span></code></pre></div>
<p>If you feel more comfortable, and you want to coerce these <code>Series</code> objects to Numpy arrays before working with them, you can do that. For example, the following works.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series(np.linspace(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">5</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>np.exp(s.to_numpy())</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([0.36787944, 0.60653066, 1.        , 1.64872127, 2.71828183])</span></span></code></pre></div>
<p>In addition, <code>Series</code> objects possess many extra <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas-series">attributes and methods</a>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ints <span class="op">=</span> pd.Series(np.arange(<span class="dv">10</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ints.<span class="bu">abs</span>()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    0</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    1</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    2</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    3</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    4</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 5    5</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 6    6</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 7    7</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 8    8</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 9    9</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>ints.mean()</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 4.5</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>ints.floordiv(<span class="dv">2</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    0</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    0</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    1</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    1</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    2</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 5    2</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 6    3</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 7    3</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 8    4</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 9    4</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span></code></pre></div>
<p><code>Series</code> objects that have <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/text.html#working-with-text-data">text data</a> are a little bit different. For one, you have to access the <code>.str</code> attribute of the <code>Series</code> before calling any <a href="https://jakevdp.github.io/PythonDataScienceHandbook/03.10-working-with-strings.html">vectorized methods</a>. Here are some examples.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series([<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>,<span class="st">&#39;33&#39;</span>])</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>s.dtype</span></code></pre></div>
<pre><code>## dtype(&#39;O&#39;)</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">str</span>.isdigit()</span></code></pre></div>
<pre><code>## 0    False
## 1    False
## 2    False
## 3     True
## dtype: bool</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">str</span>.replace(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;z&#39;</span>)</span></code></pre></div>
<pre><code>## 0     z
## 1     b
## 2     c
## 3    33
## dtype: object</code></pre>
<p>String operations can be a big game changer, and we discuss text processing strategies in more detail in section @(working-with-text-data).</p>
</div>
<div id="indexing-vectors-in-r" class="section level2" number="3.5">
<h2 number="3.5"><span class="header-section-number">3.5</span> Indexing Vectors in R</h2>
<p>It is very common to want to extract or modify a subset of elements in a vector. There are a few ways to do this. All of the ways I discuss will involve the square bracket operator (i.e. <code>[]</code>). Feel free to retrieve the documentation by typing <code>?'['</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>allElements <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>allElements[<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">2</span>)] <span class="co"># extract evens</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2 4 6</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>allElements[<span class="sc">-</span><span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="dv">99</span> <span class="co"># replace all odds with 99</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>allElements[allElements <span class="sc">&gt;</span> <span class="dv">2</span>] <span class="co"># get nums bigger than 2</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 99 99  4 99  6</span></span></code></pre></div>
<p>To access the first element, we use the index <code>1</code>. To access the second, we use <code>2</code>, and so on. Also, the <code>-</code> sign tells R to remove elements. Both of these functionalities are <em>very different</em> from Python, as we will see shortly.</p>
<p>We can use names to access elements elements, too, but only if the elements are named.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>sillyVec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;favorite&quot;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&quot;least favorite&quot;</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sillyVec[<span class="st">&#39;favorite&#39;</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">## favorite </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="do">##        1</span></span></code></pre></div>
</div>
<div id="indexing-numpy-arrays" class="section level2" number="3.6">
<h2 number="3.6"><span class="header-section-number">3.6</span> Indexing Numpy arrays</h2>
<p><a href="https://numpy.org/doc/stable/user/basics.indexing.html">Indexing Numpy arrays</a> is very similar to indexing vectors in R. You use the square brackets, and you can do it with logical arrays or index arrays. There are some important differences, though.</p>
<p>For one, indexing is 0-based in Python. The <code>0</code>th element is the first element of an array. Another key difference is that the <code>-</code> isn’t used to remove elements like it is in R, but rather to count backwards. Third, using one or two <code>:</code> inside square brackets is more flexible in Python. This is syntactic sugar for using the <code>slice()</code> function, which is similar to R’s <code>seq()</code> function.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>one_through_ten <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">11</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>one_through_ten[np.array([<span class="dv">2</span>,<span class="dv">3</span>])]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([3, 4])</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>one_through_ten[<span class="dv">1</span>:<span class="dv">10</span>:<span class="dv">2</span>] <span class="co"># evens</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 2,  4,  6,  8, 10])</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>one_through_ten[::<span class="op">-</span><span class="dv">1</span>] <span class="co"># reversed</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">## array([10,  9,  8,  7,  6,  5,  4,  3,  2,  1])</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>one_through_ten[<span class="op">-</span><span class="dv">2</span>] <span class="op">=</span> <span class="dv">99</span> <span class="co"># second to last</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>one_through_ten</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 1,  2,  3,  4,  5,  6,  7,  8, 99, 10])</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>one_through_ten[one_through_ten <span class="op">&gt;</span> <span class="dv">3</span>] <span class="co"># bigger than three</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 4,  5,  6,  7,  8, 99, 10])</span></span></code></pre></div>
</div>
<div id="indexing-pandas-series" class="section level2" number="3.7">
<h2 number="3.7"><span class="header-section-number">3.7</span> Indexing Pandas’ Series</h2>
<p>At a minimum, there is little that is new that you <em>need</em> to learn to go from Numpy arrays to Pandas’ Series objects. They still have the <code>[]</code> operator, and <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.html">many methods are shared across these two types</a>. The following is almost equivalent to the code above, and the only apparent difference is that the results are printed a little differently.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>one_through_ten <span class="op">=</span> pd.Series(np.arange(<span class="dv">1</span>, <span class="dv">11</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>one_through_ten[np.array([<span class="dv">2</span>,<span class="dv">3</span>])]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    3</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    4</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>one_through_ten[<span class="dv">1</span>:<span class="dv">10</span>:<span class="dv">2</span>] <span class="co"># evens</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     2</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 3     4</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 5     6</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 7     8</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 9    10</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>one_through_ten[::<span class="op">-</span><span class="dv">1</span>] <span class="co"># reversed</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 9    10</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 8     9</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 7     8</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 6     7</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 5     6</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 4     5</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 3     4</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 2     3</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     2</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 0     1</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>one_through_ten[<span class="op">-</span><span class="dv">2</span>] <span class="op">=</span> <span class="dv">99</span> <span class="co"># second to last</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>one_through_ten</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co">##  0     1</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co">##  1     2</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">##  2     3</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co">##  3     4</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co">##  4     5</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co">##  5     6</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co">##  6     7</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co">##  7     8</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co">##  8     9</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="co">##  9    10</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="co">## -2    99</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>one_through_ten[one_through_ten <span class="op">&gt;</span> <span class="dv">3</span>] <span class="co"># bigger than three</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="co">##  3     4</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="co">##  4     5</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="co">##  5     6</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="co">##  6     7</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="co">##  7     8</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="co">##  8     9</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="co">##  9    10</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="co">## -2    99</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>one_through_ten.<span class="bu">sum</span>()</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="co">## 154</span></span></code></pre></div>
<p>However, <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#different-choices-for-indexing">Pandas’ Series have <code>.loc</code> and <code>.iloc</code> methods</a>. We won’t talk much about these two methods now, but they will become very important when we start to discuss Pandas’ data frames in section @ref(data-frames-in-python).</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>one_through_ten.iloc[<span class="dv">2</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 3</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>one_through_ten.loc[<span class="dv">2</span>]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 3</span></span></code></pre></div>
</div>
<div id="some-gotchas" class="section level2" number="3.8">
<h2 number="3.8"><span class="header-section-number">3.8</span> Some Gotchas</h2>
<div id="shallow-versus-deep-copies" class="section level3" number="3.8.1">
<h3 number="3.8.1"><span class="header-section-number">3.8.1</span> Shallow versus Deep Copies</h3>
<p>In R, assignment usually produces a <strong>deep copy.</strong> In the code below, we create <code>b</code> from <code>a</code>. If we modify <code>b</code>, these changes don’t affect <code>a</code>. This takes up more memory, but our program is easier to follow as we don’t have to keep track of connections between objects.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> a</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>b[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>a <span class="co"># still the same!</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 3</span></span></code></pre></div>
<p>With Numpy arrays in Python, <a href="https://numpy.org/devdocs/user/quickstart.html#copies-and-views">“shallow copies” can be created by simple assignment, or by explicitly constructing a <strong>view</strong></a>. In the code below, <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> all share the same data. If you modify one, you change all the others. This can make the program more confusing, but on the other hand, it can also improve computational efficiency.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in python</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> a <span class="co"># b is an alias</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> a.view() <span class="co"># c is a view</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> a[:]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>b[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">999</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>a <span class="co"># two names for the same object in memory</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">## array([999,   2,   3])</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">## array([999,   2,   3])</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>c</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">## array([999,   2,   3])</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">## array([999,   2,   3])</span></span></code></pre></div>
<p>It’s the same story with Pandas’ Series objects. You’re usually making a “shallow” copy.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in python</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> pd.Series(np.array([<span class="fl">100.0</span>,<span class="fl">200.0</span>,<span class="fl">300.0</span>]))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> s1</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> s1.view()</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>s4 <span class="op">=</span> s1[:]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>s1[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">999</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>s1</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    999.0</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    200.0</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    300.0</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>s2</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    999.0</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    200.0</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    300.0</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>s3</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    999.0</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    200.0</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    300.0</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>s4</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    999.0</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    200.0</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    300.0</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span></code></pre></div>
<p>If you want a “deep copy” in Python, you usually want a function or method called <code>copy()</code>. Use <code>np.copy</code> or <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.copy.html#numpy-ndarray-copy"><code>np.ndarray.copy</code></a> when you have a Numpy array.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in python</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.copy(a)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> a.copy()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>b[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">999</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>a </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">## array([1, 2, 3])</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">## array([999,   2,   3])</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>c</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">## array([1, 2, 3])</span></span></code></pre></div>
<p>Use <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.copy.html#pandas-series-copy"><code>pandas.Series.copy</code></a> with Pandas’ Series objects. Make sure not to set the <code>deep</code> argument to <code>False</code>. Otherwise you’ll get a shallow copy.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in python</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> pd.Series(np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> s1.copy()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> s1.copy(deep<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>s1[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">999</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>s1</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    999</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1      2</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2      3</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>s2</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    1</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    2</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    3</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>s3</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    999</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 1      2</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 2      3</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span></code></pre></div>
</div>
<div id="how-r-and-python-handle-missing-values" class="section level3" number="3.8.2">
<h3 number="3.8.2"><span class="header-section-number">3.8.2</span> How R and Python Handle Missing Values</h3>
<p>R has <code>NULL</code>, <code>NaN</code>, and <code>NA</code>. Python has <code>None</code> and <code>np.nan</code>. If your eyes are glazing over already and you’re thinking “they all look like the same”–they are not.</p>
<p>R’s <code>NULL</code> and Python’s <code>None</code> are similar. Both represent “nothingness.” This is <em>not</em> the same as <code>0</code>, or an empty string, or <code>FALSE</code>/<code>False</code>. This is commonly used to detect if a user fails to pass in an argument to a function, or if a function fails to “return” (more information on functions can be found in section @ref(functions)) anything meaningful.</p>
<p>In R, for example, if a function fails to return anything, then it actually returns a <code>NULL</code>. <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#NULL-object">A <code>NULL</code> object has its own type.</a></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span> <span class="sc">==</span> <span class="cn">FALSE</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="do">## logical(0)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span> <span class="sc">==</span> <span class="cn">NULL</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="do">## logical(0)</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function that doesn&#39;t return anything</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># more information on this later</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>doNothingFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(a){} </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>thing <span class="ot">&lt;-</span> <span class="fu">doNothingFunc</span>() <span class="co"># call our new function</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">is.null</span>(thing)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NULL</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;NULL&quot;</span></span></code></pre></div>
<p>In Python, we have the following.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="va">None</span> <span class="op">==</span> <span class="va">False</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="va">None</span> <span class="op">==</span> <span class="va">None</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function that doesn&#39;t return anything</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># more information on this later</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> do_nothing_func():</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">pass</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>thing <span class="op">=</span> do_nothing_func()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> thing <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;thing is None!&quot;</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">## thing is None!</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(<span class="va">None</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;NoneType&#39;&gt;</span></span></code></pre></div>
<p>“NaN” abbreviates “not a number.” <code>NaN</code> is an object of type <code>double</code> in R, and <code>np.nan</code> is of type <code>float</code> in Python. It can come in handy when you (deliberately or accidentally) perform undefined calculations such as <span class="math inline">\(0/0\)</span> or <span class="math inline">\(\infty / -\infty\)</span>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span><span class="sc">/</span><span class="dv">0</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] NaN</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="cn">Inf</span><span class="sc">/</span><span class="cn">Inf</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] NaN</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(<span class="dv">0</span><span class="sc">/</span><span class="dv">0</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span><span class="op">/</span><span class="dv">0</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Error in py_call_impl(callable, dots$args, dots$keywords): ZeroDivisionError: division by zero</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Detailed traceback:</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>np.inf<span class="op">/</span>np.inf</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">## nan</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>np.isnan(np.nan)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span></code></pre></div>
<p>“NA” is short for “not available.” Missing data is a fact of life in data science. Observations are often missing in data sets, introduced after joining/merging data sets together (more on this in section @ref(merging-or-joining-data-sets)), or arise from calculations involving underflow and overflow. There are many techniques designed to estimate quantities in the presence of missing data. When you code them up, you’ll need to make sure you deal with <code>NA</code>s properly.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>babyData <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">9</span>,<span class="cn">NA</span>,<span class="dv">21</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="cn">TRUE</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] NA</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(babyData)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] FALSE FALSE FALSE  TRUE FALSE</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NA</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;logical&quot;</span></span></code></pre></div>
<p>Unfortunately, Python’s support of an <code>NA</code>-like object is more limited. There is no <code>NA</code> object in base Python. And often <code>NaN</code>s will appear in place of an <code>NA</code>. There are a few useful tools, though. The Numpy library offers <a href="https://numpy.org/devdocs/reference/maskedarray.html">“masked arrays”</a>, for instance.</p>
<p>Also, as of version <code>1.0.0</code>, the <a href="https://pandas.pydata.org/docs/user_guide/index.html#user-guide">pandas library</a> has an experimental <code>pd.NA</code> object. However, they <a href="https://pandas.pydata.org/pandas-docs/dev/user_guide/missing_data.html#missing-data-na">warn</a> that “the behaviour of <code>pd.NA</code> can still change without warning.”</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>baby_data <span class="op">=</span> ma.array([<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">9</span>,<span class="op">-</span><span class="dv">9999</span>, <span class="dv">21</span>]) <span class="co"># -9999 &quot;stands for&quot; missing</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>baby_data[<span class="dv">3</span>] <span class="op">=</span> ma.masked</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>np.average(baby_data)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 7.25</span></span></code></pre></div>
<div class="rmd-caution">
<p>Be careful of using extreme values to stand in for what should be an <code>NA</code>. Be aware that some data providers will follow this strategy. I recommend that you avoid it yourself. Failing to represent a missing value correctly would lead to extremely wrong calculations!</p>
</div>
</div>
</div>
<div id="exercises-1" class="section level2" number="3.9">
<h2 number="3.9"><span class="header-section-number">3.9</span> Exercises</h2>
<div id="r-questions-1" class="section level3" number="3.9.1">
<h3 number="3.9.1"><span class="header-section-number">3.9.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li><p>Let’s flip some coins! Generate a thousand flips of a fair coin. Use <code>rbinom</code>, and let heads be coded as <code>1</code> and tails coded as <code>0</code>.</p>
<ul>
<li>Assign the thousand raw coin flips to a variable <code>flips</code>. Make sure the elements are integers, and make sure you flip a “fair” coin (<span class="math inline">\(p=.5\)</span>).</li>
<li>Create a length <code>1000</code> <code>logical</code> <code>vector</code> called <code>isHeads</code>. Whenever you get a heads, make sure the corresponding element is <code>TRUE</code> and <code>FALSE</code> otherwise.</li>
<li>Create a variable called <code>numHeads</code> by tallying up the number of heads.</li>
<li>Calculate the percent of time that the number changes in <code>flips</code>. Assign your number to <code>acceptanceRate</code>. Try to write only one line of code to do this.</li>
</ul></li>
<li><p>Say you have a <code>vector</code> of prices of some financial asset:</p></li>
</ol>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">100.10</span>, <span class="fl">95.98</span>, <span class="fl">100.01</span>, <span class="fl">99.87</span>)</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Convert this vector into a vector of <em>log returns</em>. Call the variable <code>logReturns</code>. If <span class="math inline">\(p_t\)</span> is the price at time <span class="math inline">\(t\)</span>, the log return ending at time <span class="math inline">\(t\)</span> is
<span class="math display">\[ r_t = \log \left( \frac{p_t}{p_{t-1}} \right) = \log p_t - \log p_{t-1}\]</span></p></li>
<li><p>Do the same for <em>arithmetic returns</em>. These are regular percent changes if you scale by <span class="math inline">\(100\)</span>. Call the variable <code>arithReturns</code>. The mathematical formula you need is <span class="math display">\[ a_t = \left( \frac{p_t - p_{t-1} }{p_{t-1}} \right) \times 100 \]</span></p></li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>Consider another <strong>mixture density</strong> <span class="math inline">\(f(y) = \int f(y \mid x) f(x) dx\)</span> where</li>
</ol>
<p><span class="math display">\[
Y \mid X = x \sim \text{Normal}(0, x^2)
\]</span>
and</p>
<p><span class="math display">\[
X \sim \text{half-Cauchy}(0, 1).
\]</span>
This distribution is a special case of a prior distribution that is used in Bayesian statistics <span class="citation">(<a href="#ref-horseshoe" role="doc-biblioref">Carvalho, Polson, and Scott 2009</a>)</span>.</p>
<p>Suppose further that you are interested in calculating the probability that one of these random variables ends up being too far from the median:</p>
<p><span class="math display">\[
\mathbb{P}[|Y| &gt; 1] = \int_{y : |y| &gt; 1} f(y)dy = \int_{y : |y| &gt; 1} \int_{-\infty}^\infty  f(y \mid x) f(x) dx dy.
\]</span></p>
<ol style="list-style-type: lower-alpha">
<li><p>Simulate <span class="math inline">\(X_1, \ldots, X_{5000}\)</span> from a <span class="math inline">\(\text{half-Cauchy}(0, 1)\)</span> and call these samples <code>xSamps</code>. Hint: you can simulate from a <span class="math inline">\(t\)</span> distribution with one degree of freedom to sample from a Cauchy. Once you have regular Cauchy samples, take the absolute value of each one.</p></li>
<li><p>Simulate <span class="math inline">\(Y_1 \mid X_1, \ldots, Y_{5000} \mid X_{5000}\)</span> and call the samples <code>ySamps</code>.</p></li>
<li><p>Calculate the approximate probability using <code>ySamps</code> and call it <code>approxProbDev1</code>.</p></li>
<li><p>Why is simply “ignoring” <code>xSamps</code>, the samples you condition on, “equivalent” to “integrating out <span class="math inline">\(x\)</span>?” Store a string response as a length <span class="math inline">\(1\)</span> character vector called <code>integratingOutResp</code>.</p></li>
<li><p>Calculate another <strong>Rao-Blackwellized</strong> Monte Carlo estimate of <span class="math inline">\(\mathbb{P}[|Y| &gt; 1]\)</span> from <code>xSamps</code>. Call it <code>approxProbDev2</code>. Hint: <span class="math inline">\(\mathbb{P}[|Y| &gt; 1] = \mathbb{E}[\mathbb{P}(|Y| &gt; 1 \mid X) ]\)</span>. Calculate <span class="math inline">\(\mathbb{P}(|Y| &gt; 1 \mid X=x)\)</span> with pencil and paper, notice it is a function in <span class="math inline">\(x\)</span>, apply that function to each of <code>xSamps</code>, and average all of it together.</p></li>
<li><p>Are you able to calculate an exact solution to <span class="math inline">\(\mathbb{P}[|Y| &gt; 1]\)</span>?</p></li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li>Store the ordered uppercase letters of the alphabet in a length <span class="math inline">\(26\)</span> <code>character</code> <code>vector</code> called <code>myUpcaseLetters</code>. Do not hardcode this. Use a function, along with the variable <code>letters</code>.</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li><p>Create a new vector called <code>withReplacements</code> that’s the same as the previous <code>vector</code>, but replace all vowels with <code>"---"</code>. Again, do not hardcode this. Find a function that searches for patterns and performs a replacement whenever that pattern is found.</p></li>
<li><p>Create a length <span class="math inline">\(26\)</span> logical vector that is <code>TRUE</code> whenever an element of <code>letters</code> is a consonant, and <code>FALSE</code> everywhere else. Call it <code>consonant</code>.</p></li>
</ol>
</div>
<div id="python-questions-1" class="section level3" number="3.9.2">
<h3 number="3.9.2"><span class="header-section-number">3.9.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li><p>Let’s flip some coins (again)! Generate a thousand flips of a fair coin. Use <code>np.random.binomial</code>, and let heads be coded as <code>1</code> and tails coded as <code>0</code>.</p>
<ul>
<li>Assign the thousand raw coin flips to a variable <code>flips</code>. Make sure the elements are integers, and make sure you flip a “fair” coin (<span class="math inline">\(p=.5\)</span>).</li>
<li>Create a length <code>1000</code> <code>list</code> of <code>bool</code>s called <code>is_heads</code>. Whenever you get a heads, make sure the corresponding element is <code>True</code> and <code>False</code> otherwise.</li>
<li>Create a variable called <code>num_heads</code> by tallying up the number of heads.</li>
<li>Calculate the percent of time that the number changes in <code>flips</code>. Assign your number to <code>acceptance_rate</code>. Try to write only one line of code to do this.</li>
</ul></li>
<li><p>Use <code>pd.read_csv</code> to correctly read in <code>"2013-10_Citi_Bike_trip_data_20K.csv"</code> as a data frame called <code>my_df</code>. Make sure to read <code>autograding_tips.html</code>.</p></li>
</ol>
<ol style="list-style-type: lower-alpha">
<li><p>extract the <code>"starttime"</code> column into a separate <code>Series</code> called <code>s_times</code></p></li>
<li><p>extract date strings of those elements into a <code>Series</code> called <code>date_strings</code></p></li>
<li><p>extract time strings of those elements into a <code>Series</code> called <code>time_strings</code></p></li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>We will make use of the <em>Monte Carlo</em> <span class="citation">(<a href="#ref-monte-carlo-stat-methods" role="doc-biblioref">Robert and Casella 2005</a>)</span> method below. It is a technique to approximate expectations and probabilities. If <span class="math inline">\(n\)</span> is a large number, and <span class="math inline">\(X_1, \ldots, X_n\)</span> is a random sample drawn from the distribution of interest, then
<span class="math display">\[
\mathbb{P}(X &gt; 6) \approx \frac{1}{n}\sum_{i=1}^n \mathbf{1}(X_i &gt; 6).
\]</span>
If you haven’t seen an <strong>indicator function</strong> before, it is defined as</li>
</ol>
<p><span class="math display">\[
\mathbf{1}(X_i &gt; 6)
=
\begin{cases}
1 &amp; X_i &gt; 6 \\
0 &amp; X_i \le 6
\end{cases}.
\]</span></p>
<p>If you wanted to visualize it, <span class="math inline">\(\mathbf{1}(x &gt; 6)\)</span> looks like this.</p>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-47-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>So, the sum in this expression is just a count of the number of elements that are greater than <span class="math inline">\(6\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Evaluate exactly the probability that a normal random variable with mean <span class="math inline">\(5\)</span> and standard deviation <span class="math inline">\(6\)</span> is greater than <span class="math inline">\(6\)</span>. Assign it to the variable <code>exact_exceedance_prob</code> in Python.</p></li>
<li><p>Simulate <span class="math inline">\(1e3\)</span> times from a standard normal distribution (mean 0 and variance 1). Call the samples <code>stand_norm_samps</code></p></li>
<li><p>Calculate a Monte Carlo estimate of <span class="math inline">\(\mathbb{P}(X &gt; 6)\)</span> from these samples. Call it <code>approx_exceedance_prob1</code>.</p></li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li>Simulate <span class="math inline">\(1e3\)</span> times from a normal distribution with mean <span class="math inline">\(5\)</span> and standard deviation <span class="math inline">\(6\)</span>. Call the samples <code>norm_samps</code>. Don’t use the old samples in any way.</li>
</ol>
<ol start="4" style="list-style-type: lower-alpha">
<li>Calculate a Monte Carlo estimate of <span class="math inline">\(\mathbb{P}(X &gt; 6)\)</span> from these new <code>norm_samps</code>. Call it <code>approx_exceedance_prob2</code>.</li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li>Alternatively, we can approximate expectations. If <span class="math inline">\(\mathbb{E}[f(X)]\)</span> exists, <span class="math inline">\(n\)</span> is a large number, and <span class="math inline">\(W_1, \ldots, W_n\)</span> is a random sample drawn from the distribution of interest, then</li>
</ol>
<p><span class="math display">\[
\mathbb{E}[f(W)] \approx \frac{1}{n}\sum_{i=1}^n f(W_i).
\]</span></p>
<p>Here’s a new distribution. It is a <strong>mixture distribution</strong>, specifically a <strong>finite mixture of normal distributions</strong>: <span class="math inline">\(f(y) = f(y \mid X=1)P(X=1) + f(y \mid X=0)P(X=0)\)</span> where</p>
<p><span class="math display">\[
Y \mid X=0 \sim \text{Normal}(0, 2) \\
Y \mid X=1 \sim \text{Normal}(10, 2)
\]</span>
and</p>
<p><span class="math display">\[
X \sim \text{Bernoulli}(.5).
\]</span></p>
<p>Both <span class="math inline">\(f(y \mid X=0)\)</span> and <span class="math inline">\(f(y \mid X=1)\)</span> are bell-curved, and <span class="math inline">\(f(y)\)</span> looks like this</p>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-48-1.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: lower-alpha">
<li><p>Evaluate exactly <span class="math inline">\(\mathbb{E}[Y]\)</span>. Assign it to the variable <code>exact_mean</code> in Python.</p></li>
<li><p>Simulate <span class="math inline">\(1e3\)</span> times from the Bernoulli distribution. Call the samples <code>bernoulli_flips</code></p></li>
<li><p>Simulate <span class="math inline">\(Y_1 \mid X_1, \ldots, Y_{1000} \mid X_{1000}\)</span> and call the samples <code>cond_norm_samps</code>.</p></li>
<li><p>Calculate a Monte Carlo estimate of <span class="math inline">\(\mathbb{E}[Y]\)</span> from <code>cond_norm_samps</code>. Call it <code>approx_ave_1</code>. Why is simply “ignoring” <code>bernoulli_flips</code>, the samples you condition on, “equivalent” to “integrating them out?”</p></li>
<li><p>Calculate a <strong>Rao-Blackwellized</strong> Monte Carlo estimate of <span class="math inline">\(\mathbb{E}[Y]\)</span> from <code>bernoulli_flips</code>. Call it <code>approx_ave_2</code>. Hint: <span class="math inline">\(\mathbb{E}[Y] = \mathbb{E}[\mathbb{E}(Y \mid X) ]\)</span>. Calculate <span class="math inline">\(\mathbb{E}(Y \mid X_i)\)</span> exactly, and evaluate that function on each <span class="math inline">\(X_i\)</span> sample, and then average them together. Rao-Blackwellization is a variance-reduction technique that allows you come up with lower-variance estimates given a fixed computational budget.</p></li>
</ol>
<!--chapter:end:03-vectors_and_arrays.Rmd-->
</div>
</div>
</div>
<div id="numpy-ndarrays-versus-rs-matrix-and-array-types" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Numpy <code>ndarray</code>s Versus R’s <code>matrix</code> and <code>array</code> Types</h1>
<p>Sometimes you want a collection of elements that are <em>all the same type</em>, but you want to store them in a two- or three-dimensional structure. For instance, say you need to use matrix multiplication for some linear regression software you’re writing, or that you need to use tensors for a computer vision project you’re working on.</p>
<div id="numpy-ndarrays-in-python" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Numpy <code>ndarray</code>s In Python</h2>
<p>In Python, you could still use arrays for these kinds of tasks. You will be pleased to learn that the Numpy <code>array</code>s we discussed earlier are a special case of <a href="https://numpy.org/doc/stable/reference/arrays.ndarray.html">Numpy’s N-dimensional arrays</a>. Each array will come with an enormous amount of <a href="https://numpy.org/doc/stable/reference/arrays.ndarray.html#array-methods">methods</a> and <a href="https://numpy.org/doc/stable/reference/arrays.ndarray.html#array-attributes">attributes</a> (more on object-oriented program in chapter @ref(an-introduction-to-object-oriented-programming)) attached to it. A few are demonstrated below.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">3</span>,<span class="dv">4</span>]], np.<span class="bu">float</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">## array([[1., 2.],</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">##        [3., 4.]])</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>a.shape</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">## (2, 2)</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>a.ndim</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>a.dtype</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype(&#39;float64&#39;)</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>a.<span class="bu">max</span>()</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 4.0</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>a.resize((<span class="dv">1</span>,<span class="dv">4</span>)) <span class="co"># modification is **in place**</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">## array([[1., 2., 3., 4.]])</span></span></code></pre></div>
<p>Matrix and elementwise multiplication is often useful, too.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.ones(<span class="dv">4</span>).reshape((<span class="dv">4</span>,<span class="dv">1</span>)) </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>np.dot(b,a) <span class="co"># matrix mult.</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([[1., 2., 3., 4.],</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">##        [1., 2., 3., 4.],</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">##        [1., 2., 3., 4.],</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">##        [1., 2., 3., 4.]])</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>b <span class="op">@</span> a <span class="co"># infix matrix mult. from PEP 465</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">## array([[1., 2., 3., 4.],</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">##        [1., 2., 3., 4.],</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">##        [1., 2., 3., 4.],</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">##        [1., 2., 3., 4.]])</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>a <span class="op">*</span> np.arange(<span class="dv">4</span>) <span class="co"># elementwise mult.</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">## array([[ 0.,  2.,  6., 12.]])</span></span></code></pre></div>
</div>
<div id="the-matrix-and-array-classes-in-r" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> The <code>matrix</code> and <code>array</code> classes in R</h2>
<p>In Python, adding a dimension to your “container” is simple. You keep using Numpy arrays, and you just change the <code>.shape</code> attribute (perhaps with a call to <code>.reshape()</code> or something similar). In R, there is a stronger distinction between 1-,2-, and 3-dimensional containers. Each has its own class. 2-dimensional containers that store objects of the same type are of the <code>matrix</code> class. Containers with 3 or more dimensions are of the <code>array</code> class. In this section, I will provide a quick introduction to using these two classes. For more information, see chapter 3 of <span class="citation">(<a href="#ref-matloff_r_book" role="doc-biblioref">Matloff 2011</a>)</span>.</p>
<div class="rmd-caution">
<p>Just like <code>vector</code>s, <code>matrix</code> objects do not necessarily have to be used to perform matrix arithmetic. Yes, they require all the elements are of the same type, but it doesn’t really make sense to “multiply” <code>matrix</code> objects that hold onto <code>character</code>s.</p>
</div>
<p>I usually create <code>matrix</code> objects with the <code>matrix()</code> function or the <code>as.matrix()</code> function. <code>matrix()</code> is to be preferred in my opinion. The first argument is explicitly a <code>vector</code> of all the flattened data that you want in your <code>matrix</code>. On the other hand, <code>as.matrix()</code> is more flexible; it takes in a variety of R objects (e.g. <code>data.frame</code>s), and tries to figure out what to do with them on a case-by-case basis. In other words, <code>as.matrix()</code> is a <em>generic function</em>. More information about generic functions is provided in @ref(using-s3-objects).</p>
<p>Some other things to remember with <code>matrix()</code>: <code>byrow=</code> is <code>FALSE</code> by default, and you will also need to specify either <code>ncol=</code> and/or <code>nrow=</code> if you want anything that isn’t a 1-column <code>matrix</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>A</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    3</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    4</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    3</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    4</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    2</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    3    4</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(<span class="fu">data.frame</span>(<span class="at">firstCol =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">secondCol =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>))) <span class="co"># coerces numbers to characters!</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="do">##      firstCol secondCol</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] &quot;1&quot;      &quot;a&quot;      </span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] &quot;2&quot;      &quot;b&quot;      </span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] &quot;3&quot;      &quot;c&quot;</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(A)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4 1</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(A)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(A)</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre></div>
<p><code>array()</code> is used to create <code>array</code> objects. This type is used less than the <code>matrix</code> type, but this doesn’t mean you should avoid learning about it. This is mostly a reflection of what kind of data sets people prefer to work with, and the fact that matrix algebra is generally better understood than tensor algebra. You won’t be able to avoid 3-d data sets (3-dimensions, not a 3-column <code>matrix</code>) forever, though, particularly if you’re working in an area such as neuroimaging or computer vision.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>myArray <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">4</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>myArray</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 1</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    1</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    1    1</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 2</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    2    2</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    2</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 3</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    3    3</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    3    3</span></span></code></pre></div>
<p>You can matrix-multiply <code>matrix</code> objects together with the <code>%*%</code> operator. If you’re working on this, then the transpose operator (i.e. <code>t()</code>) comes in handy, too. You can still use element-wise (Hadamard) multiplication. This is defined with the more familiar multiplication operator <code>*</code>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate a quadratic form y&#39;Qy</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, <span class="dv">3</span>) <span class="co"># diag() gets and sets diagonal matrices</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(y) <span class="sc">%*%</span> Q <span class="sc">%*%</span> y</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]   14</span></span></code></pre></div>
<p>Sometimes you need to access or modify individual elements of a <code>matrix</code> object. You can use the familiar <code>[</code> and <code>[&lt;-</code> operators to do this. Here is a setting example. You don’t need to worry about coercion to different types here.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>Qcopy <span class="ot">&lt;-</span> Q</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>Qcopy[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>Qcopy[<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>Qcopy</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    3    0    0</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    0    4    0</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    0    0    1</span></span></code></pre></div>
<p>Here are some extraction examples. Notice that, if it can, <code>[</code> will coerce a <code>matrix</code> to <code>vector</code>. If you wish to avoid this, you can specify <code>drop=FALSE</code>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>Q</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    0    0</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    0    1    0</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    0    0    1</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>Q[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>Q[<span class="dv">2</span>,]</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0 1 0</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>Q[<span class="dv">2</span>,,drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    0    1    0</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Q)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;matrix&quot; &quot;array&quot;</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Q[<span class="dv">2</span>,])</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;numeric&quot;</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Q[<span class="dv">2</span>,,<span class="at">drop=</span><span class="cn">FALSE</span>])  </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;matrix&quot; &quot;array&quot;</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="fu">row</span>(Q) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="do">##       [,1]  [,2]  [,3]</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] FALSE FALSE FALSE</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]  TRUE  TRUE  TRUE</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]  TRUE  TRUE  TRUE</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>Q[<span class="fu">row</span>(Q) <span class="sc">&gt;</span> <span class="dv">1</span>] <span class="co"># column-wise ordering</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0 0 1 0 0 1</span></span></code></pre></div>
<p>There are other functions that operate on one or more <code>matrix</code> objects in more interesting ways, but much of this will be covered in future sections. For instance, we will describe how <code>apply()</code> works with <code>matrix</code>s in section @ref(functional-programming), and we will discuss combining <code>matrix</code> objects in different ways in section @ref(reshaping-and-combining-data-sets).</p>
</div>
<div id="exercises-2" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> Exercises</h2>
<div id="r-questions-2" class="section level3" number="4.3.1">
<h3 number="4.3.1"><span class="header-section-number">4.3.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li>Consider the following data set. Let <span class="math inline">\(N = 20\)</span> be the number of rows. For <span class="math inline">\(i=1,\ldots,N\)</span>, define <span class="math inline">\(\mathbf{x}_i \in \mathbb{R}^4\)</span> as the data in row <span class="math inline">\(i\)</span>.</li>
</ol>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">1.1585476</span>,  <span class="fl">0.06059602</span>, <span class="sc">-</span><span class="fl">1.854421163</span>,  <span class="fl">1.62855626</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.5619835</span>,  <span class="fl">0.74857327</span>, <span class="sc">-</span><span class="fl">0.830973409</span>,  <span class="fl">0.38432716</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">1.6949202</span>,  <span class="fl">1.24726626</span>,  <span class="fl">0.068601035</span>, <span class="sc">-</span><span class="fl">0.32505127</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.8260260</span>, <span class="sc">-</span><span class="fl">0.68567999</span>, <span class="sc">-</span><span class="fl">0.109012111</span>, <span class="sc">-</span><span class="fl">0.59738648</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.3128249</span>, <span class="sc">-</span><span class="fl">0.21192009</span>, <span class="sc">-</span><span class="fl">0.317923437</span>, <span class="sc">-</span><span class="fl">1.60813901</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.3830597</span>,  <span class="fl">0.68000706</span>,  <span class="fl">0.787044622</span>,  <span class="fl">0.13872087</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.2381630</span>,  <span class="fl">1.02531172</span>, <span class="sc">-</span><span class="fl">0.606091651</span>,  <span class="fl">1.80442260</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.5429671</span>, <span class="sc">-</span><span class="fl">0.05174198</span>, <span class="sc">-</span><span class="fl">1.950780046</span>, <span class="sc">-</span><span class="fl">0.87716787</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.5927925</span>, <span class="sc">-</span><span class="fl">0.40566883</span>, <span class="sc">-</span><span class="fl">0.309193162</span>,  <span class="fl">1.25575250</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.8970403</span>, <span class="sc">-</span><span class="fl">0.10111751</span>,  <span class="fl">1.555160257</span>, <span class="sc">-</span><span class="fl">0.54434356</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.4060504</span>, <span class="sc">-</span><span class="fl">0.08199934</span>, <span class="sc">-</span><span class="fl">0.472715155</span>,  <span class="fl">0.25254794</span>,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">1.0145770</span>, <span class="sc">-</span><span class="fl">0.83132666</span>, <span class="sc">-</span><span class="fl">0.009597552</span>, <span class="sc">-</span><span class="fl">1.71378699</span>,</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.3590219</span>,  <span class="fl">0.84127504</span>,  <span class="fl">0.062052945</span>, <span class="sc">-</span><span class="fl">1.00587841</span>,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.1335952</span>, <span class="sc">-</span><span class="fl">0.02769315</span>, <span class="sc">-</span><span class="fl">0.102229046</span>, <span class="sc">-</span><span class="fl">1.08526057</span>,</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.1641571</span>, <span class="sc">-</span><span class="fl">0.08308289</span>, <span class="sc">-</span><span class="fl">0.711009361</span>,  <span class="fl">0.06809487</span>,</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.2450975</span>,  <span class="fl">0.32619749</span>,  <span class="fl">1.280665384</span>,  <span class="fl">1.75090469</span>,</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.2147885</span>,  <span class="fl">0.10720830</span>, <span class="sc">-</span><span class="fl">2.018215962</span>,  <span class="fl">0.34602861</span>,</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.7309219</span>, <span class="sc">-</span><span class="fl">0.60083707</span>, <span class="sc">-</span><span class="fl">1.007344145</span>, <span class="sc">-</span><span class="fl">1.77345958</span>,</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.1791807</span>, <span class="sc">-</span><span class="fl">0.49500051</span>,  <span class="fl">0.402840566</span>,  <span class="fl">0.60532646</span>,</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.0454594</span>,  <span class="fl">1.09878293</span>,  <span class="fl">2.784986486</span>, <span class="sc">-</span><span class="fl">0.22579848</span>), <span class="at">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>For the following problems, make sure to only use the transpose function <code>t()</code>, matrix multiplication (i.e. <code>%*%</code>), and scalar multiplication/division. You may use other functions in interactive mode to check your work, but please do not use them in your submission.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Calculate the sample mean <span class="math inline">\(\bar{\mathbf{x}} = \frac{1}{N} \sum_{i=1}^N \mathbf{x}_i\)</span>. Check your work with <code>colMeans()</code>, <strong>but don’t use that function in your submitted code.</strong> Assign it to the variable <code>xbar</code>. Make sure it is a <span class="math inline">\(4 \times 1\)</span> <code>matrix</code> object.</p></li>
<li><p>Calculate the <span class="math inline">\(4 \times 4\)</span> sample covariance of the following data. Call the variable <code>mySampCov</code>, and make sure it is also a <code>matrix</code> object.</p></li>
</ol>
<p>A formula for the sample covariance is
<span class="math display">\[
\frac{1}{N-1} \sum_{i=1}^N (\mathbf{x}_i - \bar{\mathbf{x}})(\mathbf{x}_i - \bar{\mathbf{x}})^\intercal
\]</span>
<strong>You can check your work with <code>cov()</code>, but don’t use it in your submitted code.</strong></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Create a <code>matrix</code> called <code>P</code> that has one hundred rows, one hundred columns, all of its elements positive, <span class="math inline">\(1/10\)</span> on every diagonal element, and all rows summing to one. This matrix is called <strong>stochastic</strong> and it describes how a Markov chain moves randomly through time.</p></li>
<li><p>Create a <code>matrix</code> called <code>X</code> that has one thousand rows, four columns, has every element set to either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>, has its first column set to all <span class="math inline">\(1\)</span>s, has the second column set to <span class="math inline">\(1\)</span> in the second <span class="math inline">\(250\)</span> elements and <span class="math inline">\(0\)</span> elsewhere, has the third column set to <span class="math inline">\(1\)</span> in the third <span class="math inline">\(250\)</span> spots and <span class="math inline">\(0\)</span> elsewhere, and has the fourth column set to <span class="math inline">\(1\)</span> in the last <span class="math inline">\(250\)</span> spots and <span class="math inline">\(0\)</span> elsewhere. In other words, it looks something like</p></li>
</ol>
<p><span class="math display">\[
  \begin{bmatrix}
  \mathbf{1}_{250}  &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} \\
  \mathbf{1}_{250}  &amp; \mathbf{1}_{250} &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} \\
  \mathbf{1}_{250}  &amp; \mathbf{0}_{250} &amp; \mathbf{1}_{250} &amp; \mathbf{0}_{250} \\
  \mathbf{1}_{250}  &amp; \mathbf{0}_{250} &amp; \mathbf{0}_{250} &amp; \mathbf{1}_{250} \\
  \end{bmatrix}
  \]</span>
where <span class="math inline">\(\mathbf{1}_{250}\)</span> and <span class="math inline">\(\mathbf{0}_{250}\)</span> are length <span class="math inline">\(250\)</span> column vectors with all of their elements set to <span class="math inline">\(1\)</span> or <span class="math inline">\(0\)</span>, respectively.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Compute the <strong>projection (or hat) matrix</strong> <span class="math inline">\(\mathbf{H} := \mathbf{X}\left(\mathbf{X}^\intercal \mathbf{X}\right)^{-1} \mathbf{X}^\intercal\)</span>. Make it a <code>matrix</code> and call it <code>H</code>.</p></li>
<li><p>An <strong>exchangeable</strong> covariance matrix for a random vector is a covariance matrix that has all the same variances, and all the same covariances. In other words, it has two unique elements: the diagonal elements should be the same, and the off-diagonals should be the same. In R, generate ten <span class="math inline">\(100 \times 100\)</span> <strong>exchangeable</strong> covariance matrices, each with <span class="math inline">\(2\)</span> as the variance, and have the possible covariances take values in the collection <span class="math inline">\(0,.01,.02, ..., .09.\)</span> Store these ten covariance matrices in a three-dimensional array. The first index should be each matrix’s row index, the second should be the column index of each matrix, and the third index should be the “layer” or “slice” indicating which of the <span class="math inline">\(10\)</span> matrices you have. Name this array <code>myCovMats</code></p></li>
<li><p>In R, generate one hundred <span class="math inline">\(10 \times 10\)</span> <strong>exchangeable</strong> covariance matrices, each with <span class="math inline">\(2\)</span> as the variance, and have the possible covariances take values in the collection <span class="math inline">\(0,0.0009090909, ..., 0.0890909091, .09.\)</span> Store these <span class="math inline">\(100\)</span> covariance matrices in a three-dimensional array. The first index should be each matrix’s row index, the second should be the column index of each matrix, and the third index should be the “layer” or “slice” indicating which of the <span class="math inline">\(100\)</span> matrices you have. Name this array <code>myCovMats2</code></p></li>
</ol>
</div>
<div id="python-questions-2" class="section level3" number="4.3.2">
<h3 number="4.3.2"><span class="header-section-number">4.3.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li>Let <span class="math inline">\(\mathbf{X}\)</span> be an <span class="math inline">\(n \times 1\)</span> random vector. It has a multivariate normal distribution with mean vector <span class="math inline">\(\mathbf{m}\)</span> and positive definite covariance matrix <span class="math inline">\(\mathbf{C}\)</span> if its probability density function can be written as</li>
</ol>
<p><span class="math display">\[
f(\mathbf{x}; \mathbf{m}, \mathbf{C}) = (2\pi)^{-n/2}\text{det}\left( \mathbf{C} \right)^{-1/2}\exp\left[- \frac{1}{2} (\mathbf{x}- \mathbf{m})^\intercal \mathbf{C}^{-1} (\mathbf{x}- \mathbf{m}) \right]
\]</span></p>
<p>Evaluating this density should be done with care. There is no one function that is optimal for all situations. Here are a couple quick things to consider:</p>
<ul>
<li><p>inverting very large matrices with either <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.solve.html"><code>np.linalg.solve</code></a> or <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.inv.html"><code>np.linalg.inv</code></a> becomes very slow if the covariance matrix is high-dimensional. If you have special assumptions about the structure of the covariance matrix, use it! Also, it’s a good idea to be aware of what happens when you try to invert noninvertible matrices. For instance, can you rely on errors to be thrown, or will it return a bogus answer?</p></li>
<li><p>recall from the last lab that exponentiating numbers close to <span class="math inline">\(-\infty\)</span> risks numerical underflow. It’s better to prefer evaluating log densities. There are also <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.slogdet.html">special functions that evaluate log determinants</a> that are less likely to underflow/overflow, too!</p></li>
</ul>
<p>Complete the following problems. <strong>Do not use pre-made functions like <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html"><code>scipy.stats.norm</code></a> and <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.multivariate_normal.html"><code>scipy.stats.multivariate_normal</code></a> in your submission, but you may use them to check your work. Use only “standard” functions and Numpy n-dimensional arrays.</strong> Use the following definitions for <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{m}\)</span>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="fl">1.1</span>, <span class="fl">.9</span>, <span class="fl">1.0</span>]).reshape((<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> np.ones(<span class="dv">3</span>).reshape((<span class="dv">3</span>,<span class="dv">1</span>))</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Let <span class="math inline">\(\mathbf{C} = \begin{bmatrix} 10 &amp; 0 &amp; 0 \\ 0 &amp; 10 &amp; 0 \\ 0 &amp; 0 &amp; 10 \end{bmatrix}\)</span>. Evaluate and assign the log density to a <code>float</code>-like called <code>log_dens1</code>. Can you do this without defining a numpy array for <span class="math inline">\(\mathbf{C}\)</span>?</p></li>
<li><p>Let <span class="math inline">\(\mathbf{C} = \begin{bmatrix} 10 &amp; 0 &amp; 0 \\ 0 &amp; 11 &amp; 0 \\ 0 &amp; 0 &amp; 12 \end{bmatrix}\)</span>. Evaluate and assign the log density to a <code>float</code>-like called <code>log_dens2</code>. Can you do this without defining a numpy array for <span class="math inline">\(\mathbf{C}\)</span>?</p></li>
<li><p>Let <span class="math inline">\(\mathbf{C} = \begin{bmatrix} 10 &amp; -.9 &amp; -.9 \\ -.9 &amp; 11 &amp; -.9 \\ -.9 &amp; -.9 &amp; 12 \end{bmatrix}\)</span>. Evaluate and assign the log density to a <code>float</code>-like called <code>log_dens3</code>. Can you do this without defining a numpy array for <span class="math inline">\(\mathbf{C}\)</span>?</p></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>Consider this <a href="https://archive.ics.uci.edu/ml/datasets/Wine+Quality">wine data set</a> from <span class="citation">(<a href="#ref-wine_data" role="doc-biblioref">Cortez et al. 2009</a>)</span> hosted by <span class="citation">(<a href="#ref-uci_data" role="doc-biblioref">Dua and Graff 2017</a>)</span>. Read it in with the following code. Note that you might need to use <code>os.chdir()</code> first.</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.read_csv(<span class="st">&quot;winequality-red.csv&quot;</span>, sep <span class="op">=</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>d.head()</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Create the <strong>design matrix</strong> (denoted mathematically by <span class="math inline">\(\mathbf{X}\)</span>) by removing the <code>"quality"</code> column, and subtracting the column mean from each element. Call the variable <code>X</code>, and make sure that it is a Numpy <code>ndarray</code>, not a Pandas <code>DataFrame</code>.</p></li>
<li><p>Compute the <strong>spectral decomposition</strong> of <span class="math inline">\(\mathbf{X}^\intercal \mathbf{X}\)</span>. In other words, find “special” matrices<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> <span class="math inline">\(\mathbf{V}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> such that <span class="math inline">\(\mathbf{X}^\intercal \mathbf{X} = \mathbf{V} \boldsymbol{\Lambda} \mathbf{V}^\intercal\)</span>. Note that the <em>eigenvectors</em> are stored as columns in a matrix <span class="math inline">\(\mathbf{V} := \begin{bmatrix} \mathbf{V}_1 &amp; \cdots &amp; \mathbf{V}_{11}\end{bmatrix}\)</span>, and the scalar <em>eigenvalues</em> are stored as diagonal elements <span class="math inline">\(\boldsymbol{\Lambda} = \text{diag}(\lambda_1, \ldots, \lambda_{11})\)</span>. Store the eigenvectors in an <code>ndarray</code> called <code>eig_vecs</code>, and store the eigenvalues in a Numpy <code>array</code> called <code>eig_vals</code>. Hint: use <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.eig.html"><code>np.linalg.eig()</code></a>. Also, if you’re rusty with your linear algebra, don’t worry too much about refreshing your memory about what eigenvectors and eigenvalues are.</p></li>
<li><p>Compute the <strong>singular value decomposition</strong> of <span class="math inline">\(\mathbf{X}\)</span>. In other words, find “special”<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> matrices <span class="math inline">\(\mathbf{U}\)</span>, <span class="math inline">\(\mathbf{\Sigma}\)</span>, and <span class="math inline">\(\mathbf{V}\)</span> such that <span class="math inline">\(\mathbf{X} = \mathbf{U} \mathbf{\Sigma} \mathbf{V}^\intercal\)</span>. Use <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.svd.html"><code>np.linalg.svd</code></a>, and don’t worry too much about the mathematical details. These two decompositions are related. If you do it correctly, the two <span class="math inline">\(\mathbf{V}\)</span> matrices should be the same, and the elements of <span class="math inline">\(\boldsymbol{\Sigma}\)</span> should be the square roots of the elements of <span class="math inline">\(\boldsymbol{\Lambda}\)</span>. Store the eigenvectors as columns in an <code>ndarray</code> called <code>eig_vecs_v2</code>, and store the singular values (diagonal elements of <span class="math inline">\(\boldsymbol{\Sigma}\)</span>) in a Numpy <code>array</code> called <code>sing_vals</code>.</p></li>
<li><p>Compute the <strong>first principal component</strong> vector, and call it <code>first_pc_v1</code>. The mathematical formula is <span class="math inline">\(\mathbf{X} \mathbf{U}_1\)</span> where <span class="math inline">\(\mathbf{U}_1\)</span> is the eigenvector associated with the largest eigenvalue <span class="math inline">\(\lambda_1\)</span>. This can be thought of as, in a sense, the most informative predictor that you can create by averaging together all other predictors.</p></li>
</ol>
<!--chapter:end:04-arrays_and_matrices.Rmd-->
</div>
</div>
</div>
<div id="rs-lists-versus-pythons-lists-and-dicts" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> R’s <code>list</code>s Versus Python’s <code>list</code>s and <code>dict</code>s</h1>
<p>When you need to store elements in a container, but you can’t guarantee that these elements all have the same type, or you can’t guarantee that they all have the same size, then you need a <code>list</code> in R. In Python, you might need a <code>list</code> or <code>dict</code> (short for dictionary).</p>
<div id="lists-in-r" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> <code>list</code>s In R</h2>
<p><code>list</code>s are one of the most flexible data types in R. You can access individual elements in many different ways, each element can be of different size, and each element can be of a different type.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>myList <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="st">&quot;May 5th, 2021&quot;</span>, <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>myList[<span class="dv">1</span>] <span class="co"># length-1 list; first element is length 3 vector</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 3</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>myList[[<span class="dv">1</span>]] <span class="co"># length-3 vector</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 3</span></span></code></pre></div>
<p>If you want to extract an element, you need to decide between using single square brackets or double square brackets. The former returns a <code>list</code>, while the second returns the type of the individual element.</p>
<p>You can also name the elements of a list. This can lead to more readable code. To see why, examine the example below. The <code>lm()</code> function estimates a linear regression model. It returns a <code>list</code> with plenty of components.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dataSet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/cars.csv&quot;</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Horsepower) <span class="sc">~</span> Type, <span class="at">data =</span> dataSet)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(results)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 13</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results) </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;          &quot;fitted.values&quot; &quot;assign&quot;       </span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] &quot;qr&quot;            &quot;df.residual&quot;   &quot;contrasts&quot;     &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;        </span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &quot;model&quot;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>contrasts</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $Type</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;contr.treatment&quot;</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&#39;rank&#39;</span>]</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="do">## $rank</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 6</span></span></code></pre></div>
<div class="rmd-caution">
<p><code>results</code> is a <code>list</code> (<code>is.list(results)</code> returns <code>TRUE</code>), but to be more specific, it is an S3 object of class <code>lm</code>. If you do not know what this means, do not worry! S3 classes are discussed more in a later chapter. Why is this important? For one, I mention it so that you aren’t confused if you type <code>class(results)</code> and see <code>lm</code> instead of <code>list</code>. Second, the fact that the authors of <code>lm()</code> wrote code that returns <code>result</code> as a “fancy list” suggests that they are encouraging another way to access elements of the <code>results</code>: to use specialized functions! For example, you can use <code>residuals(results)</code>, <code>coefficients(results)</code>, and <code>fitted.values(results)</code>. These functions do not work for all lists in R, but when they do work (for <code>lm</code> and <code>glm</code> objects only), you can be sure you are writing the kind of code that is encouraged by the authors of <code>lm()</code>.</p>
</div>
</div>
<div id="lists-in-python" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> <code>list</code>s In Python</h2>
<p><a href="https://docs.python.org/3/library/stdtypes.html#lists">Python <code>list</code>s</a> are very flexible, too. There are fewer choices for accessing and modifying elements of lists in Python–you’ll most likely end up using the square bracket operator. Elements can be different sizes and types, just like they were with R’s lists.</p>
<p>Unlike in R, however, you cannot name elements of lists. If you want a container that allows you to access elements by name, look into Python <a href="https://docs.python.org/3/library/stdtypes.html#mapping-types-dict">dictionaries</a> (see section @ref(dictionaries-in-python)) or Pandas’ <code>Series</code> objects (see section @ref(overview-of-python)).</p>
<p>From the example below, you can see that we’ve been introduced to lists already. We have been constructing Numpy arrays from them.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>another_list <span class="op">=</span> [np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), <span class="st">&quot;May 5th, 2021&quot;</span>, <span class="va">True</span>, [<span class="dv">42</span>,<span class="dv">42</span>]]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>another_list[<span class="dv">2</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>another_list[<span class="dv">2</span>] <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>another_list</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([1, 2, 3]), &#39;May 5th, 2021&#39;, 100, [42, 42]]</span></span></code></pre></div>
<p>Python lists have <a href="https://docs.python.org/3/tutorial/datastructures.html#more-on-lists">methods attached to them</a>, which can come in handy.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>another_list</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([1, 2, 3]), &#39;May 5th, 2021&#39;, 100, [42, 42]]</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>another_list.append(<span class="st">&#39;new element&#39;</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>another_list</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([1, 2, 3]), &#39;May 5th, 2021&#39;, 100, [42, 42], &#39;new element&#39;]</span></span></code></pre></div>
<p>Creating lists can be done as above, with the square bracket operators. They can also be created with the <code>list()</code> function, and by creating a <em>list comprehension</em>. List comprehensions are discussed more in @ref(loops).</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="op">=</span> <span class="bu">list</span>((<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>)) <span class="co"># converting a tuple to a list</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>your_list <span class="op">=</span> [i<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)] <span class="co"># list comprehension</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>my_list</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">## [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>your_list</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">## [0, 1, 4]</span></span></code></pre></div>
</div>
<div id="dictionaries-in-python" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> Dictionaries In Python</h2>
<p><a href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries"><strong>Dictionaries</strong></a> in Python provide a container of key-value pairs. The keys are <em>unique</em>, and they must be <em>immutable</em>. <code>string</code>s are the most common key type, but <code>int</code>s can be used as well.</p>
<p>Here is an example of creating a <code>dict</code> with curly braces (i.e. <code>{}</code>). This <code>dict</code> stores the current price of a few popular cryptocurrencies. Accessing an individual element’s value using its key is done with the square bracket operator (i.e. <code>[]</code>), and deleting elements is done with the <code>del</code> keyword.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>current_crypto_prices <span class="op">=</span> {<span class="st">&#39;BTC&#39;</span>: <span class="fl">38657.14</span>, <span class="st">&#39;ETH&#39;</span>: <span class="fl">2386.54</span>, <span class="st">&#39;DOGE&#39;</span>: <span class="fl">.308122</span>}</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>current_crypto_prices[<span class="st">&#39;DOGE&#39;</span>] <span class="co"># get the current price of Dogecoin</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 0.308122</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> current_crypto_prices[<span class="st">&#39;BTC&#39;</span>] <span class="co"># remove the current price of Bitcoin</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>current_crypto_prices.keys()</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">## dict_keys([&#39;ETH&#39;, &#39;DOGE&#39;])</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>current_crypto_prices.values()</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co">## dict_values([2386.54, 0.308122])</span></span></code></pre></div>
<p>You can also create <code>dict</code>s using <strong>dictionary comprehensions</strong>. Just like list comprehensions, these are discussed more in @ref(loops).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>incr_cryptos <span class="op">=</span> {key:val<span class="op">*</span><span class="fl">1.1</span> <span class="cf">for</span> (key,val) <span class="kw">in</span> current_crypto_prices.items()}</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>incr_cryptos</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">## {&#39;ETH&#39;: 2625.194, &#39;DOGE&#39;: 0.3389342}</span></span></code></pre></div>
<p>Personally, I don’t use dictionaries as much as lists. If I have a dictionary, I usually convert it to a pandas data frame (more information on those in @ref(data-frames-in-python)).</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>df_from_dict <span class="op">=</span> pd.DataFrame({ <span class="st">&#39;col1&#39;</span>: [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>], <span class="st">&#39;col2&#39;</span> : [<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>]})</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>df_from_dict</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">##    col1 col2</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 0     1    a</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     2    b</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 2     3    c</span></span></code></pre></div>
</div>
<div id="exercises-3" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> Exercises</h2>
<div id="r-questions-3" class="section level3" number="5.4.1">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li>Consider the data sets <code>adult.data</code>, <code>car.data</code>, <code>hungarian.data</code>, <code>iris.data</code>, <code>long-beach-va.data</code> and <code>switzerland.data</code> <span class="citation">(<a href="#ref-misc_heart_disease_45" role="doc-biblioref">Janosi et al. 1988</a>)</span>, <span class="citation">(<a href="#ref-misc_iris_53" role="doc-biblioref">Fisher 1988</a>)</span>. <span class="citation">(<a href="#ref-misc_adult_2" role="doc-biblioref"><span>“<span>Adult</span>”</span> 1996</a>)</span> and <span class="citation">(<a href="#ref-misc_car_evaluation_19" role="doc-biblioref"><span>“<span>Car Evaluation</span>”</span> 1997</a>)</span>. Read all of these in and store them all as a <code>list</code> of <code>data.frame</code>s. Call the list <code>listDfs</code>.</li>
</ol>
</div>
<div id="python-questions-3" class="section level3" number="5.4.2">
<h3 number="5.4.2"><span class="header-section-number">5.4.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li>Read in <code>car.data</code> with <code>pd.read_csv()</code>, and use a <code>DataFrame</code> method to convert that to a <code>dict</code>. Store your answer as <code>car_dict</code>.</li>
</ol>
<!--chapter:end:05-lists_and_dictionaries.Rmd-->
</div>
</div>
</div>
<div id="functions" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Functions</h1>
<p>This text has already covered how to <em>use</em> functions that come to us pre-made. At least we have discussed how to use them in a one-off way–just write the name of the function, write some parentheses after that name, and then plug in any requisite arguments by writing them in a comma-separated way between those two parentheses. This is how it works in both R and Python.</p>
<p>In this section we take a look at how to <em>define</em> our own functions. This will not only help us to understand pre-made functions, but it will also be useful if we need some extra functionality that isn’t already provided to us.</p>
<p>Writing our own functions is also useful for “packaging up” computations. The utility of this will become apparent very soon. Consider the task of estimating a regression model. If you have a function that performs all of the required calculations, then</p>
<ul>
<li>you can estimate models without having to think about lower-level details or write any code yourself, and</li>
<li>you can re-use this function every time you fit any model on any data set for any project.</li>
</ul>
<div id="defining-r-functions" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> Defining R Functions</h2>
<p>To create a function in R, we need another function called <code>function()</code>. We give the output of <code>function()</code> a name in the same way we give names to any other variable in R, by using the assignment operator <code>&lt;-</code>. Here’s an example of a toy function called <code>addOne()</code>. Here <code>myInput</code> is a placeholder that refers to whatever the user of the function ends up plugging in.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>addOne <span class="ot">&lt;-</span> <span class="cf">function</span>(myInput){  <span class="co"># define the function</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  myOutput <span class="ot">&lt;-</span> myInput <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(myOutput)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">addOne</span>(<span class="dv">41</span>) <span class="co"># call/invoke/use the function </span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 42</span></span></code></pre></div>
<p>Below the definition, the function is called with an input of <code>41</code>. When this happens, the following sequence of events occurs</p>
<ul>
<li>The value <code>41</code> is assigned to <code>myInput</code></li>
<li><code>myOutput</code> is given the value <code>42</code></li>
<li><code>myOutput</code>, which is <code>42</code>, is returned from the function</li>
<li>the temporary variables <code>myInput</code> and <code>myOutput</code> are destroyed.</li>
</ul>
<p>We get the desired answer, and all the unnecessary intermediate variables are cleaned up and thrown away after they are no longer needed.</p>
<div class="rmd-caution">
<p>If you are interested in writing a function, I recommend that you first write the logic outside of a function. This initial code will be easier to debug because your temporary variables will not be destroyed after the final result has been obtained. Once you are happy with the working code, you can copy and paste the logic into a function definition, and replace permanent variables with function inputs like <code>myInput</code> above.</p>
</div>
</div>
<div id="defining-python-functions" class="section level2" number="6.2">
<h2 number="6.2"><span class="header-section-number">6.2</span> Defining Python Functions</h2>
<p>To create a function in Python, we use the <code>def</code> statement (instead of the <code>function()</code> function in R). The desired name of the function comes next. After that, the formal parameters come, comma-separated inside parentheses, just like in R.</p>
<p>Defining a function in Python is a little more concise. There is no assignment operator like there is in R, there are no curly braces, and <code>return</code> isn’t a function like it is in R, so there is no need to use parentheses after it. There is one syntactic addition, though–we need a colon (<code>:</code>) at the end of the first line of the definition.</p>
<p>Here is an example of a toy function called <code>add_one()</code>.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_one(my_input):  <span class="co"># define the function</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  my_output <span class="op">=</span> my_input <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> my_output</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>add_one(<span class="dv">41</span>) <span class="co"># call/invoke/use the function </span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 42</span></span></code></pre></div>
<p>Below the definition, the function is called with an input of <code>41</code>. When this happens, the following sequence of events occurs</p>
<ul>
<li>The value <code>41</code> is assigned to <code>my_input</code></li>
<li><code>my_output</code> is given the value <code>42</code></li>
<li><code>my_output</code>, which is <code>42</code>, is returned from the function</li>
<li>the temporary variables <code>my_input</code> and <code>my_output</code> are destroyed.</li>
</ul>
<p>We get the desired answer, and all the unnecessary intermediate variables are cleaned up and thrown away after they are no longer needed.</p>
</div>
<div id="more-details-on-rs-user-defined-functions" class="section level2" number="6.3">
<h2 number="6.3"><span class="header-section-number">6.3</span> More Details On R’s User-Defined Functions</h2>
<p>Technically, in R, functions are <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Function-objects">defined as three things bundled together</a>:</p>
<ol style="list-style-type: decimal">
<li>a <strong>formal argument list</strong> (also known as <em>formals</em>),</li>
<li>a <strong>body</strong>, and</li>
<li>a <strong>parent environment</strong>.</li>
</ol>
<p>The <em>formal argument list</em> is exactly what it sounds like. It is the list of arguments a function takes. You can access a function’s formal argument list using the <code>formals()</code> function. Note that it is not the <em>actual</em> arguments a user will plug in–that isn’t knowable at the time the function is created in the first place.</p>
<p>Here is another function that takes a parameter called <code>whichNumber</code> that comes with a <strong>default argument</strong> of <code>1</code>. If the caller of the function does not specify what she wants to add to <code>myInput</code>, <code>addNumber()</code> will use <code>1</code> as the default. This default value shows up in the output of <code>formals(addNumber)</code>.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>addNumber <span class="ot">&lt;-</span> <span class="cf">function</span>(myInput, <span class="at">whichNumber =</span> <span class="dv">1</span>){  </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  myOutput <span class="ot">&lt;-</span> myInput <span class="sc">+</span> whichNumber</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(myOutput)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">addNumber</span>(<span class="dv">3</span>) <span class="co"># no second argument being provided by the user here</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(addNumber)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $myInput</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $whichNumber</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre></div>
<p>The function’s <em>body</em> is also exactly what it sounds like. It is the work that a function performs. You can access a function’s body using the the <code>body()</code> function.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>addNumber <span class="ot">&lt;-</span> <span class="cf">function</span>(myInput, <span class="at">whichNumber =</span> <span class="dv">1</span>){  </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  myOutput <span class="ot">&lt;-</span> myInput <span class="sc">+</span> whichNumber</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(myOutput)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(addNumber)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="do">## {</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     myOutput &lt;- myInput + whichNumber</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     return(myOutput)</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="do">## }</span></span></code></pre></div>
<p>Every function you create also has a <em>parent environment</em><a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. You can get/set this using the <code>environment()</code> function. Environments help a function know which variables it is allowed to use and how to use them. The parent environment of a function is where the function was <em>created</em>, and it contains variables outside of the body that the function can also use. The rules of which variables a function can use are called <em>scoping</em>. When you create functions in R, you are primarily using <strong>lexical scoping</strong>. This is discussed in more detail in section @ref(function-scope-in-r).</p>
<div class="rmd-details">
<p>There is a lot more information about environments that isn’t provided in this text. For instance, a user-defined function also has <a href="http://adv-r.had.co.nz/Environments.html#function-envs">binding, execution, and calling environments associated with it</a>, and environments are used in creating package namespaces, which are important when two packages each have a function with the same name.</p>
</div>
</div>
<div id="more-details-on-pythons-user-defined-functions" class="section level2" number="6.4">
<h2 number="6.4"><span class="header-section-number">6.4</span> More details on Python’s user-defined functions</h2>
<p>Roughly, Python functions have the same things R functions have. They have a <strong>formal parameter list</strong>, a body, and there are <a href="https://docs.python.org/3/tutorial/classes.html#python-scopes-and-namespaces">namespaces</a> created that help organize which variables the function can access, as well as which pieces of code can call this new function. A namespace is just a “mapping from names to objects.”</p>
<p>These three concepts are analogous to those in R. The names are just a bit different sometimes, and it isn’t organized in the same way. To access these bits of information, you need to access the <em>special attributes</em> of a function. User-defined functions in Python have a lot of pieces of information attached to them. If you’d like to see all of them, you can visit <a href="https://docs.python.org/3/reference/datamodel.html#objects-values-and-types">this page of documentation</a>.</p>
<!-- Below is a table, taken straight from [the documentation](https://docs.python.org/3/reference/datamodel.html#objects-values-and-types), of all each user-defined function's .  -->
<!-- | Attribute |  Meaning | -->
<!-- |-----------|-------------------| -->
<!-- `__doc__`  | The function’s documentation string, or `None` if unavailable; not inherited by subclasses. -->
<!-- `__name__` | The function’s name.   -->
<!-- `__qualname__` | The function’s qualified name.     -->
<!-- `__module__` | The name of the module the function was defined in, or None if unavailable. -->
<!-- `__defaults__` | A tuple containing default argument values for those arguments that have defaults, or None if no arguments have a default value. -->
<!-- `__code__` |   The code object representing the compiled function body. -->
<!-- `__globals__`  | A reference to the dictionary that holds the function’s global variables — the global namespace of the module in which the function was defined. -->
<!-- `__dict__` |   The namespace supporting arbitrary function attributes. -->
<!-- `__closure__` | `None` or a tuple of cells that contain bindings for the function’s free variables. See below for information on the `cell_contents` attribute. -->
<!-- `__annotations__` | A dict containing annotations of parameters. The keys of the dict are the parameter names, and 'return' for the return annotation, if provided. -->
<!-- `__kwdefaults__` | A dict containing defaults for keyword-only parameters. -->
<p>So, for instance, let’s try to find the <em>formal parameter list</em> of a user-defined function below. This is, again, the collection of inputs a function takes. Just like in R, this is not the <em>actual</em> arguments a user will plug in–that isn’t knowable at the time the function is created.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> Here we have another function called <code>add_number()</code> that takes a parameter <code>which_number</code> that is accompanied by a default argument of <code>1</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_number(my_input, which_number <span class="op">=</span> <span class="dv">1</span>): <span class="co"># define a function</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  my_output <span class="op">=</span> my_input <span class="op">+</span> which_number</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> my_output</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>add_number(<span class="dv">3</span>) <span class="co"># no second argument being provided by the user here</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 4</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>add_number.__code__.co_varnames <span class="co"># note this also contains *my_output*</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">## (&#39;my_input&#39;, &#39;which_number&#39;, &#39;my_output&#39;)</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>add_number.__defaults__</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co">## (1,)</span></span></code></pre></div>
<p>The <code>__code__</code> attribute has much more to offer. To see a list of names of all its contents, you can use <code>dir(add_number.__code__)</code>.</p>
<div class="rmd-details">
<p>Don’t worry if the notation <code>add_number.__code__</code> looks strange. The dot (<code>.</code>) operator will become more clear in the future chapter on <em>object-oriented programming</em>. For now, just think of <code>__code__</code> as being an object <em>belonging to</em> <code>add_number</code>. Objects that belong to other objects are called <strong>attributes</strong> in Python. The dot operator helps us access attributes <em>inside</em> other objects. It also helps us access objects belonging to modules that we <code>import</code> into our scripts.</p>
</div>
</div>
<div id="function-scope-in-r" class="section level2" number="6.5">
<h2 number="6.5"><span class="header-section-number">6.5</span> Function Scope in R</h2>
<p>R uses <strong>lexical scoping</strong>. This means, in R,</p>
<ol style="list-style-type: decimal">
<li>functions can use <em>local</em> variables that are defined inside themselves,<br />
</li>
<li>functions can use <em>global</em> variables defined in the environment where the function itself was <em>defined</em> in, and</li>
<li>functions <em>cannot</em> necessarily use <em>global</em> variables defined in the environment where the function was <em>called</em> in, and</li>
<li>functions will prefer <em>local</em> variables to <em>global</em> variables if there is a name clash.</li>
</ol>
<p>The first characteristic is obvious. The second and third are import to distinguish between. Consider the following code below. <code>sillyFunction()</code> can access <code>a</code> because <code>sillyFunction()</code> and <code>a</code> are defined in the same place.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>sillyFunction <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a <span class="sc">+</span> <span class="dv">20</span>) </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(sillyFunction) <span class="co"># the env. it was defined in contains a</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;environment: R_GlobalEnv&gt;</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sillyFunction</span>()</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 23</span></span></code></pre></div>
<p>On the other hand, the following example will not work because <code>a</code> and <code>anotherSillyFunc()</code> are not defined in the same place. Calling the function is not the same as defining a function.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>anotherSillyFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a <span class="sc">+</span> <span class="dv">20</span>) </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>highLevelFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="dv">99</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this isn&#39;t the global environment anotherSillyFunc() was defined in</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;environment inside highLevelFunc(): &quot;</span>, <span class="fu">environment</span>())</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anotherSillyFunc</span>()</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, here is a demonstration of a function preferring one <code>a</code> over another. When <code>sillyFunction()</code> attempts to access <code>a</code>, it first looks in its own body, and so the innermost one gets used. On the other hand, <code>print(a)</code> shows <code>3</code>, the global variable.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>sillyFunction <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a <span class="sc">+</span> <span class="dv">20</span>) </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sillyFunction</span>()</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 40</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span></code></pre></div>
<p>The same concept applies if you create functions within functions. The inner function <code>innerFunc()</code> looks “inside-out” for variables, but only in the place it was defined.</p>
<p>Below we call <code>outerFunc()</code>, which then calls <code>innerFunc()</code>. <code>innerFunc()</code> can refer to the variable <code>b</code>, because it lies in the same environment in which <code>innerFunc()</code> was created. Interestingly, <code>innerFunc()</code> can also refer to the variable <code>a</code>, because that variable was captured by <code>outerFunc()</code>, which provides access to <code>innerFunc()</code>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&quot;outside both&quot;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>outerFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="st">&quot;inside one&quot;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  innerFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(a) </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(b)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">innerFunc</span>())</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">outerFunc</span>()</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;outside both&quot;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;inside one&quot;</span></span></code></pre></div>
<p>Here’s another interesting example. If we ask <code>outerFunc()</code> to return the function <code>innerFunc()</code> (not the return object of <code>innerFunct()</code>…functions are objects, too!), then we might be surprised to see that <code>innerFunc()</code> can still successfully refer to <code>b</code>, even though it doesn’t exist inside the <em>calling environment.</em> But don’t be surprised! What matters is what was available when the function was <em>created</em>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>outerFuncV2 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="st">&quot;inside one&quot;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  innerFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(b)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(innerFunc) <span class="co"># note the missing inner parentheses!</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>myFunc <span class="ot">&lt;-</span> <span class="fu">outerFuncV2</span>() <span class="co"># get a new function</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="fu">environment</span>(myFunc)) <span class="co"># list all data attached to this function</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;b&quot;         &quot;innerFunc&quot;</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="fu">myFunc</span>()</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;inside one&quot;</span></span></code></pre></div>
<p>We use this property all the time when we create functions that return other functions. This is discussed in more detail in chapter @ref(functional-programming). In the above example, <code>outerFuncV2()</code>, the function that returned another function, is called a <em>function factory</em>.</p>
<div class="rmd-details">
<p>Sometimes people will refer to R’s functions as <strong>closures</strong> to emphasize that they are capturing variables from the parent environment in which they were created, to emphasize the data that they are bundled with.</p>
</div>
</div>
<div id="function-scope-in-python" class="section level2" number="6.6">
<h2 number="6.6"><span class="header-section-number">6.6</span> Function Scope in Python</h2>
<p>Python uses <strong>lexical scoping</strong> just like R. This means, in Python,</p>
<ol style="list-style-type: decimal">
<li>functions can use <em>local</em> variables that are defined inside themselves,<br />
</li>
<li>functions have an order of preference for which variable to prefer in the case of a name clash, and</li>
<li>functions can sometimes use variables defined outside itself, but that ability depends on where the function and variable were <em>defined</em>, not where the function was <em>called</em>.</li>
</ol>
<p>Regarding characteristics (2) and (3), there is a famous acronym that describes the rules Python follows when finding and choosing variables: <strong>LEGB</strong>.</p>
<ul>
<li>L: Local,</li>
<li>E: Enclosing,</li>
<li>G: Global, and</li>
<li>B: Built-in.</li>
</ul>
<p>A Python function will search for a variable in these namespaces in this order.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>.</p>
<p>“<em>Local</em>” refers to variables that are defined inside of the function’s block. The function below uses the local <code>a</code> over the global one.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> silly_function():</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="dv">22</span> <span class="co"># local a</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;local variables are &quot;</span>, <span class="bu">locals</span>())</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">+</span> <span class="dv">20</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>silly_function()</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co">## local variables are  {&#39;a&#39;: 22}</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 42</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>silly_function.__code__.co_nlocals <span class="co"># number of local variables</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>silly_function.__code__.co_varnames <span class="co"># names of local variables</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co">## (&#39;a&#39;,)</span></span></code></pre></div>
<p>“<em>Enclosing</em>” refers to variables that were defined in the enclosing namespace, but not the global namespace. These variables are sometimes called <strong>free variables.</strong> In the example below, there is no local <code>a</code> variable for <code>inner_func()</code>, but there is a global one, and one in the enclosing namespace. <code>inner_func()</code> chooses the one in the enclosing namespace. Moreover, <code>inner_func()</code> has its own copy of <code>a</code> to use, even after <code>a</code> was initially destroyed upon the completion of the call to <code>outer_func()</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="st">&quot;outside both&quot;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> outer_func():</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="st">&quot;inside one&quot;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> inner_func():</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(a)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> inner_func</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>my_new_func <span class="op">=</span> outer_func()</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>my_new_func()</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co">## inside one</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>my_new_func.__code__.co_freevars</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co">## (&#39;a&#39;,)</span></span></code></pre></div>
<p>“<em>Global</em>” scope contains variables defined in the module-level namespace. If the code in the below example was the entirety of your script, then <code>a</code> would be a global variable.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="st">&quot;outside both&quot;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> outer_func():</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="st">&quot;inside one&quot;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> inner_func():</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(a) </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  inner_func()</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>outer_func()</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">## outside both</span></span></code></pre></div>
<p>Just like in R, Python functions <strong>cannot</strong> necessarily find variables where the function was <em>called</em>. For example, here is some code that mimics the above R example. Both <code>a</code> and <code>b</code> are accessible from within <code>inner_func()</code>. That is due to LEGB.</p>
<p>However, if we start using <code>outer_func()</code> inside another function, <em>calling</em> it in another function, when it was <em>defined</em> somewhere else, well then it doesn’t have access to variables in the call site. You might be surprised at how the following code functions. Does this print the right string: <code>"this is the a I want to use now!"</code> No!</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="st">&quot;outside both&quot;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> outer_func():</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="st">&quot;inside one&quot;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> inner_func():</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(a) </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> inner_func() </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> third_func():</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="st">&quot;this is the a I want to use now!&quot;</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  outer_func()</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>third_func() </span></code></pre></div>
<pre><code>## outside both
## inside one</code></pre>
<p>If you feel like you understand lexical scoping, great! You should be ready to take on chapter @ref(functional-programming), then. If not, keep playing around with examples. Without understanding the scoping rules R and Python share, writing your own functions will persistently feel more difficult than it really is.</p>
</div>
<div id="modifying-a-functions-arguments" class="section level2" number="6.7">
<h2 number="6.7"><span class="header-section-number">6.7</span> Modifying a Function’s Arguments</h2>
<p>Can/should we modify a function’s argument? The flexibility to do this sounds empowering; however, not doing it is recommended because it makes programs easier to reason about.</p>
<div id="passing-by-value-in-r" class="section level3" number="6.7.1">
<h3 number="6.7.1"><span class="header-section-number">6.7.1</span> Passing By Value In R</h3>
<p>In R, it is <em>difficult</em> for a function to modify one of its argument.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> Consider the following code.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(arg){</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  arg <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># modifying a temporary variable, not a</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(arg)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">f</span>(a))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre></div>
<p>The function <code>f</code> has an argument called <code>arg</code>. When <code>f(a)</code> is performed, changes are made to a <em>copy</em> of <code>a</code>. When a function constructs a copy of all input variables inside its body, this is called <strong>pass-by-value</strong> semantics. This copy is a temporary intermediate value that only serves as a starting point for the function to produce a return value of <code>2</code>.</p>
<p><code>arg</code> could have been called <code>a</code>, and the same behavior will take place. However, giving these two things different names is helpful to remind you and others that R copies its arguments.</p>
<p>It is still possible to modify <code>a</code>, but I don’t recommend doing this either. I will discuss this more in subsection @ref(modifying-a-functions-arguments).</p>
</div>
<div id="passing-by-assignment-in-python" class="section level3" number="6.7.2">
<h3 number="6.7.2"><span class="header-section-number">6.7.2</span> Passing By Assignment In Python</h3>
<p>The story is more complicated in Python. Python functions have <strong>pass-by-assignment</strong> semantics. This is something that is very unique to Python. What this means is that your ability to modify the arguments of a function depends on</p>
<ul>
<li>what the type of the argument is, and</li>
<li>what you’re trying to do to it.</li>
</ul>
<p>We will go throw some examples first, and then explain why this works the way it does. Here is some code that is analogous to the example above.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(arg):</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  arg <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> arg</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f(a))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1</span></span></code></pre></div>
<p>In this case, <code>a</code> is not modified. That is because <code>a</code> is an <code>int</code>. <code>int</code>s are <strong>immutable</strong> in Python, which means that their <a href="https://docs.python.org/3/reference/datamodel.html#objects-values-and-types">value</a> cannot be changed after they are created, either inside or outside of the function’s scope. However, consider the case when <code>a</code> is a <code>list</code>, which is a <strong>mutable</strong> type. A mutable type is one that can have its value changed after its created.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">999</span>]</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(arg):</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  arg[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> arg</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f(a))</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co">## [2]</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a) <span class="co"># not [999] anymore!</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co">## [2]</span></span></code></pre></div>
<p>In this case <code>a</code> <em>is</em> modified. Changing the value of the argument <em>inside</em> the function effects changes to that variable outside of the function.</p>
<p>Ready to be confused? Here is a tricky third example. What happens if we take in a list, but try to do something else with it.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">999</span>]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(arg):</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  arg <span class="op">=</span> [<span class="dv">2</span>]</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> arg</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f(a))</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">## [2]</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a) <span class="co"># didn&#39;t change this time :(</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">## [999]</span></span></code></pre></div>
<p>That time <code>a</code> did not permanently change in the global scope. Why does this happen? I thought <code>list</code>s were mutable!</p>
<p>The reason behind all of this doesn’t even have anything to do with functions, per se. Rather, it has to do with how Python manages, <a href="https://docs.python.org/3/reference/datamodel.html#objects-values-and-types">objects, values, and types</a>. It also has to do with what happens during <a href="https://docs.python.org/3/reference/executionmodel.html#naming-and-binding">assignment</a>.</p>
<p>Let’s revisit the above code, but bring everything out of a function. Python is pass-by-assignment, so all we have to do is understand how assignment works. Starting with the immutable <code>int</code> example, we have the following.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># old code: </span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a = 1</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># def f(arg):</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   arg = 2</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   return arg</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">1</span>    <span class="co"># still done in global scope</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>arg <span class="op">=</span> a  <span class="co"># arg is a name that is bound to the object a refers to</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>arg <span class="op">=</span> <span class="dv">2</span>  <span class="co"># arg is a name that is bound to the object 2</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arg <span class="kw">is</span> a)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">id</span>(a), <span class="bu">id</span>(arg)) <span class="co"># different!`</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 140343715792224 140343715792256</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 1</span></span></code></pre></div>
<div class="rmd-details">
<p>The <a href="https://docs.python.org/3/library/functions.html#id"><code>id()</code></a> function returns the <strong>identity</strong> of an object, which is kind of like its memory address. Identities of objects are unique and constant. If two variables, <code>a</code> and <code>b</code> say, have the same identity, <code>a is b</code> will evaluate to <code>True</code>. Otherwise, it will evaluate to <code>False</code>.</p>
</div>
<p>In the first line, the <em>name</em> <code>a</code> is bound to the <em>object</em> <code>1</code>. In the second line, the name <code>arg</code> is bound to the <em>object</em> that is referred to by the <em>name</em> <code>a</code>. After the second line finishes, <code>arg</code> and <code>a</code> are two names for the same object (a fact that you can confirm by inserting <code>arg is a</code> immediately after this line).</p>
<p>In the third line, <code>arg</code> is bound to <code>2</code>. The variable <code>arg</code> can be changed, but only by re-binding it with a separate object. Re-binding <code>arg</code> does not change the value referred to by <code>a</code> because <code>a</code> still refers to <code>1</code>, an object separate from <code>2</code>. There is no reason to re-bind <code>a</code> because it wasn’t mentioned at all in the third line.</p>
<p>If we go back to the first function example, it’s basically the same idea. The only difference, however, is that <code>arg</code> is in its own scope. Let’s look at a simplified version of our second code chunk that uses a mutable list.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">999</span>]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># old code:</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># def f(arg):</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   arg[0] = 2</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   return arg</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>arg <span class="op">=</span> a</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>arg[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arg)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co">## [2]</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="co">## [2]</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arg <span class="kw">is</span> a)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span></code></pre></div>
<p>In this example, when we run <code>arg = a</code>, the name <code>arg</code> is bound to the same object that is bound to <code>a</code>. This much is the same. The only difference here, though, is that because lists are mutable, changing the first element of <code>arg</code> is done “in place,” and all variables can access the mutated object.</p>
<p>Why did the third example produce unexpected results? The difference is in the line <code>arg = [2]</code>. This rebinds the name <code>arg</code> to a different variable. <code>list</code>s are still mutable, but this has nothing to do with re-binding–re-binding a name works no matter what type of object you’re binding it to. In this case we are re-binding <code>arg</code> to a completely different list.</p>
</div>
</div>
<div id="accessing-and-modifying-captured-variables" class="section level2" number="6.8">
<h2 number="6.8"><span class="header-section-number">6.8</span> Accessing and Modifying Captured Variables</h2>
<p>In the last section, we were talking about variables that were passed in as function arguments. Here we are talking about variables that are <strong>captured</strong>. They are not passed in as variables, but they are still used inside a function. In general, even though it is possible to access and modify non-local captured variables in both languages, it is not a good idea.</p>
<div id="accessing-captured-variables-in-r" class="section level3" number="6.8.1">
<h3 number="6.8.1"><span class="header-section-number">6.8.1</span> Accessing Captured Variables in R</h3>
<p>As Hadley Wickham writes in <a href="https://adv-r.hadley.nz/functions.html#dynamic-lookup">his book</a>, “[l]exical scoping determines where, but not when to look for values.” R has <strong>dynamic lookup</strong>, meaning code inside a function will only try to access a referred-to variable when the function is <em>running</em>, not when it is defined.</p>
<p>Consider the R code below. The <code>dataReadyForModeling()</code> function is created in the global environment, and the global environment contains a Boolean variable called <code>dataAreClean</code>.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>dataAreClean <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>dataReadyForModeling <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dataAreClean)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>dataAreClean <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># readyToDoSecondPart() # what happens if we call it now?</span></span></code></pre></div>
<p>Now imagine sharing some code with a collaborator. Imagine, further, that your collaborator is the subject-matter expert, and knows little about R programming. Suppose that he changes <code>dataAreClean</code>, a global variable in the script, after he is done . Shouldn’t this induce a relatively trivial change to the overall program?</p>
<p>Let’s explore this hypothetical further. Consider what could happen if any of the following (very typical) conditions are true:</p>
<ul>
<li>you or your collaborators aren’t sure what <code>dataReadyForModeling()</code> will return because you don’t understand dynamic lookup, or</li>
<li>it’s difficult to visually keep track of all assignments to <code>dataAreClean</code> (e.g. your script is quite long or it changes often), or</li>
<li>you are not running code sequentially (e.g. you are repeatedly testing chunks at a time instead of clearing out your memory and <code>source()</code>ing from scratch, over and over again).</li>
</ul>
<p>In each of these situations, understanding of the program would be compromised. However, if you follow the above principle of never referring to non-local variables in function code, all members of the group could do their own work separately, minimizing the dependence on one another.</p>
<p>Another reason violating this could be troublesome is if you define a function that refers to a nonexistent variable. <em>Defining</em> the function will never throw an error because R will assume that variable is defined in the global environment. <em>Calling</em> the function might throw an error, unless you accidentally defined the variable, or if you forgot to delete a variable whose name you no longer want to use. Defining <code>myFunc()</code> with the code below will not throw an error, even if you think it should!</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>myFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(varigbleNameWithTypo) <span class="co">#varigble?</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="accessing-captured-variables-in-python" class="section level3" number="6.8.2">
<h3 number="6.8.2"><span class="header-section-number">6.8.2</span> Accessing Captured Variables in Python</h3>
<p>It is the same exact situation in Python. Consider <code>everything_is_safe()</code>, a function that is analogous to <code>dataReadyForModeling()</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># python</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>missile_launch_codes_set <span class="op">=</span> <span class="va">True</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> everything_is_safe():</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">not</span> missile_launch_codes_set</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>missile_launch_codes_set <span class="op">=</span> <span class="va">False</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>everything_is_safe()</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span></code></pre></div>
<p>We can also define <code>my_func()</code>, which is analogous to <code>myFunc()</code>. Defining this function doesn’t throw an error either.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># python</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_func():</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> varigble_name_with_typo</span></code></pre></div>
<p>So stay away from referring to variables outside the body of your function!</p>
</div>
<div id="modifying-captured-variables-in-r" class="section level3" number="6.8.3">
<h3 number="6.8.3"><span class="header-section-number">6.8.3</span> Modifying Captured Variables In R</h3>
<p>Now what if we want to be extra bad, and in addition to <em>accessing</em> global variables, we <em>modify</em> them, too?</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>makeATwo <span class="ot">&lt;-</span> <span class="cf">function</span>(arg){</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  arg <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;&lt;-</span> arg</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">makeATwo</span>(a))</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>In the program above, <code>makeATwo()</code> copies <code>a</code> into <code>arg</code>. It then assigns <code>2</code> to that copy. <strong>Then it takes that <code>2</code> and writes it to the global <code>a</code> variable in the parent environment.</strong> It does this using R’s super assignment operator <code>&lt;&lt;-</code>. Regardless of the inputs passed in to this function, it will always assign exactly <code>2</code> to <code>a</code>, no matter what.</p>
<p>This is problematic because you are pre-occupying your mind with one function: <code>makeATwo()</code>. Whenever you write code that depends on <code>a</code> (or on things that depend on <code>a</code>, or on things that depended on things that depend on <code>a</code>, or …), you’ll have to repeatedly interrupt your train of thought to <em>try</em> and remember if what you’re doing is going to be okay with the current and future <code>makeATwo()</code> call sites.</p>
</div>
<div id="modifying-captured-variables-in-python" class="section level3" number="6.8.4">
<h3 number="6.8.4"><span class="header-section-number">6.8.4</span> Modifying Captured Variables In Python</h3>
<p>There is something in Python that is similar to R’s super assignment operator (<code>&lt;&lt;-</code>). It is the <code>global</code> keyword. This keyword will let you modify global variables from inside a function.</p>
<div class="rmd-details">
<p>The upside to the <code>global</code> keyword is that it makes hunting for <strong>side effects</strong> relatively easy (A function’s side effects are changes it makes to non-local variables). Yes, this keyword should be used sparingly, even more sparingly than merely referring to global variables, but if you are ever debugging, and you want to hunt down places where variables are surprisingly being changed, you can hit <code>Ctrl-F</code> and search for the phrase “global.”</p>
</div>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> increment_a():</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">global</span> a</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  a <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>[increment_a() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">## [None, None, None, None, None, None, None, None, None, None]</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 11</span></span></code></pre></div>
</div>
</div>
<div id="exercises-4" class="section level2" number="6.9">
<h2 number="6.9"><span class="header-section-number">6.9</span> Exercises</h2>
<div id="r-questions-4" class="section level3" number="6.9.1">
<h3 number="6.9.1"><span class="header-section-number">6.9.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you have a matrix <span class="math inline">\(\mathbf{X} \in \mathbb{R}^{n \times p}\)</span> and a column vector <span class="math inline">\(\mathbf{y} \in \mathbb{R}^{n}\)</span>. To estimate the linear regression model
<span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \epsilon,
\]</span>
where <span class="math inline">\(\boldsymbol{\beta} \in \mathbb{R}^p\)</span> is a column vector of errors, you can use calculus instead of numerical optimization. The formula for the least squares estimate of <span class="math inline">\(\boldsymbol{\beta}\)</span> is
<span class="math display">\[
\hat{\boldsymbol{\beta}} = (\mathbf{X}^\intercal \mathbf{X})^{-1} \mathbf{X}^\intercal \mathbf{y}.
\]</span></p>
<p>Once this <span class="math inline">\(p\)</span>-dimensional vector is found, you can also obtain the <em>predicted (or fitted) values</em></p>
<p><span class="math display">\[
\hat{\mathbf{y}} := \mathbf{X}\hat{\boldsymbol{\beta}},
\]</span>
and the <em>residuals (or errors)</em></p>
<p><span class="math display">\[
\mathbf{y} - \hat{\mathbf{y}}
\]</span></p>
<p>Write a function called <code>getLinModEstimates()</code> that takes in two arguments in the following order:
a. the <code>vector</code> of response data <span class="math inline">\(\mathbf{y}\)</span>
b. the <code>matrix</code> of predictors <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p>Have it return a named <code>list</code> with three outputs inside:</p>
<ol style="list-style-type: lower-alpha">
<li>the coefficient estimates as a <code>vector</code>,</li>
<li>a <code>vector</code> of fitted values, and</li>
<li>a <code>vector</code> of residuals.</li>
</ol>
<p>The three elements of the returned list should have the names <code>coefficients</code>, <code>fitVals</code>, and <code>residuals</code>.</p>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Write a function called <code>monteCarlo</code> that</p>
<ul>
<li>takes as an input a function <code>sim(n)</code> that simulates <code>n</code> scalar variables,<br />
</li>
<li>takes as an input a function that evaluates <span class="math inline">\(f(x)\)</span> on each random variable sample and that ideally takes in all of the random variables as a <code>vector</code>, and</li>
<li>returns a function that takes one integer-valued argument (<code>num_sims</code>) and outputs a length one <code>vector</code>.</li>
</ul>
<p>Assume <code>sim(n)</code> only has one argument: <code>n</code>, which is the number of simulations desired. <code>sim(n)</code>’s output should be a length <code>n</code> <code>vector</code>.</p>
<p>The output of this returned function should be a Monte Carlo estimate of the expectation: <span class="math inline">\(\mathbb{E}[f(X)] \approx \frac{1}{n}\sum_{i=1}^n f(X^i)\)</span>.</p>
<ol start="3" style="list-style-type: decimal">
<li></li>
</ol>
<p>Write a function called <code>myDFT()</code> that computes the <strong>Discrete Fourier Transform</strong> of a <code>vector</code> and returns another <code>vector</code>. Feel free to check your work against <code>spec.pgram()</code>, <code>fft()</code>, or <code>astsa::mvspec()</code>, but do not include calls to those functions in your submission. Also, you should be aware that different functions transform and scale the answer differently, so be sure to read the documentation of any function you use to test against.</p>
<p>Given data <span class="math inline">\(x_1,x_2,\ldots,x_n\)</span>, <span class="math inline">\(i = \sqrt{-1}\)</span>, and the <strong>Fourier/fundamental frequencies</strong> <span class="math inline">\(\omega_j= j/n\)</span> for <span class="math inline">\(j=0,1,\ldots,n-1\)</span>, we define the discrete Fourier transform (DFT) as:</p>
<p><span class="math display">\[\begin{equation} \label{eq:DFT}
d(\omega_j)= n^{-1/2} \sum_{t=1}^n x_t e^{-2 \pi i \omega_j t}
\end{equation}\]</span></p>
</div>
<div id="python-questions-4" class="section level3" number="6.9.2">
<h3 number="6.9.2"><span class="header-section-number">6.9.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Estimating statistical models often involves some form of optimization, and often times, optimization is performed numerically. One of the most famous optimization algorithms is Newton’s method TODO cite.</p>
<p>Suppose you have a function <span class="math inline">\(f(x)\)</span> that takes a scalar-valued input and returns a scalar as well. Also, suppose you have the function’s derivative <span class="math inline">\(f&#39;(x)\)</span>, its second derivative <span class="math inline">\(f&#39;&#39;(x)\)</span>, and a starting point guess for what the minimizing input of <span class="math inline">\(f(x)\)</span> is: <span class="math inline">\(x_0\)</span>.</p>
<p>The algorithm repeatedly applies the following recursion:</p>
<p><span class="math display">\[
x_{n+1} = x_{n} - \frac{f&#39;(x_n)}{f&#39;&#39;(x_{n})}.
\]</span>
Under appropriate regularity conditions for <span class="math inline">\(f\)</span>, after many iterations of the above recursion, when <span class="math inline">\(\tilde{n}\)</span> is very large, <span class="math inline">\(x_{\tilde{n}}\)</span> will be nearly the same as <span class="math inline">\(x_{\tilde{n}-1}\)</span>, and <span class="math inline">\(x_{\tilde{n}}\)</span> is pretty close to <span class="math inline">\(\text{argmin}_x f(x)\)</span>. In other words, <span class="math inline">\(x_{\tilde{n}}\)</span> is the minimizer of <span class="math inline">\(f\)</span>, and a root of <span class="math inline">\(f&#39;\)</span>.</p>
<ul>
<li>Write a function called <code>f</code> that takes a <code>float</code> <code>x</code> and returns <span class="math inline">\((x-42)^2 - 33\)</span>.</li>
<li>Write a function called <code>f_prime</code> that takes a <code>float</code> and returns the derivative of the above.</li>
<li>Write a function called <code>f_dub_prime</code> that takes a <code>float</code> and returns an evaluation of the second derivative of <span class="math inline">\(f\)</span>.</li>
<li>Theoretically, what is the minimizer of <span class="math inline">\(f\)</span>? Assign your answer to the variable <code>best_x</code>.</li>
<li>Write a function called <code>minimize()</code> that takes three arguments, and performs <strong>ten iterations</strong> of Newton’s algorithm, after which it returns <span class="math inline">\(x_{10}\)</span>. Don’t be afraid of copy/pasting ten or so lines of code. We haven’t learned loops yet, so that’s fine. The ordered arguments are:
<ul>
<li>the function that evaluates the derivative of the function you’re interested in,</li>
<li>the function that evaluates the second derivative of your objective function,</li>
<li>an initial guess of the minimizer.</li>
</ul></li>
<li>Test your function by plugging in the above functions, and use a starting point of <span class="math inline">\(10\)</span>. Assign the output to a variable called <code>x_ten</code>.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Write a function called <code>smw_inverse(A,U,C,V)</code> that returns the inverse of a matrix using the <strong>Sherman-Morrison-Woodbury formula</strong> <span class="citation">(<a href="#ref-woodbury" role="doc-biblioref">Guttman 1946</a>)</span>. Have it take the arguments <span class="math inline">\(A\)</span>, <span class="math inline">\(U\)</span>, <span class="math inline">\(C\)</span>, and <span class="math inline">\(V\)</span> in that order and as Numpy <code>ndarray</code>s. Assume that <code>A</code> is a diagonal matrix.</p>
<p><span class="math display">\[
(A + UCV)^{-1} = A^{-1} - A^{-1}U(C^{-1} + VA^{-1}U)^{-1}V A^{-1}
\]</span>
Despite being difficult to remember, this formula can be quite handy for speeding up matrix inversions when <span class="math inline">\(A\)</span> and <span class="math inline">\(C\)</span> are easier to invert (e.g. if <span class="math inline">\(A\)</span> is diagonal and <span class="math inline">\(C\)</span> is a scalar). The formula often shows up a lot in applications where you multiply matrices together (there are many such examples).</p>
<p>To check your work, pick certain inputs, and make sure your formula corresponds with the naive, left-hand-side approach.</p>
<!--chapter:end:06-functions.Rmd-->
</div>
</div>
</div>
<div id="categorical-data" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Categorical Data</h1>
<p>While statisticians may describe data as being either categorical or numerical, this classification is different than classifying data by its <em>type</em> in a program. So, strictly speaking, if you have categorical data, you are not obligated to use any particular type to represent it in your script.</p>
<p>However, there are types that are specifically designed to be used with categorical data, and so they are especially advantageous to use if you end up with the opportunity. We describe a few of them here in this chapter.</p>
<div id="factors-in-r" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> <code>factor</code>s in R</h2>
<p>Categorical data in R is often stored in a <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Factors"><code>factor</code></a> variable. <code>factor</code>s are more special than <code>vector</code>s of integers because</p>
<ul>
<li>they have a <code>levels</code> attribute, which is comprised of all the possible values that each response could be;</li>
<li>they may or may not be <em>ordered</em>, which will also control how they are used in mathematical functions;</li>
<li>they might have a <code>contrasts</code> attribute, which will control how they are used in statistical modeling functions.</li>
</ul>
<p>Here is a first example. Say we asked three people what their favorite season was. The data might look something like this.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>allSeasons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;spring&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;winter&quot;</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>responses <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;summer&quot;</span>), </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> allSeasons)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(responses)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;spring&quot; &quot;summer&quot; &quot;autumn&quot; &quot;winter&quot;</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(responses)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ordered</span>(responses)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] FALSE</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="co">#contrasts(responses) # controls how factor is used in different  functions</span></span></code></pre></div>
<p><code>factor</code>s always have levels, which is the collection of all possible unique values each observation can take.</p>
<div class="rmd-caution">
<p>You should be careful if you are not specifying them directly. What happens when you use the default option and replace the second assignment in the above code with <code>responses &lt;- factor(c("autumn", "summer", "summer"))</code>? The documentation of <code>factor()</code> will tell you that, by default, <code>factor()</code> will just take the unique values found in the data. In this case, nobody prefers winter or spring, and so neither will show up in <code>levels(responses)</code>. This may or may not be what you want.</p>
</div>
<p><code>factor</code>s can be ordered or unordered. Ordered <code>factor</code>s are for <em>ordinal</em> data. Ordinal data is a particular type of categorical data that recognizes the categories have a natural order (e.g. low/ medium/high and not red/green/blue).</p>
<p>As another example, say we asked ten people how much they liked statistical computing, and they could only respond “love it,” “it’s okay” or “hate it.” The data might look something like this.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>ordFeelOptions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;hate it&quot;</span>, <span class="st">&quot;it&#39;s okay&quot;</span>, <span class="st">&quot;love it&quot;</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>responses <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;love it&quot;</span>, <span class="st">&quot;it&#39;s okay&quot;</span>, <span class="st">&quot;love it&quot;</span>, </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;love it&quot;</span>, <span class="st">&quot;it&#39;s okay&quot;</span>, <span class="st">&quot;love it&quot;</span>, </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;love it&quot;</span>, <span class="st">&quot;love it&quot;</span>, <span class="st">&quot;it&#39;s okay&quot;</span>, </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;it&#39;s okay&quot;</span>), </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> ordFeelOptions,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(responses)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;hate it&quot;   &quot;it&#39;s okay&quot; &quot;love it&quot;</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(responses)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ordered</span>(responses)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="co"># contrasts(responses)</span></span></code></pre></div>
<div class="rmd-caution">
<p>When creating ordered factors with <code>factor()</code>, be mindful that the <code>levels=</code> argument is assumed to be ordered when you plug it into <code>factor()</code>. In the above example, if you specified <code>levels = c("love it", "it's okay", "hate it")</code>, then the factor would assume <code>love it &lt; it's okay &lt; hate it</code>, which may or may not be what you want.</p>
</div>
<p>Last, <code>factor</code>s may or may not have a <code>contrast</code> attribute. You can get or set this with the <code>contrasts()</code> function. This will influence some of the functions you use on your data that estimate statistical models.</p>
<p>I will not discuss specifics of contrasts in this text, but the overall motivation is important. In short, the primary reason for using <code>factor</code>s is that they are designed to allow control over <em>how</em> you model categorical data. To be more specific, changing attributes of a <code>factor</code> could control the paremeterization of a model you’re estimating. If you’re using a particular function for modeling with categorical data, you need to know how it treats factors. On the other hand, if you’re writing a function that performs modeling of categorical data, you should know how to treat factors.</p>
<p>Here are two examples that you might come across in your studies.</p>
<ol style="list-style-type: decimal">
<li><p>Consider using <code>factor</code>s as inputs to a function that performs linear regression. With linear regression models, if you have categorical inputs, there are many choices for how to write down a model. In each model, the collection of parameters will mean different things. In R, you might pick the model by creating the <code>factor</code> in a specific way.</p></li>
<li><p>Suppose you are interested in estimating a classification model. In this case, the <em>dependent</em> variable is categorical, not the independent variable. With these types of models, choosing whether or not your <code>factor</code> is ordered is critical. These options would estimate completely different models, so choose wisely!</p></li>
</ol>
<p>The mathematical details of these examples is outside of the scope of this text. If you have not learned about dummy variables in a regression course, or if you have not considered the difference between multinomial logistic regression and ordinal logistic regression, or if you have but you’re just a little rusty, that is totally fine. I only mention these as examples for how the <code>factor</code> type can trigger special behavior.</p>
<p>In addition to creating one with <code>factor()</code>, there are two other common ways that you can end up with <code>factors</code>:</p>
<ol style="list-style-type: decimal">
<li>creating factors from numerical data, and</li>
<li>when reading in an external data file, one of the columns is coerced to a <code>factor</code>.</li>
</ol>
<p>Here is an example of (1). We can take non-categorical data, and <code>cut()</code> it into something categorical.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>stockReturns <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>) <span class="co"># not categorical here</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>typeOfDay <span class="ot">&lt;-</span> <span class="fu">cut</span>(stockReturns, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">0</span>, <span class="cn">Inf</span>)) </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>typeOfDay</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] (0, Inf] (0, Inf] (0, Inf] (-Inf,0] (0, Inf] (0, Inf] (-Inf,0] (-Inf,0] (0, Inf] (-Inf,0]</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Levels: (-Inf,0] (0, Inf]</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(typeOfDay)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;(-Inf,0]&quot; &quot;(0, Inf]&quot;</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(typeOfDay)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ordered</span>(typeOfDay)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] FALSE</span></span></code></pre></div>
<p>Finally, be mindful of how different functions read in external data sets. When reading in an external file, if a particular function comes across a column that has characters in it, it will need to decide whether to store that column as a character vector, or as a <code>factor</code>. For example, <code>read.csv()</code> and <code>read.table()</code> have a <code>stringsAsFactors=</code> argument that you should be mindful of.</p>
</div>
<div id="two-options-for-categorical-data-in-pandas" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> Two Options for Categorical Data in Pandas</h2>
<p>Pandas provides two options for storing categorical data. They are both very similar to R’s <code>factor</code>s. You may use either</p>
<ol style="list-style-type: decimal">
<li>a Pandas <code>Series</code> with a special <code>dtype</code>, or</li>
<li>a Pandas <code>Categorical</code> container.</li>
</ol>
<p>Pandas’ <code>Series</code> were discussed earlier in sections @ref(overview-of-python) and @ref(vectorization-in-python). These were containers that forced every element to share the same <code>dtype</code>. Here, we specify <code>dtype="category"</code> in <code>pd.Series()</code>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>resp_series <span class="op">=</span> pd.Series([<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;summer&quot;</span>], dtype <span class="op">=</span> <span class="st">&quot;category&quot;</span>) </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>resp_series.cat.categories</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Index([&#39;autumn&#39;, &#39;summer&#39;], dtype=&#39;object&#39;)</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>resp_series.cat.ordered</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>resp_series.dtype</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co">## CategoricalDtype(categories=[&#39;autumn&#39;, &#39;summer&#39;], ordered=False)</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(resp_series)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;pandas.core.series.Series&#39;&gt;</span></span></code></pre></div>
<p>The second option is to use Pandas’ <code>Categorical</code> containers. They are quite similar, so the choice is subtle. Like <code>Series</code> containers, they also force all of their elements to share the same shared <code>dtype</code>.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>resp_cat <span class="op">=</span> pd.Categorical([<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;summer&quot;</span>])</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>resp_cat.categories</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Index([&#39;autumn&#39;, &#39;summer&#39;], dtype=&#39;object&#39;)</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>resp_cat.ordered</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>resp_cat.dtype</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co">## CategoricalDtype(categories=[&#39;autumn&#39;, &#39;summer&#39;], ordered=False)</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(resp_cat)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;pandas.core.arrays.categorical.Categorical&#39;&gt;</span></span></code></pre></div>
<p>You might have noticed that, with the <code>Categorical</code> container, methods and data members were not accessed through the <code>.cat</code> accessor. It is also more similar to R’s <code>factor</code>s because you can specify more arguments in the constructor.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>all_szns <span class="op">=</span> [<span class="st">&quot;spring&quot;</span>,<span class="st">&quot;summer&quot;</span>, <span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;winter&quot;</span>]</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>resp_cat2 <span class="op">=</span> pd.Categorical([<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;summer&quot;</span>], </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                            categories <span class="op">=</span> all_szns, </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                            ordered <span class="op">=</span> <span class="va">False</span>)</span></code></pre></div>
<div class="rmd-caution">
<p>In Pandas, just like in R, you need to be very careful about what the <code>categories</code> (c.f <code>levels</code>) are. If you are using ordinal data, they need to be specified in the correct order. If you are using small data sets, be cognizant of whether all the categories show up in the data–otherwise they will not be correctly inferred.</p>
</div>
<p>With Pandas’ <code>Series</code> it’s more difficult to specify a nondefault <code>dtype</code>. One option is to change them after the object has been created.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>resp_series <span class="op">=</span> resp_series.cat.set_categories([<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>,<span class="st">&quot;spring&quot;</span>,<span class="st">&quot;winter&quot;</span>])</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>resp_series.cat.categories</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Index([&#39;autumn&#39;, &#39;summer&#39;, &#39;spring&#39;, &#39;winter&#39;], dtype=&#39;object&#39;)</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>resp_series <span class="op">=</span> resp_series.cat.remove_categories([<span class="st">&#39;spring&#39;</span>,<span class="st">&#39;winter&#39;</span>])</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>resp_series.cat.categories</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Index([&#39;autumn&#39;, &#39;summer&#39;], dtype=&#39;object&#39;)</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>resp_series <span class="op">=</span> resp_series.cat.add_categories([<span class="st">&quot;fall&quot;</span>, <span class="st">&quot;winter&quot;</span>])</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>resp_series.cat.categories</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Index([&#39;autumn&#39;, &#39;summer&#39;, &#39;fall&#39;, &#39;winter&#39;], dtype=&#39;object&#39;)</span></span></code></pre></div>
<p>Another option is to create the <code>dtype</code> before you create the <code>Series</code>, and pass it into <code>pd.Series()</code>.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>cat_type <span class="op">=</span> pd.CategoricalDtype(</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                  categories<span class="op">=</span>[<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;spring&quot;</span>, <span class="st">&quot;winter&quot;</span>],</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                  ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>responses <span class="op">=</span> pd.Series([<span class="st">&quot;autumn&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;summer&quot;</span>], dtype <span class="op">=</span> cat_type)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>responses</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    autumn</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    summer</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    summer</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: category</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Categories (4, object): [&#39;autumn&#39; &lt; &#39;summer&#39; &lt; &#39;spring&#39; &lt; &#39;winter&#39;]</span></span></code></pre></div>
<p>Just like in R, you can convert numerical data into categorical. The function even has the same name as in R: <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html#series-creation"><code>pd.cut()</code></a>. Depending on the type of the input, <a href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html">it will return either a <code>Series</code> or a <code>Categorical</code></a>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>stock_returns <span class="op">=</span> np.random.normal(size<span class="op">=</span><span class="dv">10</span>) <span class="co"># not categorical </span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>type_of_day <span class="op">=</span> pd.cut(stock_returns, <span class="co"># array input means Categorical output</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                     bins <span class="op">=</span> [<span class="op">-</span>np.inf, <span class="dv">0</span>, np.inf], </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>                     labels <span class="op">=</span> [<span class="st">&#39;bad day&#39;</span>, <span class="st">&#39;good day&#39;</span>]) </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(type_of_day)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;pandas.core.arrays.categorical.Categorical&#39;&gt;</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>type_of_day2 <span class="op">=</span> pd.cut(pd.Series(stock_returns), <span class="co"># Series in means Series out</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>                      bins <span class="op">=</span> [<span class="op">-</span>np.inf, <span class="dv">0</span>, np.inf], </span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>                      labels <span class="op">=</span> [<span class="st">&#39;bad day&#39;</span>, <span class="st">&#39;good day&#39;</span>]) </span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(type_of_day2)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;pandas.core.series.Series&#39;&gt;</span></span></code></pre></div>
<p>Finally, when reading in data from an external source, choose carefully whether you want character data to be stored as a string type, or as a categorical type. Here we use <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html"><code>pd.read_csv()</code></a> to read in Fisher’s Iris data set <span class="citation">(<a href="#ref-misc_iris_53" role="doc-biblioref">Fisher 1988</a>)</span>. More information on Pandas’ <code>DataFrames</code> can be found in the next chapter.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>my_data <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/iris.csv&quot;</span>, header<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>                      dtype <span class="op">=</span> {<span class="dv">4</span>:<span class="st">&quot;category&quot;</span>}) <span class="co"># make 5th col categorical</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>my_data.head(<span class="dv">1</span>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co">##      0    1    2    3            4</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  5.1  3.5  1.4  0.2  Iris-setosa</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>my_data.dtypes</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 0     float64</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     float64</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 2     float64</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 3     float64</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    category</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: object</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>np.unique(my_data[<span class="dv">4</span>])</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co">## array([&#39;Iris-setosa&#39;, &#39;Iris-versicolor&#39;, &#39;Iris-virginica&#39;], dtype=object)</span></span></code></pre></div>
</div>
<div id="exercises-5" class="section level2" number="7.3">
<h2 number="7.3"><span class="header-section-number">7.3</span> Exercises</h2>
<div id="r-questions-5" class="section level3" number="7.3.1">
<h3 number="7.3.1"><span class="header-section-number">7.3.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Read in this chess data set <span class="citation">(<a href="#ref-misc_chess" role="doc-biblioref"><span>“<span class="nocase">Chess (King-Rook vs. King-Pawn)</span>”</span> 1989</a>)</span> with the following code. You will probably have to change your working directory, but if you do, make sure to comment out that code before you submit your script to me.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;kr-vs-kp.data&quot;</span>, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<ul>
<li>Are all of the columns <code>factor</code>s? Assign <code>TRUE</code> or <code>FALSE</code> to <code>allFactors</code>.</li>
<li>Should any of these <code>factor</code>s be ordered? Assign <code>TRUE</code> or <code>FALSE</code> to <code>ideallyOrdered</code>. Hint: read the data set description from <a href="https://archive.ics.uci.edu/ml/datasets/Chess+%28King-Rook+vs.+King-Pawn%29">https://archive.ics.uci.edu/ml/datasets/Chess+%28King-Rook+vs.+King-Pawn%29</a>.</li>
<li>Are any of these factors currently ordered? Assign <code>TRUE</code> or <code>FALSE</code> to <code>currentlyOrdered</code>.</li>
<li>What percent (between <span class="math inline">\(0\)</span> and <span class="math inline">\(100\)</span>) of the time is the first column equal to <code>'f'</code>? Assign your answer to <code>percentF</code>.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you have the following <code>vector</code>. Please make sure to include this code in your script.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>normSamps <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span></code></pre></div>
<ul>
<li>create a <code>factor</code> from <code>normSamps</code>. Map each element to <code>"within 1 sd"</code> or <code>"outside 1 sd"</code> depending on whether the element is within <span class="math inline">\(1\)</span> theoretical standard deviation of <span class="math inline">\(0\)</span> or not. Call the <code>factor</code> <code>withinOrNot</code>.</li>
</ul>
</div>
<div id="python-questions-5" class="section level3" number="7.3.2">
<h3 number="7.3.2"><span class="header-section-number">7.3.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Consider the following simulated letter grade data for two students:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>poss_grades <span class="op">=</span> [<span class="st">&#39;A+&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;A-&#39;</span>,<span class="st">&#39;B+&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;B-&#39;</span>,<span class="st">&#39;C+&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;C-&#39;</span>,<span class="st">&#39;D+&#39;</span>,<span class="st">&#39;D&#39;</span>,<span class="st">&#39;D-&#39;</span>,<span class="st">&#39;F&#39;</span>]</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>grade_values <span class="op">=</span> {<span class="st">&#39;A+&#39;</span>:<span class="fl">4.0</span>,<span class="st">&#39;A&#39;</span>:<span class="fl">4.0</span>,<span class="st">&#39;A-&#39;</span>:<span class="fl">3.7</span>,<span class="st">&#39;B+&#39;</span>:<span class="fl">3.3</span>,<span class="st">&#39;B&#39;</span>:<span class="fl">3.0</span>,<span class="st">&#39;B-&#39;</span>:<span class="fl">2.7</span>,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;C+&#39;</span>:<span class="fl">2.3</span>,<span class="st">&#39;C&#39;</span>:<span class="fl">2.0</span>,<span class="st">&#39;C-&#39;</span>:<span class="fl">1.7</span>,<span class="st">&#39;D+&#39;</span>:<span class="fl">1.3</span>,<span class="st">&#39;D&#39;</span>:<span class="fl">1.0</span>,<span class="st">&#39;D-&#39;</span>:<span class="fl">.67</span>,<span class="st">&#39;F&#39;</span>:<span class="fl">0.0</span>}</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>student1 <span class="op">=</span> np.random.choice(poss_grades, size <span class="op">=</span> <span class="dv">10</span>, replace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>student2 <span class="op">=</span> np.random.choice(poss_grades, size <span class="op">=</span> <span class="dv">12</span>, replace <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
<ul>
<li>Convert the two Numpy arrays to one of the Pandas types for categorical data that the textbook discussed. Call these two variables <code>s1</code> and <code>s2</code>.</li>
<li>These data are categorical. Are they ordinal? Make sure to adjust <code>s1</code> and <code>s2</code> accordingly.</li>
<li>Calculate the two student GPAs. Assign the floating point numbers to variables named <code>s1_gpa</code> and <code>s2_gpa</code>. Use <code>grade_values</code> to convert each letter grade to a number, and then average all the numbers for each student together using equal weights.</li>
<li>Is each category equally-spaced? If yes, then these are said to be <em>interval data</em>. Does your answer to this question affect the legitimacy of averaging together any ordinal data? Assign a <code>str</code> response to the variable <code>ave_ord_data_response</code>. Hint: consider (any) two different data sets that happen to produce the same GPA. Is the equality of these two GPAs misleading?</li>
<li>Compute the mode grade for each student. Assign your answers as <code>str</code>s to the variables <code>s1_mode</code> and <code>s2_mode</code>. If there are more than one modes, then assign the one that comes first alphabetically.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you are creating a <em>classifier</em> whose job it is to predict labels. Consider the following <code>DataFrame</code> of predicted labels next to their corresponding actual labels. Please make sure to include this code in your script.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.DataFrame({<span class="st">&#39;predicted label&#39;</span> : [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>], </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;actual label&#39;</span>: [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]}, </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>                 dtype<span class="op">=</span><span class="st">&#39;category&#39;</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(d.dtypes)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="co">## [CategoricalDtype(categories=[1, 2, 3], ordered=False), CategoricalDtype(categories=[1, 2, 3], ordered=False)]</span></span></code></pre></div>
<ul>
<li>Assign the prediction accuracy, as a percent (between <span class="math inline">\(0\)</span> and <span class="math inline">\(100\)</span>), to the variable <code>perc_acc</code>.</li>
<li>Create a <em>confusion matrix</em> to better assess <em>which</em> labels your classifier has a difficult time with. This should be a <span class="math inline">\(3 \times 3\)</span> Numpy <code>ndarray</code> of percentages. The row will correspond to the predicted label, the column will correspond to the actual label, and number in location <span class="math inline">\((0,2)\)</span>, say, will be the percent of observations where your model predicted label <code>1</code> and the actual was a label <code>3</code>. Call the variable <code>confusion</code>.</li>
</ul>
<!--chapter:end:07-categorical_data.Rmd-->
</div>
</div>
</div>
<div id="data-frames" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Data Frames</h1>
<p>The rectangular array (e.g. an Excel spreadsheet ) of information is what many think of when they hear the word “data.” Each column contains elements of a shared data type, and these data types can vary from column to column.</p>
<p>There is a type for this in R and Python: a data frame. It might even be the most common way that data is stored in both R and Python programs because many functions that read in data from an external source return objects of this type (e.g. <code>read.csv()</code> in R and <code>pd.read_csv()</code> in Python).</p>
<p>R and Python’s data frames have a number of things in common:</p>
<ol style="list-style-type: decimal">
<li>each column must be the same length as all other columns,</li>
<li>each column’s elements will all have the same type,</li>
<li>elements in any rows can have different types,</li>
<li>columns and rows can be named in different ways,</li>
<li>there are many ways to get and set different subsets of data, and</li>
<li>when reading in data, the same sorts of difficulties arise in both languages.</li>
</ol>
<div id="data-frames-in-r" class="section level2" number="8.1">
<h2 number="8.1"><span class="header-section-number">8.1</span> Data Frames in R</h2>
<p>Let’s consider as an example Fisher’s “Iris” data set <span class="citation">(<a href="#ref-misc_iris_53" role="doc-biblioref">Fisher 1988</a>)</span>. We will read this data set in from a comma separated file (more information on input/output can be found in chapter @ref(input-and-output)). This file can be downloaded from this link: <a href="https://archive.ics.uci.edu/ml/datasets/iris">https://archive.ics.uci.edu/ml/datasets/iris</a>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>irisData <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/iris.csv&quot;</span>, <span class="at">header =</span> F)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(irisData, <span class="dv">3</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    V1  V2  V3  V4          V5</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 5.1 3.5 1.4 0.2 Iris-setosa</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 4.9 3.0 1.4 0.2 Iris-setosa</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 4.7 3.2 1.3 0.2 Iris-setosa</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(irisData)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;list&quot;</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(irisData) <span class="co"># we&#39;ll talk more about classes later</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;data.frame&quot;</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(irisData)</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 150   5</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(irisData)</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 150</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(irisData)</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5</span></span></code></pre></div>
<p>There are some exceptions, but most data sets can be stored as a <code>data.frame</code>. These kinds of two-dimensional data sets are quite common. Any particular row is often an observation on one experimental unit (e.g. person, place or thing). Looking at a particular column gives you one kind of measurement stored for all observations.</p>
<div class="rmd-caution">
<p>Do not rely on the default arguments of <code>read.csv()</code> or <code>read.table()</code>! After you read in a data frame, always check to make sure that</p>
<ol style="list-style-type: decimal">
<li>the number of columns is correct because the correct column <em>separator</em> was used (c.f. <code>sep=</code>),</li>
<li>column names were parsed correctly, if there were some in the raw text file,</li>
<li>the first row of data wasn’t used as a column name sequence, if there weren’t column names in the text file, and</li>
<li>the last few rows aren’t reading in empty spaces</li>
<li>character columns are read in correctly (c.f. <code>stringsAsFactors=</code>), and</li>
<li>special characters signifying missing data were correctly identified (c.f. <code>na.strings=</code>).</li>
</ol>
</div>
<p><a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Data-frame-objects">A <code>data.frame</code> is a special case of a <code>list</code></a>. Every element of the list is a column. Columns can be <code>vector</code>s or <code>factor</code>s, and they can all be of a different type. This is one of the biggest differences between data frames and <code>matrix</code>s. They are both two-dimensional, but a <code>matrix</code> needs elements to be all the same type. Unlike a general <code>list</code>, a <code>data.frame</code> requires all of its columns to have the same number of elements. In other words, the <code>data.frame</code> is not a “<em>ragged</em>” list.</p>
<p>Often times you will need to extract pieces of information from a <code>data.frame</code>. This can be done in many ways. If the columns have names, you can use the <code>$</code> operator to access a single column. Accessing a single column might be followed up by creating a new vector. You can also use the <code>[</code> operator to access multiple columns by name.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(irisData) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sepal.length&quot;</span>, <span class="st">&quot;sepal.width&quot;</span>, </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;petal.length&quot;</span>,<span class="st">&quot;petal.width&quot;</span>, </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;species&quot;</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>firstCol <span class="ot">&lt;-</span> irisData<span class="sc">$</span>sepal.length</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(firstCol)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5.1 4.9 4.7 4.6 5.0 5.4</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>firstTwoCols <span class="ot">&lt;-</span> irisData[<span class="fu">c</span>(<span class="st">&quot;sepal.length&quot;</span>, <span class="st">&quot;sepal.width&quot;</span>)] </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(firstTwoCols, <span class="dv">3</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   sepal.length sepal.width</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1          5.1         3.5</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2          4.9         3.0</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3          4.7         3.2</span></span></code></pre></div>
<p>The <code>[</code> operator is also useful for selecting rows and columns by index numbers, or by some logical criteria.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>topLeft <span class="ot">&lt;-</span> irisData[<span class="dv">1</span>,<span class="dv">1</span>] <span class="co"># first row, first col</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>topLeft</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5.1</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>firstThreeRows <span class="ot">&lt;-</span> irisData[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,] <span class="co"># rows 1-3, all cols</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>firstThreeRows</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   sepal.length sepal.width petal.length petal.width     species</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1          5.1         3.5          1.4         0.2 Iris-setosa</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2          4.9         3.0          1.4         0.2 Iris-setosa</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3          4.7         3.2          1.3         0.2 Iris-setosa</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>setosaOnly <span class="ot">&lt;-</span> irisData[irisData<span class="sc">$</span>species <span class="sc">==</span> <span class="st">&quot;Iris-setosa&quot;</span>,] <span class="co"># rows where species column is setosa</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(setosaOnly, <span class="dv">3</span>)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   sepal.length sepal.width petal.length petal.width     species</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1          5.1         3.5          1.4         0.2 Iris-setosa</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2          4.9         3.0          1.4         0.2 Iris-setosa</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3          4.7         3.2          1.3         0.2 Iris-setosa</span></span></code></pre></div>
<p>In the code above, <code>irisData$species == "Iris-setosa"</code> creates a logical vector (try it!) using the vectorized <code>==</code> operator. The <code>[</code> operator selects the rows for which the corresponding element of this logical vector is <code>TRUE</code>.</p>
<div class="rmd-details">
<p>Be careful: depending on how you use the square brackets, you can either get a <code>data.frame</code> or a <code>vector.</code> As an example, try both <code>class(irisData[,1])</code> and <code>class(irisData[,c(1,2)])</code>.</p>
</div>
<p>In R, <code>data.frame</code>s might have row names. You can get and set this character <code>vector</code> with the <code>rownames()</code> function. You can access rows by name using the square bracket operator.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rownames</span>(irisData))</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(irisData) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(irisData)) <span class="sc">+</span> <span class="dv">1000</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rownames</span>(irisData))</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;1001&quot; &quot;1002&quot; &quot;1003&quot; &quot;1004&quot; &quot;1005&quot; &quot;1006&quot;</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>irisData[<span class="st">&quot;1002&quot;</span>,]</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="do">##      sepal.length sepal.width petal.length petal.width     species</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1002          4.9           3          1.4         0.2 Iris-setosa</span></span></code></pre></div>
<p>Code that modifies data usually looks quite similar to code extracting data. You’ll notice a lot of the same symbols (e.g. <code>$</code>, <code>[</code>, etc.), but the (<code>&lt;-</code>) will point in the other direction.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>irisData<span class="sc">$</span>columnOfOnes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(irisData))</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>irisData[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">999</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>irisData[,<span class="st">&#39;sepal.width&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(irisData), <span class="at">mean =</span> <span class="sc">-</span><span class="dv">999</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>irisData[irisData<span class="sc">$</span>species <span class="sc">==</span> <span class="st">&quot;Iris-setosa&quot;</span>, <span class="st">&#39;species&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;SETOSA!&quot;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(irisData,<span class="dv">3</span>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="do">##      sepal.length sepal.width petal.length petal.width species columnOfOnes</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1001     999.2556   -998.2781          1.4         0.2 SETOSA!            1</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1002    1000.0485   -996.9854          1.4         0.2 SETOSA!            1</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1003       4.7000   -999.6731          1.3         0.2 SETOSA!            1</span></span></code></pre></div>
</div>
<div id="data-frames-in-python" class="section level2" number="8.2">
<h2 number="8.2"><span class="header-section-number">8.2</span> Data Frames in Python</h2>
<p>The Pandas library in Python has data frames that are modeled after R’s.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>iris_data <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/iris.csv&quot;</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>iris_data.head(<span class="dv">3</span>)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">##      0    1    2    3            4</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  5.1  3.5  1.4  0.2  Iris-setosa</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  4.9  3.0  1.4  0.2  Iris-setosa</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  4.7  3.2  1.3  0.2  Iris-setosa</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>iris_data.shape</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="co">## (150, 5)</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(iris_data) <span class="co"># num rows</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 150</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(iris_data.columns) <span class="co"># num columns</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 5</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(iris_data.dtypes)</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="co">## [dtype(&#39;float64&#39;), dtype(&#39;float64&#39;), dtype(&#39;float64&#39;), dtype(&#39;float64&#39;), dtype(&#39;O&#39;)]</span></span></code></pre></div>
<p>The structure is very similar to that of R’s data frame. It’s two dimensional, and you can <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html">access columns and rows by name or number.</a> Each column is a <code>Series</code> object, and each column can have a different <code>dtype</code>, which is analogous to R’s situation. Again, because the elements need to be the same type along columns only, this is a big difference between 2-d Numpy <code>ndarray</code>s and <code>DataFrame</code>s (c.f. R’s <code>matrix</code> versus R’s <code>data.frame</code>).</p>
<div class="rmd-caution">
<p>Again, do not rely on the default arguments of <code>pd.read_csv()</code>! After you read in a data set, always check that</p>
<ol style="list-style-type: decimal">
<li>the number of columns is correct because the correct column <em>separator</em> was used (c.f. <code>sep=</code>),</li>
<li>column names were parsed correctly, if there were some in the raw text file,</li>
<li>the first row of data wasn’t used as a column name sequence, if there weren’t column names in the text file (c.f. <code>header=</code>), and</li>
<li>the last few rows aren’t reading in empty spaces</li>
<li>character columns are read in correctly (c.f. <code>dtype=</code>), and</li>
<li>special characters signifying missing data were correctly identified (c.f. <code>na.values=</code>).</li>
</ol>
</div>
<p>Square brackets are a little different in Python than they are in R. Just like in R, you can access columns by name with square brackets, and you can also access rows. Unlike R, though, you don’t have to specify both rows and columns every time you use the square brackets.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>iris_data.columns <span class="op">=</span> [<span class="st">&quot;sepal.length&quot;</span>, <span class="st">&quot;sepal.width&quot;</span>, </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;petal.length&quot;</span>, <span class="st">&quot;petal.width&quot;</span>, </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;species&quot;</span>]</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>first_col <span class="op">=</span> iris_data[<span class="st">&#39;sepal.length&#39;</span>]</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>first_col.head()</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    5.1</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    4.9</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    4.7</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    4.6</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    5.0</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Name: sepal.length, dtype: float64</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>first_two_cols <span class="op">=</span> iris_data[[<span class="st">&quot;sepal.length&quot;</span>, <span class="st">&quot;sepal.width&quot;</span>]]</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>first_two_cols.head(<span class="dv">3</span>)</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="co">##    sepal.length  sepal.width</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           5.1          3.5</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           4.9          3.0</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           4.7          3.2</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>iris_data[<span class="dv">0</span>:<span class="dv">2</span>]</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a><span class="co">##    sepal.length  sepal.width  petal.length  petal.width      species</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           5.1          3.5           1.4          0.2  Iris-setosa</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           4.9          3.0           1.4          0.2  Iris-setosa</span></span></code></pre></div>
<div class="rmd-details">
<p>Notice that <code>iris_data['sepal.length']</code> returns a <code>Series</code> and <code>iris_data[["sepal.length", "sepal.width"]</code> returns a Pandas <code>DataFrame</code>. This behavior is similar to what happened in R’s. For more details, click <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/dsintro.html#indexing-selection">here</a>.</p>
</div>
<p>You can select columns and rows by number with the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.iloc.html"><code>.iloc</code> method</a>. <code>iloc</code> is (probably) short for “integer location.”</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify rows/cols by number</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>top_left <span class="op">=</span> iris_data.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>top_left</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 5.1</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>first_three_rows <span class="op">=</span> iris_data.iloc[:<span class="dv">3</span>,]</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>first_three_rows</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co">#setosa_only = iris_data[irisData$species == &quot;Iris-setosa&quot;,]  # easieriwith loc?</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co">#head(setosaOnly)</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="co">##    sepal.length  sepal.width  petal.length  petal.width      species</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           5.1          3.5           1.4          0.2  Iris-setosa</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           4.9          3.0           1.4          0.2  Iris-setosa</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           4.7          3.2           1.3          0.2  Iris-setosa</span></span></code></pre></div>
<p>Selecting columns by anything besides integer number can be done with the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html"><code>.loc()</code> method</a>. You should generally prefer this method to access columns because accessing things by <em>name</em> instead of <em>number</em> is more readable. Here are some examples.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>sepal_w_to_pedal_w <span class="op">=</span> iris_data.loc[<span class="st">&#39;sepal.width&#39;</span>:<span class="st">&#39;pedal.width&#39;</span>]</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>sepal_w_to_pedal_w</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Empty DataFrame</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Columns: [sepal.length, sepal.width, petal.length, petal.width, species]</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Index: []</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>setosa_only <span class="op">=</span> iris_data.loc[iris_data[<span class="st">&#39;species&#39;</span>] <span class="op">==</span> <span class="st">&quot;Iris-setosa&quot;</span>,]</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>setosa_only.head(<span class="dv">3</span>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co">##    sepal.length  sepal.width  petal.length  petal.width      species</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           5.1          3.5           1.4          0.2  Iris-setosa</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           4.9          3.0           1.4          0.2  Iris-setosa</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           4.7          3.2           1.3          0.2  Iris-setosa</span></span></code></pre></div>
<p>Notice we used a <code>slice</code> (i.e. <code>'sepal.width':'pedal.width'</code>) to access many columns by only referring to the left-most and the right-most. Unlike slicing with numbers, <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#slicing-ranges">the right end is included</a>. Also note that this does not work with the regular square bracket operator (i.e. <code>iris_data['sepal.width':'pedal.width']</code>). The second example filters out the rows where the <code>"species"</code> column elements are equal to <code>"Iris-setosa"</code>.</p>
<p>Each <code>DataFrame</code> in pandas comes with an <code>.index</code> attribute. This is analogous to a row name in R, but it’s much more flexible because the index can take on a variety of types. This can help us highlight the difference between <code>.loc</code> and <code>.iloc</code>. Recall that <code>.loc</code> was <em>label-based selection.</em> Labels don’t necessarily have to be strings. Consider the following example.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>iris_data.index</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co">## RangeIndex(start=0, stop=150, step=1)</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>iris_data <span class="op">=</span> iris_data.set_index(iris_data.index[::<span class="op">-</span><span class="dv">1</span>]) <span class="co"># reverse the index</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>iris_data.tail(<span class="dv">2</span>) <span class="co"># top is now bottom</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co">##    sepal.length  sepal.width  petal.length  petal.width         species</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           6.2          3.4           5.4          2.3  Iris-virginica</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           5.9          3.0           5.1          1.8  Iris-virginica</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>iris_data.loc[<span class="dv">0</span>] <span class="co"># last row has 0 index</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="co">## sepal.length               5.9</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co">## sepal.width                  3</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co">## petal.length               5.1</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co">## petal.width                1.8</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="co">## species         Iris-virginica</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Name: 0, dtype: object</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>iris_data.iloc[<span class="dv">0</span>] <span class="co"># first row with big index </span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co">## sepal.length            5.1</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a><span class="co">## sepal.width             3.5</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="co">## petal.length            1.4</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a><span class="co">## petal.width             0.2</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="co">## species         Iris-setosa</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a><span class="co">## Name: 149, dtype: object</span></span></code></pre></div>
<p><code>iris_data.loc[0]</code> selects the <code>0</code>th index. The second line reversed the indexes, so this is actually the last row. If you want the first row, use <code>iris_data.iloc[0]</code>.</p>
<!-- [`DataFrame`s have a huge amount  many useful attributes and methods, too.](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#) -->
<p>Modifying data inside a data frame looks quite similar to extracting data. You’ll recognize a lot of the methods mentioned earlier.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>n_rows <span class="op">=</span> iris_data.shape[<span class="dv">0</span>]</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>iris_data[<span class="st">&#39;col_ones&#39;</span>] <span class="op">=</span> np.repeat(<span class="fl">1.0</span>, n_rows)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>iris_data.iloc[:<span class="dv">2</span>,<span class="dv">0</span>] <span class="op">=</span>  np.random.normal(loc<span class="op">=</span><span class="dv">999</span>, size<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>iris_data.loc[:,<span class="st">&#39;sepal.width&#39;</span>] <span class="op">=</span> np.random.normal(loc<span class="op">=-</span><span class="dv">999</span>, size<span class="op">=</span>n_rows)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>iris_data.loc[iris_data[<span class="st">&#39;species&#39;</span>] <span class="op">==</span> <span class="st">&quot;Iris-setosa&quot;</span>, <span class="st">&#39;species&#39;</span>] <span class="op">=</span> <span class="st">&quot;SETOSA!&quot;</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>iris_data.head(<span class="dv">3</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co">##      sepal.length  sepal.width  petal.length  petal.width  species  col_ones</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 149    998.647670  -999.772495           1.4          0.2  SETOSA!       1.0</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 148    997.539297  -999.998765           1.4          0.2  SETOSA!       1.0</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 147      4.700000  -996.909943           1.3          0.2  SETOSA!       1.0</span></span></code></pre></div>
<p>You can also use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.assign.html"><code>.assign()</code> method</a> to create a new column. This method does not modify the data frame in place. It returns a new <code>DataFrame</code> with the additional column.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>iris_data <span class="op">=</span> iris_data.assign(new_col_name <span class="op">=</span> np.arange(n_rows))</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>iris_data.head(<span class="dv">3</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co">##      sepal.length  sepal.width  petal.length  ...  species col_ones  new_col_name</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 149    998.647670  -999.772495           1.4  ...  SETOSA!      1.0             0</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 148    997.539297  -999.998765           1.4  ...  SETOSA!      1.0             1</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 147      4.700000  -996.909943           1.3  ...  SETOSA!      1.0             2</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">## [3 rows x 7 columns]</span></span></code></pre></div>
<div class="rmd-caution">
<p>Above we were assigning Numpy arrays to columns of a <code>DataFrame</code>. Be careful when you’re assigning <code>Series</code> objects. You’ll see in the documentation that <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#basics">“pandas aligns all AXES when setting Series and <code>DataFrame</code> from <code>.loc</code>, and <code>.iloc</code>.”</a>.</p>
</div>
</div>
<div id="exercises-6" class="section level2" number="8.3">
<h2 number="8.3"><span class="header-section-number">8.3</span> Exercises</h2>
<div id="r-questions-6" class="section level3" number="8.3.1">
<h3 number="8.3.1"><span class="header-section-number">8.3.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Consider the data set <code>original_rt_snippets.txt</code> <span class="citation">(<a href="#ref-SocherEtAl2013:RNTN" role="doc-biblioref">Socher et al. 2013</a>)</span>. We will calculate the <em>term frequency-inverse document frequency statistics</em> <span class="citation">(<a href="#ref-Jones72astatistical" role="doc-biblioref">Jones 1972</a>)</span> on this data set, which is a common data transformation technique used in text mining and natural language processing. You may use the <code>stringr</code> library for this question, if you wish.</p>
<ul>
<li>read in this data set as a <code>vector</code> and call it <code>corpus</code>.</li>
<li>create a <code>vector</code> called <code>dictionary</code> that contains the following phrases: “charming,”“fantasy,” “hate,” and “boring.”</li>
<li>Construct a <code>data.frame</code> with four columns called <code>bagOfWords</code> that contains the number of appearances of each word in the dictionary. Match the exact phrases. Label the columns of this <code>data.frame</code> with the phrases you’re searching for. Try to write code that is easy to modify if you decide to change the set of phrases in your dictionary.</li>
<li>Create a <code>data.frame</code> with four columns called <code>termFrequency</code>. Each element should correspond with the count from the previous <code>data.frame</code>. Instead of the count, each element should be <span class="math inline">\(\log(1 + \text{count})\)</span>.</li>
<li>Create a <code>vector</code> of length four called <code>invDocFrequency</code>. The inverse document frequency formula for any term <span class="math inline">\(t\)</span> is <span class="math inline">\(\log([\text{number of documents in corpus}] / [\text{number of documents that contain term } t])\)</span> Make sure the names of this vector are the same as the words in the dictionary.</li>
<li>Create a <code>data.frame</code> called <code>tfidf</code> (short for “term frequency-inverse document frequency”). For row/document <span class="math inline">\(d\)</span>, and column/term <span class="math inline">\(t\)</span>, the formula is the product: <span class="math inline">\([\text{term frequency of term } t \text{ and document } d ] \times [\text{inverse doc. freq. of term } t]\)</span>.</li>
<li>Extract the elements of <code>corpus</code> that have at least one nonzero element in the corresponding row of <code>tfidf</code>. Call the <code>vector</code> <code>informativeDocuments</code>.</li>
<li>Do you see any documents that were labeled as informative, that do not actually contain the words you searched for?</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p><code>mtcars</code> is a data set that is built into R, so you don’t need to read it in. You can read more about it by typing <code>?datasets::mtcars</code>.</p>
<ul>
<li>Create a new <code>data.frame</code> called <code>withoutDisp</code> that is the same as <code>mtcars</code>, but has its <code>disp</code> column removed.</li>
<li>Create a new column for <code>withoutDisp</code> called <code>coolnessScore</code>. The formula is <span class="math inline">\(\frac{1}{\text{mpg}} + \text{quarter mile time}\)</span>.</li>
<li>Create a new <code>data.frame</code> called <code>sortedWD</code> that is equal to <code>withoutDisp</code>, but sorted in descending order by the coolness score.</li>
<li>Create a new <code>data.frame</code> from <code>sortedWD</code> called <code>specialRows</code> that keeps only rows where <span class="math inline">\(\text{weight (1000lbs)} + \text{rear axle ratio} &lt; 7\)</span></li>
<li>Calculate the percent reduction in number of rows, going from <code>sortedWD</code> to <code>specialRows</code>. Call it <code>percReduction</code>. Make sure it is between <span class="math inline">\(0\)</span> and <span class="math inline">\(100\)</span>.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>This question investigates the <a href="https://www.zillow.com/research/data/"><em>Zillow Home Value Index (ZHVI)</em></a> for single family homes.</p>
<ul>
<li>read in your data from <code>Zip_zhvi_uc_sfr_tier_0.33_0.67_sm_sa_month.csv</code>. Call the <code>data.frame</code> <code>homeData</code>. Remember to be careful with file paths. Also, when looking at the data set with a text editor, be sure that “word wrap” is not turned on.</li>
<li>Extract the rows of <code>homeData</code> that correspond with Charlottesville, VA, and assign them as a <code>data.frame</code> to the variable <code>cvilleData</code></li>
<li>Assign all the unique zip codes to a <code>character vector</code> called <code>cvilleZips</code>.</li>
<li>Extract the columns of <code>cvilleData</code> that correspond with home prices, and transpose them so that each row of the result corresponds with a different month. Call this new <code>data.frame</code> <code>timeSeriesData</code>. Also, make sure that the column names of this new <code>data.frame</code> are set equal to the appropriate zip codes.</li>
<li>Write a function called <code>getAveMonthlyChange</code> that takes in a numeric <code>vector</code>, and returns the average change. Your function should not return an <code>NA</code>, so be sure to deal with <code>NA</code>s appropriately.</li>
<li>Calculate the average monthly price change for each zip code. Store your results in a <code>vector</code> called <code>aveMonthlyChanges</code>. Make sure this <code>vector</code> has named elements so one can extract elements by zip code.</li>
</ul></li>
</ol>
</div>
<div id="python-questions-6" class="section level3" number="8.3.2">
<h3 number="8.3.2"><span class="header-section-number">8.3.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>This question deals with looking at historical prices of the S&amp;P500 Index. This data was downloaded from <a href="https://finance.yahoo.com">https://finance.yahoo.com</a> <span class="citation">(<a href="#ref-gspc_data" role="doc-biblioref"><span>“GSPC DATA”</span> 2021</a>)</span>. It contains prices starting from “2007-01-03” and going until “2021-10-01.”</p>
<ul>
<li>Read in the data <code>gspc.csv</code> as a <code>data.frame</code> and call the variable <code>gspc</code>.</li>
<li>Use <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.set_index.html"><code>.set_index()</code></a> to change the index of <code>gspc</code> to its <code>"Index"</code> column. Store the new <code>DataFrame</code> as <code>gspc_good_idx</code>.</li>
<li>Add a column to <code>gspc_good_idx</code> called <code>log_returns</code>. Calculate them from the column <code>GSPC.Adjusted</code>. Make sure to scale them by <span class="math inline">\(100\)</span> and put an <code>np.nan</code> in the first element where you don’t have a return.</li>
<li>Extract all the returns that are available for the year 2021, and store them as a <code>Series</code> called <code>this_year_returns</code>.</li>
<li>Add a column to <code>gspc_good_idx</code> containing the <em>drawdown</em> time series. Call this column <code>drawdown</code>. To calculate drawdown at a given date, subtract that date’s price from the running maximum price that is current at that date. Use only adjusted close prices for this calculation.<br />
</li>
<li>Add a column to <code>gspc_good_idx</code> containing the percent drawdown time series. Call this column <code>perc_drawdown</code>. Use the previous column, but make this number a percent of the corresponding running maximum.</li>
<li>What is the maximum drawdown of this time series? Store it as a percent in the value <code>mdd</code>.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>In this question we’ll look at <a href="https://www.tensorflow.org/datasets/catalog/radon">some data on radon measurements</a> <span class="citation">(<a href="#ref-GelmanHill:2007" role="doc-biblioref">Gelman and Hill 2007</a>)</span>. Instead of reading in a text file, we will load the data into Python using the <a href="https://www.tensorflow.org/datasets"><code>tensorflow_datasets</code> module</a> <span class="citation">(<a href="#ref-TFDS" role="doc-biblioref"><span>“<span>TensorFlow Datasets</span>, a Collection of Ready-to-Use Datasets”</span> 2021</a>)</span>.</p>
<p>Please include the following code in your submission.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#%pip install tensorflow</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co">#%pip install tensorflow_datasets</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow_datasets <span class="im">as</span> tfds</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> tfds.load(<span class="st">&quot;radon&quot;</span>)</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.DataFrame(tfds.as_dataframe(d[<span class="st">&#39;train&#39;</span>]))</span></code></pre></div>
<p>Many of you will need to install <code>tensorflow</code> and <code>tensorflow_datasets</code> before you’re able to <code>import</code> it. If that’s so, please see the <a href="https://randpythonbook.netlify.app/using-third-party-code.html#installing-packages-in-python">text for more information</a> on how to install packages. On my machine, I was able to install it with the commented out line, however, that may not be the case for you. After it is installed, please comment out all lines in your script that attempt to install packages. They will not work on the Gradescope server.</p>
<ul>
<li>Assign to <code>worst_row</code> the row of <code>d</code> that is associated the highest recorded level of radon. Make sure it a <code>DataFrame</code>.</li>
<li>Assign to <code>nrows</code> and <code>ncols</code> the number of rows and columns of <code>d</code>, respectively.</li>
<li>Assign the most common column data type to <code>most_common_dtype</code>. Make sure the variable is of type <code>numpy.dtype</code></li>
<li>Are there any observations from Virginia in this data set? If so, assign <code>True</code> to <code>any_va</code>. Otherwise assign <code>False</code>.</li>
<li>Create a new column in <code>d</code> called <code>dist_from_cville</code>. Use the <strong>Haversine formula</strong> to calculate distance between each row and the University of Virginia, in kilometers.
<ul>
<li>Assume the University of Virginia is at 38.0336<span class="math inline">\(^\circ\)</span> N, 78.5080<span class="math inline">\(^\circ\)</span>W</li>
<li>Assume the Earth’s radius <span class="math inline">\(r = 6378.137\)</span> kilometers.</li>
<li>The formula for distance between <span class="math inline">\((\lambda_1, \phi_1)\)</span> (signed longitude in radians, signed latitude in radians) and <span class="math inline">\((\lambda_2, \phi_2)\)</span> is <span class="math display">\[2 \hspace{1mm} r \hspace{1mm} \text{arcsin}\left( \sqrt{ \sin^2\left( \frac{\phi_2 - \phi_1}{2}\right)  + \cos(\phi_1)\cos(\phi_2) \sin^2\left( \frac{\lambda_2 - \lambda_1}{2} \right)  } \right)\]</span></li>
</ul></li>
<li>What is the average radon measurement between all measurements taken at the place that is closest to where we are now? Assign your answer as a <code>float</code> to <code>close_ave</code></li>
</ul>
<!--chapter:end:08-data_frames.Rmd-->
</div>
</div>
</div>
<div id="part-common-tasks-and-patterns" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Common Tasks and Patterns</h1>
</div>
<div id="input-and-output" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> Input and Output</h1>
<div id="general-input-considerations" class="section level2" number="9.1">
<h2 number="9.1"><span class="header-section-number">9.1</span> General Input Considerations</h2>
<p>So far, this text has been favoring the creation of small pieces of data <em>within our scripts.</em> The avoidance of reading in data from an external file has been avoided primarily for pedagogical purposes. In general, one might have</p>
<ul>
<li>data read in from a plain text file (e.g. <code>my_data.csv</code> or <code>log_file.txt</code> ),</li>
<li>data read in from a database (e.g. MySQL, PostgreSQL, etc.), or</li>
<li>data created in a script (either deterministically or randomly).</li>
</ul>
<p>When discussing reading in data, this text mostly focuses on the first category. Here are the reasons for its doing so:</p>
<ol style="list-style-type: decimal">
<li>text-files are more readily-available to students than databases,</li>
<li>teaching the second category requires teaching SQL, and that would introduce conceptual overlap, and</li>
<li>the third category is programmatically self-explanatory.</li>
</ol>
<div class="rmd-details">
<p>The third reason does not imply data created by code is unimportant. For example, it is the most common approach to create data used in <strong>simulation studies.</strong> Authors writing statistical papers need to demonstrate that their techniques work on “nice” data: data simulated from a <em>known</em> data-generating process. In a simulation study, unlike in the “real-world,” you have access to the parameters generating your data, and you can examine data that might otherwise be unobserved or hidden. Further, with data from the real-world, there is no guarantee your model correctly matches the true model.</p>
<p>Can your code/technique/algorithm, at the very least, obtain parameter estimates that are “in-line” with the parameters your code is using to simulate data? Are forecasts or predictions obtained by your method accurate? These kinds of questions can often only be answered by simulating fake data. Programmatically, simulating data like this largely involves calling functions that we have seen before (e.g. <code>rnorm()</code> in R or <code>np.random.choice()</code> in Python). This may or may not involve setting a pseudorandom number seed, first, for reproducibility.</p>
<p>Also, <em>benchmark data sets</em> are often readily available through specialized function calls.</p>
</div>
<p>Even though this chapter is written to teach you how to read in files into R and Python, you should not expect that you will know how to read in <em>all</em> data sets after reading this section. For both R and Python, there are an enormous amount of functions, different functions have different return types, different functions are suited for different file types, many functions are spread across a plethora of third party libraries, and many of these functions have an enormous amount of arguments. You will probably not be able to memorize everything. In my very humble opinion, I doubt you should want to.</p>
<p>Instead, <strong>focus on developing your ability to identify and diagnose data input problems.</strong> Reading in a data set correctly is often a process of trial-and-error. After attempting to read in a data set, always check the following items. Many of these points were previously mentioned in section @(data-frames-in-r). Some apply to reading in text data more than reading in structured data from a database, and vice versa.</p>
<ol style="list-style-type: decimal">
<li>Check that <strong>the correct column <em>separator</em> was used, or the correct “fixed-width format” was expected.</strong> If mistakes are made, data frame columns are going to be combined or split apart in weird ways, and often the wrong types are going to be used for pieces of data (e.g. <code>"2,3"</code> instead of <code>2</code> and <code>3</code>.) Also, watch out for when separators are found inside data elements or column names. For example, sometimes it’s unclear whether people’s names in the “last, first” format can be stored in one or two columns. Also, text data might surprise you with unexpected spaces or other whitespace is a common separator.</li>
<li>Check that <strong>the column names were parsed and stored correctly.</strong> Column names should not be stored as data in R/Python. Functions that read in data should not expect column names when they don’t exist in the actual file.</li>
<li>Check that <strong>empty space and metadata was ignored correctly.</strong> Data descriptions are sometimes stored in the same file as the data itself, and that should be skipped over when it’s being read in. Empty space between column names and data shouldn’t be stored. This can occur at the beginning of the file, and even at the end of the file.</li>
<li><strong>Check that type choice and recognition of special characters are performed correctly.</strong> Are letters stored as strings or as something else such as an R <code>factor</code>? Are dates and times stored as a special date/time type, or as strings? Is missing data correctly identified? Sometimes data providers use outrageous numbers like <span class="math inline">\(-9999\)</span> to represent missing data–don’t store that as a float or integer!</li>
<li><strong>Be ready to prompt R or Python to recognize a specific character encoding if you are reading in text data written in another language.</strong> All text data has a character encoding, which is a mapping of numbers to characters. Any specific encoding will dictate what characters are recognizable in a program. If you try to read in data written in another language, the function you are using will likely complain about unrecognized characters. Fortunately, these errors and warnings are easily fixed by specifying a nondefault argument such as <code>encoding=</code> or <code>fileEncoding=</code>.</li>
</ol>
<p>This is no small task. To make matters worse:</p>
<ul>
<li><p>you can’t (or shouldn’t) edit the raw data to suit your needs, to make it easier to read in. You have to work with what you are given. If you were allowed to edit, say, a text file you downloaded onto your own machine, you shouldn’t–it will lead to code that doesn’t run anywhere else. Additionally, if you abuse write privileges on your company’s database, for example–that could be very dangerous as well.</p></li>
<li><p>Data sets are often quite large, so manually checking each element is often impossible. In this situation you will have to resign yourself to checking the top and bottom of a data set, or maybe anticipate a specific place where problems are likely to appear.</p></li>
</ul>
</div>
<div id="reading-in-text-files-with-r" class="section level2" number="9.2">
<h2 number="9.2"><span class="header-section-number">9.2</span> Reading in Text Files with R</h2>
<p>You’ve seen examples of <code>read.csv()</code> used earlier in the book, so it should not surprise you that this is one of the most common ways to read in data in R. Another important function is <code>read.table()</code>.</p>
<p>If you look at the source code for <code>read.csv()</code> (type the name of the function without parentheses into the console and press the <code>&lt;Enter&gt;</code> key), you will see it calls <code>read.table()</code>. The primary difference between these functions is default arguments. <strong>Mind the default arguments.</strong> Do not be completely averse to writing a long-line of code to read in a data set correctly. Or do, and choose the function with the best default arguments.</p>
<p>Consider the <a href="https://archive.ics.uci.edu/ml/datasets/Challenger+USA+Space+Shuttle+O-Ring">“Challenger USA Space Shuttle O-Ring Data Set”</a> from <span class="citation">(<a href="#ref-uci_data" role="doc-biblioref">Dua and Graff 2017</a>)</span>. The first few rows of the raw text file<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a> looks like this.</p>
<pre><code>6 0 66  50  1
6 1 70  50  2
6 0 69  50  3</code></pre>
<p>It does not use commas as separators, and there is no header information, so <code>read.csv()</code> used with its default arguments will produce an incorrect result. It will miss the first row by counting it as a column name, and store everything in one column with the wrong type.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d) <span class="co"># one row short, only 1 col</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 22  1</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(d[,<span class="dv">1</span>])</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;character&quot;</span></span></code></pre></div>
<p>Specifying <code>header=FALSE</code> fixes the column name issue, but <code>sep = " "</code> does not fix the separator issue.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="do">## &#39;data.frame&#39;:    23 obs. of  7 variables:</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V1: int  6 6 6 6 6 6 6 6 6 6 ...</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V2: int  0 1 0 0 0 0 0 0 1 1 ...</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V3: int  66 70 69 68 67 72 73 70 57 63 ...</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V4: int  NA NA NA NA NA NA 100 100 200 200 ...</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V5: int  50 50 50 50 50 50 NA NA NA 10 ...</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V6: int  NA NA NA NA NA NA 7 8 9 NA ...</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V7: int  1 2 3 4 5 6 NA NA NA NA ...</span></span></code></pre></div>
<p>One space is strictly one space. Some rows have two, though. This causes there to be two too many columns filled with <code>NA</code>s.</p>
<p>After digging into the documentation a bit further, you will notice that <code>""</code> works for “one or more spaces, tabs, newlines or carriage returns.” This is why <code>read.table()</code>, with its default arguments, works well.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="do">## &#39;data.frame&#39;:    23 obs. of  5 variables:</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V1: int  6 6 6 6 6 6 6 6 6 6 ...</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V2: int  0 1 0 0 0 0 0 0 1 1 ...</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V3: int  66 70 69 68 67 72 73 70 57 63 ...</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V4: int  50 50 50 50 50 50 100 100 200 200 ...</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V5: int  1 2 3 4 5 6 7 8 9 10 ...</span></span></code></pre></div>
<p>This data set has columns whose widths are “fixed,” too. It is in “fixed width format” because any given column has all its elements take up a constant amount of characters. The third column has integers with two or three digits, but no matter what, each row has the same number of characters.</p>
<p>You may choose to exploit this and use a specialized function that reads in data in a fixed width format (e.g. <code>read.fwf()</code>). The frustrating thing about this approach, though, is that you have to specify what those widths are. This can be quite tedious, particularly if your data set has many columns and/or many rows. The upside though, is that the files can be a little bit smaller, because the data provider does not have to waste characters on separators.</p>
<p>In the example below, we specify widths that include blank spaces to the left of the digits. On the other hand, if we specified <code>widths=c(2,2,4,4,1)</code>, which includes spaces to the <em>right</em> of digits, then columns would have been recognized as <code>character</code>s.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.fwf</span>(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>)) <span class="co"># or try c(2,2,4,4,1)</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="do">## &#39;data.frame&#39;:    23 obs. of  5 variables:</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V1: int  6 6 6 6 6 6 6 6 6 6 ...</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V2: int  0 1 0 0 0 0 0 0 1 1 ...</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V3: int  66 70 69 68 67 72 73 70 57 63 ...</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V4: int  50 50 50 50 50 50 100 100 200 200 ...</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ V5: int  1 2 3 4 5 6 7 8 9 10 ...</span></span></code></pre></div>
<p>If you need to read in some text data that does not possess a tabular structure, then you may need <code>readLines()</code>. This function will read in all of the text, separate each line into an element of a <code>character</code> <code>vector</code>, and will not make any attempt to parse lines into columns. Further processing can be accomplished using the techniques from chapter @(working-with-text-data).</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>html_data <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;data/Google.html&quot;</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(html_data, <span class="dv">2</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;&lt;!DOCTYPE html&gt;&quot;                                                               </span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &quot;&lt;html itemscope=\&quot;\&quot; itemtype=\&quot;http://schema.org/WebPage\&quot; lang=\&quot;en\&quot;&gt;&lt;head&gt;&quot;</span></span></code></pre></div>
<p>Some of you may have had difficulty reading in the above data. This can happen if your machine’s default character encoding is different than mine. For instance, if your character encoding is <a href="https://en.wikipedia.org/wiki/GBK_(character_encoding)">“GBK”</a>, then the following warning message might appear. This message means that your machine didn’t recognize some of the characters in the data set.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/Google.html&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;~&quot;</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in scan(file = file, what = what, sep = sep, quote = quote, dec = dec, : invalid input found on input</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="do">## connection &#39;data/Google.html&#39;</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in scan(file = file, what = what, sep = sep, quote = quote, dec = dec, : EOF within quoted string</span></span></code></pre></div>
<p>These errors are easy to fix, though, so don’t worry. Just specify an encoding argument in your function that reads in data.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/Google.html&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;~&quot;</span>, </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fileEncoding =</span> <span class="st">&quot;UTF-8&quot;</span>) <span class="co"># this makes errors disappear</span></span></code></pre></div>
</div>
<div id="reading-in-text-files-with-pandas" class="section level2" number="9.3">
<h2 number="9.3"><span class="header-section-number">9.3</span> Reading in Text Files with Pandas</h2>
<p>A <a href="https://pandas.pydata.org/pandas-docs/stable/reference/io.html">wide variety of different file formats can be read in with Pandas.</a> I will only mention a few functions here.</p>
<p>Recall R has <code>read.table()</code> and <code>read.csv()</code>, and that they are very similar. In Pandas, <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html"><code>pd.read_csv()</code></a> and <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_table.html"><code>pd.read_table()</code></a> have a lot in common, too. Their primary difference is the default column separator, as well.</p>
<p>Recall the O-Ring data from above. The columns are <em>not</em> separated by commas, so if we treat it as a comma-separated file, the resulting Pandas <code>DataFrame</code> is going to be missing all but one of its columns.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>d.shape <span class="co"># one column and missing a row</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">## (22, 1)</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>d.columns <span class="co"># column labels are data</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Index([&#39;6 0 66  50  1&#39;], dtype=&#39;object&#39;)</span></span></code></pre></div>
<p>By default, <code>pd.read_csv()</code> is expecting column labels, which is also a problem. Unlike R, though, the <code>header=</code> argument is not expected to be a Boolean. You will need to provide a <code>None</code>, instead. The separator needs to be just right, too.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>            header<span class="op">=</span><span class="va">None</span>, sep <span class="op">=</span> <span class="st">&quot; &quot;</span>).head(<span class="dv">2</span>) <span class="co"># 1 space: no</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co">##    0  1   2   3     4   5    6</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  6  0  66 NaN  50.0 NaN  1.0</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  6  1  70 NaN  50.0 NaN  2.0</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>            header<span class="op">=</span><span class="va">None</span>, sep <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>).head(<span class="dv">2</span>) <span class="co"># tabs: no</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co">##                0</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  6 0 66  50  1</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  6 1 70  50  2</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>pd.read_table(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>              header<span class="op">=</span><span class="va">None</span>).head(<span class="dv">2</span>) <span class="co"># default sep is tabs, so no</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="co">##                0</span></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  6 0 66  50  1</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  6 1 70  50  2</span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>            header<span class="op">=</span><span class="va">None</span>, sep <span class="op">=</span> <span class="st">&quot;\s+&quot;</span>).head(<span class="dv">2</span>) <span class="co"># 1 or more spaces: yes</span></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="co">##    0  1   2   3  4</span></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  6  0  66  50  1</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  6  1  70  50  2</span></span></code></pre></div>
<p>Reading in fixed width files can be done in a way that is nearly identical to the way we did it in R. Here is an example.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.read_fwf(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                widths <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>], header<span class="op">=</span><span class="va">None</span>) <span class="co"># or try [2,2,4,4,1]</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>d.info()</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co">## RangeIndex: 23 entries, 0 to 22</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Data columns (total 5 columns):</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co">##  #   Column  Non-Null Count  Dtype</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="co">## ---  ------  --------------  -----</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="co">##  0   0       23 non-null     int64</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="co">##  1   1       23 non-null     int64</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="co">##  2   2       23 non-null     int64</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="co">##  3   3       23 non-null     int64</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="co">##  4   4       23 non-null     int64</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="co">## dtypes: int64(5)</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="co">## memory usage: 1.0 KB</span></span></code></pre></div>
<p>If you had chosen <code>widths=[2,2,4,4,1]</code>, instead, then the trailing whitespace will cause Pandas to recognize a <code>dtype</code> of <code>object</code>. The reason it is not recognized as a string is because strings can be of different length, and all string types specify a maximum length. If you want to enforce a maximum length, there may be some speed advantages. In the below example, we use <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html"><code>d.astype()</code></a> to convert two columns’ types to <a href="https://pandas.pydata.org/docs/reference/api/pandas.StringDtype.html#pandas.StringDtype"><code>pd.StringDtype</code></a>.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.read_fwf(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                widths <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>], header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(d.dtypes)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co">## [dtype(&#39;int64&#39;), dtype(&#39;int64&#39;), dtype(&#39;O&#39;), dtype(&#39;O&#39;), dtype(&#39;int64&#39;)]</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> d.astype({<span class="dv">2</span>:<span class="st">&#39;string&#39;</span>, <span class="dv">3</span>:<span class="st">&#39;string&#39;</span>}) </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(d.dtypes)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co">## [dtype(&#39;int64&#39;), dtype(&#39;int64&#39;), StringDtype, StringDtype, dtype(&#39;int64&#39;)]</span></span></code></pre></div>
<p>Just like in R, you may run into an encoding issue with a file. For instance, the following will not work because the file contains Chinese characters.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&quot;data/message.txt&quot;</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Error in py_call_impl(callable, dots$args, dots$keywords): UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0xb9 in position 0: invalid start byte</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Detailed traceback:</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;/home/taylor/.local/share/r-miniconda/envs/r-reticulate/lib/python3.6/site-packages/pandas/io/parsers.py&quot;, line 688, in read_csv</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">##     return _read(filepath_or_buffer, kwds)</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;/home/taylor/.local/share/r-miniconda/envs/r-reticulate/lib/python3.6/site-packages/pandas/io/parsers.py&quot;, line 454, in _read</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co">##     parser = TextFileReader(fp_or_buf, **kwds)</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;/home/taylor/.local/share/r-miniconda/envs/r-reticulate/lib/python3.6/site-packages/pandas/io/parsers.py&quot;, line 948, in __init__</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co">##     self._make_engine(self.engine)</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;/home/taylor/.local/share/r-miniconda/envs/r-reticulate/lib/python3.6/site-packages/pandas/io/parsers.py&quot;, line 1180, in _make_engine</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co">##     self._engine = CParserWrapper(self.f, **self.options)</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;/home/taylor/.local/share/r-miniconda/envs/r-reticulate/lib/python3.6/site-packages/pandas/io/parsers.py&quot;, line 2010, in __init__</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="co">##     self._reader = parsers.TextReader(src, **kwds)</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;pandas/_libs/parsers.pyx&quot;, line 537, in pandas._libs.parsers.TextReader.__cinit__</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a><span class="co">##   File &quot;pandas/_libs/parsers.pyx&quot;, line 740, in pandas._libs.parsers.TextReader._get_header</span></span></code></pre></div>
<p>However, the error messages disappear when you specify <code>encoding="gbk"</code>.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">&quot;data/message.txt&quot;</span>, encoding <span class="op">=</span> <span class="st">&quot;gbk&quot;</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Empty DataFrame</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Columns: [恭喜发财]</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Index: []</span></span></code></pre></div>
<p>You may also read in unstructured, nontabular data with Python. Use the built-in <a href="https://docs.python.org/3/library/functions.html#open"><code>open()</code></a> function to open up a file in read mode, and then use <code>f.readlines()</code> to return a <code>list</code> of strings.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;data/Google.html&quot;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> f.readlines()</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>d[:<span class="dv">2</span>]</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="co">## [&#39;&lt;!DOCTYPE html&gt;\n&#39;, &#39;&lt;html itemscope=&quot;&quot; itemtype=&quot;http://schema.org/WebPage&quot; lang=&quot;en&quot;&gt;&lt;head&gt;\n&#39;]</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(d), <span class="bu">type</span>(d[<span class="dv">0</span>]))</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;list&#39;&gt; &lt;class &#39;str&#39;&gt;</span></span></code></pre></div>
</div>
<div id="saving-data-in-r" class="section level2" number="9.4">
<h2 number="9.4"><span class="header-section-number">9.4</span> Saving Data in R</h2>
<p>Storing data is important for saving your progress. For example, sometimes running a script that performs data cleaning can take a very long time. Saving your progress might free you from the responsibility of running that script many times.</p>
<p>In R, there are many options for storing data. I will mention two: writing data out to a plain text file, and saving a serialized object.</p>
<div id="writing-out-tabular-plain-text-data-in-r" class="section level3" number="9.4.1">
<h3 number="9.4.1"><span class="header-section-number">9.4.1</span> Writing Out Tabular Plain Text Data in R</h3>
<p>If you want to write out tabular data to a text file, use <code>write.table()</code> or <code>write.csv()</code>. There are two arguments that you must specify, at a minimum: the first argument is your R object (typically a <code>matrix</code> or <code>data.frame</code>), and the second argument is the file path on your hard drive.</p>
<p>Here is an example of writing out <code>d</code> to a file called <code>oring_out.csv</code>. I choose to include column names, but not row names. I also use commas to separate columns.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(d, <span class="at">file =</span> <span class="st">&quot;data/oring_out.csv&quot;</span>, </span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<p>The above will not print anything to the R console, but we can use a text editor to take a look at the raw text file on our hard drive. Here are the first three rows.</p>
<pre><code>&quot;V1&quot;;&quot;V2&quot;;&quot;V3&quot;;&quot;V4&quot;;&quot;V5&quot;
6;0;66;50;1
6;1;70;50;2</code></pre>
</div>
<div id="serialization-in-r" class="section level3" number="9.4.2">
<h3 number="9.4.2"><span class="header-section-number">9.4.2</span> Serialization in R</h3>
<p>Alternatively you may choose to store your data in a <strong>serialized</strong> form. With this approach, you are still saving your data in a more permanent way to your hard drive, but it is stored in format that’s usually more memory efficient.</p>
<p>For instance, let’s save the object <code>d</code> in a file called <code>oring.rds</code>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(d, <span class="at">file =</span> <span class="st">&quot;data/oring.rds&quot;</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(d)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exists</span>(<span class="st">&quot;d&quot;</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] FALSE</span></span></code></pre></div>
<p>After it is saved with <code>saveRDS()</code>, we are free to delete the variable with <code>rm()</code>, because it can be read back in later on. To do this, call <code>readRDS()</code>. This is file has a special format that is recognized by R, so you will not need to worry about any of the usual struggles that occur when reading in data from a plain text file. Additionally, <code>.rds</code> files are typically smaller–<code>oring.rds</code> is only 248 bytes, while <code>oring_out.csv</code> is 332 bytes.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">&quot;data/oring.rds&quot;</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d2, <span class="dv">3</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   V1 V2 V3 V4 V5</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  6  0 66 50  1</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  6  1 70 50  2</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  6  0 69 50  3</span></span></code></pre></div>
<p>You can serialize multiple objects at once, too! Convention dictates that these files end with the <code>.RData</code> suffix. Save your entire global environment with <code>save()</code> or <code>save.image()</code>, and bring it back with <code>load()</code> or <code>attach()</code>.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co"># remove everything</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="at">file =</span> <span class="st">&quot;data/my-current-workspace.RData&quot;</span>)</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/my-current-workspace.RData&quot;</span>)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>() <span class="co"># print all objects in your workspace</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;a&quot; &quot;b&quot;</span></span></code></pre></div>
</div>
</div>
<div id="saving-data-in-python" class="section level2" number="9.5">
<h2 number="9.5"><span class="header-section-number">9.5</span> Saving Data in Python</h2>
<div id="writing-out-tabular-plain-text-data-in-python" class="section level3" number="9.5.1">
<h3 number="9.5.1"><span class="header-section-number">9.5.1</span> Writing Out Tabular Plain Text Data in Python</h3>
<p>You can write out tabular data with a variety of <a href="https://pandas.pydata.org/pandas-docs/stable/reference/io.html#input-output"><code>DataFrame</code> methods that are named <code>to_*()</code>.</a>. <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html#pandas.DataFrame.to_csv"><code>pd.DataFrame.to_csv()</code></a> has a lot of common with <code>write.csv()</code> in R. Below we write out <code>d</code> to a file called <code>oring_out2.csv</code>.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/o-ring-erosion-only.data&quot;</span>, header<span class="op">=</span><span class="va">None</span>, sep <span class="op">=</span> <span class="st">&quot;\s+&quot;</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>d.to_csv(<span class="st">&quot;data/oring_out2.csv&quot;</span>, header<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">False</span>, sep <span class="op">=</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p>Here is how the first few rows of that file looks in a text editor.</p>
<pre><code>0,1,2,3,4
6,0,66,50,1
6,1,70,50,2</code></pre>
</div>
<div id="serialization-in-python" class="section level3" number="9.5.2">
<h3 number="9.5.2"><span class="header-section-number">9.5.2</span> Serialization in Python</h3>
<p>Serialization functionality is readily available in Python, just like it is in R. In Python, the <a href="https://docs.python.org/3/library/pickle.html"><code>pickle</code></a> and <code>cPickle</code> libraries are probably the most commonly used. Serializing objects with these libraries is known as <em>pickling</em> an object.</p>
<p>Pandas has a <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_pickle.html"><code>.to_pickle()</code></a> wrapper method attached to every <code>DataFrame</code>. Once the pickled object is saved, the file can be read back into Python with <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_pickle.html#pandas.read_pickle"><code>pd.read_pickle()</code></a>. These functions are extremely convenient, because they call all the required <code>pickle</code> code and hide a decent amount of complexity.</p>
<p>Here is an example of writing out <code>d</code> and then reading the pickled object back in. In Python 3, the file suffix for pickled objects is usually <code>.pickle</code>, but there are many other choices.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>d.to_pickle(<span class="st">&quot;data/oring.pickle&quot;</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> d</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>d_is_back <span class="op">=</span> pd.read_pickle(<span class="st">&quot;data/oring.pickle&quot;</span>)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>d_is_back.head(<span class="dv">2</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="co">##    0  1   2   3  4</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  6  0  66  50  1</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  6  1  70  50  2</span></span></code></pre></div>
<div class="rmd-caution">
<p>Unfortunately, <code>oring.pickle</code> is much larger (1,676 bytes) than the original text file <code>o-ring-erosion-only.data</code> (322 bytes). This is for two reasons. First, the original data set is small, so the overhead of pickling this object is relatively pronounced, and second, we are not taking advantage of any compression. If you use something like <code>d_is_back.to_pickle("data/oring.zip")</code> it will become smaller.</p>
</div>
<p>In Python, unlike in R, it is more difficult to serialize all of the objects you currently have in memory. It is possible, but it will likely require the use of a third-party library.</p>
<p>Speaking of third-party code, there are many that provide alternative serialization solutions in both R and Python. I do not discuss any in this text. However, I will mention that some of them may provide combinations of the following: an increase in read and write speed, a decrease in required memory, improved security<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>, improved human readability and interoperability between multiple programming languages. If any of these sound potentially beneficial, I encourage you to conduct further research.</p>
</div>
</div>
<div id="exercises-7" class="section level2" number="9.6">
<h2 number="9.6"><span class="header-section-number">9.6</span> Exercises</h2>
<div id="r-questions-7" class="section level3" number="9.6.1">
<h3 number="9.6.1"><span class="header-section-number">9.6.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Consider again the data set called <code>gspc.csv</code>, which contains daily open, high, low and close values for the S&amp;P500 Index.</p>
<ul>
<li>Read in this data set as a <code>data.frame</code>, and call it <code>myData</code>. Do not include the code that achieves this in your assignment submission.</li>
<li>Write out this object as <code>myData.rds</code>. After you are finished, remove <code>myData</code> from memory. Do not include the code that achieves this in your assignment submission.</li>
<li>Read in <code>myData.rds</code>, and store the variable as <code>financialData</code>. <em>Do</em> include the code that achieves this in your project submission. Make sure this code assumes that <code>myData.rds</code> is in the same folder as the code file <code>io_lab.R</code>.</li>
</ul>
</div>
<div id="python-questions-7" class="section level3" number="9.6.2">
<h3 number="9.6.2"><span class="header-section-number">9.6.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>We will use the <code>"Google.html"</code> data set mentioned in the chapter.</p>
<ul>
<li>Use <code>open()</code> to open the <code>"Google.html"</code> file. Store the output of the function as <code>my_file</code>.</li>
<li>Use the <code>.readlines()</code> method of the file to write the contents of the file as a <code>list</code> called <code>html_data</code></li>
<li>Coerce the <code>list</code> to a <code>DataFrame</code> with one column called <code>html</code></li>
<li>Create a <code>Series</code> called <code>nchars_ineach</code> that stores the number of characters in each line of text. Hint: the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/series.html#api-series-str"><code>Series.str</code> attribute has a lot of helpful methods</a>.</li>
<li>Create an <code>int</code>-like variable called <code>num_div_tags</code> that holds the total number of times the phrase “<code>&lt;div&gt;</code>” appears in the file.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Consider the data set called <code>gspc.csv</code>, which contains daily open, high, low and close values for the S&amp;P500 Index.</p>
<ul>
<li>Read in this data set as a <code>DataFrame</code>, and call it <code>my_data</code>. Do not include the code that achieves this in your assignment submission.</li>
<li>Write out this object as <code>my_data.pickle</code>. After you are finished, remove <code>my_data</code> from memory. Do not include the code that achieves this in your assignment submission.</li>
<li>Read in <code>my_data.pickle</code>, and store the variable as <code>financial_data</code>. <em>Do</em> include the code that achieves this in your project submission. Make sure this code assumes that <code>my_data.pickle</code> is in the same folder as the code file <code>io_lab.py</code>.</li>
</ul>
<!--chapter:end:09-io.Rmd-->
</div>
</div>
</div>
<div id="using-third-party-code" class="section level1" number="10">
<h1 number="10"><span class="header-section-number">10</span> Using Third-Party Code</h1>
<p>Before using third-party code, it must first be installed. After it is installed, it must be “loaded in” to your session. I will describe both of these steps in R and Python.</p>
<div id="installing-packages-in-r" class="section level2" number="10.1">
<h2 number="10.1"><span class="header-section-number">10.1</span> Installing Packages In R</h2>
<p>In R, there are thousands of user-created <strong>packages.</strong> You can download most of these from the <a href="https://cran.r-project.org/"><em>Comprehensive R Archive Network</em></a>. You can also download packages from other publishing platforms like <a href="https://www.bioconductor.org/">Bioconductor</a>, or <a href="https://github.com/">Github</a>. Installing from CRAN is more commonplace, and extremely easy to do. Just use the <code>install.packages()</code> function. This can be run inside your R console, so there is no need to type things into the command line.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;thePackage&quot;</span>)</span></code></pre></div>
</div>
<div id="installing-packages-in-python" class="section level2" number="10.2">
<h2 number="10.2"><span class="header-section-number">10.2</span> Installing Packages In Python</h2>
<p>In Python, installing packages is more complicated. Commands must be written in the command line, and there are multiple package managers. This isn’t surprising, because Python is used more extensively than R in fields other than data science.</p>
<p>If you followed the suggestions provided in earlier in the text, then you installed Anaconda. This means you will usually be using the <a href="https://docs.anaconda.com/anaconda/user-guide/tasks/install-packages/"><code>conda</code> command</a>. Point-and-click interfaces are made available as well.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install the_package</span></code></pre></div>
<p>There are some packages that will not be available using this method. For more information on that situation, see <a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-pkgs.html#install-non-conda-packages">here.</a></p>
</div>
<div id="loading-packages-in-r" class="section level2" number="10.3">
<h2 number="10.3"><span class="header-section-number">10.3</span> Loading Packages In R</h2>
<p>After they are installed on your machine, third-party code will need to be “loaded” into your R or Python session.</p>
<p>Loading in a package is relatively simple in R, however complications can arise when different variables share the same name. This happens relatively often because</p>
<ul>
<li>it’s easy to create a variable in the global environment that has the same name as another object you don’t know about, and</li>
<li>different packages you load in sometimes share names accidentally.</li>
</ul>
<p>Starting off with the basics, here’s how to load in a package of third-party code. Just type the following into your R console.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(thePackage)</span></code></pre></div>
<p>You can also use the <code>require()</code> function, which has slightly different behavior when the requested package is not found.</p>
<p>To understand this more deeply, we need to talk about <strong>environments</strong> again. We discussed these before in @ref(more-details-on-rs-user-defined-functions), but only in the context of user-defined functions. When we load in a package with <code>library()</code>, we make its contents available by putting it all in an environment for that package.</p>
<p>An <a href="https://cran.r-project.org/doc/manuals/R-lang.html#Environment-objects">environment</a> holds the names of objects. There are usually several environments, and each holds a different set of functions and variables. All the variables you define are in an environment, every package you load in gets its own environment, and all the functions that come in R pre-loaded have their own environment.</p>
<div class="rmd-details">
<p>Formally, each environment is pair of two things: a <strong>frame</strong> and an <strong>enclosure</strong>. The frame is the set of symbol-value pairs, and the enclosure is a pointer to the parent environment. If you’ve heard of a <em>linked list</em> in a computer science class, it’s the same thing.</p>
</div>
<p>Moreover, all of these environments are connected in a chain-like structure. To see what environments are loaded on your machine, and what order they were loaded in, use the <code>search()</code> function. This displays the <a href="https://cran.r-project.org/doc/manuals/R-lang.html#Search-path"><strong>search path</strong></a>, or the ordered sequence of all of your environments.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;.GlobalEnv&quot;          &quot;package:R6&quot;          &quot;package:ggplot2&quot;     &quot;package:reticulate&quot;  &quot;package:BayesFactor&quot;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6] &quot;package:Matrix&quot;      &quot;package:coda&quot;        &quot;package:pacman&quot;      &quot;tools:rstudio&quot;       &quot;package:stats&quot;      </span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [11] &quot;package:graphics&quot;    &quot;package:grDevices&quot;   &quot;package:utils&quot;       &quot;package:datasets&quot;    &quot;package:methods&quot;    </span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [16] &quot;Autoloads&quot;           &quot;package:base&quot;</span></span></code></pre></div>
<p>Alternatively, if you’re using RStudio, the search path, and the contents of each of its environments, are displayed in the “Environment” window. You can choose which environment you’d like to look at by selecting it from the drop-down menu. This allows you to see all of the variables in that particular environment. The <strong>global environment</strong> (i.e. <code>".GlobalEnv"</code>) is displayed by default, because that is where you store all the objects you are creating in the console.</p>
<div class="figure" style="text-align: center">
<img src="pics/environments_display_rstudio.png" alt="The Environment Window in RStudio" width="80%" />
<p class="caption">
(#fig:rstudiodisp)The Environment Window in RStudio
</p>
</div>
<p>When you call <code>library(thePackage)</code>, the package has an environment created for it, and it is <em>inserted between the global environment, and the most recently loaded package.</em> When you want to access an object by name, R will first search the global environment, and then it will traverse the environments in the search path in order. These has a few important implications.</p>
<ul>
<li><p>First, <strong>don’t define variables in the global environment that are already named in another environment.</strong> There are many variables that come pre-loaded in the <code>base</code> package (to see them, type <code>ls("package:base")</code>), and if you like using a lot of packages, you’re increasing the number of names you should avoid using.</p></li>
<li><p>Second, <strong>don’t <code>library()</code> in a package unless you need it, and if you do, be aware of all the names it will mask it packages you loaded in before</strong>. The good news is that <code>library</code> will often print warnings letting you know which names have been masked. The bad news is that it’s somewhat out of your control–if you need two packages, then they might have a shared name, and the only thing you can do about it is watch the ordering you load them in.</p></li>
<li><p>Third, don’t use <code>library()</code> inside code that is <code>source()</code>’d in other files. For example, if you attach a package to the search path from within a function you defined, anybody that uses your function loses control over the order of packages that get attached.</p></li>
</ul>
<p>All is not lost if there is a name conflict. The variables haven’t disappeared. It’s just slightly more difficult to refer to them. For instance, if I load in <code>Hmisc</code> <span class="citation">(<a href="#ref-hmisc" role="doc-biblioref">Harrell Jr, Charles Dupont, and others. 2021</a>)</span>, I get the warning warning that <code>format.pval</code> and <code>units</code> are now masked because they were names that were in <code>"package:base"</code>. I can still refer to these masked variables with the double colon operator (<code>::</code>).</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>format.pval <span class="co"># now refers to Hmisc&#39;s format.pval because it was loaded more recently</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>Hmisc<span class="sc">::</span>format.pval <span class="co"># in this case is the same as above</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span>format.pval  <span class="co"># this is the only way you can get base&#39;s format.pval function now </span></span></code></pre></div>
</div>
<div id="loading-packages-in-python" class="section level2" number="10.4">
<h2 number="10.4"><span class="header-section-number">10.4</span> Loading Packages In Python</h2>
<p>In Python, you use the <code>import</code> statement to access objects defined in another file. It is slightly more complicated than R’s <code>library()</code> function, but it is also more flexible. To make the contents of a package called, say, <code>the_package</code> available, type <em>one of the following</em> inside a Python session.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> the_package</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> the_package <span class="im">as</span> tp </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> the_package <span class="im">import</span> <span class="op">*</span></span></code></pre></div>
<p>To describe the difference between these three approaches, as well as to highlight the important takeaways and compare them with the important takeaways in the last section, we need to discuss what a Python module is, what a package is, and what a Python namespace is.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
<ul>
<li><p>A Python <a href="https://docs.python.org/3/tutorial/modules.html"><strong><code>module</code></strong></a> is a <code>.py</code> file, separate from the one you are currently editing, with function and/or object definitions in it.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></p></li>
<li><p>A <a href="https://docs.python.org/3/tutorial/modules.html#packages">package</a> is a group of modules.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></p></li>
<li><p>A <a href="https://docs.python.org/3/tutorial/classes.html#python-scopes-and-namespaces"><strong>namespace</strong></a> is “a mapping from names to objects.”</p></li>
</ul>
<p>With these definitions, we can define <code>import</code>ing. According to the <a href="https://docs.python.org/3/reference/import.html#the-import-system">Python documentation</a>, “[t]he import statement combines two operations; it searches for the named module, then it binds the results of that search to a name in the local scope.”</p>
<p>The sequence of places Python looks for a module is called the search path. This is not the same as R’s search path, though. In Python, the search path is a list of places to look for <em>modules</em>, not a list of places to look for variables. To see it, <code>import sys</code>, then type <code>sys.path</code>.</p>
<p>After a module is found, the variable names inside it become available to the <code>import</code>ing module. These variables are available in the global scope, but the names you use to access them will depend on what kind of <code>import</code> statement you used. From there, you are using the same scoping rules that we described in @ref(function-scope-in-python), which means the LEGB acronym still applies.</p>
<div class="rmd-details">
<p>In both languages, an (unqualified) variable name can only refer to one object at any time. This does not necessarily have anything to do with using third-party code–you can redefine objects, but don’t expect to be able to access the old object after you do it.</p>
<p>The same thing can happen when you use third-party code.</p>
<ul>
<li>In R, you have to worry about the order of <code>library()</code> and <code>require()</code> calls, because there is potential <em>masking</em> going on.</li>
<li>If you don’t want to worry about masking, don’t use <code>library()</code> or <code>require()</code>, and just refer to variables using the <code>::</code> operator (e.g. <code>coolPackage::specialFunc()</code>).</li>
<li>In Python, loading packages using either the <code>import package</code> format or the <code>import package as p</code> format means you do not need to worry about the order of imports because you will be forced to qualify variable names (e.g. <code>package.func()</code> or <code>p.func()</code>).</li>
<li>In Python, if you load third-party code using either <code>from package import foo</code> or <code>from package import *</code>, you won’t have to qualify variable names, but imported objects will overwrite any variables that happen to have the same name as something you’re importing.</li>
</ul>
<p>The way variable names are stored are only slightly different between R and Python.</p>
<ul>
<li>Python namespaces are similar to R environments in that they hold name-value pairs; however</li>
<li>Python namespaces are unlike R environments in that they are not arranged into a sorted list.</li>
<li>Also, Python modules may be organized into a nested or tree-like structure, whereas R packages will always have a flat structure.</li>
</ul>
</div>
<div id="importing-examples" class="section level3" number="10.4.1">
<h3 number="10.4.1"><span class="header-section-number">10.4.1</span> <code>import</code>ing Examples</h3>
<p>In the example below, we import the entire <code>numpy</code> package in a way that lets us refer to it as <code>np</code>. This reduces the amount of typing that is required of us, but it also protects against variable name clashing. We then use the <code>normal()</code> function to simulate normal random variables. This function is in the <a href="https://numpy.org/doc/stable/reference/random/index.html?highlight=random#module-numpy.random"><code>random</code> sub-module</a>, which is a sub-module in <code>numpy</code> that collects all of the pseudorandom number generation functionality together.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># import all of numpy</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>np.random.normal(size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([-0.1177849 ,  0.09242971,  1.70867542, -0.5152147 , -0.95926628,</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="co">##         1.44507218,  0.23446986, -0.41666161, -0.40232228, -1.76533545])</span></span></code></pre></div>
<p>This is one use of the dot operator (<code>.</code>). It is also used to access attributes and methods of objects (more information on that will come later in chapter @ref(an-introduction-to-object-oriented-programming)). <code>normal</code> is <em>inside of</em> <code>random</code>, which it itself inside of <code>np</code>.</p>
<p>As a second example, suppose we were interested in the <a href="https://docs.scipy.org/doc/scipy/reference/tutorial/stats.html"><code>stats</code> sub-module</a> found inside the <code>scipy</code> package. We could import all of <code>scipy</code>, but just like the above example, that would mean we would need to consistently refer to a variable’s module, the sub-module, and the variable name. For long programs, this can become tedious if we had to type <code>scipy.stats.norm</code> over and over again. Instead, let’s import the sub-module (or sub-package) and ignore the rest of <code>scipy</code>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>stats.norm().rvs(size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 1.25077337,  0.26024957, -0.5032605 ,  0.40672638,  0.36374873,</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co">##        -1.00236825,  1.38125477,  0.57683001, -0.61989706, -0.26551659])</span></span></code></pre></div>
<p>So we don’t have to type <code>scipy</code> every time we use something in <code>scipy.stats</code>.</p>
<p>Finally, we can import the function directly, and refer to it with only one letter. This is highly discouraged, though. We are much more likely to accidentally use the name <code>n</code> twice. Further, <code>n</code> is not a very descriptive name, which means it could be difficult to understand what your program is doing later.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> normal <span class="im">as</span> n</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>n(size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 1.51261848,  1.3758968 , -0.16714459,  0.46187777, -0.65945332,</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">##         0.6232959 ,  0.570791  , -1.11566223, -0.36101484,  1.97399363])</span></span></code></pre></div>
<p>Keep in mind, you’re always at risk of accidentally re-using names, even if you aren’t <code>import</code>ing anything. For example, consider the following code.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">3</span> <span class="co"># now you can&#39;t use n as a function </span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>n()   </span></code></pre></div>
<p>This is very bad, because now you cannot use the <code>n()</code> function that was imported from the <code>numpy.random</code> sub-module earlier. In other words, it is longer <em>callable</em>. The error message from the above code will be something like <code>TypeError: 'int' object is not callable</code>.</p>
<p>Use the <code>dir()</code> function to see what is available inside a module. Here are a few examples. Type them into your own machine to see what they output.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="bu">dir</span>(np) <span class="co"># numpy stuff</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="bu">dir</span>(__builtins__) <span class="co">#built-in stuff</span></span></code></pre></div>
</div>
</div>
<div id="exercises-8" class="section level2" number="10.5">
<h2 number="10.5"><span class="header-section-number">10.5</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>What are important differences in the package installation procedures of R and Python? Select all that apply.</p>
<ul>
<li>Installing R packages can be done from within R, while installing packages in Python can be done in the command line.</li>
<li>Installing R packages can usually be done with the same function <code>install.packages()</code>, while installing packages in Python can be done with a variety of package installers such as <code>pip install</code> and <code>conda install</code>.</li>
<li>There is only one package repository for R, but many for Python.</li>
<li>There is only one package repository for Python, but many for R.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>What are important similarities and differences in the package loading procedures of R and Python? Select all that apply.</p>
<ul>
<li>R and Python both have a search path.</li>
<li>R’s <code>::</code> operator is very similar to Python’s <code>.</code> operator because they can both help access variable names inside packages.</li>
<li>Python namespaces are unlike R environments in that they are not arranged into a sorted list.</li>
<li><code>library(package)</code> in R is similar to <code>from package import *</code> in Python because it will allow you to refer to all variables in <code>package</code> without qualification.</li>
<li>Python packages might have <code>sub-modules</code> whereas R’s packages do not.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li></li>
</ol>
<p>In Python, which of the following is, generally speaking, the best way to <code>import</code>?</p>
<ul>
<li><code>import the_package</code></li>
<li><code>from the_package import *</code></li>
<li><code>import the_package as tp</code></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li></li>
</ol>
<p>In Python, which of the following is, generally speaking, the worst way to <code>import</code>?</p>
<ul>
<li><code>import the_package</code></li>
<li><code>from the_package import *</code></li>
<li><code>import the_package as tp</code></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li></li>
</ol>
<p>In R, if you want to use a function <code>func()</code> from <code>package</code>, do you always have to use <code>library(package)</code> or <code>require(package)</code> first?</p>
<ul>
<li>yes, otherwise <code>func()</code> won’t be available.</li>
<li>no, you can just use <code>package::func()</code> without calling any function that performs pre-loading.</li>
</ul>
<!--chapter:end:10-third_party_code.Rmd-->
</div>
</div>
<div id="control-flow" class="section level1" number="11">
<h1 number="11"><span class="header-section-number">11</span> Control Flow</h1>
<div id="conditional-logic" class="section level2" number="11.1">
<h2 number="11.1"><span class="header-section-number">11.1</span> Conditional Logic</h2>
<p>We discussed Boolean/logical objects in @ref(basic-types). We used these for</p>
<ul>
<li>counting the number of times a condition appeared, and</li>
<li>subsetting vectors and data frames.</li>
</ul>
<p>Another way to use them is to conditionally execute code. You can choose to execute code depending on whether or not a Boolean/logical value is true or not.</p>
<p>This is what an <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#if">if statement looks like In R</a>:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>myName <span class="ot">&lt;-</span> <span class="st">&quot;Taylor&quot;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(myName <span class="sc">!=</span> <span class="st">&quot;Clare&quot;</span>){</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;you are not Clare&quot;</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;you are not Clare&quot;</span></span></code></pre></div>
<p><a href="https://docs.python.org/3/tutorial/controlflow.html#if-statements">In Python</a>, you don’t need curly braces, but the indentation needs to be just right, and you need a colon.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>my_name <span class="op">=</span> <span class="st">&quot;Taylor&quot;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> my_name <span class="op">==</span> <span class="st">&quot;Taylor&quot;</span>:</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;hi Taylor&quot;</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co">## hi Taylor</span></span></code></pre></div>
<p>There can be more than one test of truth. To test alternative conditions, you can add one or more <code>else if</code> (in R) or <code>elif</code> (in Python) blocks. The first block with a Boolean that is found to be true will execute, and none of the resulting conditions will be checked.</p>
<p>If no <code>if</code> block or <code>else if</code>/<code>elif</code> block executes, an <code>else</code> block will always execute. That’s why <code>else</code> blocks don’t need to look at a Boolean. Whether they execute only depends on the Booleans in the previous blocks. If there is no <code>else</code> block, and none of the previous conditions are true, nothing will execute.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>food <span class="ot">&lt;-</span> <span class="st">&quot;muffin&quot;</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(food <span class="sc">==</span> <span class="st">&quot;apple&quot;</span>){</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;an apple a day keeps the doctor away&quot;</span>)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(food <span class="sc">==</span> <span class="st">&quot;muffin&quot;</span>){</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;muffins have a lot of sugar in them&quot;</span>)</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;neither an apple nor a muffin&quot;</span>)</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;muffins have a lot of sugar in them&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>my_num <span class="op">=</span> <span class="fl">42.999</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> my_num <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;my_num is even&quot;</span>)</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> my_num <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    my_num <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;my_num was made even&quot;</span>)</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;you&#39;re cheating by not using integers!&quot;</span>)</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="co">## you&#39;re cheating by not using integers!</span></span></code></pre></div>
</div>
<div id="loops" class="section level2" number="11.2">
<h2 number="11.2"><span class="header-section-number">11.2</span> Loops</h2>
<p>One line of code generally does one “thing,” unless you’re using loops. Code written inside a loop will execute many times.</p>
<p>The most common loop for us will be a <code>for</code> loop. A simple <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#for"><code>for</code> loop in R</a> might look like this</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">#in R</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>myLength <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> myLength)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(myLength)){</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>    r[i] <span class="ot">&lt;-</span> i</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>r</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 3 4 5 6 7 8 9</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>seq_len(myLength)</code> gives us a <code>vector</code>.</li>
<li><code>i</code> is a variable that takes on the values found in <code>seq_len(myLength)</code>.</li>
<li>Code inside the loop (inside the curly braces), is repeatedly executed, and it may or may not reference the dynamic variable <code>i</code>.</li>
</ol>
<p><a href="https://docs.python.org/3/tutorial/controlflow.html#for-statements">Here is an example of a for loop in Python</a>:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">#in Python</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>my_length <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> []</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(my_length):</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    r.append(i)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>r</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co">## [0, 1, 2, 3, 4, 5, 6, 7, 8]</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Unsurprisingly, Python’s syntax opts for indentation and colons instead of curly braces and parentheses.</li>
<li>Code inside the loop (indented underneath the <code>for</code> line), is repeatedly executed, and it may or may not reference the dynamic variable <code>i</code>.</li>
<li><code>for</code> loops in Python are more flexible because they iterate over many different types of data structures–in this case <a href="https://docs.python.org/3/library/stdtypes.html#range"><code>range()</code> returns an object of type <code>range</code></a>.</li>
<li>The <a href="https://docs.python.org/3/tutorial/controlflow.html#the-range-function"><code>range</code></a> doesn’t generate all the numbers in the sequence at once, so it saves on memory. This can be quite useful if you’re looping over a large collection, and you don’t need to store everything all at once. However, in this example, <code>r</code> is a list that <em>does</em> store all the consecutive integers.</li>
</ol>
<p>Loops are for repeatedly executing code. <code>for</code> loops are great when you know the number of iterations needed ahead of time. If the number of iterations is not known, then you’ll need a <code>while</code> loop. While loops will only terminate after a condition is found to be true. Here are some examples <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#while">in R</a> and <a href="https://docs.python.org/3/reference/compound_stmts.html#while">in Python</a>.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>keepGoing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keepGoing){</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    oneOrZero <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">5</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;oneOrZero:&quot;</span>, oneOrZero))</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(oneOrZero <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>        keepGoing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;oneOrZero: 0&quot;</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;oneOrZero: 0&quot;</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;oneOrZero: 1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>keep_going <span class="op">=</span> <span class="va">True</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> keep_going:</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    one_or_zero <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, <span class="fl">.5</span>) </span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;one_or_zero: &quot;</span>, one_or_zero)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> one_or_zero <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>        keep_going <span class="op">=</span> <span class="va">False</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="co">## one_or_zero:  0</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="co">## one_or_zero:  1</span></span></code></pre></div>
<div class="rmd-caution">
<p>Here are some tips for writing loops:</p>
<ol style="list-style-type: decimal">
<li>If you find yourself copying and pasting code, changing only a small portion of text on each line of code, you should consider using a loop.</li>
<li>If a <code>for</code> loop works for something you are trying to do, first try to find a replacement function that does what you want. The examples above just made a <code>vector</code>/<code>list</code> of consecutive integers. There are many built in functions that accomplish this. Avoiding loops in this case would make your program shorter, easier to read, and (potentially) much faster.</li>
<li>A third option between looping, and a built-in function, is to try the functional approach. This will be explained more in the last chapter.</li>
<li>Watch out for <a href="https://en.wikipedia.org/wiki/Off-by-one_error"><strong>off-by-one</strong> errors</a>. Iterating over the wrong sequence is a common mistake, considering
<ul>
<li>Python starts counting from <span class="math inline">\(0\)</span>, while R starts counting from <span class="math inline">\(1\)</span></li>
<li>sometimes iteration <code>i</code> references the <code>i-1</code>th element of a container</li>
<li>The behavior of loops is sometimes more difficult to understand if they’re using <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Looping"><code>break</code></a> or <a href="https://docs.python.org/3/tutorial/controlflow.html#break-and-continue-statements-and-else-clauses-on-loops"><code>continue</code>/<code>next</code> statements</a>.</li>
</ul></li>
<li><em>Don’t hardcode variables.</em> In other words, don’t write code that is specific to particulars of your script’s current draft. Write code that will still run if your program is fed different data, or if you need to calculate something else that’s closely-related (e.g. run the same calculations on different data sets, or vary the number of simulations, or make the same plot several times in similar situations, etc.). I can guarantee that most of the code you write will need to be run in many different situations. If, at every time you decide to make a change, you need to hunt down multiple places and make multiple changes, there is a nontrivial probability you will miss at least one. As a result, you will introduce a bug into your program, and waste (sometimes a lot of) time trying to find it.</li>
<li>Watch out for infinite <code>while</code> loops. Make sure that your stopping criterion is guaranteed to eventually become true.</li>
</ol>
</div>
<!-- Above I provide some advice that is worth repeating: *don't hardcode variables*. The goal is to minimize the number of places you have to make changes to your code, if such a need arises. , so try to save your future self some time.  -->
<!-- For example, in statistical programs, there are often "tuning parameters" that must be changed frequently to affect the overall behavior of the program. For instance, you might need to re-run some plotting script after changing a few graphical parameters, or you might need to change the confidence or significance level of some interval or hypothesis test, or change a variable you're using to subset values in a data frame, or alter the number of simulations you're performing, or the number of iterations you're performing, etc. If these variables only need to be changed in one location, that saves you a lot of time and gives you more flexibility. If they don't need to be changed at all, even better!  -->
<!-- On the other hand, if you refer to specific choices in the code of your program, then every time you make a change, you will need to hunt down all of those lines of code, and make multiple changes. -->
<!-- In the code examples above, the  `myLength` and `my_length` variables could be referenced in many places later on in our programs.  -->
<!-- Even better, use a function to calculate the length of the container. Then, even if your container changes in size, the program will still run as intended.  -->
<!-- TODO -->
<p>Python also provides an alternative way to construct lists similar to the one we constructed in the above example. They are called <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions"><strong>list comprehensions</strong></a>. These are convenient because you can incorporate iteration and conditional logic in one line of code.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span><span class="op">*</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>) <span class="cf">if</span> i<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co">## [0, 6, 12, 18, 24]</span></span></code></pre></div>
<p>You might also have a look at <a href="https://www.python.org/dev/peps/pep-0289/"><em>generator expressions</em></a> and <a href="https://www.python.org/dev/peps/pep-0274/"><em>dictionary comprehensions</em></a>.</p>
<p>R can come close to replicating the above behavior with vectorization, but the conditional part is hard to achieve without subsetting.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">*</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>)[<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>)<span class="sc">%%</span><span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  0  6 12 18 24</span></span></code></pre></div>
</div>
<div id="exercises-9" class="section level2" number="11.3">
<h2 number="11.3"><span class="header-section-number">11.3</span> Exercises</h2>
<div id="r-questions-8" class="section level3" number="11.3.1">
<h3 number="11.3.1"><span class="header-section-number">11.3.1</span> R Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you have a <code>vector</code> of <code>numeric</code> data: <span class="math inline">\(x_1, \ldots, x_n\)</span>. Write a function called <code>cappedMoveAve(dataVector)</code> that takes in a <code>vector</code> and returns a 3-period “capped” moving average. Make sure to use a <code>for</code> loop. The formula you should use is
<span class="math display">\[
y_t = \min\left(10, \frac{1}{3}\sum_{i=0}^2x_{t-i} \right).
\]</span>
The function should return <span class="math inline">\(y_1, \ldots, y_n\)</span> as a <code>vector</code>. Let <span class="math inline">\(y_1 = y_2 = 0\)</span>.</p>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Say we have a target<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a> distribution that we want to sample from:
<span class="math display">\[
p(x) = 
\begin{cases}
\frac{x^2(1-x)}{\int_0^1 y^2(1-y) dy} &amp; 0 &lt; x &lt; 1 \\
0 &amp; \text{otherwise}
\end{cases}.
\]</span>
The denominator, <span class="math inline">\(\int_0^1 y^2(1-y) dy\)</span>, is the target’s normalizing constant. You might know how to solve this integral (it’s equal to <span class="math inline">\(1/12\)</span>), but let’s pretend for the sake of our example that it’s too difficult for us. We want to sample from <span class="math inline">\(p(x)\)</span> while only being able to evaluate (not sample) from its unnormalized version <span class="math inline">\(f(x) := x^2(1-x)\)</span>. This is a situation that arises often–wanting to sample from some complicated distribution whose density you can only evaluate up to a constant of proportionality.</p>
<p>Next, let’s choose a uniform distribution for our <em>proposal distribution</em>: <span class="math inline">\(q(x) = 1\)</span> if <span class="math inline">\(0 &lt; x &lt; 1\)</span>. This means we will sample from this distribution, because it’s easier. We just need to “adjust” our samples somehow, because it’s not the same as our target.</p>
<p>We can plot all three functions. The area under the <span class="math inline">\(p(x)\)</span> and <span class="math inline">\(q(x)\)</span> curves is <span class="math inline">\(1\)</span>, because they are true probability density functions. <span class="math inline">\(f(x)\)</span>, however, is not.</p>
<div class="figure" style="text-align: center">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-168-1.png" alt="Visualizing Our Three Functions" width="40%" />
<p class="caption">
(#fig:unnamed-chunk-168)Visualizing Our Three Functions
</p>
</div>
<ul>
<li>Write a function called <code>arSamp(n)</code> that samples from <span class="math inline">\(p(x)\)</span> using accept-reject sampling. It should take a single argument that is equal to the number of samples desired. Below is one step of the accept-reject algorithm. You will need to do many iterations of this. The number of iterations will be random, because some of these proposals will not be accepted.</li>
</ul>
<hr />
<p><strong>Algorithm 1</strong>: Accept-Reject Sampling (One Step)</p>
<hr />
<ol style="list-style-type: decimal">
<li>Find <span class="math inline">\(M\)</span> such that <span class="math inline">\(M &gt; \frac{f(x)}{q(x)}\)</span> for all possible <span class="math inline">\(x\)</span> (the smaller the better).</li>
<li>Sample <span class="math inline">\(X\)</span> from <span class="math inline">\(q(x)\)</span>.</li>
<li>Sample <span class="math inline">\(Y \mid X\)</span> from <span class="math inline">\(\text{Bernoulli}\left(\frac{f(X)}{q(X)M}\right)\)</span>.</li>
<li>If <span class="math inline">\(Y = 1\)</span>, then return <span class="math inline">\(X\)</span>.</li>
<li>Otherwise, return nothing.</li>
</ol>
<hr />
<ol start="3" style="list-style-type: decimal">
<li></li>
</ol>
<p>Write a function called <code>multiplyTwoMats(A,B)</code> that performs matrix multiplication. It should take two <code>matrix</code> arguments: <code>A</code> and <code>B</code>. Then it should return the matrix product <code>AB</code>. Use two nested <code>for</code> loops to write this function. Make sure to test this function against the usual tool you use to multiply matrices together: <code>%*%</code>.</p>
<ol start="4" style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you are trying to predict a value of <span class="math inline">\(Y\)</span> given some information about a corresponding independent variable <span class="math inline">\(x\)</span>. Suppose further that you have a historical data set of observations <span class="math inline">\((x_1, y_1), \ldots, (x_n,y_n)\)</span>. One approach for coming up with predictions is to use <strong>Nadaraya–Watson Kernel Regression</strong> <span class="citation">(<a href="#ref-Nadaraya" role="doc-biblioref">Nadaraya 1964</a>)</span> <span class="citation">(<a href="#ref-Watson" role="doc-biblioref">Watson 1964</a>)</span>. The prediction this approach provides is simply a weighted average of all of the historically-observed data points <span class="math inline">\(y_1, \ldots, y_n\)</span>. The weight for a given <span class="math inline">\(y_i\)</span> will be larger if <span class="math inline">\(x_i\)</span> is “close” to the value <span class="math inline">\(x\)</span> that you are obtaining predictions for. On the other hand, if <span class="math inline">\(x_j\)</span> is far away from <span class="math inline">\(x\)</span>, then the weight for <span class="math inline">\(y_j\)</span> will be relatively small, and so this data point won’t influence the prediction much.</p>
<p>Write a function called <code>kernReg(xPred,xData,yData,kernFunc)</code> that computes the Nadaraya–Watson estimate of the prediction of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X=x\)</span>. Do not use a <code>for</code> loop in your function definition. The formula is
<span class="math display">\[\sum_{i=1}^n \frac{K(x-x_i)}{\sum_{j=1}^n K(x-x_j) } y_i,\]</span> where <span class="math inline">\(x\)</span> is the point you’re trying to get a prediction for.</p>
<pre><code>* Your function should return one floating point number. 
* The input `xPred` will be a floating point number.
* The input `xData` is a one-dimensional `vector` of numerical data of independent variables. 
* The input `yData` is a one-dimensional `vector` of numerical data of dependent variables.
* `kernFunc` is a function that accepts a `numeric` `vector` and returns a floating point. It&#39;s vectorized.</code></pre>
<p>Below is some code that will help you test your predictions. The kernel function, <code>gaussKernel()</code>, implements the Gaussian kernel function <span class="math inline">\(K(z) = \exp[-z^2/2]/\sqrt{2\pi}\)</span>. Notice the creation of <code>preds</code> was commented out. Use a <code>for</code> loop to generate predictions for all elements of <code>xTest</code> and store them in the vector <code>preds</code>.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>gaussKernel <span class="ot">&lt;-</span> dnorm</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>xTest <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="at">length.out=</span> <span class="dv">100</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>yTest <span class="ot">&lt;-</span> xTest<span class="sc">*</span><span class="dv">2</span> </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="co"># preds &lt;- ?</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xTest, yTest, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xTest, preds, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
</div>
<div id="python-questions-8" class="section level3" number="11.3.2">
<h3 number="11.3.2"><span class="header-section-number">11.3.2</span> Python Questions</h3>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you go to the casino with <span class="math inline">\(10\)</span> dollars. You decide that your policy is to play until you go broke, or until you triple your money. The only game you play costs <span class="math inline">\(\$1\)</span> to play. If you lose, you lose that dollar. If you win, you get another <span class="math inline">\(\$1\)</span> in addition to getting your money back.</p>
<ul>
<li>Write a function called <code>sim_night(p)</code> that simulates your night of gambling. Have it return a Pandas <code>Series</code> with the running balance of money you have over the course of a night. For example, if you lose <span class="math inline">\(10\)</span> games in a row, and go home early, the returned <code>Series</code> contains <span class="math inline">\(9, \ldots, 1,0\)</span>. This function will only take one input, <code>p</code>, which is the probability of winning any/every game you play.</li>
<li>Use a <code>for</code> loop to call your function <span class="math inline">\(5000\)</span> times with probability <code>p=.5</code>. Each time, store the number of games played. Store them all in a Numpy <code>array</code> or Pandas <code>Series</code> called <code>simulated_durations</code>.</li>
<li>Take the average of <code>simulated_durations</code>. This is your Monte Carlo estimate of the expected duration. How does it compare with what you think it should be theoretically?</li>
<li>Perform the same analysis to estimate the expected duration when <span class="math inline">\(p=.7\)</span>. Store your answer as a <code>float</code> called <code>expec_duration</code>.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<p>Suppose you have the following data set. Please include the following snippet in your submission.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>my_data <span class="op">=</span> pd.read_csv(<span class="st">&quot;sim_data.csv&quot;</span>, header<span class="op">=</span><span class="va">None</span>).values.flatten()</span></code></pre></div>
<p>This question will demonstrate how to implement <strong>The Bootstrap</strong> <span class="citation">(<a href="#ref-bootstrap" role="doc-biblioref">Efron 1979</a>)</span>, which is a popular nonparametric approach to understand the distribution of a statistic of interest. The main idea is to calculate your statistic over and over again on <em>bootstrapped</em> data sets, which are data sets randomly chosen, with replacement, from your original data set <code>my_data</code>. Each bootstrapped data set is of the same size as the original data set, and each bootstrapped data set will yield one statistic. Collect all of these random statistics, and it is a good approximation to the statistic’s theoretical distribution.</p>
<ul>
<li>Calculate the mean of this data set and store it as a floating point number called <code>sample_mean</code>.</li>
<li>Calculate <span class="math inline">\(5,000\)</span> bootstrap sample means. Store them in a Numpy <code>array</code> called <code>bootstrapped_means</code>. Use a <code>for</code> loop, and inside the loop, sample with replacement <span class="math inline">\(1000\)</span> times from the length <span class="math inline">\(1000\)</span> data set. You can use the function <code>np.random.choice()</code> to accomplish this.</li>
<li>Calculate the sample mean of these bootstrapped means. This is a good estimate of the <em>theoretical</em> mean/expectation of the sample mean. Call it <code>mean_of_means</code>.</li>
<li>Calculate the sample variance of these bootstrapped means. This is a good estimate of the <em>theoretical</em> variance of the sample mean. Call it <code>var_of_means</code>.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li></li>
</ol>
<p>Write a function called <code>ar_samp(n)</code> that samples from <span class="math inline">\(p(x)\)</span> using accept-reject sampling. Use any proposal distribution that you’d like. It should take a single argument that is equal to the number of samples desired. Sample from the following target:
<span class="math display">\[
  p(x) \propto f(x) := \exp[\cos(2\pi x)] x^2(1-x), \hspace{5mm} 0 &lt; x &lt; 1.
  \]</span></p>
<!--chapter:end:11-control_flow.Rmd-->
</div>
</div>
</div>
<div id="reshaping-and-combining-data-sets" class="section level1" number="12">
<h1 number="12"><span class="header-section-number">12</span> Reshaping and Combining Data Sets</h1>
<div id="ordering-and-sorting-data" class="section level2" number="12.1">
<h2 number="12.1"><span class="header-section-number">12.1</span> Ordering and Sorting Data</h2>
<p>Sorting a data set, in ascending order, say, is a common task. You might need to do it because</p>
<ol style="list-style-type: decimal">
<li>ordering and ranking is commonly done in <em>nonparametric statistics</em>,</li>
<li>you want to inspect the most “extreme” observations in a data set,</li>
<li>it’s a pre-processing step before generating visualizations.</li>
</ol>
<p>In R, it all starts with <code>vector</code>s. There are two common functions you should know: <code>sort()</code> and <code>order()</code>. <code>sort()</code> returns the sorted <em>data</em>, while <code>order()</code> returns the <em>order indexes</em>.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>sillyData <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sillyData)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  0.3903776  0.5796584  1.4929115  0.3704896 -1.3450719</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(sillyData)</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -1.3450719  0.3704896  0.3903776  0.5796584  1.4929115</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="fu">order</span>(sillyData)</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5 4 1 2 3</span></span></code></pre></div>
<p><code>order()</code> is useful if you’re sorting a data frame by a particularly column. Below, we inspect the top 5 most expensive cars. Notice that we need to clean up the <code>MSRP</code> (a <code>character</code> vector) a little first. We use the function <code>gsub()</code> to find patterns in the text, and replace them with the empty string.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>carData <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/cars.csv&quot;</span>)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>noDollarSignMSRP <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;$&quot;</span>, <span class="st">&quot;&quot;</span>, carData<span class="sc">$</span>MSRP, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>carData<span class="sc">$</span>cleanMSRP <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>, noDollarSignMSRP, <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>rowIndices <span class="ot">&lt;-</span> <span class="fu">order</span>(carData<span class="sc">$</span>cleanMSRP, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>carData[rowIndices,<span class="fu">c</span>(<span class="st">&quot;Make&quot;</span>, <span class="st">&quot;Model&quot;</span>, <span class="st">&quot;MSRP&quot;</span>, <span class="st">&quot;cleanMSRP&quot;</span>)]</span></code></pre></div>
<pre><code>##              Make                 Model     MSRP cleanMSRP
## 335       Porsche           911 GT2 2dr $192,465    192465
## 263 Mercedes-Benz             CL600 2dr $128,420    128420
## 272 Mercedes-Benz SL600 convertible 2dr $126,670    126670
## 271 Mercedes-Benz          SL55 AMG 2dr $121,770    121770
## 262 Mercedes-Benz             CL500 2dr  $94,820     94820</code></pre>
<p>In Python, Numpy has <a href="https://numpy.org/doc/stable/reference/generated/numpy.argsort.html"><code>np.argsort()</code></a> and <a href="https://numpy.org/doc/stable/reference/generated/numpy.sort.html"><code>np.sort()</code></a>.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>silly_data <span class="op">=</span> np.random.normal(size<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(silly_data)</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="co">## [-0.52817175 -1.07296862  0.86540763 -2.3015387   1.74481176]</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>np.sort(silly_data)</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="co">## array([-2.3015387 , -1.07296862, -0.52817175,  0.86540763,  1.74481176])</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>np.argsort(silly_data)</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="co">## array([3, 1, 0, 2, 4])</span></span></code></pre></div>
<p>For Pandas’ <code>DataFrame</code>s, most of the functions I find useful are methods attached to the <code>DataFrame</code> class. That means that, as long as something is inside a <code>DataFrame</code>, you can use dot notation.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>car_data <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/cars.csv&quot;</span>)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>car_data[<span class="st">&#39;no_dlr_msrp&#39;</span>] <span class="op">=</span> car_data[<span class="st">&#39;MSRP&#39;</span>].<span class="bu">str</span>.replace(<span class="st">&quot;$&quot;</span>, <span class="st">&quot;&quot;</span>, regex <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>car_data[<span class="st">&#39;clean_MSRP&#39;</span>] <span class="op">=</span> car_data[<span class="st">&#39;no_dlr_msrp&#39;</span>].<span class="bu">str</span>.replace(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>).astype(<span class="bu">float</span>)</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>car_data <span class="op">=</span> car_data.sort_values(by<span class="op">=</span><span class="st">&#39;clean_MSRP&#39;</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>car_data[[<span class="st">&quot;Make&quot;</span>, <span class="st">&quot;Model&quot;</span>, <span class="st">&quot;MSRP&quot;</span>, <span class="st">&quot;clean_MSRP&quot;</span>]].head(<span class="dv">5</span>)</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="co">##               Make                  Model      MSRP  clean_MSRP</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 334        Porsche            911 GT2 2dr  $192,465    192465.0</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 262  Mercedes-Benz              CL600 2dr  $128,420    128420.0</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 271  Mercedes-Benz  SL600 convertible 2dr  $126,670    126670.0</span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 270  Mercedes-Benz           SL55 AMG 2dr  $121,770    121770.0</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 261  Mercedes-Benz              CL500 2dr   $94,820     94820.0</span></span></code></pre></div>
<p>Pandas’ <code>DataFrame</code>s and <code>Series</code> have a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html"><code>.replace()</code></a> method. We use this to remove dollar signs and commas from the MSRP column. Note that we had to access the <code>.str</code> attribute of the <code>Series</code> column before we used it. After the string was processed, we converted it to a <code>Series</code> of <code>float</code>s with the <code>astype()</code> method.</p>
<p>Finally, sorting the overall data frame could have been done with the same approach as the code we used in R (i.e. raw subsetting by row indexes), but there is a built-in method called <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sort_values.html"><code>sort_values()</code></a> that will do it for us.</p>
</div>
<div id="stacking-data-sets-and-placing-them-shoulder-to-shoulder" class="section level2" number="12.2">
<h2 number="12.2"><span class="header-section-number">12.2</span> Stacking Data Sets and Placing Them Shoulder to Shoulder</h2>
<p>Stacking data sets on top of each other is a common task. You might need to do it if</p>
<ol style="list-style-type: decimal">
<li>you need to add new a new row (or many rows) to a data frame,</li>
<li>you need to recombine data sets (e.g. recombine a train/test split), or</li>
<li>you’re creating a matrix in a step-by-step way.</li>
</ol>
<p>In R, this can be done with <code>rbind()</code> (short for “row bind”)</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>realEstate <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/albemarle_real_estate.csv&quot;</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> realEstate[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> realEstate[<span class="dv">1</span>,]</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rbind</span>(test, train))</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   YearBuilt YearRemodeled Condition NumStories FinSqFt Bedroom FullBath HalfBath TotalRooms LotSize TotalValue</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      2006             0   Average       1.00    1922       3        3        0         10   5.000     409900</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      2003             0   Average       1.00    1848       3        2        0          7  61.189     523100</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      1972             0   Average       1.00    1248       2        1        0          4   1.760     180900</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      1998             0      Good       1.00    1244       1        1        0          3  50.648     620700</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      1886             0   Average       1.86    1861       4        1        0          6   3.880     162500</span></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      1910             0      Fair       1.53    1108       3        1        0          6   8.838     167200</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a><span class="do">##          City</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      CROZET</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      CROZET</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 EARLYSVILLE</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      CROZET</span></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      CROZET</span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      CROZET</span></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">rbind</span>(test, train) <span class="sc">!=</span> realEstate)</span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span></code></pre></div>
<p>The above example was with <code>data.frame</code>s. This example of <code>rbind()</code> is with <code>matrix</code> objects.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">matrix</span>(<span class="dv">1</span>,<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>), </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="dv">2</span>,<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>))</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    1    1</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    1    1    1</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    2    2    2</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    2    2    2</span></span></code></pre></div>
<p>In Python, you can stack data frames with <a href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=pandas+concat&amp;ie=UTF-8&amp;oe=UTF-8"><code>pd.concat()</code></a>. It has a lot of options, so feel free to peruse those. You can also replace the call to <code>pd.concat()</code> below with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.append.html"><code>test.append(train)</code></a>.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>real_estate <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/albemarle_real_estate.csv&quot;</span>)</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> real_estate.iloc[<span class="dv">1</span>:,]</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> real_estate.iloc[[<span class="dv">0</span>],] <span class="co"># need the extra brackets!</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>pd.concat([test,train], axis<span class="op">=</span><span class="dv">0</span>).head() <span class="co"># also </span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="co">##    YearBuilt  YearRemodeled Condition  ...  LotSize  TotalValue         City</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 0       2006              0   Average  ...    5.000      409900       CROZET</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1       2003              0   Average  ...   61.189      523100       CROZET</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2       1972              0   Average  ...    1.760      180900  EARLYSVILLE</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 3       1998              0      Good  ...   50.648      620700       CROZET</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 4       1886              0   Average  ...    3.880      162500       CROZET</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 12 columns]</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>(pd.concat([test,train], axis<span class="op">=</span><span class="dv">0</span>) <span class="op">!=</span> real_estate).<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 0</span></span></code></pre></div>
<p>Take note of the extra square brackets when we create <code>test</code>. If you use <code>real_estate.iloc[0,]</code> instead, it will return a <code>Series</code> with all the elements coerced to the same type, and this won’t <code>pd.concat()</code> properly with the rest of the data!</p>
</div>
<div id="merging-or-joining-data-sets" class="section level2" number="12.3">
<h2 number="12.3"><span class="header-section-number">12.3</span> Merging or Joining Data Sets</h2>
<p>If you have two different data sets that provide different information about the same things, you put them together using a <strong><code>merge</code></strong> (aka <strong><code>join</code></strong>) statement. The resulting data set is wider, and it may end up with either more or fewer rows. In R, you can use the <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/merge"><code>merge()</code> function</a>. In Python, you can use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas-dataframe-merge"><code>.merge()</code> method</a>.</p>
<p>Suppose you have to sets of supposedly anonymized data about individual accounts on some online platforms.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>baby1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/baby1.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>baby2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/baby2.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(baby1)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   idnum height.inches.          email_address</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1     1             74 fakeemail123@gmail.com</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2     3             66  anotherfake@gmail.com</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3     4             62      notreal@gmail.com</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4    23             62      notreal@gmail.com</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(baby2)</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     idnum      phone                   email</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 3901283 5051234567       notreal@gmail.com</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2   41823 5051234568 notrealeither@gmail.com</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 7198273 5051234568   anotherfake@gmail.com</span></span></code></pre></div>
<p>The first thing you need to ask yourself is <em>“which column is the unique identifier that is shared between these two data sets?”</em> In our case, they both have an “identification number” column. However, these two data sets are coming from different online platforms, and these two places use different schemes to number their users.</p>
<p>In this case, it is better to merge on the email addresses. Users might be using different email addresses on these two platforms, but there’s a stronger guarantee that matched email addresses means that you’re matching the right accounts. The columns are named differently in each data set, so we must specify them by name.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(baby1, baby2, <span class="at">by.x =</span> <span class="st">&quot;email_address&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;email&quot;</span>)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="do">##           email_address idnum.x height.inches. idnum.y      phone</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 anotherfake@gmail.com       3             66 7198273 5051234568</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2     notreal@gmail.com       4             62 3901283 5051234567</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3     notreal@gmail.com      23             62 3901283 5051234567</span></span></code></pre></div>
<p>In Python, <code>merge()</code> is a method attached to each <code>DataFrame</code> instance.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>baby1.merge(baby2, left_on <span class="op">=</span> <span class="st">&quot;email_address&quot;</span>, right_on <span class="op">=</span> <span class="st">&quot;email&quot;</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="co">##    idnum_x  height(inches)  ...       phone                  email</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0        3              66  ...  5051234568  anotherfake@gmail.com</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1        4              62  ...  5051234567      notreal@gmail.com</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2       23              62  ...  5051234567      notreal@gmail.com</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="co">## [3 rows x 6 columns]</span></span></code></pre></div>
<p>The email addresses <code>anotherfake@gmail.com</code> and <code>notreal@gmail.com</code> exist in both data sets, so each of these email addresses will end up in the result data frame. The rows in the result data set are wider and have more attributes for each individual.</p>
<p>Notice the duplicate email address, too. In this case, either the user signed up for two accounts using the same email, or one person signed up for an account with another person’s email address. In the case of duplicates, both rows will match with the same rows in the other data frame.</p>
<p>Also, in this case, all email addresses that weren’t found in both data sets were thrown away. This does not necessarily need to be the intended behavior. For instance, if we wanted to make sure no rows were thrown away, that would be possible. In this case, though, for email addresses that weren’t found in both data sets, some information will be missing. Recall that Python and R handle missing data differently (see @ref(how-r-and-python-handle-missing-values)).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(baby1, baby2, </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.x =</span> <span class="st">&quot;email_address&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;email&quot;</span>, </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="do">##             email_address idnum.x height.inches. idnum.y      phone</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   anotherfake@gmail.com       3             66 7198273 5051234568</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  fakeemail123@gmail.com       1             74      NA         NA</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       notreal@gmail.com       4             62 3901283 5051234567</span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       notreal@gmail.com      23             62 3901283 5051234567</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 notrealeither@gmail.com      NA             NA   41823 5051234568</span></span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>baby1.merge(baby2, </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>            left_on <span class="op">=</span> <span class="st">&quot;email_address&quot;</span>, right_on <span class="op">=</span> <span class="st">&quot;email&quot;</span>, </span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>            how <span class="op">=</span> <span class="st">&quot;outer&quot;</span>)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="co">##    idnum_x  height(inches)  ...         phone                    email</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0      1.0            74.0  ...           NaN                      NaN</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 1      3.0            66.0  ...  5.051235e+09    anotherfake@gmail.com</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 2      4.0            62.0  ...  5.051235e+09        notreal@gmail.com</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 3     23.0            62.0  ...  5.051235e+09        notreal@gmail.com</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 4      NaN             NaN  ...  5.051235e+09  notrealeither@gmail.com</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 6 columns]</span></span></code></pre></div>
<p>You can see it’s slightly more concise in Python. If you are familiar with SQL, you might have heard of inner and outer joins. This is where pandas <a href="https://pandas.pydata.org/pandas-docs/version/0.15/merging.html#database-style-dataframe-joining-merging">takes some of its argument names from</a>.</p>
<p>Finally, if both data sets have multiple values in the column you’re joining on, the result can have more rows than either table. This is because <em>every possible match</em> shows up.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>first <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">category =</span> <span class="fu">c</span>(<span class="st">&#39;a&#39;</span>,<span class="st">&#39;a&#39;</span>), <span class="at">measurement =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(first, first, <span class="at">by.x =</span> <span class="st">&quot;category&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;category&quot;</span>)</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   category measurement.x measurement.y</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1        a             1             1</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2        a             1             2</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3        a             2             1</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4        a             2             2</span></span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>first <span class="op">=</span> pd.DataFrame({<span class="st">&#39;category&#39;</span> : [<span class="st">&#39;a&#39;</span>,<span class="st">&#39;a&#39;</span>], <span class="st">&#39;measurement&#39;</span> : [<span class="dv">1</span>,<span class="dv">2</span>]})</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>first.merge(first, left_on <span class="op">=</span> <span class="st">&quot;category&quot;</span>, right_on <span class="op">=</span> <span class="st">&quot;category&quot;</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co">##   category  measurement_x  measurement_y</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 0        a              1              1</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1        a              1              2</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 2        a              2              1</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 3        a              2              2</span></span></code></pre></div>
</div>
<div id="long-versus-wide-data" class="section level2" number="12.4">
<h2 number="12.4"><span class="header-section-number">12.4</span> Long Versus Wide Data</h2>
<div id="long-versus-wide-in-r" class="section level3" number="12.4.1">
<h3 number="12.4.1"><span class="header-section-number">12.4.1</span> Long Versus Wide in R</h3>
<p>Many types of data can be stored in either a <strong>wide</strong> or <strong>long</strong> format.</p>
<p>The classical example is data from a <em>longitudinal study.</em> If an experimental unit (in the example below this is a person) is repeatedly measured over time, each row would correspond to an experimental unit <em>and</em> an observation time in a data set in a long form.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>fakeLongData1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">person =</span> <span class="fu">c</span>(<span class="st">&quot;Taylor&quot;</span>,<span class="st">&quot;Taylor&quot;</span>,<span class="st">&quot;Charlie&quot;</span>,<span class="st">&quot;Charlie&quot;</span>), </span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">timeObserved =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nums =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>))</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>fakeLongData1</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    person timeObserved nums</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor            1  100</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  Taylor            2  101</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie            1  300</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Charlie            2  301</span></span></code></pre></div>
<p>A long format can also be used if you have multiple observations (at a single time point) on an experimental unit. Here is another example.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>fakeLongData2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">person =</span> <span class="fu">c</span>(<span class="st">&quot;Taylor&quot;</span>, <span class="st">&quot;Taylor&quot;</span>, <span class="st">&quot;Charlie&quot;</span>,<span class="st">&quot;Charlie&quot;</span>), </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">attributeName =</span> <span class="fu">c</span>(<span class="st">&quot;attrA&quot;</span>,<span class="st">&quot;attrB&quot;</span>,<span class="st">&quot;attrA&quot;</span>,<span class="st">&quot;attrB&quot;</span>),</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nums =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>))</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>fakeLongData2</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    person attributeName nums</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor         attrA  100</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  Taylor         attrB  101</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie         attrA  300</span></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Charlie         attrB  301</span></span></code></pre></div>
<p>If you would like to reshape the long data sets into a wide format, you can use the <code>reshape()</code> function. You will need to specify which columns correspond with the experimental unit, and which column is the “factor” variable.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>fakeWideData1 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(fakeLongData1, </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>, </span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">timevar =</span> <span class="st">&quot;timeObserved&quot;</span>, </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">idvar =</span> <span class="st">&quot;person&quot;</span>, </span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;before&quot;</span>,<span class="st">&quot;after&quot;</span>)) <span class="co"># col names in new data set</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>fakeLongData1</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    person timeObserved nums</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor            1  100</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  Taylor            2  101</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie            1  300</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Charlie            2  301</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>fakeWideData1</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    person before after</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor    100   101</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie    300   301</span></span></code></pre></div>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>fakeWideData2 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(fakeLongData2, </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>, </span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">timevar =</span> <span class="st">&quot;attributeName&quot;</span>, <span class="co"># timevar is a misnomer here</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">idvar =</span> <span class="st">&quot;person&quot;</span>, </span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;attribute A&quot;</span>,<span class="st">&quot;attribute B&quot;</span>)) </span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>fakeLongData2</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    person attributeName nums</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor         attrA  100</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  Taylor         attrB  101</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie         attrA  300</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Charlie         attrB  301</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>fakeWideData2</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    person attribute A attribute B</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor         100         101</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie         300         301</span></span></code></pre></div>
<p><code>reshape()</code> will also go in the other direction: it can take wide data and convert it into long data</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(fakeWideData1, </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">idvar =</span> <span class="st">&quot;person&quot;</span>, </span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">varying =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;before&quot;</span>,<span class="st">&quot;after&quot;</span>)),</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">v.names =</span> <span class="st">&quot;nums&quot;</span>)</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="do">##            person time nums</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Taylor.1   Taylor    1  100</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Charlie.1 Charlie    1  300</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Taylor.2   Taylor    2  101</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Charlie.2 Charlie    2  301</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>fakeLongData1</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    person timeObserved nums</span></span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor            1  100</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  Taylor            2  101</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie            1  300</span></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Charlie            2  301</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(fakeWideData2, </span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">idvar =</span> <span class="st">&quot;person&quot;</span>, </span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">varying =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;attribute A&quot;</span>,<span class="st">&quot;attribute B&quot;</span>)),</span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">v.names =</span> <span class="st">&quot;nums&quot;</span>)</span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a><span class="do">##            person time nums</span></span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Taylor.1   Taylor    1  100</span></span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Charlie.1 Charlie    1  300</span></span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Taylor.2   Taylor    2  101</span></span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Charlie.2 Charlie    2  301</span></span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>fakeLongData2</span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a><span class="do">##    person attributeName nums</span></span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  Taylor         attrA  100</span></span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  Taylor         attrB  101</span></span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Charlie         attrA  300</span></span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Charlie         attrB  301</span></span></code></pre></div>
</div>
<div id="long-versus-wide-in-python" class="section level3" number="12.4.2">
<h3 number="12.4.2"><span class="header-section-number">12.4.2</span> Long Versus Wide in Python</h3>
<p>With Pandas, we can take make wide data long with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot.html#"><code>pd.DataFrame.pivot()</code></a>, and we can go in the other direction with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.melt.html?highlight=melt"><code>pd.DataFrame.melt()</code></a>.</p>
<p>When going from wide to long, make sure to use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html#"><code>pd.DataFrame.reset_index()</code></a> method afterwards to reshape the data and remove the index. Here is an example similar to the one above.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>fake_long_data1 <span class="op">=</span> pd.DataFrame(</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  {<span class="st">&#39;person&#39;</span> : [<span class="st">&quot;Taylor&quot;</span>,<span class="st">&quot;Taylor&quot;</span>,<span class="st">&quot;Charlie&quot;</span>,<span class="st">&quot;Charlie&quot;</span>], </span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;time_observed&#39;</span> : [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;nums&#39;</span> : [<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>]})</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>fake_long_data1</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="co">##     person  time_observed  nums</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 0   Taylor              1   100</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1   Taylor              2   101</span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  Charlie              1   300</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 3  Charlie              2   301</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>pivot_data1 <span class="op">=</span> fake_long_data1.pivot(index<span class="op">=</span><span class="st">&#39;person&#39;</span>, </span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a>                                    columns<span class="op">=</span><span class="st">&#39;time_observed&#39;</span>, </span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a>                                    values<span class="op">=</span><span class="st">&#39;nums&#39;</span>)</span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a>fake_wide_data1 <span class="op">=</span> pivot_data1.reset_index()</span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a>fake_wide_data1</span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="co">## time_observed   person    1    2</span></span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 0              Charlie  300  301</span></span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 1               Taylor  100  101</span></span></code></pre></div>
<p>Here’s one more example showing the same functionality–going from wide to long format.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>fake_long_data2 <span class="op">=</span> pd.DataFrame({<span class="st">&#39;person&#39;</span> : [<span class="st">&quot;Taylor&quot;</span>,<span class="st">&quot;Taylor&quot;</span>,<span class="st">&quot;Charlie&quot;</span>,<span class="st">&quot;Charlie&quot;</span>], </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&#39;attribute_name&#39;</span> : [<span class="st">&#39;attrA&#39;</span>, <span class="st">&#39;attrB&#39;</span>, <span class="st">&#39;attrA&#39;</span>, <span class="st">&#39;attrB&#39;</span>],</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&#39;nums&#39;</span> : [<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">300</span>,<span class="dv">301</span>]})</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>fake_wide_data2 <span class="op">=</span> fake_long_data2.pivot(index<span class="op">=</span><span class="st">&#39;person&#39;</span>, </span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>                                        columns<span class="op">=</span><span class="st">&#39;attribute_name&#39;</span>, </span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>                                        values<span class="op">=</span><span class="st">&#39;nums&#39;</span>).reset_index()</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>fake_wide_data2</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co">## attribute_name   person  attrA  attrB</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 0               Charlie    300    301</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1                Taylor    100    101</span></span></code></pre></div>
<p>Here are some examples of going in the other direction: from wide to long with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.melt.html?highlight=melt"><code>pd.DataFrame.melt()</code></a>. The first example specifies value columns by integers.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>fake_wide_data1</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co">## time_observed   person    1    2</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 0              Charlie  300  301</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 1               Taylor  100  101</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>fake_wide_data1.melt(id_vars <span class="op">=</span> <span class="st">&quot;person&quot;</span>, value_vars <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="co">##     person time_observed  value</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  Charlie             1    300</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1   Taylor             1    100</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  Charlie             2    301</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 3   Taylor             2    101</span></span></code></pre></div>
<p>The second example uses strings to specify value columns.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>fake_wide_data2</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="co">## attribute_name   person  attrA  attrB</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 0               Charlie    300    301</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 1                Taylor    100    101</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>fake_wide_data2.melt(id_vars <span class="op">=</span> <span class="st">&quot;person&quot;</span>, value_vars <span class="op">=</span> [<span class="st">&#39;attrA&#39;</span>,<span class="st">&#39;attrB&#39;</span>])</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="co">##     person attribute_name  value</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  Charlie          attrA    300</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1   Taylor          attrA    100</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  Charlie          attrB    301</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 3   Taylor          attrB    101</span></span></code></pre></div>
<p>TODO exercises just have them read in correctly Recall the file “<code>long-beach-va.data</code>” from <a href="https://archive.ics.uci.edu/ml/datasets/heart+disease">UCI Machine Learning Repository</a>.</p>
<!--chapter:end:12-reshaping.Rmd-->
</div>
</div>
</div>
<div id="visualization" class="section level1" number="13">
<h1 number="13"><span class="header-section-number">13</span> Visualization</h1>
<p>I describe a few plotting paradigms in R and Python below. Note that these descriptions are extremely thin. More depth could easily turn any of these subsections into an entire textbook!</p>
<div id="base-r-plotting" class="section level2" number="13.1">
<h2 number="13.1"><span class="header-section-number">13.1</span> Base R Plotting</h2>
<p>R comes with some built-in functions <code>plot</code>, <code>hist</code>, <code>boxplot</code>, etc. Many of these reside in <code>package:graphics</code>, which comes pre-loaded into the search path. <code>plot</code> on the other hand, is higher up the search path in <code>package:base</code>–it is a generic method whose methods might be in <code>package:graphics</code> or some place else.</p>
<p>Base plotting covers most needs, so that’s what we spend most time with. However, there are a large number of third-party libraries for plotting that you might consider looking into if you want to follow a certain aesthetic, or if you want plotting specialized for certain cases (e.g. geospatial plots).</p>
<p>Recall our Albemarle Real Estate data set.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/albemarle_real_estate.csv&quot;</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   YearBuilt YearRemodeled Condition NumStories FinSqFt Bedroom FullBath HalfBath TotalRooms LotSize TotalValue</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      2006             0   Average       1.00    1922       3        3        0         10   5.000     409900</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      2003             0   Average       1.00    1848       3        2        0          7  61.189     523100</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      1972             0   Average       1.00    1248       2        1        0          4   1.760     180900</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      1998             0      Good       1.00    1244       1        1        0          3  50.648     620700</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      1886             0   Average       1.86    1861       4        1        0          6   3.880     162500</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      1910             0      Fair       1.53    1108       3        1        0          6   8.838     167200</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="do">##          City</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      CROZET</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      CROZET</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 EARLYSVILLE</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      CROZET</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      CROZET</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      CROZET</span></span></code></pre></div>
<p>If we wanted to get a general idea of how expensive homes were in Albemarle County, we could use a histogram. This helps us visualize a univariate numerical variable/column. Below I plot the (natural) logarithm of home prices.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(df<span class="sc">$</span>TotalValue), </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;natural logarithm of home price&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Super-Duper Plot!&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-196-1.png" alt="A Simple Histogram" width="672" />
<p class="caption">
(#fig:unnamed-chunk-196)A Simple Histogram
</p>
</div>
<p>I specified the <code>xlab=</code> and <code>main=</code> arguments, but there are many more that could be tweaked. Make sure to skim the options in the documentation (<code>?hist</code>).</p>
<p><code>plot</code> is useful for plotting two univariate numerical variables. This can be done in time series plots (variable versus time) and scatter plots (one variable versus another).</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>TotalValue, df<span class="sc">$</span>LotSize, </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;total value ($)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;lot size (sq. ft.)&quot;</span>,</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(df<span class="sc">$</span>TotalValue), <span class="fu">log</span>(df<span class="sc">$</span>LotSize), </span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;log. total value&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;log. lot size&quot;</span>, </span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">type =</span> <span class="st">&quot;p&quot;</span>)</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">log</span>(<span class="fu">mean</span>(df<span class="sc">$</span>LotSize)), <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-197-1.png" alt="Some Scatterplots" width="672" />
<p class="caption">
(#fig:unnamed-chunk-197)Some Scatterplots
</p>
</div>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>I use some of the many arguments available (type <code>?plot</code>). <code>xlab=</code> and <code>ylab=</code> specify the x- and y-axis labels, respectively. <code>col=</code> is short for “color.” <code>pch=</code> is short for “point character.” Changing this will change the symbol shapes used for each point. <code>type=</code> is more general than that, but it is related. I typically use it to specify whether or not I want the points connected with lines.</p>
<p>I also use a couple other functions. <code>abline</code> is used to superimpose lines over the top of a plot. They can be <code>h</code>orizontal, <code>v</code>ertical, or you can specify them in slope-intercept form, or by providing a linear model object. I also used <code>par</code> to set a graphical parameter. The graphical parameter <code>par()$mfrow</code> sets the layout of a multiple plot visualization. I then set it back to the standard <span class="math inline">\(1 \times 1\)</span> layout afterwards.</p>
</div>
<div id="plotting-with-ggplot2" class="section level2" number="13.2">
<h2 number="13.2"><span class="header-section-number">13.2</span> Plotting with <code>ggplot2</code></h2>
<p><a href="https://ggplot2.tidyverse.org/index.html"><code>ggplot2</code></a> is a popular third-party visualization package for R. There are also libraries in Python (e.g. <a href="https://plotnine.readthedocs.io/en/stable/#"><code>plotnine</code></a>) that look and feel quite similar. This subsection provides a short tutorial on how to use <code>ggplot2</code> in R, and it is primarily based off of the material provided in <span class="citation">(<a href="#ref-ggplot2" role="doc-biblioref">Wickham 2016</a>)</span>. An online version of this text is provided <a href="https://ggplot2-book.org">here</a>.</p>
<p><code>ggplot2</code> code looks a lot different than the code in the above section<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>. There, we would write a series of function calls, and each would change some state in the current figure. Here, we call different <code>ggplot2</code> functions that create S3 objects with special behavior (more information about S3 objects in subsection @ref(using-s3-objects)), and then we “add” (i.e. we use the <code>+</code> operator) them together.</p>
<p>This new design is not to encourage you to think about S3 object-oriented systems. Rather, it is to get you thinking about making visualizations using the “grammar of graphics” <span class="citation">(<a href="#ref-gog" role="doc-biblioref">Wilkinson 2005</a>)</span>. <code>ggplot2</code> makes use of its own specialized vocabulary that is taken from this book. As we get started, I will try to introduce some of this vocabulary slowly.</p>
<p>The core function is the <a href="https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/ggplot"><code>ggplot</code> function</a>. This is the function that figures are initialized with; it is the function that will take in information about <em>which</em> data set you want to plot, and <em>how</em> you want to plot it. The raw data is provided in the first argument. The second argument, <code>mapping=</code>, is more confusing. The argument should be constructed with the <code>aes</code> function. In the parlance of <code>ggplot2</code>, <code>aes</code> constructs an <strong>aesthetic mapping</strong>. Think of the “aesthetic mapping” as stored information that can be used later on–it “maps” data to visual properties of a figure.</p>
<p>Consider this first example.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-198-1.png" alt="A Blank Canvas" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-198)A Blank Canvas
</p>
</div>
<p>You’ll notice a few things about the code and the result produced:</p>
<ol style="list-style-type: decimal">
<li><p>No geometric shapes show up!</p></li>
<li><p>A Cartesian coordinate system is displayed, and the x-axis and y-axis were created based on aesthetic mapping provided (confirm this by typing <code>summary(mpg$displ)</code> and <code>summary(mpg$hwy)</code>).</p></li>
<li><p>The axis labels are taken from the column names provided to <code>aes</code>.</p></li>
</ol>
<p>To plot geometric shapes (<em>geoms</em> in the parlance of <code>ggplot2</code>), we need to add <a href="https://ggplot2-book.org/toolbox.html#toolbox"><strong>layers</strong></a> to it. “Layers” is quite a broad term–it does not only apply to geometric objects. In fact, in <code>ggplot2</code>, a layer can be pretty much anything: raw data, summarized data, transformed data, annotations, etc. However, the functions that add geometric object layers usually start with the prefix <code>geom_</code>. In RStudio, after loading <code>ggplot2</code>, type <code>geom_</code>, and then press <code>&lt;Tab&gt;</code> (autocomplete) to see some of the options.</p>
<p>Consider the function <a href="https://www.rdocumentation.org/packages/ggplot2/versions/3.3.5/topics/geom_point"><code>geom_point</code></a>. It too returns an S3 instance that has specialized behavior. In the parlance of <code>ggplot2</code>, it adds a <a href="https://ggplot2-book.org/getting-started.html#basic-use">scatterplot</a> layer to the figure.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))  <span class="sc">+</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-199-1.png" alt="A Second Scatterplot" width="672" />
<p class="caption">
(#fig:unnamed-chunk-199)A Second Scatterplot
</p>
</div>
<p>Notice that we did not need to provide any arguments to <code>geom_point</code>. The aesthetic mappings were used by the new layer.</p>
<p>There are <em>many</em> types of layers that you can add to a plot, and you’re not limited to any number of them in a given plot. For example, if we wanted to add a title, we could use the <code>ggtitle</code> function to add a title layer. Unlike <code>geom_point</code>, this function will need to take an argument because the desired title is not stored as an aesthetic mapping. Try running the following code on your own machine.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))  <span class="sc">+</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;my favorite scatterplot&quot;</span>)</span></code></pre></div>
<p>Additionally, notice that the same layer will behave much differently if we change the aesthetic mapping.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> manufacturer))  <span class="sc">+</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;my favorite scatterplot&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-201-1.png" alt="Adding Some Color" width="672" />
<p class="caption">
(#fig:unnamed-chunk-201)Adding Some Color
</p>
</div>
<p>If we want tighter control on the aesthetic mapping, we can use <a href="https://ggplot2-book.org/scales.html#scales"><strong>scales</strong></a>. Syntactically, these are things we “add” (<code>+</code>) to the figure, just like layers. However, these scales are constructed with a different set of functions, many of which start with the prefix <code>scale_</code>.</p>
<p>We can change attributes of the axes like this.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> manufacturer))  <span class="sc">+</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">ggtitle</span>(<span class="st">&quot;my favorite scatterplot&quot;</span>)</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>base_plot <span class="sc">+</span> <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">scale_y_reverse</span>()</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-202-1.png" alt="Changing Scales" width="672" />
<p class="caption">
(#fig:unnamed-chunk-202)Changing Scales
</p>
</div>
<p>We can also change plot colors with scale layers. Let’s add an aesthetic called <code>fill=</code> so we can use colors to denote the value of a numerical (not categorical) column. This data set doesn’t have any more unused numerical columns, so let’s create a new one called <code>score</code>. We also use a new geom layer from a function called <code>geom_tile()</code>.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>score <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(mpg<span class="sc">$</span>displ<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> mpg<span class="sc">$</span>hwy<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">fill =</span> score ))  <span class="sc">+</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() </span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-203-1.png" alt="Changing the Fill" width="672" />
<p class="caption">
(#fig:unnamed-chunk-203)Changing the Fill
</p>
</div>
<p>If we didn’t like these colors, we could change them with a scale layer. Personally, I like this one.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>score <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(mpg<span class="sc">$</span>displ<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> mpg<span class="sc">$</span>hwy<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">fill =</span> score ))  <span class="sc">+</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> </span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_b</span>()</span></code></pre></div>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-204-1.png" alt="Changing the Fill Again" width="672" />
<p class="caption">
(#fig:unnamed-chunk-204)Changing the Fill Again
</p>
</div>
<p>There are many to choose from, though. Try to run the following code on your own to see what it produces.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>score <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(mpg<span class="sc">$</span>displ<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> mpg<span class="sc">$</span>hwy<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">fill =</span> score ))  <span class="sc">+</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> </span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>()</span></code></pre></div>
</div>
<div id="plotting-with-matplotlib" class="section level2" number="13.3">
<h2 number="13.3"><span class="header-section-number">13.3</span> Plotting with Matplotlib</h2>
<p>Matplotlib <span class="citation">(<a href="#ref-Hunter:2007" role="doc-biblioref">Hunter 2007</a>)</span> is a third-party visualization library in Python. It’s the oldest and most heavily-used, so it’s the best way to start making graphics in Python, in my humble opinion. It also comes installed with Anaconda. This short introduction borrows heavily from the myriad of <a href="https://matplotlib.org/stable/tutorials/index.html">tutorials</a> on Matplotlib’s website. I will start off making a simple plot, and commenting on each line of code.</p>
<div class="rmd-details">
<p>You can use either “pyplot-style” (e.g. <code>plt.plot()</code>) or “object-oriented-style” to make figures in Matplotlib. Even though using the first type is faster to make simple plots, I will only describe the second one. It is the recommended approach because it is more extensible. However, the first one resembles the syntax of MATLAB. If you’re familiar with MATLAB, you might consider learning a little about the first style, as well.</p>
</div>
<div class="sourceCode" id="cb206"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt       <span class="co"># 1</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                    <span class="co"># 2</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()              <span class="co"># 3</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>ax.hist(np.random.normal(size<span class="op">=</span><span class="dv">1000</span>))  <span class="co"># 4</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="co">## (array([ 11.,  36., 103., 224., 287., 224.,  88.,  24.,   1.,   2.]), array([-3.05376438, -2.35252767, -1.65129096, -0.95005426, -0.24881755,</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="co">##         0.45241916,  1.15365587,  1.85489258,  2.55612929,  3.257366  ,</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="co">##         3.9586027 ]), &lt;a list of 10 Patch objects&gt;)</span></span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-207-1.png" width="80%" /></p>
<p>In the first line, we import the <code>pyplot</code> submodule of <code>matplotlib</code>. We rename it to <code>plt</code>, which is short, and will save us some typing. It also follows the most commonly-used convention.</p>
<p>Second, we import Numpy in the same way we always have. Matplotlib is written to work with Numpy arrays. If you want to plot some data, and it isn’t in a Numpy array, you should convert it first.</p>
<p>Third, we call the <code>subplots()</code> function, and use <em>sequence unpacking</em> to unpack the returned container into individual objects without storing the overall container. “Subplots” sounds like it will make many different plots all on one figure, but if you look at the <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib-pyplot-subplots">documentation</a> the number of rows and columns defaults to one and one, respectively.</p>
<p><code>plt.subplots()</code> returns a <a href="https://docs.python.org/3.3/library/stdtypes.html?highlight=tuple#tuple"><code>tuple</code></a><a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> of two things: a <code>Figure</code> object, and one or more <code>Axes</code> object(s). These two classes will require some explanation.</p>
<ol style="list-style-type: decimal">
<li><p>A <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure"><code>Figure</code> object</a> is the overall visualization object you’re making. It holds onto all of the plot elements. If you want to save all of your progress (e.g. with <code>fig.savefig('my_picture.png')</code>), you’re saving the overall <code>Figure</code> object.</p></li>
<li><p>One or more <a href="https://matplotlib.org/stable/api/axes_api.html#the-axes-class"><code>Axes</code> objects</a> are contained in a <code>Figure</code> object. Each is <a href="https://matplotlib.org/stable/tutorials/introductory/usage.html#axes">"what you think of as ‘a plot’</a>." They hold onto two <code>Axis</code> objects (in the case of 2-dimensional plots) or three (in the case of 3-dimensional arguments). We are usually calling the methods of these objects to effect changes on a plot.</p></li>
</ol>
<p>In line four, we call the <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.hist.html#matplotlib.axes.Axes.hist"><code>hist()</code> method</a> of the <code>Axes</code> object called <code>ax</code>. There are many more plots available than plain histograms. Each one has its own method, and you can peruse the options in <a href="https://matplotlib.org/stable/api/axes_api.html#plotting">the documentation</a>.</p>
<p>If you want to make figures more elaborate, just keep calling different methods of <code>ax</code>. If you want to fit more subplots to the same figure, add more <code>Axes</code> objects. Here is an example using some code from <a href="https://matplotlib.org/stable/tutorials/introductory/usage.html#the-object-oriented-interface-and-the-pyplot-interface">one of the official Matplotlib tutorials</a>.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>np.pi, <span class="dv">100</span>) <span class="co"># x values grid shared by both subplots</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create two subplots...one row two columns</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>fig, myAxes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>) <span class="co"># kind of like par(mfrow=c(1,2)) in R</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="co"># first subplot</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].plot(x, x, label<span class="op">=</span><span class="st">&#39;linear&#39;</span>)  <span class="co"># Plot some data on the axes.</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].plot(x, x<span class="op">**</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;quadratic&#39;</span>)  <span class="co"># Plot more data on the axes...</span></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].plot(x, x<span class="op">**</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">&#39;cubic&#39;</span>)  <span class="co"># ... and some more.</span></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;x label&#39;</span>)  <span class="co"># Add an x-label to the axes.</span></span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;y label&#39;</span>)  <span class="co"># Add a y-label to the axes.</span></span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].set_title(<span class="st">&quot;Simple Plot&quot;</span>)  <span class="co"># Add a title to the axes.</span></span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">0</span>].legend()  <span class="co"># Add a legend.</span></span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a><span class="co"># second subplot</span></span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">1</span>].plot(x,np.sin(x), label<span class="op">=</span><span class="st">&#39;sine wave&#39;</span>)</span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a>myAxes[<span class="dv">1</span>].legend()</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-208-3.png" width="672" /></p>
<div class="figure">
<img src="r_and_python_book_files/figure-html/unnamed-chunk-209-5.png" alt="Side-By-Side Line Plots in Matplotlib" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-209)Side-By-Side Line Plots in Matplotlib
</p>
</div>
<p>import numpy as np
my_inputs = np.linspace(start = 0, stop = 2*np.pi)
outputs = np.sin(my_inputs)</p>
<p>import matplotlib.pyplot as plt
plt.plot(my_inputs, outputs)</p>
<p>very good! <a href="https://jakevdp.github.io/PythonDataScienceHandbook/04.12-three-dimensional-plotting.html" class="uri">https://jakevdp.github.io/PythonDataScienceHandbook/04.12-three-dimensional-plotting.html</a></p>
<!--chapter:end:13-visualization.Rmd-->
</div>
</div>
<div id="working-with-text-data" class="section level1" number="14">
<h1 number="14"><span class="header-section-number">14</span> Working With Text Data</h1>
<p>We have already talked a little about how to work with text data in this book. Regarding Python, section @ref(vectorization-in-python) mentioned that Pandas <code>Series</code> objects have a <a href="https://pandas.pydata.org/pandas-docs/version/1.3/user_guide/text.html#string-methods"><code>.str</code> accessor attribute</a> that has plenty of special methods that will work on string data. The same tools can be used whether or not these <code>Series</code> objects are contained in a Pandas <code>DataFrame</code>.</p>
<p>Regarding R, <code>character</code> <code>vector</code>s were mentioned in chapter @ref(r-vectors-versus-numpy-arrays-and-pandas-series). There are many functions that operate on these, too, whether or not they are held inside an R <code>data.frame</code>. They might be a little harder to find because they aren’t methods, so pressing <code>&lt;Tab&gt;</code> and using your GUI’s autocomplete feature doesn’t reveal them as easily.</p>
<p>Suppose you’re interested in replacing lowercase letters with uppercase ones, removing certain characters from text, or counting the number of times a certain expression appears. Up until now, as long as you can find a function or method that performs the task, you were doing just fine. If you need to do something with text data, there’s probably a function for it.</p>
<p>Notice what all of these tasks have in common–they all require the ability to find patterns. When your patterns are easy to describe (e.g. find all lowercase “a”s), then all is well. What can make matters more complicated, however, is when the patterns are more difficult to describe (e.g. find all valid email addresses). That is why this chapter is primarily concerned with discussing <strong>regular expressions,</strong> which are a tool that help you describe the patterns in text.</p>
<div id="an-introducton-to-regular-expressions" class="section level2" number="14.1">
<h2 number="14.1"><span class="header-section-number">14.1</span> An Introducton to Regular Expressions</h2>
<div id="literal-characters-versus-metacharacters" class="section level3" number="14.1.1">
<h3 number="14.1.1"><span class="header-section-number">14.1.1</span> Literal Characters versus Metacharacters</h3>
<p>Every character in a regular expression is interpreted in one of two ways. Either it is interpreted as a</p>
<ol style="list-style-type: decimal">
<li>literal character, or as a</li>
<li>metacharacter.</li>
</ol>
<p>If it is a literal character, then the character is the <em>literal</em> pattern. For example, in the regular expression “e,” the character “e” has a literal interpretation. If you seek to capitalize all instances of “e” in the following phrase, you can do it pretty easily. As long as you know which function performs find-and-replace, you’re good. The pattern is trivial to specify.</p>
<p>On the other hand, if I asked you to remove <code>$</code>s from price or salary data, you might have a little more difficulty. This is because <code>$</code> is a <em>metacharacter</em> in regular expressions, and so it has a special meaning.<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a> In the examples below, if <code>$</code> is interpreted as a regular expression, the pattern will not be found at all, despite the prevalence of <em>literal</em> dollar signs.</p>
<p>There are a few functions in R that perform find-and-replace, but in this case, I use <code>gsub()</code>. In Pandas, I can use <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.str.replace.html"><code>.str.replace()</code></a>, to do this. Here are the examples that find patterns that are described by literal characters.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;e&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;E&quot;</span>, <span class="at">x =</span> <span class="st">&quot;I don&#39;t need a regex for this!&quot;</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;I don&#39;t nEEd a rEgEx for this!&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>pd.Series([<span class="st">&quot;I don&#39;t need a regex for this!&quot;</span>]).<span class="bu">str</span>.replace(pat<span class="op">=</span><span class="st">&quot;e&quot;</span>,repl<span class="op">=</span><span class="st">&quot;E&quot;</span>)</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    I don&#39;t nEEd a rEgEx for this!</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: object</span></span></code></pre></div>
<p>On the other hand, here are a few examples that remove dollar signs. We generally have two options to recognize symbols that happen to be metacharacters.</p>
<ol style="list-style-type: decimal">
<li>We can <em>escape</em> the dollar sign. That means you need to put a backslash (i.e. <code>\</code>) before the dollar sign. The backslash is a metacharacter looks at the character coming after it, and it either removes the special meaning from a metacharacter, or adds special meaning to a literal character.</li>
<li>Alternatively, we can tell the function to ignore regular expressions. <code>gsub()</code> can take <code>fixed=TRUE</code>, and <code>.str.replace()</code> can take <code>regex=False</code>.</li>
</ol>
<div class="sourceCode" id="cb210"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in Python</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>pd.Series([<span class="st">&quot;$100, $200&quot;</span>]).<span class="bu">str</span>.replace(pat<span class="op">=</span><span class="st">&quot;$&quot;</span>,repl<span class="op">=</span><span class="st">&quot;&quot;</span>,regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    100, 200</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: object</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>pd.Series([<span class="st">&quot;$100, $200&quot;</span>]).<span class="bu">str</span>.replace(pat<span class="op">=</span><span class="st">&quot;\$&quot;</span>,repl<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    100, 200</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: object</span></span></code></pre></div>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in R</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;$&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;$100, $200&quot;</span>), <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;100, 200&quot;</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="fu">c</span>(<span class="st">&quot;$100, $200&quot;</span>), <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">$&quot;</span>)</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;100, 200&quot;</span></span></code></pre></div>
</div>
<div id="the-trouble-with-backslashes-escape-sequences" class="section level3" number="14.1.2">
<h3 number="14.1.2"><span class="header-section-number">14.1.2</span> The Trouble With Backslashes: Escape Sequences</h3>
<p>You might have noticed above and gotten confused–sometimes in Python and in R, we need <em>two</em> backslashes instead of <em>one</em>. This is because backslashes have another purpose that can complicate our using them to escape metacharacters. They also help us write untypeable characters, also known as <strong>escape sequences</strong>. We need to be able to do this even if we aren’t using regular expressions.</p>
<p>For instance, consider the way we type the “newline” character. Even though it is understood by the computer as one character, it takes us two keystrokes to write it with our keyboard. <code>\</code> is one character, and <code>n</code> is another, but together they are one!</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>) <span class="co">#in R</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>) <span class="co">#in Python</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 1</span></span></code></pre></div>
<p><code>str</code>s in Python and <code>character</code> <code>vectors</code> in R will look for these combinations by default. When we specify regular expressions with strings, the backslashes will be used first for this purpose. Their regular expression purpose is a second priority.</p>
<p>The reason we used <code>\\$</code> in the above example is to escape the second backslash. <code>\$</code> is not a special character, but Python and R will handle it differently. Python will not recognize it, and it won’t complain that it didn’t. On the other hand, R will throw an error that it can’t recognize it.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">&#39;\$&#39;</span>) <span class="co"># in Python, not special</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 2</span></span></code></pre></div>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(<span class="st">&#39;\$&#39;</span>) <span class="co"># R gets confused</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error: &#39;\$&#39; is an unrecognized escape in character string starting &quot;&#39;\$&quot;</span></span></code></pre></div>
<p>There is another way to deal with this issue–<strong>raw strings!</strong> Raw strings make life easier because they do not interpret backslashes as the beginning of escape sequences. You can make them in R and Python by putting an “r” in front of the quotation marks. However, it is slightly more complicated in R because you need a delimiter pair inside the quotation marks–for more information type <code>?Quotes</code> in your R console.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="vs">r&#39;\n&#39;</span>) <span class="co"># in Python </span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 2</span></span></code></pre></div>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(r<span class="st">&#39;{\$}&#39;</span>) <span class="co"># in R</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
</div>
<div id="more-examples-of-using-regular-expressions" class="section level3" number="14.1.3">
<h3 number="14.1.3"><span class="header-section-number">14.1.3</span> More Examples of Using Regular Expressions</h3>
<p>TODO
- raw strings
- text in files or finding files by name
- backslashes are a nightmare
- citations</p>
<!--chapter:end:14-text_data.Rmd-->
</div>
</div>
</div>
<div id="dates-and-times" class="section level1" number="15">
<h1 number="15"><span class="header-section-number">15</span> Dates and Times</h1>
<p>TODO</p>
<!--chapter:end:15-dates_and_times.Rmd-->
</div>
<div id="running-scripts-from-the-command-line" class="section level1" number="16">
<h1 number="16"><span class="header-section-number">16</span> Running Scripts from the Command Line</h1>
<p>TODO</p>
<!--chapter:end:16-CLI.Rmd-->
</div>
<div id="part-programming-styles" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Programming Styles</h1>
</div>
<div id="an-introduction-to-object-oriented-programming" class="section level1" number="17">
<h1 number="17"><span class="header-section-number">17</span> An Introduction to Object-Oriented Programming</h1>
<p><strong>Object-Oriented Programming (OOP)</strong> is a way of thinking about how to organize programs. This way of thinking focuses on objects. In the next chapter, we focus on organizing programs by functions, but for now we stick to objects. We already know about objects from the last chapter, so what’s new here?</p>
<p>The difference is that we’re creating our own <em>types</em> now. In the last chapter we learned about built-in types: floating point numbers, lists, arrays, functions, etc. Now we will discuss broadly how one can create his own types in both R and Python. These user-defined types can be used as cookie cutters. Once we have the cookie cutter, we can make as many cookies as we want!</p>
<p>TODO: image of cookie cutter</p>
<p>We will not go into this too deeply, but it is important to know how how code works so that we can use it more effectively. For instance, in Python, we frequently write code like <code>my_data_frame.doSomething()</code>. The material in this chapter will go a long way to describe how we can make our own types with custom behavior.</p>
<hr />
<p>Here are a few abstract concepts that will help thinking about OOP. They are not mutually exclusive, and they aren’t unique to OOP, but understanding these words will help you understand the purpose of OOP. Later on, when we start looking at code examples, I will alert you to when these concepts are coming into play.</p>
<ul>
<li><p><strong>Composition</strong> refers to the idea when one type of object <em>contains</em> an object of another type. For example, a linear model object could hold onto estimated regression coefficients, residuals, etc.</p></li>
<li><p><strong>Inheritance</strong> takes place when an object can be considered to be of another type(s). For example, an analysis of variance linear regression model might be a special case of a general linear model.</p></li>
<li><p><strong>Polymorphism</strong> is the idea that the programmer can use the same code on objects of different types. For example, built-in functions in both R and Python can work on arguments of a wide variety of different types.</p></li>
<li><p><strong>Encapsulation</strong> is another word for complexity hiding. Do you have to understand every line of code in a package you’re using? No, because a lot of details are purposefully hidden from you.</p></li>
<li><p><strong>Modularity</strong> is an idea related to encapsulation–it means splitting something into independent pieces. How you split code into different files, different functions, different classes–all of that has to do with modularity. It promotes encapsulation, and it allows you to think about only a few lines of code at a time.</p></li>
<li><p>The <strong>interface</strong>, between you and the code you’re using, describes <em>what</em> can happen, but not <em>how</em> it happens. In other words, it describes some functionality so that you can decide whether you want to use it, but there are not enough details for you to make it work yourself. For example, all you have to do to be able to estimate a complicated statistical model is to look up some documentation.<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a> In other words, you only need to be familiar with the interface, not the implementation.</p></li>
<li><p>The <strong>implementation</strong> of some code you’re using describes <em>how</em> it works in detail. If you are a package author, you can change your code’s implementation “behind the scenes” and ideally, your end-users would never notice.</p></li>
</ul>
<div id="oop-in-python" class="section level2" number="17.1">
<h2 number="17.1"><span class="header-section-number">17.1</span> OOP In Python</h2>
<div id="overview" class="section level3" number="17.1.1">
<h3 number="17.1.1"><span class="header-section-number">17.1.1</span> Overview</h3>
<p>In Python, <a href="https://docs.python.org/3/tutorial/classes.html">classes</a> are user-defined types. When you define your own class, you describe what kind of information it holds onto, and how it behaves.</p>
<p>To define your own type, use the <a href="https://docs.python.org/3/tutorial/classes.html#class-definition-syntax"><code>class</code> keyword</a>. Objects created with a user-defined class are sometimes called <strong>instances</strong>. The behave according to the rules written in the class definition–they always have data and/or functions bundled together in the same way, but these instances do not all have the same data.</p>
<p>To be more clear, classes may have the following two things in their definition.</p>
<ul>
<li><p><strong>Attributes</strong> are pieces of data “owned” by an instance created by the class.</p></li>
<li><p><strong>(Instance) methods</strong> are functions “owned” by an instance created by the class. They can use and/or modify data belonging to the class.</p></li>
</ul>
</div>
<div id="a-first-example" class="section level3" number="17.1.2">
<h3 number="17.1.2"><span class="header-section-number">17.1.2</span> A First Example</h3>
<p>Here’s a simple example. Say we are interested in calculating, from numerical data <span class="math inline">\(x_1, \ldots, x_n\)</span>, a sample mean:
<span class="math display">\[
\bar{x}_n = \frac{\sum_{i=1}^n x_i}{n}.
\]</span></p>
<p>In Python, we can usually calculate this one number very easily using <code>np.average</code>. However, this function requires that we pass into it all of the data at once. What if we don’t have all the data at any given time? In other words, suppose that the data arrive intermittently
.
We might consider taking advantage of a recursive formula for the sample means.</p>
<p><span class="math display">\[
\bar{x}_n =  \frac{(n-1) \bar{x}_{n-1} + x_n}{n}
\]</span></p>
<p>How would we program this in Python? A first option: we might create a variable <code>my_running_ave</code>, and after every data point arrives, we could</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>my_running_ave <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>my_running_ave</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.0</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>my_running_ave <span class="op">=</span> ((<span class="dv">2</span><span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>my_running_ave <span class="op">+</span> <span class="fl">3.0</span>)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>my_running_ave</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2.0</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>my_running_ave <span class="op">=</span> ((<span class="dv">3</span><span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>my_running_ave <span class="op">+</span> <span class="fl">2.0</span>)<span class="op">/</span><span class="dv">3</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>my_running_ave</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2.0</span></span></code></pre></div>
<p>There are a few problems with this. Every time we add a data point, the formula slightly changes. Every time we update the average, we have to write a different line of code. This opens up the possibility for more bugs, and it makes your code less likely to be used by other people and more difficult to understand. And if we were trying to code up something more complicated than a running average? That would make matters even worse.</p>
<p>A second option: write a class that holds onto the running average, and that has</p>
<ol style="list-style-type: decimal">
<li>an <code>update</code> method that updates the running average every time a new data point is received, and</li>
<li>a <code>get_current_xbar</code> method that gets the most up-to-date information for us.</li>
</ol>
<p>Using our code would look like this:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>my_ave <span class="op">=</span> RunningMean() <span class="co"># create running average object</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>my_ave.get_current_xbar() <span class="co"># no data yet!</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>my_ave.update(<span class="fl">1.</span>) <span class="co"># first data point</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>my_ave.get_current_xbar() <span class="co"># xbar_1</span></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.0</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>my_ave.update(<span class="fl">3.</span>)  <span class="co"># second data point</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>my_ave.get_current_xbar()  <span class="co">#xbar_2</span></span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 2.0</span></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a>my_ave.n   <span class="co"># my_ave.n instead of self.n</span></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 2</span></span></code></pre></div>
<div class="rmd-details">
<p>There is a Python convention that stipules class names should be written in <code>UpperCamelCase</code> (e.g. <code>RunningMean</code>).</p>
</div>
<p>That’s much better! Notice the <em>encapsulation</em>. Looking at this code we don’t need to think about the mathematical formula and the data being received. We only need to think about the latter. In other words, the <em>implementation</em> is separated from the <em>interface</em>. The interface in this case, is just the name of the class methods, and the arguments they expect. That’s all we need to know about to use this code.</p>
<p>Classes (obviously) need to be defined before they are used, so here is the definition of our class.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RunningMean:</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Updates a running average&quot;&quot;&quot;</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.current_xbar <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> update(<span class="va">self</span>, new_x):</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.current_xbar <span class="op">=</span> (<span class="va">self</span>.current_xbar<span class="op">*</span>(<span class="va">self</span>.n <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span> new_x) <span class="op">/</span> <span class="va">self</span>.n</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_current_xbar(<span class="va">self</span>):</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">self</span>.current_xbar</span></code></pre></div>
<div class="rmd-details">
<p>Methods that look like <code>\_\_init\_\_</code>, or that possess names that begin and end with two underscores, are called <strong>dunder (double underscore) methods</strong>, <strong>special methods</strong> or <strong>magic methods</strong>. There are many that you can take advantage of! For more information see <a href="https://docs.python.org/3/reference/datamodel.html#special-method-names">this</a>.</p>
</div>
<p>Here are the details of the class definition:</p>
<ol style="list-style-type: decimal">
<li><p>Defining class methods looks exactly like defining functions! The primary difference is that the first argument must be <code>self</code>. If the definition of a method refers to <code>self</code>, then this allows the class instance to refer to its own (heretofore undefined) data attributes. Also, these method definitions are indented inside the definition of the class.</p></li>
<li><p>This class owns two data attributes. One to represent the number of data points seen up to now (<code>n</code>), and another to represent the current running average (<code>current_xbar</code>).</p></li>
<li><p>Referring to data members requires dot notation. <code>self.n</code> refers to the <code>n</code> belonging to any instance. This data attribute is free to vary between all the objects instantiated by this class.</p></li>
<li><p>The <code>__init__</code> method performs the setup operations that are performed every time any object is instantiated.</p></li>
<li><p>The <code>update</code> method provides the core functionality using the recursive formula displayed above.</p></li>
<li><p><code>get_current_xbar</code> simply returns the current average. In the case that this function is called before any data has been seen, it returns <code>None</code>.</p></li>
</ol>
<p>A few things you might find interesting:</p>
<ol style="list-style-type: lower-roman">
<li><p>Computationally, there is never any requirement that we must hold <em>all</em> of the data points in memory. Our data set could be infinitely large, and our class will hold onto only one floating point number, and one integer.</p></li>
<li><p>This example is generalizable to other statistical methods. In a mathematical statistics course, you will learn about a large class of models having <em>sufficient statistics</em>. Most sufficient statistics have recursive formulas like the one above. Second, many algorithms in <em>time series analysis</em> have recursive formulas and are often needed to analyze large streams of data. They can all be wrapped into a class in a way that is similar to the above example.</p></li>
</ol>
</div>
<div id="adding-inheritance" class="section level3" number="17.1.3">
<h3 number="17.1.3"><span class="header-section-number">17.1.3</span> Adding Inheritance</h3>
<p>How can we use inheritance in statistical programming? A primary benefit of inheritance is code re-use, so one example of inheritance is writing a generic algorithm as a base class, and a specific algorithm as a class that inherits from the base class. For example, we could re-use the code in the <code>RunningMean</code> class in a variety of other classes.</p>
<p>Let’s make some assumptions about a <em>parametric model</em> that is generating our data. Suppose I assume that the data points <span class="math inline">\(x_1, \ldots, x_n\)</span> are a “random sample”<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> from a normal distribution with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2=1\)</span>. <span class="math inline">\(\mu\)</span> is assumed to be unknown (this is, after all, and interval for <span class="math inline">\(\mu\)</span>), and <span class="math inline">\(\sigma^2\)</span> is assumed to be known, for simplicity.</p>
<p>A <span class="math inline">\(95\%\)</span> confidence interval for the true unknown population mean <span class="math inline">\(\mu\)</span> is
<span class="math display">\[
\left[\bar{x} - 1.96 \sqrt{\frac{\sigma^2}{n}}, \bar{x} + 1.96 \sqrt{\frac{\sigma^2}{n}} \right].
\]</span>
The width of the interval shrinks as we get more data (as <span class="math inline">\(n \to \infty\)</span>). We can write another class that, not only calculates the center of this interval, <span class="math inline">\(\bar{x}\)</span>, but also returns the interval endpoints.</p>
<p>If we wrote another class from scratch, then we would need to rewrite a lot of the code that we already have in the definition of <code>RunningMean</code>. Instead, we’ll use the idea of <a href="https://docs.python.org/3/tutorial/classes.html#inheritance"><em>inheritance</em></a>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RunningCI(RunningMean):</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Updates a running average and gives you a known-variance confidence interval&quot;&quot;&quot;</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, known_var):</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.known_var <span class="op">=</span> known_var</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_current_interval(<span class="va">self</span>):</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>      half_width <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> np.sqrt(<span class="va">self</span>.known_var <span class="op">/</span> <span class="va">self</span>.n)  </span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> np.array([<span class="va">self</span>.current_xbar <span class="op">-</span> half_width, <span class="va">self</span>.current_xbar <span class="op">+</span> half_width])</span></code></pre></div>
<p>The parentheses in the first line of the class definition signal that this new class definition is inheriting from <code>RunningMean</code>. Inside the definition of this new class, when I refer to <code>self.current_xbar</code> Python knows what I’m referring to because it is defined in the base class. Last, I am using <code>super()</code> to access the base class’s methods, such as <code>__init__</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>my_ci <span class="op">=</span> RunningCI(<span class="dv">1</span>) <span class="co"># create running average object</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>my_ci.get_current_xbar() <span class="co"># no data yet!</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>my_ci.update(<span class="fl">1.</span>) </span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>my_ci.get_current_interval() </span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="co">## array([-0.96,  2.96])</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>my_ci.update(<span class="fl">3.</span>)  </span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>my_ci.get_current_interval()  </span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a><span class="co">## array([0.61407071, 3.38592929])</span></span></code></pre></div>
<p>This example also demonstrates <strong>polymorphism.</strong> Polymorphism comes from the Greek for “many forms.” “Forms” means “type” or “class” in this case. If the same code (usually a function or method) works on objects of different types, that’s polymorphic. Here, the <code>update</code> method worked on an object of class <code>RunningCI</code>, as well as an object of <code>RunningMean</code>.</p>
<p>Why is this useful? Consider this example.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> datum <span class="kw">in</span> time_series:</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> thing <span class="kw">in</span> obj_list:</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>    thing.update(xt)</span></code></pre></div>
<p>Inside the inner <code>for</code> loop, there is no need for include conditional logic that tests for what kind of type each <code>thing</code> is. We can iterate through time more succinctly.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> datum <span class="kw">in</span> time_series:</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> thing <span class="kw">in</span> obj_list:</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, class1):</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>      thing.updatec1(xt)</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, class2):</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>      thing.updatec2(xt)</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, class3):</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>      thing.updatec3(xt)</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, class4):</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>      thing.updatec4(xt)</span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, class5):</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>      thing.updatec5(xt)</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, class6):</span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>      thing.updatec6(xt)</span></code></pre></div>
<p>If, in the future, you add a new class called <code>class7</code>, then you need to change this inner <code>for</code> loop, as well as provide new code for the class.</p>
</div>
<div id="adding-in-composition" class="section level3" number="17.1.4">
<h3 number="17.1.4"><span class="header-section-number">17.1.4</span> Adding in Composition</h3>
<p><em>Composition</em> also enables code re-use. Inheritance ensures an “is a” relationship between base and derived classes, and composition promotes a “has a” relationship. Sometimes it can be tricky to decide which technique to use, especially when it comes to statistical programming.</p>
<p>Regarding the example above, you might argue that a confidence interval isn’t a particular type of a sample mean. Rather, it only <em>has a</em> sample mean. If you believe this, then you might opt for a composition based model instead. With composition, the derived class (the confidence interval class) will be decoupled from the base class (the sample mean class). This decoupling will have a few implications. In general, composition is more flexible, but can lead to longer, uglier code.</p>
<ol style="list-style-type: decimal">
<li><p>You will lose polymorphism.</p></li>
<li><p>Your code might become less re-usable.</p>
<ul>
<li><p>You have to write any derive class methods you want because you don’t inherit any from the base class. For example, you won’t automatically get the <code>.update()</code> or the <code>.get_current_xbar()</code> method for free. This can be tedious if there are a lot of methods you want both classes to have that should work the same exact way for both classes. If there are, you would have to re-write a bunch of method definitions.</p></li>
<li><p>On the other hand, this could be good if you have methods that behave completely differently. Each method you write can have totally different behavior in the derived class, even if the method names are the same in both classes. For instance, <code>.update()</code> could mean something totally different in these two classes. Also, in the derive class, you can still call the base class’s <code>.update()</code> method.</p></li>
</ul></li>
<li><p>Many-to-one relationships are easier. It’s generally easier to “own” many base class instances rather than inherit from many base classes at once. This is especially true if this is the only book on programming you plan on reading–I completely avoid the topic of multiple inheritance!</p></li>
</ol>
<div class="rmd-caution">
<p>Sometimes it is very difficult to choose between using composition or using inheritance. However, this choice should be made very carefully. If you make the wrong one, and realize too late, <em>refactoring</em> your code might be very time consuming!</p>
</div>
<hr />
<p>Here is an example implementation of a confidence interval using composition. Notice that this class “owns” a <code>RunningMean</code> instance called <code>self.mean</code>. This is contrast with <em>inheriting</em> from the <code>RunningMean</code> class.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RunningCI2:</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Updates a running average and gives you a known-variance confidence interval&quot;&quot;&quot;</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, known_var):</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.mean <span class="op">=</span> RunningMean()</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.known_var <span class="op">=</span> known_var</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> update(<span class="va">self</span>, new_x):    </span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.mean.update(new_x)</span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_current_interval(<span class="va">self</span>):</span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>      half_width <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> np.sqrt(<span class="va">self</span>.known_var <span class="op">/</span> <span class="va">self</span>.n)  </span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> np.array([<span class="va">self</span>.mean.get_current_xbar() <span class="op">-</span> half_width, <span class="va">self</span>.mean.get_current_xbar() <span class="op">+</span> half_width])</span></code></pre></div>
</div>
</div>
<div id="oop-in-r" class="section level2" number="17.2">
<h2 number="17.2"><span class="header-section-number">17.2</span> OOP In R</h2>
<p>R, unlike Python, has many different kinds of classes. In R, there is not only one way to make a class. There are many! This list isn’t exhaustive, but I will discuss</p>
<ul>
<li>S3 classes</li>
<li>S4 classes</li>
<li>Reference classes, and</li>
<li>R6 classes.</li>
</ul>
<p>If you like how Python does OOP, you will like reference classes and R6 classes, while S3 and S4 classes will feel strange to you.</p>
<p>It’s best to learn about them chronologically, in my opinion. S3 classes came first, S4 classes sought to improve upon those. Reference classes rely on S4 classes, and R6 classes are an improved version of Reference classes.</p>
<p>TODO a picture of a wide variety of choices</p>
<div id="s3-objects-the-big-picture" class="section level3" number="17.2.1">
<h3 number="17.2.1"><span class="header-section-number">17.2.1</span> S3 objects: The Big Picture</h3>
<p>With S3 (and S4) objects, calling a method <code>print</code> will not look like this.</p>
<pre><code>my_obj.print()</code></pre>
<p>Instead, it will look like this:</p>
<pre><code>print(my_obj)</code></pre>
<p>The primary goal of S3 is <em>polymorphism</em>. We want functions like <code>print</code>, <code>summary</code> and <code>plot</code> to behave differently when objects of a different type are passed in to them. Printing a linear model should look a lot different than printing a data frame, right? So we can write code like the following, we only have to remember fewer functions as an end-user, and the “right” thing will always happen. If you’re writing a package, it’s also nice for your users that they’re able to use the regular functions that they’re familiar with. For instance, I allow users of my package <a href="https://cran.r-project.org/web/packages/cPseudoMaRg/index.html"><code>cPseudoMaRg</code></a> <span class="citation">(<a href="#ref-cpm" role="doc-biblioref">Brown 2021</a>)</span> to call <code>print</code> on objects of type <code>cpmResults</code>. In section @ref(plotting-with-ggplot2), <code>ggplot2</code> instances, which are much more complicated than plain <code>numeric</code> <code>vector</code>s, are <code>+</code>ed together.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print works on pretty much everything</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(myObj)</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(myObjOfADifferentClass)</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(aThirdClassObject)</span></code></pre></div>
<p>This works because these “high-level” functions (like <code>print</code>), will look at its input and choose the most appropriate function to call, based on what kind of type the input has. <code>print</code> is the high-level function. When you run some of the above code, it might not be obvious which specific function <code>print</code> chooses for each input. You can’t see that happening, yet.</p>
<p>Last, recall that this discussion only applies to S3 objects. Not all objects are S3 objects, though. To find out if an object <code>x</code> is an S3 object, use <code>is.object(x)</code>.</p>
</div>
<div id="using-s3-objects" class="section level3" number="17.2.2">
<h3 number="17.2.2"><span class="header-section-number">17.2.2</span> Using S3 objects</h3>
<p>Using S3 objects is so easy that you probably don’t even know that you’re actually using them. You can just try to call functions on objects, look at the output, and if you’re happy with it, you’re good. However, if you’ve ever asked yourself: “why does <code>print</code> (for another function) do different things all the time?” then this section will be useful for you to read.</p>
<p>TODO: picture of looking into one door but going down a lot of avenues</p>
<p><code>print</code> is a <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Method-dispatching"><strong>generic function</strong></a> which is a function that looks at the type of its first argument, and then calls another, more specialized function depending on what type that argument is. Not all functions in <code>R</code> are generic, but some are. In addition to <code>print</code>, <code>summary</code> and <code>plot</code> are the most ubiquitous generic functions. Generic functions are an <em>interface</em>, because the user does not need to concern himself with the details going on behind the scenes.</p>
<p>In R, a <strong>method</strong> is a specialized function that gets chosen by the generic function for a particular type of input. The method is the <em>implementation</em>. When the generic function chooses a particular method, this is called <strong>method dispatch</strong>.</p>
<p>If you look at the definition of a generic function, let’s take <code>plot</code> for instance, it has a single line that calls <code>UseMethod</code>.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>plot</span></code></pre></div>
<pre><code>## function (x, y, ...) 
## UseMethod(&quot;plot&quot;)
## &lt;bytecode: 0x55b21747b1c0&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p><code>UseMethod</code> performs method dispatch. Which methods can be dispatched to? To see that, use the <code>methods</code> function.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(plot)</span></code></pre></div>
<pre><code>##  [1] plot,ANY-method        plot,color-method      plot.acf*              plot.BFBayesFactor*   
##  [5] plot.BFBayesFactorTop* plot.data.frame*       plot.decomposed.ts*    plot.default          
##  [9] plot.dendrogram*       plot.density*          plot.ecdf              plot.factor*          
## [13] plot.formula*          plot.function          plot.ggplot*           plot.gtable*          
## [17] plot.hcl_palettes*     plot.hclust*           plot.histogram*        plot.HoltWinters*     
## [21] plot.isoreg*           plot.lm*               plot.mcmc*             plot.mcmc.list*       
## [25] plot.medpolish*        plot.mlm*              plot.numpy.ndarray*    plot.ppr*             
## [29] plot.prcomp*           plot.princomp*         plot.profile.nls*      plot.R6*              
## [33] plot.raster*           plot.shingle*          plot.spec*             plot.stepfun          
## [37] plot.stl*              plot.table*            plot.trans*            plot.trellis*         
## [41] plot.ts                plot.tskernel*         plot.TukeyHSD*        
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>All of these S3 class methods share the same naming convention. Their name has the generic function’s name as a prefix, then a dot (<code>.</code>), then the name of the class that they are specifically written to be used with.</p>
<div class="rmd-caution">
<p>R’s dot-notation is nothing like Python’s dot-notation! In R, functions do not <em>belong</em> to types/classes like they do in Python!</p>
</div>
<p>Method dispatch works by looking at the <code>class</code> attribute of an S3 object argument. An object in R may or may not have a set of <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Attributes"><strong>attributes</strong></a>, which are a collection of name/value pairs that give a particular object extra functionality. Regular <code>vector</code>s in R don’t have attributes (e.g. try running <code>attributes(1:3)</code>), but objects that are “embellished” versions of a <code>vector</code> might (e.g. run <code>attributes(factor(1:3))</code>).</p>
<div class="rmd-caution">
<p><code>class</code> will return misleading results if it’s called on an object that isn’t an S3 object. Make sure to check with <code>is.object</code> first.</p>
</div>
<p>Also, these methods are not <em>encapsulated</em> inside a class definition like they are in Python, either. They just look like loose functions–the method definition for a particular class is not defined inside the class. These class methods can be defined just as ordinary functions, out on their own, in whatever file you think is appropriate to define functions in.</p>
<p>As an example, let’s try to <code>plot</code> some specific objects.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>aDF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">nrow =</span> <span class="dv">10</span>))</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.object</span>(aDF) <span class="co"># is this s3?</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(aDF)</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;data.frame&quot;</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aDF)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-232-1.png" width="50%" /></p>
<p>Because <code>aDF</code> has its <code>class</code> set to <code>data.frame</code>, this causes <code>plot</code> to try to find a <code>plot.data.frame</code> method. If this method was not found, R would attempt to find/use a <code>plot.default</code> method. If no default method existed, an error would be thrown.</p>
<p>As another example, we can play around with objects created with the <code>ecdf</code> function. This function computes an <em>empirical cumulative distribution function</em>, which takes a real number as an input, and outputs the proportion of observations that are less than or equal to that input<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a></p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>myECDF <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.object</span>(myECDF)</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(myECDF)</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;ecdf&quot;     &quot;stepfun&quot;  &quot;function&quot;</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(myECDF)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-233-1.png" width="50%" /></p>
<p>This is how <em>inheritance</em> works in R. The <code>ecdf</code> class inherits from the <code>stepfun</code> class, which in turn inherits from the <code>function</code> class. When you call <code>plot(myECDF)</code>, ultimately <code>plot.ecdf</code> is used on this object. However, if <code>plot.ecdf</code> did not exist, <code>plot.stepfun</code> would be tried. S3 inheritance in R is much simpler than Python’s inheritance!</p>
</div>
<div id="creating-s3-objects" class="section level3" number="17.2.3">
<h3 number="17.2.3"><span class="header-section-number">17.2.3</span> Creating S3 objects</h3>
<p>Creating an S3 object is very easy, and is a nice way to spruce up some bundled up object that you’re returning from a function, say. All you have to do is tag an object by changing its class attribute. Just assign a character <code>vector</code> to it!</p>
<p>Here is an example of creating an object of <code>CoolClass</code>.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>myThing <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(myThing)</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(myThing) <span class="ot">&lt;-</span> <span class="st">&quot;CoolClass&quot;</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(myThing) <span class="co"># also try class(myThing)</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $class</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;CoolClass&quot;</span></span></code></pre></div>
<p><code>myThing</code> is now an instance of <code>CoolClass</code>, even though I never defined what a <code>CoolClass</code> was ahead of time! If you’re used to Python, this should seem very strange. Compared to Python, this approach is very flexible, but also, kind of dangerous, because you can change the <code>class</code>es of existing objects. You shouldn’t do that, but you could if you wanted to.</p>
<p>After you start creating your own S3 objects, you can write your own methods associated with these objects. That way, when a user of your code uses typical generic functions, such as <code>summary</code>, on your S3 object, you can control what interesting things will happen to the user of your package. Here’s an example.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(myThing)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;No summary available!&quot;</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Cool Classes are too cool for summaries!&quot;</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;:)&quot;</span></span></code></pre></div>
<p>The <code>summary</code> method I wrote for this class is the following.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>summary.CoolClass <span class="ot">&lt;-</span> <span class="cf">function</span>(object,...){</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;No summary available!&quot;</span>)</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Cool Classes are too cool for summaries!&quot;</span>)</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;:)&quot;</span>)</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>When writing this, I kept the signature the same as <code>summary</code>’s.</p>
</div>
<div id="s4-objects-the-big-picture" class="section level3" number="17.2.4">
<h3 number="17.2.4"><span class="header-section-number">17.2.4</span> S4 objects: The Big Picture</h3>
<p>S4 was developed after S3. If you look at your search path (type <code>search()</code>), you will see <code>package:methods</code>. That’s where all the code you need to do S4 is.</p>
<p>Here are the similarities and differences between S3 and S4:</p>
<ul>
<li>they both use generic functions and methods work in the same way</li>
<li>unlike in S3, S4 classes allow you to use multiple dispatch, which means the generic function can dispatch on multiple arguments, instead of just the first argument</li>
<li>S4 class definitions are strict. They aren’t just name tags like in S3.</li>
<li>S4 inheritance feels more like Python’s. You can think of a base class object living inside a child class object.</li>
<li>S4 classes can have default data members via <code>prototype</code>s.</li>
</ul>
<p>Much more information about S4 classes can be obtained by reading <a href="https://adv-r.hadley.nz/s4.html">Chapter 15 in Hadley Wickham’s book.</a></p>
</div>
<div id="using-s4-objects" class="section level3" number="17.2.5">
<h3 number="17.2.5"><span class="header-section-number">17.2.5</span> Using S4 objects</h3>
<p>One CRAN package that uses S4 is the <a href="https://cran.r-project.org/web/packages/Matrix/vignettes/Intro2Matrix.pdf">Matrix package.</a> S4 objects are also extremely popular in packages hosted on <a href="https://www.bioconductor.org/">Bioconductor</a>.</p>
<div class="rmd-details">
<p>Bioconductor is kind of like CRAN, but its software has a much more specific focus on bioinformatics. To download packages from Bioconductor, you can check out the installation instructions provided <a href="https://bioconductor.org/help/course-materials/2017/Zurich/S4-classes-and-methods.html">here</a>.</p>
</div>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">10</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="fu">isS4</span>(M)</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>M</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 x 7 Matrix of class &quot;dgeMatrix&quot;</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]   11   15   19   23   27   31   35</span></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]   12   16   20   24   28   32   36</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]   13   17   21   25   29   33   37</span></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]   14   18   22   26   30   34   38</span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>M<span class="sc">@</span>Dim</span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4 7</span></span></code></pre></div>
<p>Inside an S4 object, data members are called <strong>slots</strong>, and they are accessed with the <code>@</code> operator (instead of the <code>$</code> operator). Objects can be tested if they are S4 with the function <code>isS4</code>. Otherwise, they look and feel just like S3 objects.</p>
</div>
<div id="creating-s4-objects" class="section level3" number="17.2.6">
<h3 number="17.2.6"><span class="header-section-number">17.2.6</span> Creating S4 objects</h3>
<p>Here are the key takeaways</p>
<ul>
<li>create a new S4 class with <code>setClass</code></li>
<li>create a new S4 object with <code>new</code></li>
<li>S4 classes have a fixed amount of slots, a name, and a fixed inheritance structure</li>
</ul>
<p>Let’s do an example that resembles the example we did in Python, where we defined a <code>RunningMean</code> class and a <code>RunningCI</code> class.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">&quot;RunningMean&quot;</span>,</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">slots =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="st">&quot;integer&quot;</span>, </span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">currentXbar =</span> <span class="st">&quot;numeric&quot;</span>))</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">&quot;RunningCI&quot;</span>,</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">slots =</span> <span class="fu">list</span>(<span class="at">knownVar =</span> <span class="st">&quot;numeric&quot;</span>),</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">contains =</span> <span class="st">&quot;RunningMean&quot;</span>)</span></code></pre></div>
<p>Here, unlike in S3 class’s, we actually have to define a class with <code>setClass</code>. In the parlance of S4, <code>slots</code> are a class’ data members, and <code>contains</code> signals that one class inherits from another (even though it kind of sounds like <em>composition</em>).</p>
<p>New objects can be created with the <code>new</code> function after this is accomplished.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new</span>(<span class="st">&quot;RunningMean&quot;</span>, <span class="at">n =</span> 0L, <span class="at">currentXbar =</span> <span class="dv">0</span>)</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="fu">new</span>(<span class="st">&quot;RunningCI&quot;</span>, <span class="at">n =</span> 0L, <span class="at">currentXbar =</span> <span class="dv">0</span>, <span class="at">knownVar =</span> <span class="fl">1.0</span>)</span></code></pre></div>
<p>Let’s set one of those up. To achieve we want this <code>update</code> method to be generic, and it will work on objects of type “RunningMean” and “RunningCI.”</p>
<p>Next we want to define an <code>update</code> generic function that will work on objects of both types. This is what gives us <em>polymorphism</em> . The generic <code>update</code> will call specialized methods for objects of class “RunningMean” and “RunningCI.”</p>
<p>Recall that in the Python example, each class had its own update method. Here, we still have a specialized method for each class, but S4 methods don’t have to be defined inside the class definition, as we can see below.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">&quot;update&quot;</span>, <span class="cf">function</span>(oldMean, newNum) {</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">standardGeneric</span>(<span class="st">&quot;update&quot;</span>)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating a new generic function for &#39;update&#39; in the global environment</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;update&quot;</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">&quot;update&quot;</span>,</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="at">oldMean =</span> <span class="st">&quot;RunningMean&quot;</span>, <span class="at">newNum =</span> <span class="st">&quot;numeric&quot;</span>),</span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>          <span class="cf">function</span>(oldMean, newNum) {</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>            oldN <span class="ot">&lt;-</span> oldMean<span class="sc">@</span>n</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>            oldAve <span class="ot">&lt;-</span> oldMean<span class="sc">@</span>currentXbar</span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>            newAve <span class="ot">&lt;-</span> (oldAve<span class="sc">*</span>oldN <span class="sc">+</span> newNum)<span class="sc">/</span>(oldN <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>            newN <span class="ot">&lt;-</span> oldN <span class="sc">+</span> 1L</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">new</span>(<span class="st">&quot;RunningMean&quot;</span>, <span class="at">n =</span> newN, <span class="at">currentXbar =</span> newAve))</span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">&quot;update&quot;</span>,</span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="at">oldMean =</span> <span class="st">&quot;RunningCI&quot;</span>, <span class="at">newNum =</span> <span class="st">&quot;numeric&quot;</span>),</span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a>          <span class="cf">function</span>(oldMean, newNum) {</span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>            oldN <span class="ot">&lt;-</span> oldMean<span class="sc">@</span>n</span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a>            oldAve <span class="ot">&lt;-</span> oldMean<span class="sc">@</span>currentXbar</span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a>            newAve <span class="ot">&lt;-</span> (oldAve<span class="sc">*</span>oldN <span class="sc">+</span> newNum)<span class="sc">/</span>(oldN <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>            newN <span class="ot">&lt;-</span> oldN <span class="sc">+</span> 1L</span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">new</span>(<span class="st">&quot;RunningCI&quot;</span>, <span class="at">n =</span> newN, <span class="at">currentXbar =</span> newAve, <span class="at">knownVar =</span> oldMean<span class="sc">@</span>knownVar))</span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Here’s a demonstration of using these two classes that mirrors the example in subsection @ref(adding-inheritance)</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>myAve <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;RunningMean&quot;</span>, <span class="at">n =</span> 0L, <span class="at">currentXbar =</span> <span class="dv">0</span>)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>myAve <span class="ot">&lt;-</span> <span class="fu">update</span>(myAve, <span class="dv">3</span>)</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>myAve</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="do">## An object of class &quot;RunningMean&quot;</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;n&quot;:</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;currentXbar&quot;:</span></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>myAve <span class="ot">&lt;-</span> <span class="fu">update</span>(myAve, <span class="dv">1</span>)</span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>myAve</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a><span class="do">## An object of class &quot;RunningMean&quot;</span></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;n&quot;:</span></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;currentXbar&quot;:</span></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>myCI <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;RunningCI&quot;</span>, <span class="at">n =</span> 0L, <span class="at">currentXbar =</span> <span class="dv">0</span>, <span class="at">knownVar =</span> <span class="fl">1.0</span>)</span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>myCI <span class="ot">&lt;-</span> <span class="fu">update</span>(myCI, <span class="dv">3</span>)</span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>myCI</span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a><span class="do">## An object of class &quot;RunningCI&quot;</span></span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;knownVar&quot;:</span></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;n&quot;:</span></span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;currentXbar&quot;:</span></span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>myCI <span class="ot">&lt;-</span> <span class="fu">update</span>(myCI, <span class="dv">1</span>)</span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>myCI</span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a><span class="do">## An object of class &quot;RunningCI&quot;</span></span>
<span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;knownVar&quot;:</span></span>
<span id="cb242-35"><a href="#cb242-35" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb242-36"><a href="#cb242-36" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb242-37"><a href="#cb242-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;n&quot;:</span></span>
<span id="cb242-38"><a href="#cb242-38" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb242-39"><a href="#cb242-39" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb242-40"><a href="#cb242-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Slot &quot;currentXbar&quot;:</span></span>
<span id="cb242-41"><a href="#cb242-41" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>This looks more <em>functional</em> (more information on functional programming is available in chapter @ref(functional-programming)) than the Python example because the <code>update</code> function does not change a <em>mutable</em> object with a side-effect. Instead, it takes the old object, changes it, returns the new object, and uses assignment to overwrite the object. The benefit of this approach is that the assignment operator (<code>&lt;-</code>) signals to us that something is changing. However, there is more data copying involved, so the program is presumably slower than it needs to be.</p>
<p>The big takeaway here is that S3 and S4 don’t feel like Python’s encapsulated OOP. If we wanted to write stateful programs, we might consider using Reference Classes, or R6 classes.</p>
</div>
<div id="reference-classes-the-big-picture" class="section level3" number="17.2.7">
<h3 number="17.2.7"><span class="header-section-number">17.2.7</span> Reference Classes: The Big Picture</h3>
<p><a href="https://www.rdocumentation.org/packages/methods/versions/3.6.2/topics/ReferenceClasses"><strong>Reference Classes.</strong></a> are built on top of S4 classes, and were released in <a href="https://stat.ethz.ch/pipermail/r-announce/2010/000529.html">late 2010</a>. They feel very different from S3 and S4 classes, and they more closely resemble Python classes, because</p>
<ol style="list-style-type: decimal">
<li>their method definitions are <em>encapsulated</em> inside class definitions like in Python, and</li>
<li>the objects they construct are <em>mutable</em>.</li>
</ol>
<p>So it will feel much more like Python’s class system. Some might say using reference classes that will lead to code that is not very R-ish, but it can be useful for certain types of programs (e.g. long-running code, code that that performs many/high-dimensional/complicated simulations, or code that circumvents storing large data set in your computer’s memory all at once).</p>
</div>
<div id="creating-reference-classes" class="section level3" number="17.2.8">
<h3 number="17.2.8"><span class="header-section-number">17.2.8</span> Creating Reference Classes</h3>
<p>Creating reference classes is done with the function <code>setRefClass</code>. I create a class called <code>RunningMean</code> that produces the same behavior as that in the previous example.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>RunningMeanRC <span class="ot">&lt;-</span> <span class="fu">setRefClass</span>(<span class="st">&quot;RunningMeanRC&quot;</span>, </span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fields =</span> <span class="fu">list</span>(<span class="at">current_xbar =</span> <span class="st">&quot;numeric&quot;</span>, </span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">n =</span> <span class="st">&quot;integer&quot;</span>),</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">methods =</span> <span class="fu">list</span>(</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">update =</span> <span class="cf">function</span>(new_x){</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>                               n <span class="ot">&lt;&lt;-</span> n <span class="sc">+</span> 1L</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>                               current_xbar <span class="ot">&lt;&lt;-</span> (current_xbar<span class="sc">*</span>(n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> new_x) <span class="sc">/</span> n</span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>                              }))</span></code></pre></div>
<p>This tells us a few things. First, data members are called <em>fields</em> now. Second, changing class variables is done with the <code>&lt;&lt;-</code>. We can use it just as before.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>my_ave <span class="ot">&lt;-</span> RunningMeanRC<span class="sc">$</span><span class="fu">new</span>(<span class="at">current_xbar=</span><span class="dv">0</span>, <span class="at">n=</span>0L)</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>my_ave</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Reference class object of class &quot;RunningMeanRC&quot;</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Field &quot;current_xbar&quot;:</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Field &quot;n&quot;:</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>my_ave<span class="sc">$</span><span class="fu">update</span>(<span class="fl">1.</span>) </span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>my_ave<span class="sc">$</span>current_xbar</span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a>my_ave<span class="sc">$</span>n   </span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>my_ave<span class="sc">$</span><span class="fu">update</span>(<span class="fl">3.</span>)  </span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a>my_ave<span class="sc">$</span>current_xbar</span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a>my_ave<span class="sc">$</span>n   </span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>Compare how similar this code looks to the code in @ref(a-first-example)! Note the paucity of assignment operators, and plenty of side-effects.</p>
</div>
<div id="creating-r6-classes" class="section level3" number="17.2.9">
<h3 number="17.2.9"><span class="header-section-number">17.2.9</span> Creating R6 Classes</h3>
<p>I quickly implement the above example as an R6 class. A more detailed introduction to R6 classes is provided in <a href="https://r6.r-lib.org/articles/Introduction.html">the vignette from the package authors.</a></p>
<p>You’ll notice the reappearance of the <code>self</code> keyword. R6 classes have a <code>self</code> keyword just like in Python. They are similar to reference classes, but there are a few differences:</p>
<ol style="list-style-type: decimal">
<li>they have <a href="https://r6.r-lib.org/articles/Performance.html">better performance than reference classes</a>, and</li>
<li>they don’t make use of the <code>&lt;&lt;-</code> operator.</li>
</ol>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>RunningMeanR6 <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;RunningMeanR6&quot;</span>,</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">current_xbar =</span> <span class="cn">NULL</span>,</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n =</span> <span class="cn">NULL</span>,</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">current_xbar =</span> <span class="cn">NA</span>, <span class="at">n =</span> <span class="cn">NA</span>) {</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>                      self<span class="sc">$</span>current_xbar <span class="ot">&lt;-</span> current_xbar</span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>                      self<span class="sc">$</span>n <span class="ot">&lt;-</span> n</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">update =</span> <span class="cf">function</span>(new_x) {</span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>                      self<span class="sc">$</span>n <span class="ot">&lt;-</span> self<span class="sc">$</span>n <span class="sc">+</span> 1L</span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>                      self<span class="sc">$</span>current_xbar <span class="ot">&lt;-</span> (self<span class="sc">$</span>current_xbar<span class="sc">*</span>(self<span class="sc">$</span>n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> new_x) <span class="sc">/</span> self<span class="sc">$</span>n</span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a>my_r6_ave <span class="ot">&lt;-</span> RunningMeanR6<span class="sc">$</span><span class="fu">new</span>(<span class="at">current_xbar=</span><span class="dv">0</span>, <span class="at">n=</span>0L)</span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a>my_r6_ave</span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;RunningMeanR6&gt;</span></span>
<span id="cb245-20"><a href="#cb245-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   Public:</span></span>
<span id="cb245-21"><a href="#cb245-21" aria-hidden="true" tabindex="-1"></a><span class="do">##     clone: function (deep = FALSE) </span></span>
<span id="cb245-22"><a href="#cb245-22" aria-hidden="true" tabindex="-1"></a><span class="do">##     current_xbar: 0</span></span>
<span id="cb245-23"><a href="#cb245-23" aria-hidden="true" tabindex="-1"></a><span class="do">##     initialize: function (current_xbar = NA, n = NA) </span></span>
<span id="cb245-24"><a href="#cb245-24" aria-hidden="true" tabindex="-1"></a><span class="do">##     n: 0</span></span>
<span id="cb245-25"><a href="#cb245-25" aria-hidden="true" tabindex="-1"></a><span class="do">##     update: function (new_x)</span></span>
<span id="cb245-26"><a href="#cb245-26" aria-hidden="true" tabindex="-1"></a>my_r6_ave<span class="sc">$</span><span class="fu">update</span>(<span class="fl">1.</span>) </span>
<span id="cb245-27"><a href="#cb245-27" aria-hidden="true" tabindex="-1"></a>my_r6_ave<span class="sc">$</span>current_xbar</span>
<span id="cb245-28"><a href="#cb245-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb245-29"><a href="#cb245-29" aria-hidden="true" tabindex="-1"></a>my_r6_ave<span class="sc">$</span>n   </span>
<span id="cb245-30"><a href="#cb245-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb245-31"><a href="#cb245-31" aria-hidden="true" tabindex="-1"></a>my_r6_ave<span class="sc">$</span><span class="fu">update</span>(<span class="fl">3.</span>)  </span>
<span id="cb245-32"><a href="#cb245-32" aria-hidden="true" tabindex="-1"></a>my_r6_ave<span class="sc">$</span>current_xbar</span>
<span id="cb245-33"><a href="#cb245-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb245-34"><a href="#cb245-34" aria-hidden="true" tabindex="-1"></a>my_r6_ave<span class="sc">$</span>n   </span>
<span id="cb245-35"><a href="#cb245-35" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>TODO
a more detailed</p>
<p><a href="https://adv-r.hadley.nz/r6.html" class="uri">https://adv-r.hadley.nz/r6.html</a></p>
<p><a href="https://adv-r.hadley.nz/r6.html#why-r6" class="uri">https://adv-r.hadley.nz/r6.html#why-r6</a></p>
<!-- Now we can create a new object -->
<!-- ```{r, collapse = TRUE} -->
<!-- myAve <- new("RunningMean", n = 0, currentXbar = 0.0) -->
<!-- ``` -->
<!-- my_ave = RunningMean() # create running average object -->
<!-- my_ave.get_current_xbar() # no data yet! -->
<!-- my_ave.update(1.) # first data point -->
<!-- my_ave.get_current_xbar() # xbar_1 -->
<!-- my_ave.update(3.)  # second data point -->
<!-- my_ave.get_current_xbar()  #xbar_2 -->
<!-- my_ave.n   # my_ave.n instead of self.n -->
<!-- import numpy as np -->
<!-- class RunningCI(RunningMean): -->
<!--   """Updates a running average and gives you a known-variance confidence interval""" -->
<!--   def __init__(self, known_var): -->
<!--     super().__init__() -->
<!--     self.known_var = known_var -->
<!--   def get_current_interval(self): -->
<!--     if self.n == 0: -->
<!--       return None -->
<!--     else: -->
<!--       half_width = 1.96 * np.sqrt(self.known_var / self.n)   -->
<!--       return np.array([self.current_xbar - half_width, self.current_xbar + half_width]) -->
</div>
</div>
<div id="exercises-10" class="section level2" number="17.3">
<h2 number="17.3"><span class="header-section-number">17.3</span> Exercises</h2>
<p>All answers to questions related to R should be written in a file named <code>data_types_exercises.R</code>. All answers to questions related to Python should be written in a file named <code>data_types_exercises.py</code>.</p>
<ol style="list-style-type: decimal">
<li><p>In Python, write a class that implements a running sample variance.`</p></li>
<li><p>In Python, write a class that estimates a linear regression model.</p></li>
</ol>
<p>Let</p>
<ul>
<li>Let <span class="math inline">\(\begin{bmatrix}x_1 \\ x_2 \\ \vdots \\ x_{10} \end{bmatrix}\)</span> be a <span class="math inline">\(10 \times 1\)</span> vector of predictor variables.</li>
<li><span class="math inline">\(\mathbf{X} = \begin{bmatrix} 1 &amp; x_1 \\ 1 &amp; x_2 \\ \vdots &amp; \vdots \\ 1 &amp; x_{10} \end{bmatrix}\)</span> be a <span class="math inline">\(10 \times 2\)</span> “design matrix,”</li>
<li><span class="math inline">\(\mathbf{y} = \begin{bmatrix} y_1 \\ y_2 \\ \vdots \\ y_{10} \end{bmatrix}\)</span> be a <span class="math inline">\(10 \times 1\)</span> vector of dependent observations, and</li>
<li><span class="math inline">\(\boldsymbol{\epsilon} = \begin{bmatrix} \epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_{10} \end{bmatrix}\)</span> be a <span class="math inline">\(10 \times 1\)</span> vector of mean <span class="math inline">\(0\)</span> random errors. The assumed regression model can be written as</li>
</ul>
<p><span class="math display">\[
\mathbf{y} = 
\mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon},
\]</span>
and the estimate for the coefficient vector can be written as
<span class="math display">\[
\hat{\boldsymbol{\beta}} = \left(\mathbf{X}^\intercal \mathbf{X} \right)^{-1}\mathbf{X}^\intercal \mathbf{y}.
\]</span></p>
<ul>
<li>Make the class called <code>LinearModel</code>, and use only the numpy package</li>
<li>have the only attribute be a numpy array of estimated coefficients <code>coeffs</code></li>
<li>have one method called <code>fit</code> that takes a numpy arrays <code>X</code> (the design matrix), and <code>y</code></li>
<li>every time <code>fit</code> is called, reset the <code>coeffs</code> using the formula above</li>
</ul>
<div class="sourceCode" id="cb246"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="co"># don&#39;t hardcode variables!</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>num_rows <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>num_predictors <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>num_x_columns <span class="op">=</span> num_predictors <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="co"># generate fake data </span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>true_coefficients <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="op">-</span><span class="dv">3</span>]).reshape((num_x_columns,<span class="dv">1</span>))</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>x_array <span class="op">=</span> np.empty((num_rows, num_x_columns))</span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>x_array[:,<span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>x_array[:,<span class="dv">1</span>] <span class="op">=</span> np.random.normal(size<span class="op">=</span>num_rows)</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>y_array <span class="op">=</span> np.dot(x_array, true_coefficients) </span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a>y_array <span class="op">=</span> y_array <span class="op">+</span> np.random.normal(scale <span class="op">=</span> <span class="fl">.3</span>, size <span class="op">=</span> num_rows).reshape((num_rows,<span class="dv">1</span>))</span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fake data </span></span>
<span id="cb246-18"><a href="#cb246-18" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_array[:,<span class="dv">1</span>], y_array)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-246-1.png" width="672" /></p>
<p>Here is an example class definition, and then its use. The class holds onto</p>
<ol start="3" style="list-style-type: decimal">
<li><p>Come up with a list of Python classes that are written in third party libraries, and that you will find useful in the future!</p></li>
<li><p>Come up with a list of R classes that are written in third party libraries, and that you will find useful in the future!</p></li>
<li><p>Finish the R6 class example by adding a method <code>get_current_xbar</code> that takes no arguments, and returns <code>NULL</code> if <code>n</code> is equal to <span class="math inline">\(0\)</span>, and <span class="math inline">\(n\)</span> otherwise. This class should behave exactly the same as the Python class that goes by the same name.</p></li>
<li><p>Come up with some ideas for (base class, derived class, object) triples.</p></li>
<li><p>Come up with some examples of when composition would be better than inheritance, and vice versa.</p></li>
</ol>
<!--chapter:end:17-oop.Rmd-->
</div>
</div>
<div id="functional-programming" class="section level1" number="18">
<h1 number="18"><span class="header-section-number">18</span> Functional Programming</h1>
<p><strong>Functional Programming (FP)</strong> is another way of thinking about how to organize programs. We talked about OOP in the last chapter (chapter @ref(an-introduction-to-object-oriented-programming)), so how do OOP and FP differ? To put it simply, FP focuses on functions instead of objects. Because we are talking a lot about functions in this chapter, we will assume you have read and understood section @ref(functions).</p>
<p>Neither R nor Python is a purely functional language. For us, FP is a style that we can choose to let guide us, or that we can disregard. You can choose to employ a more functional style, or you can choose to use a more object-oriented style, or neither. Some people tend to prefer one style to other styles, and others prefer to decide which to use depending on the task at hand.</p>
<p>More specifically, a functional programming style takes advantage of <strong>first-class functions</strong> and favors functions that are <strong>pure</strong>.</p>
<ol style="list-style-type: decimal">
<li><strong>First-class functions</strong> are <span class="citation">(<a href="#ref-struc_and_interp" role="doc-biblioref">Abelson and Sussman 1996</a>)</span> functions that
<ul>
<li>can be passed as arguments to other functions,</li>
<li>can be returned from other functions, and</li>
<li>can be assigned to variables or stored in data structures.</li>
</ul></li>
<li><strong>Pure functions</strong>
<ul>
<li>return the same output if they are given the same input, and</li>
<li>do not produce <strong>side-effects</strong>.</li>
</ul></li>
</ol>
<p>Side-effects are changes made to non-temporary variables, to the “state” of the program.</p>
<p>We discussed (1) in the beginning of chapter @ref(functions). If you have not used any other programming languages before, you might even take (1) for granted. However, if you have written C code before, you might remember how difficult it is to use functions as inputs to other functions!</p>
<p>There is more to say about point (2). This means you should keep your functions as <em>modular</em> as possible, unless you want your overall program to be much more difficult to understand. FP stipulates that</p>
<ul>
<li><p><strong>ideally functions will not refer to non-local variables;</strong></p></li>
<li><p><strong>ideally functions will not (refer to and) modify non-local variables; and</strong></p></li>
<li><p><strong>ideally functions will not modify their arguments.</strong></p></li>
</ul>
<p>Unfortunately, violating the first of these three criteria is very easy to do in both of our languages. Recall our conversation about <em>dynamic lookup</em> in subsection @ref(accessing-and-modifying-captured-variables). Both R and Python use dynamic lookup, which means you can’t reliably control <em>when</em> functions look for variables. Typos in variable names easily go undiscovered, and modified global variables can potentially wreak havoc on your overall program.</p>
<p>Fortunately it is difficult to modify global variables inside functions in both R and Python. This was also discussed in subsection @ref(accessing-and-modifying-captured-variables). In Python, you need to make use of the <code>global</code> keyword (mentioned in section @ref(passing-by-assignment-in-python)), and in R, you need to use the rare super assignment operator (it looks like <code>&lt;&lt;-</code>, and it was mentioned in @ref(passing-by-value-in-r)). Because these two symbols are so rare, they can serve as signals to viewers of your code about when and where (in which functions) global variables are being modified.</p>
<p>Last, violating the third criterion is easy in Python and difficult in R. This was discussed earlier in @ref(modifying-a-functions-arguments). Python can mutate/change arguments that have a mutable type because it has <em>pass-by-assignment</em> semantics (mentioned in section @ref(passing-by-assignment-in-python), and R generally can’t modify its arguments at all because it has <em>pass-by-value</em> semantics @ref(passing-by-value-in-r).</p>
<hr />
<p>This chapter avoids the philosophical discussion of FP. Instead, it takes the applied approach, and provides instructions on how to use FP in your own programs. I try to give examples of <em>how</em> you can use FP, and <em>when</em> these tools are especially suitable.</p>
<p>One of the biggest tip-offs that you should be using functional programming is if you need to evaluate a single function many times, or in many different ways. This happens quite frequently in statistical computing. Instead of copy/pasting similar-looking lines of code, you might consider <em>higher-order</em> functions that take your function as an input, and intelligently call it in all the many ways you want it to. A third option you might also consider is to use a loop (c.f. @ref(loops)). However, that approach is not very functional, and so it will not be heavily-discussed in this section.</p>
<p>Another tip-off that you need FP is if you need many different functions that are all “related” to one another. Should you define each function separately, using excessive copy/paste-ing? Or should you write a function that can elegantly generate any function you need?</p>
<p>Not repeating yourself and re-using code is a primary motivation, but it is not the only one. Another motivation for <strong>functional programming</strong> is clearly explained in <a href="https://adv-r.hadley.nz/fp.html">Advanced R</a><a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>:</p>
<blockquote>
<p>A functional style tends to create functions that can easily be analysed in isolation (i.e. using only local information), and hence is often much easier to automatically optimise or parallelise.</p>
</blockquote>
<p>All of these sound like a good things to have in our code, so let’s get started with some examples!</p>
<div id="functions-as-function-inputs-in-r" class="section level2" number="18.1">
<h2 number="18.1"><span class="header-section-number">18.1</span> Functions as Function Inputs in R</h2>
<p>Many of the most commonly-used functionals in R have names that end in “apply.” The ones I discuss are <code>sapply()</code>, <code>vapply()</code>, <code>lapply()</code>, <code>apply()</code>, <code>tapply()</code> and <code>mapply()</code>. Each of these takes a function as one of its arguments. Recall that this is made possible by the fact that R has first-class functions.</p>
<div id="sapply-and-vapply" class="section level3" number="18.1.1">
<h3 number="18.1.1"><span class="header-section-number">18.1.1</span> <code>sapply()</code> and <code>vapply()</code></h3>
<p>Suppose we have a <code>data.frame</code> that has 10 rows and 100 columns. What if we want to take the mean of each column?</p>
<p>An amateurish way to do this would be something like the following.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>myFirstMean <span class="ot">&lt;-</span> <span class="fu">mean</span>(myDF[,<span class="dv">1</span>])</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>mySecondMean <span class="ot">&lt;-</span> <span class="fu">mean</span>(myDF[,<span class="dv">2</span>])</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>myThirdMean <span class="ot">&lt;-</span> <span class="fu">mean</span>(myDF[,<span class="dv">3</span>])</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ....</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="co"># so on and so forth</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ....</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>myThirdMean <span class="ot">&lt;-</span> <span class="fu">mean</span>(myDF[,<span class="dv">100</span>])</span></code></pre></div>
<p>You will need one line of code for each column in the data frame. For data frames with a lot of columns, this becomes quite tedious. You should also ask yourself what happens to you and your collaborators when the data frame changes even slightly, or if you want to apply a different function to its columns. Third, the results are not stored in a single container. You are making it difficult on yourself if you want to use these variables in subsequent pieces of code.</p>
<div class="rmd-details">
<p>“Don’t repeat yourself” (DRY) is an idea that’s been around for a while and is widely accepted <span class="citation">(<a href="#ref-hunt2000pragmatic" role="doc-biblioref">Hunt and Thomas 2000</a>)</span>. DRY is the opposite of <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself#WET">WET</a>.</p>
</div>
<p>Instead, prefer the use of <code>sapply()</code> in this situation. The “s” in <code>sapply()</code> stands for “simplified.” In this bit of code <code>mean()</code> is called on each column of th data frame. <code>sapply()</code> applies the function over columns, instead of rows, because data frames are internally a <code>list</code> of columns.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>myMeans <span class="ot">&lt;-</span> <span class="fu">sapply</span>(myDF, mean)</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(myMeans)</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="do">##          X1          X2          X3          X4          X5          X6 </span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.18577292  0.58759539 -0.05194271 -0.07027537 -0.35365358 -0.11115972</span></span></code></pre></div>
<p>Each call to <code>mean()</code> returns a <code>double</code> <code>vector</code> of length <span class="math inline">\(1\)</span>. This is necessary if you want to collect all the results into a <code>vector</code>–remember, all elements of a <code>vector</code> have to have the same type. To get the same behavior, you might also consider using <code>vapply(myDF, mean, numeric(1))</code>.</p>
<p>In the above case, “simplify” referred to how one-hundred length-<span class="math inline">\(1\)</span> vectors were simplified into one length-<span class="math inline">\(100\)</span> <code>vector</code>. However, “simplified” does not necessarily imply that all elements will be stored in a <code>vector</code>. Consider the <code>summary</code> function, which returns a <code>double</code> <code>vector</code> of length <span class="math inline">\(6\)</span>. In this case, one-hundred length-<span class="math inline">\(6\)</span> vectors were simplified into one <span class="math inline">\(6 \times 100\)</span> matrix.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>mySummaries <span class="ot">&lt;-</span> <span class="fu">sapply</span>(myDF, summary)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(mySummaries)</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mySummaries)</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]   6 100</span></span></code></pre></div>
<div class="rmd-details">
<p>Another function that is worth mentioning is <code>replicate()</code>–it is a wrapper for <code>sapply()</code>. Consider a situation where you want to call a function many times with the same inputs. You might try something like <code>sapply(1:100, function(elem) {  return(myFunc(someInput)) } )</code>. Another, more readable, way to do this is <code>replicate(100, myFunc(someInput))</code>.</p>
</div>
</div>
<div id="lapply" class="section level3" number="18.1.2">
<h3 number="18.1.2"><span class="header-section-number">18.1.2</span> <code>lapply()</code></h3>
<p>For functions that do not return amenable types that fit into a <code>vector</code>, <code>matrix</code> or <code>array</code>, they might need to be stored in <code>list</code>. In this situation, you would need <code>lapply()</code>. The “l” in <code>lapply()</code> stands for “list.” <code>lapply()</code> always returns a <code>list</code> of the same length as the <code>input</code>.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>regress <span class="ot">&lt;-</span> <span class="cf">function</span>(y){ <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span>) }</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>myRegs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(myDF, regress)</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(myRegs)</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 100</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(myRegs[[<span class="dv">1</span>]])</span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;lm&quot;</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(myRegs[[<span class="dv">12</span>]])</span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = y ~ 1)</span></span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a><span class="do">## -1.6149 -0.8692 -0.2541  0.7596  2.5718 </span></span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)   0.2104     0.4139   0.508    0.623</span></span>
<span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 1.309 on 9 degrees of freedom</span></span></code></pre></div>
</div>
<div id="apply" class="section level3" number="18.1.3">
<h3 number="18.1.3"><span class="header-section-number">18.1.3</span> <code>apply()</code></h3>
<p>I use <code>sapply()</code> and <code>lapply()</code> the most, personally. The next most common function I use is <code>apply()</code>. I use it to apply functions to <em>rows</em> instead of columns. However, it can also apply functions over columns, just as the other functions we discussed can.<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a></p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(myDF)</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  10 100</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(myDF, <span class="dv">1</span>, mean)</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  0.18971263 -0.07595286  0.18400138  0.08895979 -0.08496412  0.06865526  0.08697484 -0.09550573  0.01071571</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [10]  0.02142769</span></span></code></pre></div>
<p>Another example where it can be useful to apply a function to rows is <strong>predicate functions.</strong> A predicate function is just a fancy name for a function that returns a Boolean. I use them to filter out rows of a <code>data.frame</code>. Without a predicate function, filtering rows might look something like this.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>albRealEstate <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/albemarle_real_estate.csv&quot;</span>)</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>subDF <span class="ot">&lt;-</span> albRealEstate[(albRealEstate<span class="sc">$</span>YearBuilt <span class="sc">==</span> <span class="dv">2006</span> <span class="sc">&amp;</span> albRealEstate<span class="sc">$</span>Condition <span class="sc">==</span> <span class="st">&quot;Average&quot;</span>) <span class="sc">|</span> albRealEstate<span class="sc">$</span>City <span class="sc">==</span> <span class="st">&quot;CROZET&quot;</span>,]</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(subDF)</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   YearBuilt YearRemodeled Condition NumStories FinSqFt Bedroom FullBath HalfBath TotalRooms LotSize TotalValue</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      2006             0   Average       1.00    1922       3        3        0         10   5.000     409900</span></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      2003             0   Average       1.00    1848       3        2        0          7  61.189     523100</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      1998             0      Good       1.00    1244       1        1        0          3  50.648     620700</span></span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      1886             0   Average       1.86    1861       4        1        0          6   3.880     162500</span></span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      1910             0      Fair       1.53    1108       3        1        0          6   8.838     167200</span></span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 8      1975          1982   Average       1.00    1520       3        1        0          4   2.030     151900</span></span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     City</span></span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 CROZET</span></span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 CROZET</span></span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 CROZET</span></span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 CROZET</span></span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 CROZET</span></span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 CROZET</span></span></code></pre></div>
<p>Complicated filtering criteria can become quite wide, so I prefer to break the above code into three steps.</p>
<ul>
<li>Step 1: write a predicate function that returns TRUE or FALSE;</li>
<li>Step 2: construct a <code>logical</code> <code>vector</code> by <code>apply()</code>ing the predicate over rows;</li>
<li>Step 3: plug the <code>logical</code> <code>vector</code> into the <code>[</code> operator to remove the rows.</li>
</ul>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="cf">function</span>(row){</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  (row[<span class="st">&#39;YearBuilt&#39;</span>] <span class="sc">==</span> <span class="dv">2006</span> <span class="sc">&amp;</span> row[<span class="st">&#39;Condition&#39;</span>] <span class="sc">==</span> <span class="st">&quot;Average&quot;</span>) <span class="sc">|</span> row[<span class="st">&#39;City&#39;</span>] <span class="sc">==</span> <span class="st">&quot;CROZET&quot;</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>whichRows <span class="ot">&lt;-</span> <span class="fu">apply</span>(albRealEstate, <span class="dv">1</span>, pred)</span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>subDF <span class="ot">&lt;-</span> albRealEstate[whichRows,]</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(subDF)</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   YearBuilt YearRemodeled Condition NumStories FinSqFt Bedroom FullBath HalfBath TotalRooms LotSize TotalValue</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      2006             0   Average       1.00    1922       3        3        0         10   5.000     409900</span></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      2003             0   Average       1.00    1848       3        2        0          7  61.189     523100</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      1998             0      Good       1.00    1244       1        1        0          3  50.648     620700</span></span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      1886             0   Average       1.86    1861       4        1        0          6   3.880     162500</span></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      1910             0      Fair       1.53    1108       3        1        0          6   8.838     167200</span></span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 8      1975          1982   Average       1.00    1520       3        1        0          4   2.030     151900</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a><span class="do">##     City</span></span>
<span id="cb253-15"><a href="#cb253-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 CROZET</span></span>
<span id="cb253-16"><a href="#cb253-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 CROZET</span></span>
<span id="cb253-17"><a href="#cb253-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 CROZET</span></span>
<span id="cb253-18"><a href="#cb253-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 CROZET</span></span>
<span id="cb253-19"><a href="#cb253-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 CROZET</span></span>
<span id="cb253-20"><a href="#cb253-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 CROZET</span></span></code></pre></div>
</div>
<div id="tapply" class="section level3" number="18.1.4">
<h3 number="18.1.4"><span class="header-section-number">18.1.4</span> <code>tapply()</code></h3>
<p><code>tapply()</code> can be very handy when you need it. First, we’ve alluded to the definition before in subsection @ref(data-frames-in-r), but a <strong>ragged array</strong> is a collection of arrays that all have potentially different lengths. I don’t typically construct such an object and then pass it to <code>tapply()</code>. Rather, I let <code>tapply()</code> construct the ragged array for me. The first argument it expects is “typically vector-like,” while the second tells us how to break that <code>vector</code> into chunks. The third argument is a function that gets applied to each <code>vector</code> chunk.</p>
<p>If I wanted the average home price for each city, I could use something like this.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(albRealEstate)</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   YearBuilt YearRemodeled Condition NumStories FinSqFt Bedroom FullBath HalfBath TotalRooms LotSize TotalValue</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      2006             0   Average       1.00    1922       3        3        0         10   5.000     409900</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      2003             0   Average       1.00    1848       3        2        0          7  61.189     523100</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      1972             0   Average       1.00    1248       2        1        0          4   1.760     180900</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      1998             0      Good       1.00    1244       1        1        0          3  50.648     620700</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      1886             0   Average       1.86    1861       4        1        0          6   3.880     162500</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      1910             0      Fair       1.53    1108       3        1        0          6   8.838     167200</span></span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="do">##          City</span></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      CROZET</span></span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      CROZET</span></span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 EARLYSVILLE</span></span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      CROZET</span></span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      CROZET</span></span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      CROZET</span></span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(albRealEstate<span class="sc">$</span>City)</span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;CROZET&quot;          &quot;EARLYSVILLE&quot;     &quot;CHARLOTTESVILLE&quot; &quot;SCOTTSVILLE&quot;     &quot;NORTH GARDEN&quot;    &quot;KESWICK&quot;</span></span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(albRealEstate<span class="sc">$</span>TotalValue, <span class="fu">list</span>(albRealEstate<span class="sc">$</span>City), mean)</span>
<span id="cb254-19"><a href="#cb254-19" aria-hidden="true" tabindex="-1"></a><span class="do">## CHARLOTTESVILLE          CROZET     EARLYSVILLE         KESWICK    NORTH GARDEN     SCOTTSVILLE </span></span>
<span id="cb254-20"><a href="#cb254-20" aria-hidden="true" tabindex="-1"></a><span class="do">##        381933.0        380425.7        439141.0        540532.6        366597.8        268407.4</span></span></code></pre></div>
<p>You might be wondering why we put <code>albRealEstate$City</code> into a <code>list</code>. That seems kind of unnecessary. This is because <code>tapply()</code> can be used with multiple <code>factor</code>s–this will break down the <code>vector</code> input into a finer partition. The second argument must be one object, though, so all of these <code>factor</code>s must be collected into a <code>list</code>. The following code produces a “pivot table.”</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(albRealEstate<span class="sc">$</span>TotalValue, <span class="fu">list</span>(albRealEstate<span class="sc">$</span>City, albRealEstate<span class="sc">$</span>Condition), mean)</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                  Average Excellent     Fair     Good      Poor Substandard</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="do">## CHARLOTTESVILLE 337913.4  491702.4 229336.2 444325.5 202420.00      457500</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="do">## CROZET          342133.4  552081.6 198009.5 390657.7 203806.25       53450</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="do">## EARLYSVILLE     365990.6  652387.4 230646.2 470554.7 372442.86      160400</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="do">## KESWICK         392998.6  871719.8 172790.9 672510.7 100337.50          NA</span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="do">## NORTH GARDEN    241187.7  966528.6 131997.0 440503.1 151187.50          NA</span></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a><span class="do">## SCOTTSVILLE     214046.9  502273.8 157438.0 374600.4  95377.78          NA</span></span></code></pre></div>
<div class="rmd-details">
<p>For functions that return higher-dimensional output, you will have to use something like <code>by()</code> or <code>aggregate()</code> in place of <code>tapply()</code>.</p>
</div>
</div>
<div id="mapply" class="section level3" number="18.1.5">
<h3 number="18.1.5"><span class="header-section-number">18.1.5</span> <code>mapply()</code></h3>
<p>The <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/mapply.html">documentation of <code>mapply()</code></a> states <code>mapply()</code> is a multivariate version of <code>sapply()</code>. <code>sapply()</code> worked with univariate functions; the function was called multiple times, but each time with a single argument. If you have a function that takes multiple arguments, and you want those arguments to change each time the function is called, then you might be able to use <code>mapply()</code>.</p>
<p>Here is a short example. Regarding the <code>n=</code> argument of <code>rnorm()</code>, the documentation explains, “[i]f <code>length(n) &gt; 1</code>, the length is taken to be the number required.” This would be a problem if we want to sample a.) three times from a mean <span class="math inline">\(0\)</span> normal, b.) twice from a mean <span class="math inline">\(100\)</span> normal, and c.) once from a mean <span class="math inline">\(-100\)</span> normal distribution.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="sc">-</span><span class="dv">100</span>), <span class="at">sd =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">01</span>, .<span class="dv">01</span>))</span></code></pre></div>
<pre><code>## [1]   0.01435773  99.99238144 -99.98256452</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(rnorm, <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="sc">-</span><span class="dv">100</span>), <span class="at">sd =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">01</span>, .<span class="dv">01</span>))</span></code></pre></div>
<pre><code>## [[1]]
## [1] -0.0122999207 -0.0064744814 -0.0002297629
## 
## [[2]]
## [1] 100.02077  99.99853
## 
## [[3]]
## [1] -100.003</code></pre>
</div>
<div id="reduce-and-do.call" class="section level3" number="18.1.6">
<h3 number="18.1.6"><span class="header-section-number">18.1.6</span> <code>Reduce()</code> and <code>do.call()</code></h3>
<p>In section @ref(reshaping-and-combining-data-sets) we talked about several different ways of “combining” data sets. We discussed stacking data sets on top of one another with <code>rbind()</code> (c.f. subsection @ref(stacking-data-sets-and-placing-them-shoulder-to-shoulder)), stacking them side-by-side with <code>cbind()</code> (also in @ref(stacking-data-sets-and-placing-them-shoulder-to-shoulder)), and intelligently joining them together with <code>merge()</code> (c.f. @ref(merging-or-joining-data-sets)). Consider the task of combining <em>many</em> data sets. How do we write DRY code and abide by the DRY principle?</p>
<p>We can use either <code>Reduce()</code> or <code>do.call()</code> as a higher-order function. Just like the aforementioned <code>*apply()</code> functions, they take in either <code>cbind()</code>, <code>rbind()</code>, or <code>merge()</code> as a function input. Which one do we pick, though? The answer to that question deals with how many arguments our lower-order functions take.</p>
<p>Take a look at the documentation to <code>rbind()</code>. Its first argument is <code>...</code>, which is the <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Dot_002ddot_002ddot">dot-dot-dot</a> symbol. This means <code>rbind()</code> can take a varying number of <code>data.frame</code>s to stack on top of each other. In other words, <code>rbind()</code> is <em>variadic</em>.</p>
<p>On the other hand, take a look at the documentation of <code>merge()</code>. It only takes two <code>data.frame</code>s at a time<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>.</p>
<p>If we want to combine many data sets, <code>merge()</code> This is the difference between <code>Reduce()</code> and <code>do.call()</code>.</p>
<p><code>do.call()</code> calls a function once on many arguments, so its function must be able to handle many arguments. On the other hand, <code>Reduce()</code> calls a binary function many times on pairs of arguments. <code>Reduce()</code>’s function argument gets called on the first two elements, then on the first output and the third element, then on the second output and fourth element, and so on.</p>
<p>TODO diagram</p>
<p>Here is an initial example that makes use of four data sets <code>d1.csv</code>, <code>d2.csv</code>, <code>d3.csv</code>, and <code>d4.csv</code>. To start, ask yourself how we would read all of these in. There is a temptation to copy and paste <code>read.csv</code> calls, but that would violate the DRY principle. Instead, let’s use <code>lapply()</code> an anonymous function that constructs a file path string, and then uses it to read in the data set the string refers to.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>numDataSets <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>dataSets <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;d&quot;</span>,<span class="dv">1</span><span class="sc">:</span>numDataSets)</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>dfs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dataSets, </span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>              <span class="cf">function</span>(name) <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">&quot;data/&quot;</span>, name, <span class="st">&quot;.csv&quot;</span>)))</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dfs[[<span class="dv">3</span>]])</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   id obs3</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  a    7</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  b    8</span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  c    9</span></span></code></pre></div>
<p>Notice how the above code would only need to be changed by one character if we wanted to increase the number of data sets being read in!</p>
<p>Next, <code>cbind()</code>ing them all together can be done as follows. <code>do.call()</code> will call the function only once. <code>cbind()</code> takes many arguments at once, so this works.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(cbind, dfs) <span class="co"># DRY! :)</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   id obs1 id obs2 id obs3 id obs4</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  a    1  b    5  a    7  a   10</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  b    2  a    4  b    8  b   11</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  c    3  c    6  c    9  c   12</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind(df1,df2,df3,df4) # WET! :(</span></span></code></pre></div>
<p>This code is even better than the above code in that if <code>dfs</code> becomes longer, or changes at all, <em>nothing</em> will need to be changed.</p>
<p>What if we wanted to <code>merge()</code> all these data sets together? After all, the <code>id</code> column appears to be repeating itself, and some data from <code>d2</code> isn’t lining up.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(merge, dfs)</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   id obs1 obs2 obs3 obs4</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  a    1    4    7   10</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  b    2    5    8   11</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  c    3    6    9   12</span></span></code></pre></div>
<p>Again, this is very DRY code. Nothing would need to be changed if <code>dfs</code> grew. Furthermore, trying to <code>do.call()</code> the <code>merge()</code> function wouldn’t work because it can only take two data sets at a time.</p>
</div>
</div>
<div id="another-example-in-r" class="section level2" number="18.2">
<h2 number="18.2"><span class="header-section-number">18.2</span> Another Example in R</h2>
<p>Consider another common example: plotting scalar-valued multivariate functions. Let’s try to plot a bivariate Gaussian distribution.</p>
<p><span class="math display">\[
f(x,y) = \frac{1}{2 \pi}  \exp\left[ -\frac{x ^2 + y^2}{2}     \right]
\]</span>
The random elements <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, in this particular case, are uncorrelated, each have unit variance, and zero mean. This density is a surface in 3-d dimensional space. To visualize this, we would need to</p>
<ol style="list-style-type: decimal">
<li>generate a “grid” of points in <span class="math inline">\(\mathbb{R}^2\)</span>,</li>
<li>evaluate our function on each point, and then</li>
<li>call some plotting function that takes this all and makes a pretty picture.</li>
</ol>
<p>There are a couple ways you could write this function. One way might take two arguments, and another might take one argument. If we are to use <code>mapply()</code>, we need the function to take two arguments.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>fTwoArgs <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y){</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5</span><span class="sc">*</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">/</span> pi</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can construct every possible point on a grid with the <code>expand.grid()</code> function.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>xGrid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,.<span class="dv">1</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>yGrid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,.<span class="dv">1</span>)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(xGrid, yGrid)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grid)</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Var1 Var2</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -3.0   -3</span></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 -2.9   -3</span></span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 -2.8   -3</span></span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 -2.7   -3</span></span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 -2.6   -3</span></span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 -2.5   -3</span></span></code></pre></div>
<p><code>mapply()</code> would take <code>fTwoArgs=</code>, and effectively call it on every row pair. The pairs do not need to be organized in a <code>data.frame</code>, though.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>funcOut1 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(fTwoArgs, grid[,<span class="dv">1</span>], grid[,<span class="dv">2</span>])</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(funcOut1)</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.964128e-05 2.638072e-05 3.508008e-05 4.618400e-05 6.019766e-05 7.768277e-05</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>rectangularOutput <span class="ot">&lt;-</span> <span class="fu">matrix</span>(funcOut1, <span class="at">ncol =</span> <span class="fu">length</span>(xGrid))</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(xGrid, yGrid, rectangularOutput, </span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlab =</span> <span class="st">&quot;f(x,y)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-263-1.png" width="672" /></p>
<p>If you prefer using <code>apply()</code>, that is also possible, but you would need to rewrite the function to take one (length-two) argument.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>fOneArg <span class="ot">&lt;-</span> <span class="cf">function</span>(vec){</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">sum</span>(vec<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span><span class="sc">/</span>pi</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>funcOut2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(grid, <span class="dv">1</span>, fOneArg)</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>moreRectOut <span class="ot">&lt;-</span> <span class="fu">matrix</span>(funcOut2, <span class="at">ncol =</span> <span class="fu">length</span>(xGrid))</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(xGrid, yGrid, moreRectOut, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-264-1.png" width="672" /></p>
</div>
<div id="functions-as-function-inputs-in-base-python" class="section level2" number="18.3">
<h2 number="18.3"><span class="header-section-number">18.3</span> Functions as Function Inputs in Base Python</h2>
<p>I discuss two functions from base Python that take functions as input. Neither return a <code>list</code> or a <code>np.array</code>, but they do return different kinds of <strong>iterables</strong>, which are “objects capable of returning their members one at a time,” <a href="https://docs.python.org/3/glossary.html">according to the Python documentation.</a> <code>map()</code>, the function, will return objects of type <code>map</code>. <code>filter()</code>, the function, will return objects of type <code>filter</code>. Often times we will just convert these to the container we are more familiar with.</p>
<div id="map" class="section level3" number="18.3.1">
<h3 number="18.3.1"><span class="header-section-number">18.3.1</span> <code>map()</code></h3>
<p><a href="https://docs.python.org/3/library/functions.html#map"><code>map()</code></a> can call a function repeatedly using elements of a container as inputs. Here is an example of calculating outputs of a <em>spline</em> function, which can be useful for coming up with predictors in regression models. This particular spline function is <span class="math inline">\(f(x) = (x-k)1(x \ge k)\)</span>, where <span class="math inline">\(k\)</span> is some chosen “knot point.”</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>my_inputs <span class="op">=</span> np.linspace(start <span class="op">=</span> <span class="dv">0</span>, stop <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> spline(x):</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>    knot <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;=</span> knot:</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x<span class="op">-</span>knot</span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(spline, my_inputs))</span></code></pre></div>
<p>We can visualize the mathematical function by plotting its outputs against its inputs. More information on visualization was given in subsection @ref(visualization).</p>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-266-1.png" width="70%" /></p>
<p><code>map()</code> can also be used like <code>mapply()</code>. In other words, you can apply it to two containers,</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(start <span class="op">=</span> <span class="op">-</span><span class="fl">1.</span>, stop <span class="op">=</span> <span class="fl">1.0</span>)</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(start <span class="op">=</span> <span class="op">-</span><span class="fl">1.</span>, stop <span class="op">=</span> <span class="fl">1.0</span>)</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>    np.log(x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(spline, my_inputs))</span></code></pre></div>
</div>
<div id="filter" class="section level3" number="18.3.2">
<h3 number="18.3.2"><span class="header-section-number">18.3.2</span> <code>filter()</code></h3>
<p><a href="https://docs.python.org/3/library/functions.html#filter"><code>filter()</code></a> helps remove unwanted elements from a container. It returns an iterable of type <code>filter</code>, which we can iterate over or convert to a more familiar type of container. In this example, I iterate over it without converting it.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> np.arange(<span class="dv">0</span>,<span class="fl">1.5</span>,<span class="fl">.01</span>)</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> elem <span class="kw">in</span> <span class="bu">filter</span>(<span class="kw">lambda</span> x : x<span class="op">**</span><span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">2</span>, raw_data):</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(elem)</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.42</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.43</span></span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.44</span></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.45</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.46</span></span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.47</span></span>
<span id="cb269-10"><a href="#cb269-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.48</span></span>
<span id="cb269-11"><a href="#cb269-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 1.49</span></span></code></pre></div>
</div>
</div>
<div id="functions-as-function-inputs-in-numpy" class="section level2" number="18.4">
<h2 number="18.4"><span class="header-section-number">18.4</span> Functions as Function Inputs in Numpy</h2>
<p>Numpy provides a <a href="https://numpy.org/doc/stable/reference/routines.functional.html">number of functions</a> that facilitate working with <code>np.ndarray</code>s in a functional style. For example, <a href="https://numpy.org/doc/stable/reference/generated/numpy.apply_along_axis.html"><code>np.apply_along_axis()</code></a> is similar to R’s <code>apply()</code>. <code>apply()</code> had a <code>MARGIN=</code> input (<code>1</code> sums rows, <code>2</code> sums columns), whereas this function has a <code>axis=</code> input (<code>0</code> sums columns, <code>1</code> sums rows).</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>my_array <span class="op">=</span> np.arange(<span class="dv">6</span>).reshape((<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>my_array</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="co">## array([[0, 1, 2],</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="co">##        [3, 4, 5]])</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>np.apply_along_axis(<span class="bu">sum</span>, <span class="dv">0</span>, my_array) <span class="co"># summing columns</span></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a><span class="co">## array([3, 5, 7])</span></span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>np.apply_along_axis(<span class="bu">sum</span>, <span class="dv">1</span>, my_array) <span class="co"># summing rows</span></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a><span class="co">## array([ 3, 12])</span></span></code></pre></div>
<div class="sourceCode" id="cb271"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>my_array <span class="op">=</span> np.random.normal(size<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">1000</span>))</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>np.apply_along_axis(<span class="bu">sum</span>, <span class="dv">0</span>, my_array).shape </span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="co">## (1000,)</span></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>np.apply_along_axis(<span class="bu">sum</span>, <span class="dv">1</span>, my_array).shape</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="co">## (10,)</span></span></code></pre></div>
</div>
<div id="functional-methods-in-pandas" class="section level2" number="18.5">
<h2 number="18.5"><span class="header-section-number">18.5</span> Functional Methods in Pandas</h2>
<p>Pandas’ <code>DataFrame</code>s have an <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html"><code>.apply()</code> method</a> that is very similar to <code>apply()</code> in R,<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a> but again, just like the above function, you have to think about an <code>axis=</code> argument instead of a <code>MARGIN=</code> argument.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>alb_real_est <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/albemarle_real_estate.csv&quot;</span>)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>alb_real_est.shape</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="co">## (27943, 12)</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>alb_real_est.<span class="bu">apply</span>(<span class="bu">len</span>, axis<span class="op">=</span><span class="dv">0</span>) <span class="co"># length of columns</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="co">## YearBuilt        27943</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="co">## YearRemodeled    27943</span></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Condition        27943</span></span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a><span class="co">## NumStories       27943</span></span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a><span class="co">## FinSqFt          27943</span></span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Bedroom          27943</span></span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a><span class="co">## FullBath         27943</span></span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a><span class="co">## HalfBath         27943</span></span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a><span class="co">## TotalRooms       27943</span></span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a><span class="co">## LotSize          27943</span></span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a><span class="co">## TotalValue       27943</span></span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a><span class="co">## City             27943</span></span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(alb_real_est.<span class="bu">apply</span>(<span class="bu">len</span>, axis<span class="op">=</span><span class="dv">1</span>)) <span class="co"># length of rows</span></span>
<span id="cb272-20"><a href="#cb272-20" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;class &#39;pandas.core.series.Series&#39;&gt;</span></span></code></pre></div>
<p>Another thing to keep in mind is that <code>DataFrame</code>s, unlike <code>ndarray</code>s, don’t have to have the same type for all elements. If you have mixed column types, then summing rows, for instance, might not make sense. This just requires subsetting columns before <code>.apply()</code>ing a function to rows. Here is an example of computing each property’s “score.”</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="co"># alb_real_est.apply(sum, axis=1) # can&#39;t add letters to numbers!</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_prop_score(row):</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">2</span><span class="op">*</span>row[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>row[<span class="dv">1</span>]</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>alb_real_est[<span class="st">&#39;Score&#39;</span>] <span class="op">=</span> alb_real_est[[<span class="st">&#39;FinSqFt&#39;</span>,<span class="st">&#39;LotSize&#39;</span>]].<span class="bu">apply</span>(get_prop_score, <span class="dv">1</span>)</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>alb_real_est[[<span class="st">&#39;FinSqFt&#39;</span>,<span class="st">&#39;LotSize&#39;</span>,<span class="st">&#39;Score&#39;</span>]].head(<span class="dv">2</span>)</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a><span class="co">##    FinSqFt  LotSize     Score</span></span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 0     1922    5.000  3859.000</span></span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     1848   61.189  3879.567</span></span></code></pre></div>
<p><code>.apply()</code> also works with more than one function at a time.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>alb_real_est[[<span class="st">&#39;FinSqFt&#39;</span>,<span class="st">&#39;LotSize&#39;</span>]].<span class="bu">apply</span>([<span class="bu">sum</span>, <span class="bu">len</span>])</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="co">##       FinSqFt     LotSize</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="co">## sum  55559801  97856.8384</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="co">## len     27943  27943.0000</span></span></code></pre></div>
<p>If you do not want to waste two lines defining a function with <code>def</code>, you can use an anonymous (unnamed) <a href="https://docs.python.org/3/tutorial/controlflow.html#lambda-expressions"><strong>lambda function</strong></a>. Be careful, though–if your function is complex enough, then your lines will get quite wide. For instance, this example is pushing it.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>alb_real_est[[<span class="st">&#39;FinSqFt&#39;</span>,<span class="st">&#39;LotSize&#39;</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> row : <span class="bu">sum</span>(row<span class="op">*</span>[<span class="dv">2</span>,<span class="dv">3</span>]), <span class="dv">1</span>)[:<span class="dv">4</span>]</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    3859.000</span></span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    3879.567</span></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    2501.280</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    2639.944</span></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span></code></pre></div>
<p>If you want to apply a (scalar-valued) function that takes only individual elements, you should try to use a unary function (recall that this was discussed in TODO). If no such unary function exists, you can apply it with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.applymap.html#pandas.DataFrame.applymap"><code>.applymap()</code></a>.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>alb_real_est[[<span class="st">&#39;FinSqFt&#39;</span>,<span class="st">&#39;LotSize&#39;</span>]].applymap(<span class="kw">lambda</span> e : e <span class="op">+</span> <span class="dv">1</span>).head(<span class="dv">2</span>)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="co">##    FinSqFt  LotSize</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 0     1923    6.000</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     1849   62.189</span></span></code></pre></div>
<p>Last, we have a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code>.groupby()</code></a> method, which can be used to mirror the behavior of R’s <code>tapply()</code>, <code>aggregate()</code> or <code>by()</code>. It can take the <code>DataFrame</code> it belongs to, and group its rows into multiple sub-<code>DataFrame</code>s. The collection of sub-<code>DataFrames</code> has a lot of the same methods that an individual <code>DataFrame</code> has (e.g. the subsetting operators, and the <code>.apply()</code> method), which can all be used in a second step of calculating things on each sub-<code>DataFrame</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(alb_real_est.groupby([<span class="st">&#39;City&#39;</span>]))</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="co">## pandas.core.groupby.generic.DataFrameGroupBy</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(alb_real_est.groupby([<span class="st">&#39;City&#39;</span>])[<span class="st">&#39;TotalValue&#39;</span>])</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="co">## pandas.core.groupby.generic.SeriesGroupBy</span></span></code></pre></div>
<p>Here is an example that models some pretty typical functionality. It shows two ways to get the average home price by city. The first line groups the rows by which <code>City</code> they are in, extracts the <code>TotalValue</code> column in each sub-<code>DataFrame</code>, and then <code>.apply()</code>s the <code>np.average()</code> function on the sole column found in each sub-<code>DataFrame</code>. The second <code>.apply()</code>s a lambda function to each sub-<code>DataFrame</code> directly.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>alb_real_est.groupby([<span class="st">&#39;City&#39;</span>])[<span class="st">&#39;TotalValue&#39;</span>].<span class="bu">apply</span>(np.average)</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="co">## City</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="co">## CHARLOTTESVILLE    381932.962760</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="co">## CROZET             380425.678927</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="co">## EARLYSVILLE        439140.987124</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a><span class="co">## KESWICK            540532.605905</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co">## NORTH GARDEN       366597.750865</span></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="co">## SCOTTSVILLE        268407.384615</span></span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Name: TotalValue, dtype: float64</span></span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>alb_real_est.groupby([<span class="st">&#39;City&#39;</span>]).<span class="bu">apply</span>(<span class="kw">lambda</span> df : np.average(df[<span class="st">&#39;TotalValue&#39;</span>]))</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a><span class="co">## City</span></span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a><span class="co">## CHARLOTTESVILLE    381932.962760</span></span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a><span class="co">## CROZET             380425.678927</span></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a><span class="co">## EARLYSVILLE        439140.987124</span></span>
<span id="cb278-15"><a href="#cb278-15" aria-hidden="true" tabindex="-1"></a><span class="co">## KESWICK            540532.605905</span></span>
<span id="cb278-16"><a href="#cb278-16" aria-hidden="true" tabindex="-1"></a><span class="co">## NORTH GARDEN       366597.750865</span></span>
<span id="cb278-17"><a href="#cb278-17" aria-hidden="true" tabindex="-1"></a><span class="co">## SCOTTSVILLE        268407.384615</span></span>
<span id="cb278-18"><a href="#cb278-18" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span></code></pre></div>
<p>More tips on this programming pattern can be found <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html">here</a>.</p>
</div>
<div id="functions-as-function-inputs-miscellany" class="section level2" number="18.6">
<h2 number="18.6"><span class="header-section-number">18.6</span> Functions as Function Inputs (miscellany)</h2>
<p>functools.reduce</p>
<p>operator module</p>
</div>
<div id="functions-as-function-outputs-in-r" class="section level2" number="18.7">
<h2 number="18.7"><span class="header-section-number">18.7</span> Functions as Function Outputs in R</h2>
<p>Functions that create and return other functions are sometimes called <strong>function factories.</strong> Functions are first-class objects in R, so it’s easy to return them. What’s more interesting is that supposedly temporary objects inside the outer function can be accessed during the call of the inner function after it’s returned.</p>
<p>Here is a first quick example.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>funcFactory <span class="ot">&lt;-</span> <span class="cf">function</span>(greetingMessage){</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(name){</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(greetingMessage, name)</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>greetWithHello <span class="ot">&lt;-</span> <span class="fu">funcFactory</span>(<span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="fu">greetWithHello</span>(<span class="st">&quot;Taylor&quot;</span>)</span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Hello Taylor&quot;</span></span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a><span class="fu">greetWithHello</span>(<span class="st">&quot;Charlie&quot;</span>)</span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Hello Charlie&quot;</span></span></code></pre></div>
<p>The <code>greetingMessage=</code> argument that is passed in, <code>"Hello"</code>, isn’t temporary anymore.</p>
<p>Here is an example that implements a variance reduction technique called <strong>common random numbers</strong>.</p>
<p>Suppose <span class="math inline">\(X \sim \text{Normal}(\mu, \sigma^2)\)</span>, and we are interested in approximating an expectation of a function of this random variable. Suppose that we don’t know that
<span class="math display">\[
\mathbb{E}[\sin(X)] = \sin(\mu) \exp\left(-\frac{\sigma^2}{2}\right)
\]</span>
for any particular choice of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>, and instead, we choose to use the Monte Carlo method:
<span class="math display">\[
\hat{\mathbb{E}}[\sin(X)] = \frac{1}{n}\sum_{i=1}^n\sin(X^i)
\]</span>
where <span class="math inline">\(X^1, \ldots, X^n \overset{\text{iid}}{\sim} \text{Normal}(\mu, \sigma^2)\)</span> is a large collection of draws from the appropriate normal distribution. In real life, the theoretical expectation might not be tractable (either because the random variable has a complicated distribution, or maybe because the functional is very complicated) and Monte Carlo, or some other approximation algorithm, might be our only hope!</p>
<p>Here are two functions that calculate the above quantities for <span class="math inline">\(n=100\)</span>. <code>actualExpectSin()</code> is a function that computes the theoretical expectation for any particular parameter pair. <code>monteCarloSin()</code> is a function that implements the Monte Carlo approximate expectation.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># don&#39;t hardcode variables that aren&#39;t passed as arguments!</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>actualExpectSin <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(params[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="co"># second parameter is sigma</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>(params[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5</span><span class="sc">*</span>(params[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>monteCarloSin <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(params[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">sin</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> params[<span class="dv">1</span>], <span class="at">sd =</span> params[<span class="dv">2</span>])))</span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a><span class="co"># monteCarloSin(c(10,1))</span></span></code></pre></div>
<p>One-off approximations aren’t as interesting as visualizing many expectations for many parameter inputs. On the left, we have the true expectation function plotted with a contour plot. On the right,</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>muGrid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>sigmaGrid <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">001</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>muSigmaGrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(muGrid, sigmaGrid)</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>actuals <span class="ot">&lt;-</span>  <span class="fu">matrix</span>(<span class="fu">apply</span>(muSigmaGrid, <span class="dv">1</span>, actualExpectSin), <span class="at">ncol =</span> <span class="fu">length</span>(muGrid))</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>mcApprox <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">apply</span>(muSigmaGrid, <span class="dv">1</span>, monteCarloSin), <span class="at">ncol =</span> <span class="fu">length</span>(muGrid))</span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(muGrid, sigmaGrid, actuals, <span class="at">xlab =</span> <span class="st">&quot;mu&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;sigma&quot;</span>, <span class="at">main =</span> <span class="st">&quot;actual expect.s&quot;</span>)</span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(muGrid, sigmaGrid, mcApprox, <span class="at">xlab =</span> <span class="st">&quot;mu&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;sigma&quot;</span>, <span class="at">main =</span> <span class="st">&quot;mc without crn&quot;</span>)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-280-1.png" width="672" /></p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>If we wanted to use common random numbers, we could generate <span class="math inline">\(Z^1, \ldots, Z^n \overset{\text{iid}}{\sim} \text{Normal}(0, 1)\)</span>, and use the fact that
<span class="math display">\[
X^i = \mu + \sigma Z^i
\]</span>
This leads to the Monte Carlo estimate
<span class="math display">\[
\tilde{\mathbb{E}}[\sin(X)] = \frac{1}{n}\sum_{i=1}^n\sin(\mu + \sigma Z^i)
\]</span>
Here is one function that naively implements Monte Carlo with common random numbers. We generate the collection of standard normal random variables once, globally. Each time you call <code>monteCarloSinCRNv1(c(10,1))</code>, you get the same answer.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>commonZs <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n)</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>monteCarloSinCRNv1 <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(params[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">sin</span>(params[<span class="dv">1</span>] <span class="sc">+</span> params[<span class="dv">2</span>]<span class="sc">*</span>commonZs))</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a><span class="co"># monteCarloSinCRNv1(c(10,1))</span></span></code></pre></div>
<p>Let’s compare using common random numbers to going without. As you can see, common random numbers make the plot look “smoother.”</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>mcApproxCRNv1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">apply</span>(muSigmaGrid, <span class="dv">1</span>, monteCarloSinCRNv1), <span class="at">ncol =</span> <span class="fu">length</span>(muGrid))</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(muGrid, sigmaGrid, mcApprox, <span class="at">xlab =</span> <span class="st">&quot;mu&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;sigma&quot;</span>, <span class="at">main =</span> <span class="st">&quot;mc without crn&quot;</span>)</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(muGrid, sigmaGrid, mcApproxCRNv1, <span class="at">xlab =</span> <span class="st">&quot;mu&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;sigma&quot;</span>, <span class="at">main =</span> <span class="st">&quot;mc with crn&quot;</span>)</span></code></pre></div>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-282-1.png" width="672" /></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>The downside to this implementation is that we have a bunch of samples floating around in the global environment. We can implement this much more nicely with a function factory.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>makeMCFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>  commonZs <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n)</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(params){</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(params[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">sin</span>(params[<span class="dv">1</span>] <span class="sc">+</span> params[<span class="dv">2</span>]<span class="sc">*</span>commonZs))    </span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb286-8"><a href="#cb286-8" aria-hidden="true" tabindex="-1"></a>monteCarloSinCRNv2 <span class="ot">&lt;-</span> <span class="fu">makeMCFunc</span>()</span>
<span id="cb286-9"><a href="#cb286-9" aria-hidden="true" tabindex="-1"></a><span class="co"># monteCarloSinCRNv2(c(10,1))</span></span></code></pre></div>
<p>Much better! Let’s just make sure this function works by comparing its output to the known true function.</p>
<p><img src="r_and_python_book_files/figure-html/unnamed-chunk-284-1.png" width="672" /></p>
</div>
<div id="functions-as-function-outputs-in-python" class="section level2" number="18.8">
<h2 number="18.8"><span class="header-section-number">18.8</span> Functions as Function Outputs in Python</h2>
<p>Returning functions from functions, explaining mechanics</p>
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.vectorize.html#numpy.vectorize"><code>np.vectorize()</code></a> is something that I use quite often.</p>
<p>decorators!</p>
<p>TODO Both R and Python have reduce functions. R has <code>Reduce()</code>, while Python has <code>reduce()</code>.</p>
<p>In R</p>
<p>reduce,</p>
<!-- ### Exercises -->
<!-- 1.  Let $X_t$ be the price of a stock at time $t$. A *call (or put) option* is a type of derivative contract you can buy or sell. It's called a derivative because its value derives from the value of a stock. A single call contract (or put) gives the owner the right to buy (or sell) stock ($100$ shares) at a certain price. This certain price written into an options contract ($s$) is called the *strike price*. The day the option expires    is called the *expiration date*. If a holder of the option uses his/her right to buy or sell the underlying stock, he/she is said to have *exercised* the option. -->
<!-- The price and value of options floats around randomly through time just like a stock does. Part of the value of an option is its *intrinsic value*. It is not the same as the overall value of an option, or its "fair price"--rather, the intrinsic value represents how much money its possible to guarantee at the current moment, if you exercised the option, and then liquidated the resulting position in the underlying. -->
<!-- For example, call owners hope the stock rises above the strike price so that they can buy the stock for a low price, and immediately sell it for a high price. If $X_t > s$, they could buy at $s$, and sell at $X_t$. In other words, the intrinsic value of a call option is  -->
<!-- $$ -->
<!-- C^s_t = 100 \times \max(X_t - s, 0) -->
<!-- $$ -->
<!-- as long as $t$ is before the expiration date. If $X_t < s$, then the owner doesn't have to buy the stock, so the call at that time is intrinsically worthless.  -->
<!-- Put owners hope the stock price falls below the strike price, because a put's intrinsic value is -->
<!-- $$ -->
<!-- P^s_t = 100 \times \max(s - X_t, 0) -->
<!-- $$ -->
<!-- Sometimes people buy and sell multiple contracts (with the same expiration date) at the same time. If they do, the intrinsic value of the entire position is additive. For example, if you bought two of the same put option as the one above, then you just double the above expression to get the intrinsic value. -->
<!-- As another example, if you buy (you can also sell) a *call spread*, you buy one call, and then sell another call with the same expiration and a higher strike price. Assuming $s_1 < s_2$ the intrinsic value is of the call spread with strikes $s_1$ and $s_2$ is -->
<!-- $$ -->
<!-- 100 \times \max(X_t - s_1, 0) - 100\times\max(X_t - s_2, 0) -->
<!-- $$ -->
<!-- a. In R, write a function called `getIntrinsicValueFunc` that takes three vectors as arguments, (`dirs`, `strikes`, `contractType`, `numContracts`), and returns a function. These arguments should all be the same length. The length of these inputs is the number of contracts in an options position. The function that `getIntrinsicValueFunc` returns should only take one argument: `prices`, a vector of prices of the underlying stock. The function that `getIntrinsicValueFunc` should return a vector of intrinsic values over time.  -->
<!-- Because the arguments may only take on certain values, and because the function to be returned has a certain signature, a template has been provided below.  -->
<!-- ```{r, eval=F} -->
<!-- getIntrinsicValueFunc <-function(dirs, strikes, contractType, numContracts){ -->
<!--   stopifnot(all(dirs %in% c("buy", "sell"))) -->
<!--   stopifnot(all(contractType %in% c("call", "put"))) -->
<!--   stopifnot(all(is.integer(strikes))) -->
<!--   stopifnot(all(is.integer(numContracts))) -->
<!--   stopifnot( (length(dirs) == length(strikes)) && (length(dirs) == length(contractType))) -->
<!--   usefulFunc <- function(prices){ -->
<!--     # TODO -->
<!--   } -->
<!--   return(usefulFunc) -->
<!-- }  -->
<!-- ``` -->
<!-- b. Create an intrinsic value plot. The x-axis should be a grid of values: let's say from $100$ to $200$. On the y-axis plot the intrinsic value of buying a call spread with strikes $110$ and $120$.  -->
<!-- c. Do the same thing as above but show what happens when you sell the same call spread.  -->
<!-- d. Plot the intrinsic value of a bought put spread with strikes $110$ and $120$.  -->
<!-- e. Plot the intrinsic value of a sold put spread with strikes $110$ and $120$. What is the difference between all four plots? -->
<!-- 2. Do the same thing, but in Python! -->
<!-- creating row masks in a data frame -->
<!-- .apply with weird predicate function -->
<!-- Optimization example  -->
<!-- Importance sampling example -->
<!-- bootstrap -->
<!-- numerical integration -->
<!-- 3. verbal, open-ended wuestion about what happens when you make a typo in a variable name? R versus Python? -->
<!-- 4. try to think of the most complicated program that uses two functions that both use (and modify) globals -->
<!--chapter:end:18-FP.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-struc_and_interp" class="csl-entry">
Abelson, Harold, and Gerald J. Sussman. 1996. <em>Structure and Interpretation of Computer Programs</em>. 2nd ed. Cambridge, MA, USA: MIT Press.
</div>
<div id="ref-misc_adult_2" class="csl-entry">
<span>“<span>Adult</span>.”</span> 1996. UCI Machine Learning Repository.
</div>
<div id="ref-gradeR" class="csl-entry">
Brown, Taylor. 2020. <em>gradeR: Helps Grade Assignment Submissions That Are r Scripts</em>. <a href="https://CRAN.R-project.org/package=gradeR">https://CRAN.R-project.org/package=gradeR</a>.
</div>
<div id="ref-cpm" class="csl-entry">
———. 2021. <em>cPseudoMaRg: Constructs a Correlated Pseudo-Marginal Sampler</em>. <a href="https://CRAN.R-project.org/package=cPseudoMaRg">https://CRAN.R-project.org/package=cPseudoMaRg</a>.
</div>
<div id="ref-misc_car_evaluation_19" class="csl-entry">
<span>“<span>Car Evaluation</span>.”</span> 1997. UCI Machine Learning Repository.
</div>
<div id="ref-horseshoe" class="csl-entry">
Carvalho, Carlos M., Nicholas G. Polson, and James G. Scott. 2009. <span>“Handling Sparsity via the Horseshoe.”</span> In <em>Proceedings of the Twelth International Conference on Artificial Intelligence and Statistics</em>, edited by David van Dyk and Max Welling, 5:73–80. Proceedings of Machine Learning Research. Hilton Clearwater Beach Resort, Clearwater Beach, Florida USA: PMLR. <a href="https://proceedings.mlr.press/v5/carvalho09a.html">https://proceedings.mlr.press/v5/carvalho09a.html</a>.
</div>
<div id="ref-misc_chess" class="csl-entry">
<span>“<span class="nocase">Chess (King-Rook vs. King-Pawn)</span>.”</span> 1989. UCI Machine Learning Repository.
</div>
<div id="ref-wine_data" class="csl-entry">
Cortez, Paulo, António Cerdeira, Fernando Almeida, Telmo Matos, and José Reis. 2009. <span>“Modeling Wine Preferences by Data Mining from Physicochemical Properties.”</span> <em>Decis. Support Syst.</em> 47 (4): 547–53. <a href="http://dblp.uni-trier.de/db/journals/dss/dss47.html#CortezCAMR09">http://dblp.uni-trier.de/db/journals/dss/dss47.html#CortezCAMR09</a>.
</div>
<div id="ref-uci_data" class="csl-entry">
Dua, Dheeru, and Casey Graff. 2017. <span>“<span>UCI</span> Machine Learning Repository.”</span> University of California, Irvine, School of Information; Computer Sciences. <a href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>.
</div>
<div id="ref-bootstrap" class="csl-entry">
Efron, B. 1979. <span>“<span class="nocase">Bootstrap Methods: Another Look at the Jackknife</span>.”</span> <em>The Annals of Statistics</em> 7 (1): 1–26. <a href="https://doi.org/10.1214/aos/1176344552">https://doi.org/10.1214/aos/1176344552</a>.
</div>
<div id="ref-misc_iris_53" class="csl-entry">
Fisher, Test, R. A. &amp; Creator. 1988. <span>“<span>Iris</span>.”</span> UCI Machine Learning Repository.
</div>
<div id="ref-GelmanHill:2007" class="csl-entry">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Analytical Methods for Social Research. Cambridge University Press.
</div>
<div id="ref-gspc_data" class="csl-entry">
<span>“GSPC DATA.”</span> 2021. <a href="https://finance.yahoo.com/quote/%5EGSPC/history?p=%5EGSPC">https://finance.yahoo.com/quote/%5EGSPC/history?p=%5EGSPC</a>.
</div>
<div id="ref-woodbury" class="csl-entry">
Guttman, Louis. 1946. <span>“<span class="nocase">Enlargement Methods for Computing the Inverse Matrix</span>.”</span> <em>The Annals of Mathematical Statistics</em> 17 (3): 336–43. <a href="https://doi.org/10.1214/aoms/1177730946">https://doi.org/10.1214/aoms/1177730946</a>.
</div>
<div id="ref-hmisc" class="csl-entry">
Harrell Jr, Frank E, with contributions from Charles Dupont, and many others. 2021. <em>Hmisc: Harrell Miscellaneous</em>. <a href="https://CRAN.R-project.org/package=Hmisc">https://CRAN.R-project.org/package=Hmisc</a>.
</div>
<div id="ref-harris2020array" class="csl-entry">
Harris, Charles R., K. Jarrod Millman, Stéfan J. van der Walt, Ralf Gommers, Pauli Virtanen, David Cournapeau, Eric Wieser, et al. 2020. <span>“Array Programming with <span>NumPy</span>.”</span> <em>Nature</em> 585 (7825): 357–62. <a href="https://doi.org/10.1038/s41586-020-2649-2">https://doi.org/10.1038/s41586-020-2649-2</a>.
</div>
<div id="ref-hunt2000pragmatic" class="csl-entry">
Hunt, Andrew, and David Thomas. 2000. <em>The Pragmatic Programmer : From Journeyman to Master</em>. Boston [etc.]: Addison-Wesley. <a href="http://www.amazon.com/The-Pragmatic-Programmer-Journeyman-Master/dp/020161622X">http://www.amazon.com/The-Pragmatic-Programmer-Journeyman-Master/dp/020161622X</a>.
</div>
<div id="ref-Hunter:2007" class="csl-entry">
Hunter, J. D. 2007. <span>“Matplotlib: A 2d Graphics Environment.”</span> <em>Computing in Science &amp; Engineering</em> 9 (3): 90–95. <a href="https://doi.org/10.1109/MCSE.2007.55">https://doi.org/10.1109/MCSE.2007.55</a>.
</div>
<div id="ref-misc_heart_disease_45" class="csl-entry">
Janosi, Andras, William Steinbrunn, Matthias Pfisterer, and Robert Detrano. 1988. <span>“<span>Heart Disease</span>.”</span> UCI Machine Learning Repository.
</div>
<div id="ref-Jones72astatistical" class="csl-entry">
Jones, Karen Spärck. 1972. <span>“A Statistical Interpretation of Term Specificity and Its Application in Retrieval.”</span> <em>Journal of Documentation</em> 28: 11–21.
</div>
<div id="ref-matloff_r_book" class="csl-entry">
Matloff, Norman. 2011. <em>The Art of r Programming: A Tour of Statistical Software Design</em>. 1st ed. USA: No Starch Press.
</div>
<div id="ref-Nadaraya" class="csl-entry">
Nadaraya, E. A. 1964. <span>“On Estimating Regression.”</span> <em>Theory of Probability &amp; Its Applications</em> 9 (1): 141–42. <a href="https://doi.org/10.1137/1109020">https://doi.org/10.1137/1109020</a>.
</div>
<div id="ref-otter" class="csl-entry">
Pyles, Christopher. 2019. <span>“Otter-Grader: A Python and r Autograding Solution.”</span> UC Berkeley Data Science Education Program. <a href="https://github.com/ucbds-infra/otter-grader">https://github.com/ucbds-infra/otter-grader</a>.
</div>
<div id="ref-monte-carlo-stat-methods" class="csl-entry">
Robert, Christian P., and George Casella. 2005. <em>Monte Carlo Statistical Methods (Springer Texts in Statistics)</em>. Berlin, Heidelberg: Springer-Verlag.
</div>
<div id="ref-SocherEtAl2013:RNTN" class="csl-entry">
Socher, Richard, Alex Perelygin, Jean Wu, Jason Chuang, Christopher Manning, Andrew Ng, and Christopher Potts. 2013. <span>“<span>Parsing With Compositional Vector Grammars</span>.”</span> In <em><span>EMNLP</span></em>.
</div>
<div id="ref-TFDS" class="csl-entry">
<span>“<span>TensorFlow Datasets</span>, a Collection of Ready-to-Use Datasets.”</span> 2021. <a href="https://www.tensorflow.org/datasets">https://www.tensorflow.org/datasets</a>.
</div>
<div id="ref-Watson" class="csl-entry">
Watson, Geoffrey S. 1964. <span>“Smooth Regression Analysis.”</span> <em>Sankhyā: The Indian Journal of Statistics, Series A (1961-2002)</em> 26 (4): 359–72. <a href="http://www.jstor.org/stable/25049340">http://www.jstor.org/stable/25049340</a>.
</div>
<div id="ref-ggplot2" class="csl-entry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-gog" class="csl-entry">
Wilkinson, Leland. 2005. <em>The Grammar of Graphics (Statistics and Computing)</em>. Berlin, Heidelberg: Springer-Verlag.
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>You can use this symbol in R, too, but it is less common.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>If you did not install <code>Anaconda</code>, then this may not work for you because this is an IPython (<a href="https://ipython.org" class="uri">https://ipython.org</a>) feature.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>“double” is short for “double precision floating point.” In other programming languages, the programmer might choose how many decimal points of precision he or she wants.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Do not worry too much about the properties of these matrices for this problem<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Again, do not worry too much about the properties of these matrices for this problem.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Primitive functions are functions that contain no R code and are internally implemented in C. These are the only type of function in R that don’t have a parent environment.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>You might have noticed that Python uses two different words to prevent confusion. Unlike R, Python uses the word “parameter” (instead of “argument”) to refer to the inputs a function takes, and “arguments” to the specific values a user plugs in.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Functions aren’t the only thing that get their own namespace. <a href="https://docs.python.org/3/tutorial/classes.html#a-first-look-at-classes">Classes do, too</a>. More information on classes is provided in Chapter @ref(an-introduction-to-object-oriented-programming)<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>There are some exceptions to this, but it’s generally true.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Open raw text files with text editor programs, not with programs that perform any kind of processing. For instance, if you open it with Microsoft Excel, the appearance of the data will change, and important information helping you to read your data into R or Python will not be available to you.<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>A list of more options of encodings that are built into Python,are available <a href="https://docs.python.org/3/library/codecs.html#standard-encodings">here.</a><a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>The <a href="https://docs.python.org/2/library/pickle.html">documentation for <code>pickle</code></a> mentions that the library is “not secure against erroneous or maliciously constructed data” and recommends that you “[n]ever unpickle data received from an untrusted or unauthenticated source.”<a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>I am avoiding any mention of <em>R’s</em> namespaces and modules. These are things that exist, but they are different from Python’s namespaces and modules, and are not within the scope of this text.<a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>The scripts you write are modules. They usually come with the intention of being run from start to finish. Other non-script modules are just a bag of definitions to be used in other places.<a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>Sometimes a package is called a <em>library</em> but I will avoid this terminology.<a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>This is the density of a <span class="math inline">\(\text{Beta}(3,2)\)</span> random variable, if you’re curious.<a href="#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>Personally, I find its syntax more confusing, and so I tend to prefer base graphics. However, it is popular at the moment, and so I do believe that it is important to mention here in this text.<a href="#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p>We didn’t talk about <code>tuple</code>s in chapter 2, but you can think of them as being similar to <code>list</code>s. They are containers that can hold elements of different types. There are a few key differences, though: they are made with parentheses (e.g. <code>('a')</code> ) instead of square brackets, and they are immutable instead of mutable.<a href="#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>The dollar sign is useful if you only want to find certain patterns that finish a line. It takes the characters preceding it, and says, only look for that pattern if it comes at the end of a string.<a href="#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>Just because you can do this, doesn’t mean you <em>should</em>, though!<a href="#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>Otherwise known as an independent and identically distributed sample<a href="#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>It’s defined as <span class="math inline">\(\hat{F}(x) = \frac{1}{n}\sum_{i=1}^n \mathbf{1}(X_i \le x)\)</span>.<a href="#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p>Even though this book only discusses <em>one</em> of our languages of interest, this quote applies to both langauges.<a href="#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p><code>apply()</code> is everyone’s favorite whipping boy whenever it comes to comparing <code>apply()</code> against the other <code>*apply()</code> functions. This is because it is generally a little slower–it is written in R and doesn’t call out to compiled C code. However, in my humble opinion, it doesn’t matter all that much because the fractions of a second saved don’t always add up in practice. <a href="#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>Although, it is still variadic. The difference is that the <code>dot-dot-dot</code> symbol does not refer to a varying number of <code>data.frame</code>s…just a varying number of other things we don’t care about at the present moment.<a href="#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p>You should know that a lot of special-case functions that you typically apply to rows or columns come built-in as <code>DataFrame</code> methods. For instance, <code>.mean()</code> would allow you to do something like <code>my_df.mean()</code>.<a href="#fnref26" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
